(self.webpackChunktraquing_app=self.webpackChunktraquing_app||[]).push([[179],{255:Et=>{function Re(Ie){return Promise.resolve().then(()=>{var Le=new Error("Cannot find module '"+Ie+"'");throw Le.code="MODULE_NOT_FOUND",Le})}Re.keys=()=>[],Re.resolve=Re,Re.id=255,Et.exports=Re},591:Et=>{function Re(Ie){this.ms=(Ie=Ie||{}).min||100,this.max=Ie.max||1e4,this.factor=Ie.factor||2,this.jitter=Ie.jitter>0&&Ie.jitter<=1?Ie.jitter:0,this.attempts=0}Et.exports=Re,Re.prototype.duration=function(){var Ie=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var Le=Math.random(),Je=Math.floor(Le*this.jitter*Ie);Ie=0==(1&Math.floor(10*Le))?Ie-Je:Ie+Je}return 0|Math.min(Ie,this.max)},Re.prototype.reset=function(){this.attempts=0},Re.prototype.setMin=function(Ie){this.ms=Ie},Re.prototype.setMax=function(Ie){this.max=Ie},Re.prototype.setJitter=function(Ie){this.jitter=Ie}},846:(Et,Re)=>{!function(Ie){"use strict";Re.encode=function(Le){var qe,Je=new Uint8Array(Le),d=Je.length,Pe="";for(qe=0;qe<d;qe+=3)Pe+=Ie[Je[qe]>>2],Pe+=Ie[(3&Je[qe])<<4|Je[qe+1]>>4],Pe+=Ie[(15&Je[qe+1])<<2|Je[qe+2]>>6],Pe+=Ie[63&Je[qe+2]];return d%3==2?Pe=Pe.substring(0,Pe.length-1)+"=":d%3==1&&(Pe=Pe.substring(0,Pe.length-2)+"=="),Pe},Re.decode=function(Le){var d,Be,Me,q,ne,Je=.75*Le.length,qe=Le.length,Pe=0;"="===Le[Le.length-1]&&(Je--,"="===Le[Le.length-2]&&Je--);var ye=new ArrayBuffer(Je),K=new Uint8Array(ye);for(d=0;d<qe;d+=4)Be=Ie.indexOf(Le[d]),Me=Ie.indexOf(Le[d+1]),q=Ie.indexOf(Le[d+2]),ne=Ie.indexOf(Le[d+3]),K[Pe++]=Be<<2|Me>>4,K[Pe++]=(15&Me)<<4|q>>2,K[Pe++]=(3&q)<<6|63&ne;return ye}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},899:Et=>{function Re(Le){if(Le)return function(Le){for(var Je in Re.prototype)Le[Je]=Re.prototype[Je];return Le}(Le)}Et.exports=Re,Re.prototype.on=Re.prototype.addEventListener=function(Le,Je){return this._callbacks=this._callbacks||{},(this._callbacks["$"+Le]=this._callbacks["$"+Le]||[]).push(Je),this},Re.prototype.once=function(Le,Je){function qe(){this.off(Le,qe),Je.apply(this,arguments)}return qe.fn=Je,this.on(Le,qe),this},Re.prototype.off=Re.prototype.removeListener=Re.prototype.removeAllListeners=Re.prototype.removeEventListener=function(Le,Je){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var qe=this._callbacks["$"+Le];if(!qe)return this;if(1==arguments.length)return delete this._callbacks["$"+Le],this;for(var d,Pe=0;Pe<qe.length;Pe++)if((d=qe[Pe])===Je||d.fn===Je){qe.splice(Pe,1);break}return 0===qe.length&&delete this._callbacks["$"+Le],this},Re.prototype.emit=function(Le){this._callbacks=this._callbacks||{};for(var Je=new Array(arguments.length-1),qe=this._callbacks["$"+Le],d=1;d<arguments.length;d++)Je[d-1]=arguments[d];if(qe){d=0;for(var Pe=(qe=qe.slice(0)).length;d<Pe;++d)qe[d].apply(this,Je)}return this},Re.prototype.listeners=function(Le){return this._callbacks=this._callbacks||{},this._callbacks["$"+Le]||[]},Re.prototype.hasListeners=function(Le){return!!this.listeners(Le).length}},36:(Et,Re,Ie)=>{Re.formatArgs=function(Me){if(Me[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+Me[0]+(this.useColors?"%c ":" ")+"+"+Et.exports.humanize(this.diff),!this.useColors)return;const q="color: "+this.color;Me.splice(1,0,q,"color: inherit");let ne=0,ye=0;Me[0].replace(/%[a-zA-Z%]/g,K=>{"%%"!==K&&(ne++,"%c"===K&&(ye=ne))}),Me.splice(ye,0,q)},Re.save=function(Me){try{Me?Re.storage.setItem("debug",Me):Re.storage.removeItem("debug")}catch(q){}},Re.load=function(){let Me;try{Me=Re.storage.getItem("debug")}catch(q){}return!Me&&"undefined"!=typeof process&&"env"in process&&(Me=process.env.DEBUG),Me},Re.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},Re.storage=function(){try{return localStorage}catch(Me){}}(),Re.destroy=(()=>{let Me=!1;return()=>{Me||(Me=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),Re.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],Re.log=console.debug||console.log||(()=>{}),Et.exports=Ie(859)(Re);const{formatters:Be}=Et.exports;Be.j=function(Me){try{return JSON.stringify(Me)}catch(q){return"[UnexpectedJSONParseError]: "+q.message}}},859:(Et,Re,Ie)=>{Et.exports=function(Je){function d(ae){let Ne,ct,xt,nt=null;function jt(...Gn){if(!jt.enabled)return;const wn=jt,Ai=Number(new Date);wn.diff=Ai-(Ne||Ai),wn.prev=Ne,wn.curr=Ai,Ne=Ai,Gn[0]=d.coerce(Gn[0]),"string"!=typeof Gn[0]&&Gn.unshift("%O");let ji=0;Gn[0]=Gn[0].replace(/%([a-zA-Z%])/g,(Qs,Al)=>{if("%%"===Qs)return"%";ji++;const qr=d.formatters[Al];return"function"==typeof qr&&(Qs=qr.call(wn,Gn[ji]),Gn.splice(ji,1),ji--),Qs}),d.formatArgs.call(wn,Gn),(wn.log||d.log).apply(wn,Gn)}return jt.namespace=ae,jt.useColors=d.useColors(),jt.color=d.selectColor(ae),jt.extend=Pe,jt.destroy=d.destroy,Object.defineProperty(jt,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==nt?nt:(ct!==d.namespaces&&(ct=d.namespaces,xt=d.enabled(ae)),xt),set:Gn=>{nt=Gn}}),"function"==typeof d.init&&d.init(jt),jt}function Pe(ae,Ne){const nt=d(this.namespace+(void 0===Ne?":":Ne)+ae);return nt.log=this.log,nt}function ne(ae){return ae.toString().substring(2,ae.toString().length-2).replace(/\.\*\?$/,"*")}return d.debug=d,d.default=d,d.coerce=function(ae){return ae instanceof Error?ae.stack||ae.message:ae},d.disable=function(){const ae=[...d.names.map(ne),...d.skips.map(ne).map(Ne=>"-"+Ne)].join(",");return d.enable(""),ae},d.enable=function(ae){let Ne;d.save(ae),d.namespaces=ae,d.names=[],d.skips=[];const nt=("string"==typeof ae?ae:"").split(/[\s,]+/),ct=nt.length;for(Ne=0;Ne<ct;Ne++)!nt[Ne]||("-"===(ae=nt[Ne].replace(/\*/g,".*?"))[0]?d.skips.push(new RegExp("^"+ae.substr(1)+"$")):d.names.push(new RegExp("^"+ae+"$")))},d.enabled=function(ae){if("*"===ae[ae.length-1])return!0;let Ne,nt;for(Ne=0,nt=d.skips.length;Ne<nt;Ne++)if(d.skips[Ne].test(ae))return!1;for(Ne=0,nt=d.names.length;Ne<nt;Ne++)if(d.names[Ne].test(ae))return!0;return!1},d.humanize=Ie(862),d.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(Je).forEach(ae=>{d[ae]=Je[ae]}),d.names=[],d.skips=[],d.formatters={},d.selectColor=function(ae){let Ne=0;for(let nt=0;nt<ae.length;nt++)Ne=(Ne<<5)-Ne+ae.charCodeAt(nt),Ne|=0;return d.colors[Math.abs(Ne)%d.colors.length]},d.enable(d.load()),d}},748:Et=>{Et.exports="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},338:(Et,Re,Ie)=>{const Le=Ie(547);Et.exports=(Je,qe)=>new Le(Je,qe),Et.exports.Socket=Le,Et.exports.protocol=Le.protocol,Et.exports.Transport=Ie(505),Et.exports.transports=Ie(674),Et.exports.parser=Ie(416)},547:(Et,Re,Ie)=>{const Le=Ie(674),Je=Ie(899),qe=Ie(36)("engine.io-client:socket"),d=Ie(416),Pe=Ie(171),Be=Ie(603),{installTimerFunctions:Me}=Ie(118);class q extends Je{constructor(K,ae={}){super(),K&&"object"==typeof K&&(ae=K,K=null),K?(K=Pe(K),ae.hostname=K.host,ae.secure="https"===K.protocol||"wss"===K.protocol,ae.port=K.port,K.query&&(ae.query=K.query)):ae.host&&(ae.hostname=Pe(ae.host).host),Me(this,ae),this.secure=null!=ae.secure?ae.secure:"undefined"!=typeof location&&"https:"===location.protocol,ae.hostname&&!ae.port&&(ae.port=this.secure?"443":"80"),this.hostname=ae.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=ae.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.transports=ae.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,jsonp:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},ae),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=Be.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(K){qe('creating transport "%s"',K);const ae=function(ye){const K={};for(let ae in ye)ye.hasOwnProperty(ae)&&(K[ae]=ye[ae]);return K}(this.opts.query);ae.EIO=d.protocol,ae.transport=K,this.id&&(ae.sid=this.id);const Ne=Object.assign({},this.opts.transportOptions[K],this.opts,{query:ae,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return qe("options: %j",Ne),new Le[K](Ne)}open(){let K;if(this.opts.rememberUpgrade&&q.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))K="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emit("error","No transports available")},0);K=this.transports[0]}this.readyState="opening";try{K=this.createTransport(K)}catch(ae){return qe("error while creating transport: %s",ae),this.transports.shift(),void this.open()}K.open(),this.setTransport(K)}setTransport(K){qe("setting transport %s",K.name),this.transport&&(qe("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=K,K.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(K){qe('probing transport "%s"',K);let ae=this.createTransport(K,{probe:1}),Ne=!1;q.priorWebsocketSuccess=!1;const nt=()=>{Ne||(qe('probe transport "%s" opened',K),ae.send([{type:"ping",data:"probe"}]),ae.once("packet",Gr=>{if(!Ne)if("pong"===Gr.type&&"probe"===Gr.data){if(qe('probe transport "%s" pong',K),this.upgrading=!0,this.emit("upgrading",ae),!ae)return;q.priorWebsocketSuccess="websocket"===ae.name,qe('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{Ne||"closed"!==this.readyState&&(qe("changing transport and sending upgrade packet"),Ai(),this.setTransport(ae),ae.send([{type:"upgrade"}]),this.emit("upgrade",ae),ae=null,this.upgrading=!1,this.flush())})}else{qe('probe transport "%s" failed',K);const ji=new Error("probe error");ji.transport=ae.name,this.emit("upgradeError",ji)}}))};function ct(){Ne||(Ne=!0,Ai(),ae.close(),ae=null)}const xt=Gr=>{const ji=new Error("probe error: "+Gr);ji.transport=ae.name,ct(),qe('probe transport "%s" failed because of error: %s',K,Gr),this.emit("upgradeError",ji)};function jt(){xt("transport closed")}function Gn(){xt("socket closed")}function wn(Gr){ae&&Gr.name!==ae.name&&(qe('"%s" works - aborting "%s"',Gr.name,ae.name),ct())}const Ai=()=>{ae.removeListener("open",nt),ae.removeListener("error",xt),ae.removeListener("close",jt),this.removeListener("close",Gn),this.removeListener("upgrading",wn)};ae.once("open",nt),ae.once("error",xt),ae.once("close",jt),this.once("close",Gn),this.once("upgrading",wn),ae.open()}onOpen(){if(qe("socket open"),this.readyState="open",q.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){qe("starting upgrade probes");let K=0;const ae=this.upgrades.length;for(;K<ae;K++)this.probe(this.upgrades[K])}}onPacket(K){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(qe('socket receive: type "%s", data "%s"',K.type,K.data),this.emit("packet",K),this.emit("heartbeat"),K.type){case"open":this.onHandshake(JSON.parse(K.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emit("ping"),this.emit("pong");break;case"error":const ae=new Error("server error");ae.code=K.data,this.onError(ae);break;case"message":this.emit("data",K.data),this.emit("message",K.data)}else qe('packet received with socket readyState "%s"',this.readyState)}onHandshake(K){this.emit("handshake",K),this.id=K.sid,this.transport.query.sid=K.sid,this.upgrades=this.filterUpgrades(K.upgrades),this.pingInterval=K.pingInterval,this.pingTimeout=K.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(qe("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))}write(K,ae,Ne){return this.sendPacket("message",K,ae,Ne),this}send(K,ae,Ne){return this.sendPacket("message",K,ae,Ne),this}sendPacket(K,ae,Ne,nt){if("function"==typeof ae&&(nt=ae,ae=void 0),"function"==typeof Ne&&(nt=Ne,Ne=null),"closing"===this.readyState||"closed"===this.readyState)return;(Ne=Ne||{}).compress=!1!==Ne.compress;const ct={type:K,data:ae,options:Ne};this.emit("packetCreate",ct),this.writeBuffer.push(ct),nt&&this.once("flush",nt),this.flush()}close(){const K=()=>{this.onClose("forced close"),qe("socket closing - telling transport to close"),this.transport.close()},ae=()=>{this.removeListener("upgrade",ae),this.removeListener("upgradeError",ae),K()},Ne=()=>{this.once("upgrade",ae),this.once("upgradeError",ae)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?Ne():K()}):this.upgrading?Ne():K()),this}onError(K){qe("socket error %j",K),q.priorWebsocketSuccess=!1,this.emit("error",K),this.onClose("transport error",K)}onClose(K,ae){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(qe('socket close with reason: "%s"',K),this.clearTimeoutFn(this.pingIntervalTimer),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emit("close",K,ae),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(K){const ae=[];let Ne=0;const nt=K.length;for(;Ne<nt;Ne++)~this.transports.indexOf(K[Ne])&&ae.push(K[Ne]);return ae}}q.priorWebsocketSuccess=!1,q.protocol=d.protocol,Et.exports=q},505:(Et,Re,Ie)=>{const Le=Ie(416),Je=Ie(899),{installTimerFunctions:qe}=Ie(118),d=Ie(36)("engine.io-client:transport");Et.exports=class extends Je{constructor(Me){super(),qe(this,Me),this.opts=Me,this.query=Me.query,this.readyState="",this.socket=Me.socket}onError(Me,q){const ne=new Error(Me);return ne.type="TransportError",ne.description=q,this.emit("error",ne),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(Me){"open"===this.readyState?this.write(Me):d("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,this.emit("open")}onData(Me){const q=Le.decodePacket(Me,this.socket.binaryType);this.onPacket(q)}onPacket(Me){this.emit("packet",Me)}onClose(){this.readyState="closed",this.emit("close")}}},674:(Et,Re,Ie)=>{const Le=Ie(737),Je=Ie(706),qe=Ie(662),d=Ie(677);Re.polling=function(Be){let Me,q=!1,ne=!1;const ye=!1!==Be.jsonp;if("undefined"!=typeof location){const K="https:"===location.protocol;let ae=location.port;ae||(ae=K?443:80),q=Be.hostname!==location.hostname||ae!==Be.port,ne=Be.secure!==K}if(Be.xdomain=q,Be.xscheme=ne,Me=new Le(Be),"open"in Me&&!Be.forceJSONP)return new Je(Be);if(!ye)throw new Error("JSONP disabled");return new qe(Be)},Re.websocket=d},662:(Et,Re,Ie)=>{const Le=Ie(685),Je=Ie(748),qe=/\n/g,d=/\\n/g;let Pe;Et.exports=class extends Le{constructor(q){super(q),this.query=this.query||{},Pe||(Pe=Je.___eio=Je.___eio||[]),this.index=Pe.length,Pe.push(this.onData.bind(this)),this.query.j=this.index}get supportsBinary(){return!1}doClose(){this.script&&(this.script.onerror=()=>{},this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),super.doClose()}doPoll(){const q=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),q.async=!0,q.src=this.uri(),q.onerror=K=>{this.onError("jsonp poll error",K)};const ne=document.getElementsByTagName("script")[0];ne?ne.parentNode.insertBefore(q,ne):(document.head||document.body).appendChild(q),this.script=q,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&this.setTimeoutFn(function(){const K=document.createElement("iframe");document.body.appendChild(K),document.body.removeChild(K)},100)}doWrite(q,ne){let ye;if(!this.form){const Ne=document.createElement("form"),nt=document.createElement("textarea"),ct=this.iframeId="eio_iframe_"+this.index;Ne.className="socketio",Ne.style.position="absolute",Ne.style.top="-1000px",Ne.style.left="-1000px",Ne.target=ct,Ne.method="POST",Ne.setAttribute("accept-charset","utf-8"),nt.name="d",Ne.appendChild(nt),document.body.appendChild(Ne),this.form=Ne,this.area=nt}function K(){ae(),ne()}this.form.action=this.uri();const ae=()=>{if(this.iframe)try{this.form.removeChild(this.iframe)}catch(Ne){this.onError("jsonp polling iframe removal error",Ne)}try{ye=document.createElement('<iframe src="javascript:0" name="'+this.iframeId+'">')}catch(Ne){ye=document.createElement("iframe"),ye.name=this.iframeId,ye.src="javascript:0"}ye.id=this.iframeId,this.form.appendChild(ye),this.iframe=ye};ae(),q=q.replace(d,"\\\n"),this.area.value=q.replace(qe,"\\n");try{this.form.submit()}catch(Ne){}this.iframe.attachEvent?this.iframe.onreadystatechange=()=>{"complete"===this.iframe.readyState&&K()}:this.iframe.onload=K}}},706:(Et,Re,Ie)=>{const Le=Ie(737),Je=Ie(685),qe=Ie(899),{pick:d,installTimerFunctions:Pe}=Ie(118),Be=Ie(748),Me=Ie(36)("engine.io-client:polling-xhr");function q(){}const ne=null!=new Le({xdomain:!1}).responseType;let K=(()=>{class Ne extends qe{constructor(ct,xt){super(),Pe(this,xt),this.opts=xt,this.method=xt.method||"GET",this.uri=ct,this.async=!1!==xt.async,this.data=void 0!==xt.data?xt.data:null,this.create()}create(){const ct=d(this.opts,"agent","enablesXDR","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");ct.xdomain=!!this.opts.xd,ct.xscheme=!!this.opts.xs;const xt=this.xhr=new Le(ct);try{Me("xhr open %s: %s",this.method,this.uri),xt.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){xt.setDisableHeaderCheck&&xt.setDisableHeaderCheck(!0);for(let jt in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(jt)&&xt.setRequestHeader(jt,this.opts.extraHeaders[jt])}}catch(jt){}if("POST"===this.method)try{xt.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(jt){}try{xt.setRequestHeader("Accept","*/*")}catch(jt){}"withCredentials"in xt&&(xt.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(xt.timeout=this.opts.requestTimeout),this.hasXDR()?(xt.onload=()=>{this.onLoad()},xt.onerror=()=>{this.onError(xt.responseText)}):xt.onreadystatechange=()=>{4===xt.readyState&&(200===xt.status||1223===xt.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof xt.status?xt.status:0)},0))},Me("xhr data %s",this.data),xt.send(this.data)}catch(jt){return void this.setTimeoutFn(()=>{this.onError(jt)},0)}"undefined"!=typeof document&&(this.index=Ne.requestsCount++,Ne.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(ct){this.emit("data",ct),this.onSuccess()}onError(ct){this.emit("error",ct),this.cleanup(!0)}cleanup(ct){if(null!=this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=q:this.xhr.onreadystatechange=q,ct)try{this.xhr.abort()}catch(xt){}"undefined"!=typeof document&&delete Ne.requests[this.index],this.xhr=null}}onLoad(){const ct=this.xhr.responseText;null!==ct&&this.onData(ct)}hasXDR(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR}abort(){this.cleanup()}}return Ne.requestsCount=0,Ne.requests={},Ne})();function ae(){for(let Ne in K.requests)K.requests.hasOwnProperty(Ne)&&K.requests[Ne].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ae):"function"==typeof addEventListener&&addEventListener("onpagehide"in Be?"pagehide":"unload",ae,!1)),Et.exports=class extends Je{constructor(nt){if(super(nt),"undefined"!=typeof location){const xt="https:"===location.protocol;let jt=location.port;jt||(jt=xt?443:80),this.xd="undefined"!=typeof location&&nt.hostname!==location.hostname||jt!==nt.port,this.xs=nt.secure!==xt}this.supportsBinary=ne&&!(nt&&nt.forceBase64)}request(nt={}){return Object.assign(nt,{xd:this.xd,xs:this.xs},this.opts),new K(this.uri(),nt)}doWrite(nt,ct){const xt=this.request({method:"POST",data:nt});xt.on("success",ct),xt.on("error",jt=>{this.onError("xhr post error",jt)})}doPoll(){Me("xhr poll");const nt=this.request();nt.on("data",this.onData.bind(this)),nt.on("error",ct=>{this.onError("xhr poll error",ct)}),this.pollXhr=nt}},Et.exports.Request=K},685:(Et,Re,Ie)=>{const Le=Ie(505),Je=Ie(603),qe=Ie(416),d=Ie(391),Pe=Ie(36)("engine.io-client:polling");Et.exports=class extends Le{get name(){return"polling"}doOpen(){this.poll()}pause(q){this.readyState="pausing";const ne=()=>{Pe("paused"),this.readyState="paused",q()};if(this.polling||!this.writable){let ye=0;this.polling&&(Pe("we are currently polling - waiting to pause"),ye++,this.once("pollComplete",function(){Pe("pre-pause polling complete"),--ye||ne()})),this.writable||(Pe("we are currently writing - waiting to pause"),ye++,this.once("drain",function(){Pe("pre-pause writing complete"),--ye||ne()}))}else ne()}poll(){Pe("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(q){Pe("polling got data %s",q),qe.decodePayload(q,this.socket.binaryType).forEach(ye=>{if("opening"===this.readyState&&"open"===ye.type&&this.onOpen(),"close"===ye.type)return this.onClose(),!1;this.onPacket(ye)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():Pe('ignoring poll - transport state "%s"',this.readyState))}doClose(){const q=()=>{Pe("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(Pe("transport open - closing"),q()):(Pe("transport not open - deferring close"),this.once("open",q))}write(q){this.writable=!1,qe.encodePayload(q,ne=>{this.doWrite(ne,()=>{this.writable=!0,this.emit("drain")})})}uri(){let q=this.query||{};const ne=this.opts.secure?"https":"http";let ye="";return!1!==this.opts.timestampRequests&&(q[this.opts.timestampParam]=d()),!this.supportsBinary&&!q.sid&&(q.b64=1),q=Je.encode(q),this.opts.port&&("https"===ne&&443!==Number(this.opts.port)||"http"===ne&&80!==Number(this.opts.port))&&(ye=":"+this.opts.port),q.length&&(q="?"+q),ne+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+ye+this.opts.path+q}}},559:(Et,Re,Ie)=>{const Le=Ie(748);Et.exports={WebSocket:Le.WebSocket||Le.MozWebSocket,usingBrowserWebSocket:!0,defaultBinaryType:"arraybuffer",nextTick:"function"==typeof Promise&&"function"==typeof Promise.resolve?d=>Promise.resolve().then(d):(d,Pe)=>Pe(d,0)}},677:(Et,Re,Ie)=>{const Le=Ie(505),Je=Ie(416),qe=Ie(603),d=Ie(391),{pick:Pe}=Ie(118),{WebSocket:Be,usingBrowserWebSocket:Me,defaultBinaryType:q,nextTick:ne}=Ie(559),ye=Ie(36)("engine.io-client:websocket"),K="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class ae extends Le{constructor(nt){super(nt),this.supportsBinary=!nt.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const nt=this.uri(),ct=this.opts.protocols,xt=K?{}:Pe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(xt.headers=this.opts.extraHeaders);try{this.ws=Me&&!K?ct?new Be(nt,ct):new Be(nt):new Be(nt,ct,xt)}catch(jt){return this.emit("error",jt)}this.ws.binaryType=this.socket.binaryType||q,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=nt=>this.onData(nt.data),this.ws.onerror=nt=>this.onError("websocket error",nt)}write(nt){this.writable=!1;for(let ct=0;ct<nt.length;ct++){const xt=nt[ct],jt=ct===nt.length-1;Je.encodePacket(xt,this.supportsBinary,Gn=>{const wn={};Me||(xt.options&&(wn.compress=xt.options.compress),this.opts.perMessageDeflate&&("string"==typeof Gn?Buffer.byteLength(Gn):Gn.length)<this.opts.perMessageDeflate.threshold&&(wn.compress=!1));try{Me?this.ws.send(Gn):this.ws.send(Gn,wn)}catch(Ai){ye("websocket closed before onclose event")}jt&&ne(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}onClose(){Le.prototype.onClose.call(this)}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let nt=this.query||{};const ct=this.opts.secure?"wss":"ws";let xt="";return this.opts.port&&("wss"===ct&&443!==Number(this.opts.port)||"ws"===ct&&80!==Number(this.opts.port))&&(xt=":"+this.opts.port),this.opts.timestampRequests&&(nt[this.opts.timestampParam]=d()),this.supportsBinary||(nt.b64=1),nt=qe.encode(nt),nt.length&&(nt="?"+nt),ct+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+xt+this.opts.path+nt}check(){return!(!Be||"__initialize"in Be&&this.name===ae.prototype.name)}}Et.exports=ae},118:(Et,Re,Ie)=>{const Le=Ie(748);Et.exports.pick=(d,...Pe)=>Pe.reduce((Be,Me)=>(d.hasOwnProperty(Me)&&(Be[Me]=d[Me]),Be),{});const Je=setTimeout,qe=clearTimeout;Et.exports.installTimerFunctions=(d,Pe)=>{Pe.useNativeTimers?(d.setTimeoutFn=Je.bind(Le),d.clearTimeoutFn=qe.bind(Le)):(d.setTimeoutFn=setTimeout.bind(Le),d.clearTimeoutFn=clearTimeout.bind(Le))}},737:(Et,Re,Ie)=>{const Le=Ie(966),Je=Ie(748);Et.exports=function(qe){const d=qe.xdomain,Pe=qe.xscheme,Be=qe.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!d||Le))return new XMLHttpRequest}catch(Me){}try{if("undefined"!=typeof XDomainRequest&&!Pe&&Be)return new XDomainRequest}catch(Me){}if(!d)try{return new(Je[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Me){}}},992:Et=>{const Re=Object.create(null);Re.open="0",Re.close="1",Re.ping="2",Re.pong="3",Re.message="4",Re.upgrade="5",Re.noop="6";const Ie=Object.create(null);Object.keys(Re).forEach(Je=>{Ie[Re[Je]]=Je}),Et.exports={PACKET_TYPES:Re,PACKET_TYPES_REVERSE:Ie,ERROR_PACKET:{type:"error",data:"parser error"}}},314:(Et,Re,Ie)=>{const{PACKET_TYPES_REVERSE:Le,ERROR_PACKET:Je}=Ie(992);let d;"function"==typeof ArrayBuffer&&(d=Ie(846));const Be=(q,ne)=>{if(d){const ye=d.decode(q);return Me(ye,ne)}return{base64:!0,data:q}},Me=(q,ne)=>{switch(ne){case"blob":return q instanceof ArrayBuffer?new Blob([q]):q;case"arraybuffer":default:return q}};Et.exports=(q,ne)=>{if("string"!=typeof q)return{type:"message",data:Me(q,ne)};const ye=q.charAt(0);return"b"===ye?{type:"message",data:Be(q.substring(1),ne)}:Le[ye]?q.length>1?{type:Le[ye],data:q.substring(1)}:{type:Le[ye]}:Je}},109:(Et,Re,Ie)=>{const{PACKET_TYPES:Le}=Ie(992),Je="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),qe="function"==typeof ArrayBuffer,Be=(Me,q)=>{const ne=new FileReader;return ne.onload=function(){const ye=ne.result.split(",")[1];q("b"+ye)},ne.readAsDataURL(Me)};Et.exports=({type:Me,data:q},ne,ye)=>Je&&q instanceof Blob?ne?ye(q):Be(q,ye):qe&&(q instanceof ArrayBuffer||(Me=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(Me):Me&&Me.buffer instanceof ArrayBuffer)(q))?ne?ye(q):Be(new Blob([q]),ye):ye(Le[Me]+(q||""))},416:(Et,Re,Ie)=>{const Le=Ie(109),Je=Ie(314),qe=String.fromCharCode(30);Et.exports={protocol:4,encodePacket:Le,encodePayload:(Be,Me)=>{const q=Be.length,ne=new Array(q);let ye=0;Be.forEach((K,ae)=>{Le(K,!1,Ne=>{ne[ae]=Ne,++ye===q&&Me(ne.join(qe))})})},decodePacket:Je,decodePayload:(Be,Me)=>{const q=Be.split(qe),ne=[];for(let ye=0;ye<q.length;ye++){const K=Je(q[ye],Me);if(ne.push(K),"error"===K.type)break}return ne}}},966:Et=>{try{Et.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Re){Et.exports=!1}},958:function(Et){Et.exports=function(){"use strict";var Re,Ie,Le;function Je(d,Pe){if(Re)if(Ie){var Be="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+Re+")(sharedChunk); ("+Ie+")(sharedChunk); self.onerror = null;",Me={};Re(Me),Le=Pe(Me),"undefined"!=typeof window&&(Le.workerUrl=window.URL.createObjectURL(new Blob([Be],{type:"text/javascript"})))}else Ie=Pe;else Re=Pe}return Je(0,function(d){var Be=Me;function Me(a,r,l,u){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=u,this.p2x=l,this.p2y=u}Me.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Me.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Me.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Me.prototype.solveCurveX=function(a,r){var l,u,p,_,v;for(void 0===r&&(r=1e-6),p=a,v=0;v<8;v++){if(_=this.sampleCurveX(p)-a,Math.abs(_)<r)return p;var C=this.sampleCurveDerivativeX(p);if(Math.abs(C)<1e-6)break;p-=_/C}if((p=a)<(l=0))return l;if(p>(u=1))return u;for(;l<u;){if(_=this.sampleCurveX(p),Math.abs(_-a)<r)return p;a>_?l=p:u=p,p=.5*(u-l)+l}return p},Me.prototype.solve=function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))};var q=ne;function ne(a,r){this.x=a,this.y=r}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,l=a.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),l=Math.sin(a),u=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=u,this},_rotateAround:function(a,r){var l=Math.cos(a),u=Math.sin(a),p=r.y+u*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-u*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(a){return a instanceof ne?a:Array.isArray(a)?new ne(a[0],a[1]):a};var ye="undefined"!=typeof self?self:{};const K=Math.pow(2,53)-1,ae=Math.PI/180,Ne=180/Math.PI;function nt(a){return a*ae}const ct=[[0,0],[1,0],[1,1],[0,1]];function xt(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,l=r*a;return 4*(a<.5?l:3*(a-r)+l-.75)}function jt(a,r,l,u){const p=new Be(a,r,l,u);return function(_){return p.solve(_)}}const Gn=jt(.25,.1,.25,1);function wn(a,r,l){return Math.min(l,Math.max(r,a))}function Ai(a,r,l){const u=l-r,p=((a-r)%u+u)%u+r;return p===r?l:p}function Gr(a,r,l){if(!a.length)return l(null,[]);let u=a.length;const p=new Array(a.length);let _=null;a.forEach((v,C)=>{r(v,(D,M)=>{D&&(_=D),p[C]=M,0==--u&&l(_,p)})})}function ji(a){const r=[];for(const l in a)r.push(a[l]);return r}function Bt(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}let Qs=1;function Al(){return Qs++}function qr(){return function a(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function ea(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function kl(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function qn(a,r){a.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function As(a,r){return-1!==a.indexOf(r,a.length-r.length)}function Vo(a,r,l){const u={};for(const p in a)u[p]=r.call(l||this,a[p],p,a);return u}function Rt(a,r,l){const u={};for(const p in a)r.call(l||this,a[p],p,a)&&(u[p]=a[p]);return u}function fi(a){return Array.isArray(a)?a.map(fi):"object"==typeof a&&a?Vo(a,fi):a}const Pa={};function pi(a){Pa[a]||("undefined"!=typeof console&&console.warn(a),Pa[a]=!0)}function zo(a,r,l){return(l.y-a.y)*(r.x-a.x)>(r.y-a.y)*(l.x-a.x)}function wc(a){let r=0;for(let l,u,p=0,_=a.length,v=_-1;p<_;v=p++)l=a[p],u=a[v],r+=(u.x-l.x)*(l.y+u.y);return r}function Pr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Na(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,u,p,_)=>{const v=p||_;return r[u]=!v||v.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let ta,Cn,Ra,Pl=null;function Fa(a){if(null==Pl){const r=a.navigator?a.navigator.userAgent:null;Pl=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Pl}function Cc(a){try{const r=ye[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const no={now:()=>void 0!==Ra?Ra:ye.performance.now(),setNow(a){Ra=a},restoreNow(){Ra=void 0},frame(a){const r=ye.requestAnimationFrame(a);return{cancel:()=>ye.cancelAnimationFrame(r)}},getImageData(a,r=0){const l=ye.document.createElement("canvas"),u=l.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,u.drawImage(a,0,0,a.width,a.height),u.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(ta||(ta=ye.document.createElement("a")),ta.href=a,ta.href),get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(null==Cn&&(Cn=ye.matchMedia("(prefers-reduced-motion: reduce)")),Cn.matches)}};let Uo;const In={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Uo){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Uo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(r){Uo=a}}return Uo},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ls={supported:!1,testSupport:function(a){!xi&&ks&&(ia?Oa(a):na=a)}};let na,ks,xi=!1,ia=!1;function Oa(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ks),a.isContextLost())return;ls.supported=!0}catch(l){}a.deleteTexture(r),xi=!0}ye.document&&(ks=ye.document.createElement("img"),ks.onload=function(){na&&Oa(na),na=null,ia=!0},ks.onerror=function(){xi=!0,na=null},ks.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cs="01",Nl="NO_ACCESS_TOKEN";function Nr(a){return 0===a.indexOf("mapbox:")}function gi(a){return In.API_URL_REGEX.test(a)}const Dc=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Co(a){const r=a.match(Dc);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function La(a){const r=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${r}`}function mr(a){if(!a)return null;const r=a.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(ye.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class Ps{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=mr(In.ACCESS_TOKEN);let u="";return u=l&&l.u?ye.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,_)=>String.fromCharCode(Number("0x"+_)))):In.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const r=Cc("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const p=ye.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const _=ye.localStorage.getItem(u);_&&(this.anonId=_)}catch(p){pi("Unable to read from LocalStorage")}}saveEventData(){const r=Cc("localStorage"),l=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{ye.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(p){pi("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,u,p){if(!In.EVENTS_URL)return;const _=Co(In.EVENTS_URL);_.params.push(`access_token=${p||In.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:cs,userId:this.anonId},C=l?Bt(v,l):v,D={url:La(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=U(D,M=>{this.pendingRequest=null,u(M),this.saveEventData(),this.processRequests(p)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Ba=new class extends Ps{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,r){In.EVENTS_URL&&In.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>Nr(l)||gi(l))&&this.queueRequest(Date.now(),r)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=mr(In.ACCESS_TOKEN),l=r?r.u:In.ACCESS_TOKEN;let u=l!==this.eventData.tokenU;kl(this.anonId)||(this.anonId=qr(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;u=u||C>=1||C<-1||_.getDate()!==v.getDate()}else u=!0;if(!u)return this.processRequests();this.postEvent(p,{"enabled.telemetry":!1},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},a)}},Rl=Ba.postTurnstileEvent.bind(Ba),Fl=new class extends Ps{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,r,l,u){this.skuToken=r,this.errorCb=u,In.EVENTS_URL&&(l||In.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Nl)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),kl(this.anonId)||(this.anonId=qr()),this.postEvent(l,{skuToken:this.skuToken},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a))}},Ec=Fl.postMapLoadEvent.bind(Fl),Tc=new class extends Ps{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,r,l,u){if(!In.API_URL||!In.SESSION_PATH)return;const p=Co(In.API_URL+In.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${u||In.ACCESS_TOKEN||""}`);const _={url:La(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Y(_,v=>{this.pendingRequest=null,l(v),this.saveEventData(),this.processRequests(u)})}getSessionAPI(a,r,l,u){this.skuToken=r,this.errorCb=u,In.SESSION_PATH&&In.API_URL&&(l||In.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Nl)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},a)}},wh=Tc.getSessionAPI.bind(Tc),Va=new Set,Mc="mapbox-tiles";let Do,ra,_u=500,Sc=50;function us(){ye.caches&&!Do&&(Do=ye.caches.open(Mc))}function yn(a){const r=a.indexOf("?");return r<0?a:a.slice(0,r)}let Ns=1/0;const qt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(qt);class oa extends Error{constructor(r,l,u){401===l&&gi(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const hs=Pr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ye.location.protocol?ye.parent:ye).location.href,W=function(a,r){if(!(/^file:/.test(l=a.url)||/^file:/.test(hs())&&!/^\w+:/.test(l))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(u,p){const _=new ye.AbortController,v=new ye.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:hs(),signal:_.signal});let C=!1,D=!1;const M=(I=v.url).indexOf("sku=")>0&&gi(I);var I;"json"===u.type&&v.headers.set("Accept","application/json");const P=(B,G,Z)=>{if(D)return;if(B&&"SecurityError"!==B.message&&pi(B),G&&Z)return N(G);const re=Date.now();ye.fetch(v).then(ue=>{if(ue.ok){const ve=M?ue.clone():null;return N(ue,ve,re)}return p(new oa(ue.statusText,ue.status,u.url))}).catch(ue=>{20!==ue.code&&p(new Error(ue.message))})},N=(B,G,Z)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(re=>{D||(G&&Z&&function(ue,ve,Ee){if(us(),!Do)return;const Te={status:ve.status,statusText:ve.statusText,headers:new ye.Headers};ve.headers.forEach((Ae,He)=>Te.headers.set(He,Ae));const Se=Na(ve.headers.get("Cache-Control")||"");Se["no-store"]||(Se["max-age"]&&Te.headers.set("Expires",new Date(Ee+1e3*Se["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-Ee<42e4||function(Ae,He){if(void 0===ra)try{new Response(new ReadableStream),ra=!0}catch(We){ra=!1}ra?He(Ae.body):Ae.blob().then(He)}(ve,Ae=>{const He=new ye.Response(Ae,Te);us(),Do&&Do.then(We=>We.put(yn(ue.url),He)).catch(We=>pi(We.message))}))}(v,G,Z),C=!0,p(null,re,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(re=>{D||p(new Error(re.message))})};return M?function(B,G){if(us(),!Do)return G(null);const Z=yn(B.url);Do.then(re=>{re.match(Z).then(ue=>{const ve=function(Ee){if(!Ee)return!1;const Te=new Date(Ee.headers.get("Expires")||0),Se=Na(Ee.headers.get("Cache-Control")||"");return Te>Date.now()&&!Se["no-cache"]}(ue);re.delete(Z),ve&&re.put(Z,ue.clone()),G(null,ue,ve)}).catch(G)}).catch(G)}(v,P):P(null,null),{cancel:()=>{D=!0,C||_.abort()}}}(a,r);if(Pr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var l;return function(u,p){const _=new ye.XMLHttpRequest;_.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(_.responseType="arraybuffer");for(const v in u.headers)_.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===u.credentials,_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let v=_.response;if("json"===u.type)try{v=JSON.parse(_.response)}catch(C){return p(C)}p(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else p(new oa(_.statusText,_.status,u.url))},_.send(u.body),{cancel:()=>_.abort()}}(a,r)},F=function(a,r){return W(Bt(a,{type:"arrayBuffer"}),r)},U=function(a,r){return W(Bt(a,{method:"POST"}),r)},Y=function(a,r){return W(Bt(a,{method:"GET"}),r)};function ie(a){const r=ye.document.createElement("a");return r.href=a,r.protocol===ye.document.location.protocol&&r.host===ye.document.location.host}const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ce,fe;Ce=[],fe=0;const pe=function(a,r){if(ls.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),fe>=In.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ce.push(_),_}fe++;let l=!1;const u=()=>{if(!l)for(l=!0,fe--;Ce.length&&fe<In.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Ce.shift(),{requestParameters:v,callback:C,cancelled:D}=_;D||(_.cancel=pe(v,C).cancel)}},p=F(a,(_,v,C,D)=>{u(),_?r(_):v&&(ye.createImageBitmap?function(M,I){const P=new ye.Blob([new Uint8Array(M)],{type:"image/png"});ye.createImageBitmap(P).then(N=>{I(null,N)}).catch(N=>{I(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(M,I)=>r(M,I,C,D)):function(M,I){const P=new ye.Image,N=ye.URL;P.onload=()=>{I(null,P),N.revokeObjectURL(P.src),P.onload=null,ye.requestAnimationFrame(()=>{P.src=de})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new ye.Blob([new Uint8Array(M)],{type:"image/png"});P.src=M.byteLength?N.createObjectURL(B):de}(v,(M,I)=>r(M,I,C,D)))});return{cancel:()=>{p.cancel(),u()}}};function De(a,r,l){l[a]&&-1!==l[a].indexOf(r)||(l[a]=l[a]||[],l[a].push(r))}function Ge(a,r,l){if(l&&l[a]){const u=l[a].indexOf(r);-1!==u&&l[a].splice(u,1)}}class lt{constructor(r,l={}){Bt(this,l),this.type=r}}class Xe extends lt{constructor(r,l={}){super("error",Bt({error:r},l))}}class Ct{on(r,l){return this._listeners=this._listeners||{},De(r,l,this._listeners),this}off(r,l){return Ge(r,l,this._listeners),Ge(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},De(r,l,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,l){"string"==typeof r&&(r=new lt(r,l||{}));const u=r.type;if(this.listens(u)){r.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const C of p)C.call(this,r);const _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const C of _)Ge(u,C,this._oneTimeListeners),C.call(this,r);const v=this._eventedParent;v&&(Bt(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(r))}else r instanceof Xe&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Oe{constructor(r,l,u,p){this.message=(r?`${r}: `:"")+u,p&&(this.identifier=p),null!=l&&l.__line__&&(this.line=l.__line__)}}function Vt(a){const r=a.value;return r?[new Oe(a.key,r,"constants have been deprecated as of v8")]:[]}function zt(a,...r){for(const l of r)for(const u in l)a[u]=l[u];return a}function Ht(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Fn(a){if(Array.isArray(a))return a.map(Fn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const l in a)r[l]=Fn(a[l]);return r}return Ht(a)}class vn extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class oi{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[u,p]of l)this.bindings[u]=p}concat(r){return new oi(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Rs={kind:"null"},dt={kind:"number"},tn={kind:"string"},nn={kind:"boolean"},wi={kind:"color"},ln={kind:"object"},sn={kind:"value"},Ch={kind:"collator"},yu={kind:"formatted"},ht={kind:"resolvedImage"};function Eo(a,r){return{kind:"array",itemType:a,N:r}}function Pt(a){if("array"===a.kind){const r=Pt(a.itemType);return"number"==typeof a.N?`array<${r}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${r}>`}return a.kind}const ds=[Rs,dt,tn,nn,wi,yu,ln,Eo(sn),ht];function za(a,r){if("error"===r.kind)return null;if("array"===a.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!za(a.itemType,r.itemType))&&("number"!=typeof a.N||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if("value"===a.kind)for(const l of ds)if(!za(l,r))return null}return`Expected ${Pt(a)} but found ${Pt(r)} instead.`}function Ol(a,r){return r.some(l=>l.kind===a.kind)}function Ic(a,r){return r.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function fs(a){var r={exports:{}};return a(r,r.exports),r.exports}var Ll=fs(function(a,r){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(C){return(C=Math.round(C))<0?0:C>255?255:C}function p(C){return u("%"===C[C.length-1]?parseFloat(C)/100*255:parseInt(C))}function _(C){return(D="%"===C[C.length-1]?parseFloat(C)/100:parseFloat(C))<0?0:D>1?1:D;var D}function v(C,D,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?C+(D-C)*M*6:2*M<1?D:3*M<2?C+(D-C)*(2/3-M)*6:C}try{r.parseCSSColor=function(C){var D,M=C.replace(/ /g,"").toLowerCase();if(M in l)return l[M].slice();if("#"===M[0])return 4===M.length?(D=parseInt(M.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:7===M.length&&(D=parseInt(M.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var I=M.indexOf("("),P=M.indexOf(")");if(-1!==I&&P+1===M.length){var N=M.substr(0,I),B=M.substr(I+1,P-(I+1)).split(","),G=1;switch(N){case"rgba":if(4!==B.length)return null;G=_(B.pop());case"rgb":return 3!==B.length?null:[p(B[0]),p(B[1]),p(B[2]),G];case"hsla":if(4!==B.length)return null;G=_(B.pop());case"hsl":if(3!==B.length)return null;var Z=(parseFloat(B[0])%360+360)%360/360,re=_(B[1]),ue=_(B[2]),ve=ue<=.5?ue*(re+1):ue+re-ue*re,Ee=2*ue-ve;return[u(255*v(Ee,ve,Z+1/3)),u(255*v(Ee,ve,Z)),u(255*v(Ee,ve,Z-1/3)),G];default:return null}}return null}}catch(C){}});class Wt{constructor(r,l,u,p=1){this.r=r,this.g=l,this.b=u,this.a=p}static parse(r){if(!r)return;if(r instanceof Wt)return r;if("string"!=typeof r)return;const l=Ll.parseCSSColor(r);return l?new Wt(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,u,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(u)},${p})`}toArray(){const{r,g:l,b:u,a:p}=this;return 0===p?[0,0,0,0]:[255*r/p,255*l/p,255*u/p,p]}}Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1),Wt.blue=new Wt(0,0,1,1);class vu{constructor(r,l,u){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bu{constructor(r,l,u,p,_){this.text=r,this.image=l,this.scale=u,this.fontStack=p,this.textColor=_}}class Tt{constructor(r){this.sections=r}static fromString(r){return new Tt([new bu(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Tt?r:Tt.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const u={};l.fontStack&&(u["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(u["font-scale"]=l.scale),l.textColor&&(u["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(u)}return r}}class Rr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Rr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Zd(a,r,l,u){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[a,r,l,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[a,r,l,u]:[a,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $o(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof Wt||a instanceof vu||a instanceof Tt||a instanceof Rr)return!0;if(Array.isArray(a)){for(const r of a)if(!$o(r))return!1;return!0}if("object"==typeof a){for(const r in a)if(!$o(a[r]))return!1;return!0}return!1}function Li(a){if(null===a)return Rs;if("string"==typeof a)return tn;if("boolean"==typeof a)return nn;if("number"==typeof a)return dt;if(a instanceof Wt)return wi;if(a instanceof vu)return Ch;if(a instanceof Tt)return yu;if(a instanceof Rr)return ht;if(Array.isArray(a)){const r=a.length;let l;for(const u of a){const p=Li(u);if(l){if(l===p)continue;l=sn;break}l=p}return Eo(l||sn,r)}return ln}function Ac(a){const r=typeof a;return null===a?"":"string"===r||"number"===r||"boolean"===r?String(a):a instanceof Wt||a instanceof Tt||a instanceof Rr?a.toString():JSON.stringify(a)}class _r{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(2!==r.length)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!$o(r[1]))return l.error("invalid value");const u=r[1];let p=Li(u);const _=l.expectedType;return"array"!==p.kind||0!==p.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(p=_),new _r(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wt?["rgba"].concat(this.value.toArray()):this.value instanceof Tt?this.value.serialize():this.value}}class ti{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const kc={string:tn,number:dt,boolean:nn,object:ln};class ps{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let u,p=1;const _=r[0];if("array"===_){let C,D;if(r.length>2){const M=r[1];if("string"!=typeof M||!(M in kc)||"object"===M)return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=kc[M],p++}else C=sn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=r[2],p++}u=Eo(C,D)}else u=kc[_];const v=[];for(;p<r.length;p++){const C=l.parse(r[p],p,sn);if(!C)return null;v.push(C)}return new ps(u,v)}evaluate(r){for(let l=0;l<this.args.length;l++){const u=this.args[l].evaluate(r);if(!za(this.type,Li(u)))return u;if(l===this.args.length-1)throw new ti(`Expected value to be of type ${Pt(this.type)}, but found ${Pt(Li(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if("array"===r.kind){const u=r.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){l.push(u.kind);const p=r.N;("number"==typeof p||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(u=>u.serialize()))}}class Ci{constructor(r){this.type=yu,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&"object"==typeof u)return l.error("First argument must be an image or text section.");const p=[];let _=!1;for(let v=1;v<=r.length-1;++v){const C=r[v];if(_&&"object"==typeof C&&!Array.isArray(C)){_=!1;let D=null;if(C["font-scale"]&&(D=l.parse(C["font-scale"],1,dt),!D))return null;let M=null;if(C["text-font"]&&(M=l.parse(C["text-font"],1,Eo(tn)),!M))return null;let I=null;if(C["text-color"]&&(I=l.parse(C["text-color"],1,wi),!I))return null;const P=p[p.length-1];P.scale=D,P.font=M,P.textColor=I}else{const D=l.parse(r[v],1,sn);if(!D)return null;const M=D.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:D,scale:null,font:null,textColor:null})}}return new Ci(p)}evaluate(r){return new Tt(this.sections.map(l=>{const u=l.content.evaluate(r);return Li(u)===ht?new bu("",u,null,null,null):new bu(Ac(u),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const u={};l.scale&&(u["font-scale"]=l.scale.serialize()),l.font&&(u["text-font"]=l.font.serialize()),l.textColor&&(u["text-color"]=l.textColor.serialize()),r.push(u)}return r}}class xu{constructor(r){this.type=ht,this.input=r}static parse(r,l){if(2!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,tn);return u?new xu(u):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),u=Rr.fromString(l);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(l)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const jp={"to-boolean":nn,"to-color":wi,"to-number":dt,"to-string":tn};class sa{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const u=r[0];if(("to-boolean"===u||"to-string"===u)&&2!==r.length)return l.error("Expected one argument.");const p=jp[u],_=[];for(let v=1;v<r.length;v++){const C=l.parse(r[v],v,sn);if(!C)return null;_.push(C)}return new sa(p,_)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let l,u;for(const p of this.args){if(l=p.evaluate(r),u=null,l instanceof Wt)return l;if("string"==typeof l){const _=r.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(u=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Zd(l[0],l[1],l[2],l[3]),!u))return new Wt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ti(u||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const u of this.args){if(l=u.evaluate(r),null===l)return 0;const p=Number(l);if(!isNaN(p))return p}throw new ti(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Tt.fromString(Ac(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Rr.fromString(Ac(this.args[0].evaluate(r))):Ac(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ci([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new xu(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Hp=["Unknown","Point","LineString","Polygon"];class jn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=Wt.parse(r)),l}}class To{constructor(r,l,u,p){this.name=r,this.type=l,this._evaluate=u,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const u=r[0],p=To.definitions[u];if(!p)return l.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,C=v.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let D=null;for(const[M,I]of C){D=new Ho(l.registry,l.path,null,l.scope);const P=[];let N=!1;for(let B=1;B<r.length;B++){const G=r[B],Z=Array.isArray(M)?M[B-1]:M.type,re=D.parse(G,1+P.length,Z);if(!re){N=!0;break}P.push(re)}if(!N)if(Array.isArray(M)&&M.length!==P.length)D.error(`Expected ${M.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const G=Array.isArray(M)?M[B]:M.type,Z=P[B];D.concat(B+1).checkSubtype(G,Z.type)}if(0===D.errors.length)return new To(u,_,I,P)}}if(1===C.length)l.errors.push(...D.errors);else{const M=(C.length?C:v).map(([P])=>{return N=P,Array.isArray(N)?`(${N.map(Pt).join(", ")})`:`(${Pt(N.type)}...)`;var N}).join(" | "),I=[];for(let P=1;P<r.length;P++){const N=l.parse(r[P],1+I.length);if(!N)return null;I.push(Pt(N.type))}l.error(`Expected arguments of type ${M}, but found (${I.join(", ")}) instead.`)}return null}static register(r,l){To.definitions=l;for(const u in l)r[u]=To}}class Bl{constructor(r,l,u){this.type=Ch,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(2!==r.length)return l.error("Expected one argument.");const u=r[1];if("object"!=typeof u||Array.isArray(u))return l.error("Collator options argument must be an object.");const p=l.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,nn);if(!p)return null;const _=l.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,nn);if(!_)return null;let v=null;return u.locale&&(v=l.parse(u.locale,1,tn),!v)?null:new Bl(p,_,v)}evaluate(r){return new vu(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const io=8192;function Wn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Ua(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Dh(a,r){const l=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*io),Math.round(u*p*io)]}function Eh(a,r,l){const u=a[0]-r[0],p=a[1]-r[1],_=a[0]-l[0],v=a[1]-l[1];return u*v-_*p==0&&u*_<=0&&p*v<=0}function wu(a,r){let l=!1;for(let v=0,C=r.length;v<C;v++){const D=r[v];for(let M=0,I=D.length;M<I-1;M++){if(Eh(a,D[M],D[M+1]))return!1;(p=D[M])[1]>(u=a)[1]!=(_=D[M+1])[1]>u[1]&&u[0]<(_[0]-p[0])*(u[1]-p[1])/(_[1]-p[1])+p[0]&&(l=!l)}}var u,p,_;return l}function Xd(a,r){for(let l=0;l<r.length;l++)if(wu(a,r[l]))return!0;return!1}function ro(a,r,l,u){const p=u[0]-l[0],_=u[1]-l[1],v=(a[0]-l[0])*_-p*(a[1]-l[1]),C=(r[0]-l[0])*_-p*(r[1]-l[1]);return v>0&&C<0||v<0&&C>0}function Pc(a,r,l){for(const M of l)for(let I=0;I<M.length-1;++I)if((C=[(v=M[I+1])[0]-(_=M[I])[0],v[1]-_[1]])[0]*(D=[(p=r)[0]-(u=a)[0],p[1]-u[1]])[1]-C[1]*D[0]!=0&&ro(u,p,_,v)&&ro(_,v,u,p))return!0;var u,p,_,v,C,D;return!1}function Yd(a,r){for(let l=0;l<a.length;++l)if(!wu(a[l],r))return!1;for(let l=0;l<a.length-1;++l)if(Pc(a[l],a[l+1],r))return!1;return!0}function si(a,r){for(let l=0;l<r.length;l++)if(Yd(a,r[l]))return!0;return!1}function Th(a,r,l){const u=[];for(let p=0;p<a.length;p++){const _=[];for(let v=0;v<a[p].length;v++){const C=Dh(a[p][v],l);Wn(r,C),_.push(C)}u.push(_)}return u}function Mo(a,r,l){const u=[];for(let p=0;p<a.length;p++){const _=Th(a[p],r,l);u.push(_)}return u}function Cu(a,r,l,u){if(a[0]<l[0]||a[0]>l[2]){const p=.5*u;let _=a[0]-l[0]>p?-u:l[0]-a[0]>p?u:0;0===_&&(_=a[0]-l[2]>p?-u:l[2]-a[0]>p?u:0),a[0]+=_}Wn(r,a)}function Du(a,r,l,u){const p=Math.pow(2,u.z)*io,_=[u.x*io,u.y*io],v=[];for(const C of a)for(const D of C){const M=[D.x+_[0],D.y+_[1]];Cu(M,r,l,p),v.push(M)}return v}function Dn(a,r,l,u){const p=Math.pow(2,u.z)*io,_=[u.x*io,u.y*io],v=[];for(const D of a){const M=[];for(const I of D){const P=[I.x+_[0],I.y+_[1]];Wn(r,P),M.push(P)}v.push(M)}if(r[2]-r[0]<=p/2){(C=r)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const D of v)for(const M of D)Cu(M,r,l,p)}var C;return v}class jo{constructor(r,l){this.type=nn,this.geojson=r,this.geometries=l}static parse(r,l){if(2!==r.length)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if($o(r[1])){const u=r[1];if("FeatureCollection"===u.type)for(let p=0;p<u.features.length;++p){const _=u.features[p].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new jo(u,u.features[p].geometry)}else if("Feature"===u.type){const p=u.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new jo(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new jo(u,u)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(l,u){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===u.type){const C=Th(u.coordinates,_,v),D=Du(l.geometry(),p,_,v);if(!Ua(p,_))return!1;for(const M of D)if(!wu(M,C))return!1}if("MultiPolygon"===u.type){const C=Mo(u.coordinates,_,v),D=Du(l.geometry(),p,_,v);if(!Ua(p,_))return!1;for(const M of D)if(!Xd(M,C))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(l,u){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if("Polygon"===u.type){const C=Th(u.coordinates,_,v),D=Dn(l.geometry(),p,_,v);if(!Ua(p,_))return!1;for(const M of D)if(!Yd(M,C))return!1}if("MultiPolygon"===u.type){const C=Mo(u.coordinates,_,v),D=Dn(l.geometry(),p,_,v);if(!Ua(p,_))return!1;for(const M of D)if(!si(M,C))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Vl(a){if(a instanceof To&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof jo)return!1;let r=!0;return a.eachChild(l=>{r&&!Vl(l)&&(r=!1)}),r}function ut(a){if(a instanceof To&&"feature-state"===a.name)return!1;let r=!0;return a.eachChild(l=>{r&&!ut(l)&&(r=!1)}),r}function dr(a,r){if(a instanceof To&&r.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(u=>{l&&!dr(u,r)&&(l=!1)}),l}class Ut{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(2!==r.length||"string"!=typeof r[1])return l.error("'var' expression requires exactly one string literal argument.");const u=r[1];return l.scope.has(u)?new Ut(u,l.scope.get(u)):l.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ho{constructor(r,l=[],u,p=new oi,_=[]){this.registry=r,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=_,this.expectedType=u}parse(r,l,u,p,_={}){return l?this.concat(l,u,p)._parse(r,_):this._parse(r,_)}_parse(r,l){function u(p,_,v){return"assert"===v?new ps(_,[p]):"coerce"===v?new sa(_,[p]):p}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let v=_.parse(r,this);if(!v)return null;if(this.expectedType){const C=this.expectedType,D=v.type;if("string"!==C.kind&&"number"!==C.kind&&"boolean"!==C.kind&&"object"!==C.kind&&"array"!==C.kind||"value"!==D.kind)if("color"!==C.kind&&"formatted"!==C.kind&&"resolvedImage"!==C.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(C,D))return null}else v=u(v,C,l.typeAnnotation||"coerce");else v=u(v,C,l.typeAnnotation||"assert")}if(!(v instanceof _r)&&"resolvedImage"!==v.type.kind&&Fs(v)){const C=new jn;try{v=new _r(v.type,v.evaluate(C))}catch(D){return this.error(D.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,u){const p="number"==typeof r?this.path.concat(r):this.path,_=u?this.scope.concat(u):this.scope;return new Ho(this.registry,p,l||null,_,this.errors)}error(r,...l){const u=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new vn(u,r))}checkSubtype(r,l){const u=za(r,l);return u&&this.error(u),u}}function Fs(a){if(a instanceof Ut)return Fs(a.boundExpression);if(a instanceof To&&"error"===a.name||a instanceof Bl||a instanceof jo)return!1;const r=a instanceof sa||a instanceof ps;let l=!0;return a.eachChild(u=>{l=r?l&&Fs(u):l&&u instanceof _r}),!!l&&Vl(a)&&dr(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function Fr(a,r){const l=a.length-1;let u,p,_=0,v=l,C=0;for(;_<=v;)if(C=Math.floor((_+v)/2),u=a[C],p=a[C+1],u<=r){if(C===l||r<p)return C;_=C+1}else{if(!(u>r))throw new ti("Input is not a number.");v=C-1}return 0}class zl{constructor(r,l,u){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,_]of u)this.labels.push(p),this.outputs.push(_)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const u=l.parse(r[1],1,dt);if(!u)return null;const p=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let v=1;v<r.length;v+=2){const C=1===v?-1/0:r[v],D=r[v+1],M=v,I=v+1;if("number"!=typeof C)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const P=l.parse(D,I,_);if(!P)return null;_=_||P.type,p.push([C,P])}return new zl(_,u,p)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return u[0].evaluate(r);const _=l.length;return p>=l[_-1]?u[_-1].evaluate(r):u[Fr(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}function Qt(a,r,l){return a*(1-l)+r*l}var wt=Object.freeze({__proto__:null,number:Qt,color:function(a,r,l){return new Wt(Qt(a.r,r.r,l),Qt(a.g,r.g,l),Qt(a.b,r.b,l),Qt(a.a,r.a,l))},array:function(a,r,l){return a.map((u,p)=>Qt(u,r[p],l))}});const Or=4/29,Os=6/29,Bi=3*Os*Os,aa=Math.PI/180,Vi=180/Math.PI;function la(a){return a>.008856451679035631?Math.pow(a,1/3):a/Bi+Or}function ca(a){return a>Os?a*a*a:Bi*(a-Or)}function en(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function $a(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ua(a){const r=$a(a.r),l=$a(a.g),u=$a(a.b),p=la((.4124564*r+.3575761*l+.1804375*u)/.95047),_=la((.2126729*r+.7151522*l+.072175*u)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-la((.0193339*r+.119192*l+.9503041*u)/1.08883)),alpha:a.a}}function Nc(a){let r=(a.l+16)/116,l=isNaN(a.a)?r:r+a.a/500,u=isNaN(a.b)?r:r-a.b/200;return r=1*ca(r),l=.95047*ca(l),u=1.08883*ca(u),new Wt(en(3.2404542*l-1.5371385*r-.4985314*u),en(-.969266*l+1.8760108*r+.041556*u),en(.0556434*l-.2040259*r+1.0572252*u),a.alpha)}function Ul(a,r,l){const u=r-a;return a+l*(u>180||u<-180?u-360*Math.round(u/360):u)}const Xi={forward:ua,reverse:Nc,interpolate:function(a,r,l){return{l:Qt(a.l,r.l,l),a:Qt(a.a,r.a,l),b:Qt(a.b,r.b,l),alpha:Qt(a.alpha,r.alpha,l)}}},gs={forward:function(a){const{l:r,a:l,b:u}=ua(a),p=Math.atan2(u,l)*Vi;return{h:p<0?p+360:p,c:Math.sqrt(l*l+u*u),l:r,alpha:a.a}},reverse:function(a){const r=a.h*aa,l=a.c;return Nc({l:a.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:a.alpha})},interpolate:function(a,r,l){return{h:Ul(a.h,r.h,l),c:Qt(a.c,r.c,l),l:Qt(a.l,r.l,l),alpha:Qt(a.alpha,r.alpha,l)}}};var ja=Object.freeze({__proto__:null,lab:Xi,hcl:gs});class Di{constructor(r,l,u,p,_){this.type=r,this.operator=l,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[v,C]of _)this.labels.push(v),this.outputs.push(C)}static interpolationFactor(r,l,u,p){let _=0;if("exponential"===r.name)_=ni(l,r.base,u,p);else if("linear"===r.name)_=ni(l,1,u,p);else if("cubic-bezier"===r.name){const v=r.controlPoints;_=new Be(v[0],v[1],v[2],v[3]).solve(ni(l,1,u,p))}return _}static parse(r,l){let[u,p,_,...v]=r;if(!Array.isArray(p)||0===p.length)return l.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const M=p[1];if("number"!=typeof M)return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if("cubic-bezier"!==p[0])return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(4!==M.length||M.some(I=>"number"!=typeof I||I<0||I>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,dt),!_)return null;const C=[];let D=null;"interpolate-hcl"===u||"interpolate-lab"===u?D=wi:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let M=0;M<v.length;M+=2){const I=v[M],P=v[M+1],N=M+3,B=M+4;if("number"!=typeof I)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(C.length&&C[C.length-1][0]>=I)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const G=l.parse(P,B,D);if(!G)return null;D=D||G.type,C.push([I,G])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new Di(D,u,p,_,C):l.error(`Type ${Pt(D)} is not interpolatable.`)}evaluate(r){const l=this.labels,u=this.outputs;if(1===l.length)return u[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return u[0].evaluate(r);const _=l.length;if(p>=l[_-1])return u[_-1].evaluate(r);const v=Fr(l,p),C=Di.interpolationFactor(this.interpolation,p,l[v],l[v+1]),D=u[v].evaluate(r),M=u[v+1].evaluate(r);return"interpolate"===this.operator?wt[this.type.kind.toLowerCase()](D,M,C):"interpolate-hcl"===this.operator?gs.reverse(gs.interpolate(gs.forward(D),gs.forward(M),C)):Xi.reverse(Xi.interpolate(Xi.forward(D),Xi.forward(M),C))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)l.push(this.labels[u],this.outputs[u].serialize());return l}}function ni(a,r,l,u){const p=u-l,_=a-l;return 0===p?0:1===r?_/p:(Math.pow(r,_)-1)/(Math.pow(r,p)-1)}class Eu{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let u=null;const p=l.expectedType;p&&"value"!==p.kind&&(u=p);const _=[];for(const C of r.slice(1)){const D=l.parse(C,1+_.length,u,void 0,{typeAnnotation:"omit"});if(!D)return null;u=u||D.type,_.push(D)}const v=p&&_.some(C=>za(p,C.type));return new Eu(v?sn:u,_)}evaluate(r){let l,u=null,p=0;for(const _ of this.args)if(p++,u=_.evaluate(r),u&&u instanceof Rr&&!u.available&&(l||(l=u.name),u=null,p===this.args.length&&(u=l)),null!==u)break;return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class Tu{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let _=1;_<r.length-1;_+=2){const v=r[_];if("string"!=typeof v)return l.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const C=l.parse(r[_+1],_+1);if(!C)return null;u.push([v,C])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,u);return p?new Tu(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,u]of this.bindings)r.push(l,u.serialize());return r.push(this.result.serialize()),r}}class Ha{constructor(r,l,u){this.type=r,this.index=l,this.input=u}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,dt),p=l.parse(r[2],2,Eo(l.expectedType||sn));return u&&p?new Ha(p.type.itemType,u,p):null}evaluate(r){const l=this.index.evaluate(r),u=this.input.evaluate(r);if(l<0)throw new ti(`Array index out of bounds: ${l} < 0.`);if(l>=u.length)throw new ti(`Array index out of bounds: ${l} > ${u.length-1}.`);if(l!==Math.floor(l))throw new ti(`Array index must be an integer, but found ${l} instead.`);return u[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Rc{constructor(r,l){this.type=nn,this.needle=r,this.haystack=l}static parse(r,l){if(3!==r.length)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,sn),p=l.parse(r[2],2,sn);return u&&p?Ol(u.type,[nn,tn,dt,Rs,sn])?new Rc(u,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pt(u.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!u)return!1;if(!Ic(l,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${Pt(Li(l))} instead.`);if(!Ic(u,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${Pt(Li(u))} instead.`);return u.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ha{constructor(r,l,u){this.type=dt,this.needle=r,this.haystack=l,this.fromIndex=u}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,sn),p=l.parse(r[2],2,sn);if(!u||!p)return null;if(!Ol(u.type,[nn,tn,dt,Rs,sn]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pt(u.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,dt);return _?new ha(u,p,_):null}return new ha(u,p)}evaluate(r){const l=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Ic(l,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${Pt(Li(l))} instead.`);if(!Ic(u,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${Pt(Li(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return u.indexOf(l,p)}return u.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class $l{constructor(r,l,u,p,_,v){this.inputType=r,this.type=l,this.input=u,this.cases=p,this.outputs=_,this.otherwise=v}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let u,p;l.expectedType&&"value"!==l.expectedType.kind&&(p=l.expectedType);const _={},v=[];for(let M=2;M<r.length-1;M+=2){let I=r[M];const P=r[M+1];Array.isArray(I)||(I=[I]);const N=l.concat(M);if(0===I.length)return N.error("Expected at least one branch label.");for(const G of I){if("number"!=typeof G&&"string"!=typeof G)return N.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,Li(G)))return null}else u=Li(G);if(void 0!==_[String(G)])return N.error("Branch labels must be unique.");_[String(G)]=v.length}const B=l.parse(P,M,p);if(!B)return null;p=p||B.type,v.push(B)}const C=l.parse(r[1],1,sn);if(!C)return null;const D=l.parse(r[r.length-1],r.length-1,p);return D?"value"!==C.type.kind&&l.concat(1).checkSubtype(u,C.type)?null:new $l(u,p,C,_,v,D):null}evaluate(r){const l=this.input.evaluate(r);return(Li(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),u=[],p={};for(const v of l){const C=p[this.cases[v]];void 0===C?(p[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[C][1].push(v)}const _=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,C]of u)r.push(1===C.length?_(C[0]):C.map(_)),r.push(this.outputs[v].serialize());return r.push(this.otherwise.serialize()),r}}class ms{constructor(r,l,u){this.type=r,this.branches=l,this.otherwise=u}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let u;l.expectedType&&"value"!==l.expectedType.kind&&(u=l.expectedType);const p=[];for(let v=1;v<r.length-1;v+=2){const C=l.parse(r[v],v,nn);if(!C)return null;const D=l.parse(r[v+1],v+1,u);if(!D)return null;p.push([C,D]),u=u||D.type}const _=l.parse(r[r.length-1],r.length-1,u);return _?new ms(u,p,_):null}evaluate(r){for(const[l,u]of this.branches)if(l.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,u]of this.branches)r(l),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}class Hi{constructor(r,l,u,p){this.type=r,this.input=l,this.beginIndex=u,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=l.parse(r[1],1,sn),p=l.parse(r[2],2,dt);if(!u||!p)return null;if(!Ol(u.type,[Eo(sn),tn,sn]))return l.error(`Expected first argument to be of type array or string, but found ${Pt(u.type)} instead`);if(4===r.length){const _=l.parse(r[3],3,dt);return _?new Hi(u.type,u,p,_):null}return new Hi(u.type,u,p)}evaluate(r){const l=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Ic(l,["string","array"]))throw new ti(`Expected first argument to be of type array or string, but found ${Pt(Li(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(u,p)}return l.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jd(a,r){return"=="===a||"!="===a?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function So(a,r,l,u){return 0===u.compare(r,l)}function yr(a,r,l){const u="=="!==a&&"!="!==a;return class y2{constructor(_,v,C){this.type=nn,this.lhs=_,this.rhs=v,this.collator=C,this.hasUntypedArgument="value"===_.type.kind||"value"===v.type.kind}static parse(_,v){if(3!==_.length&&4!==_.length)return v.error("Expected two or three arguments.");const C=_[0];let D=v.parse(_[1],1,sn);if(!D)return null;if(!Jd(C,D.type))return v.concat(1).error(`"${C}" comparisons are not supported for type '${Pt(D.type)}'.`);let M=v.parse(_[2],2,sn);if(!M)return null;if(!Jd(C,M.type))return v.concat(2).error(`"${C}" comparisons are not supported for type '${Pt(M.type)}'.`);if(D.type.kind!==M.type.kind&&"value"!==D.type.kind&&"value"!==M.type.kind)return v.error(`Cannot compare types '${Pt(D.type)}' and '${Pt(M.type)}'.`);u&&("value"===D.type.kind&&"value"!==M.type.kind?D=new ps(M.type,[D]):"value"!==D.type.kind&&"value"===M.type.kind&&(M=new ps(D.type,[M])));let I=null;if(4===_.length){if("string"!==D.type.kind&&"string"!==M.type.kind&&"value"!==D.type.kind&&"value"!==M.type.kind)return v.error("Cannot use collator to compare non-string types.");if(I=v.parse(_[3],3,Ch),!I)return null}return new y2(D,M,I)}evaluate(_){const v=this.lhs.evaluate(_),C=this.rhs.evaluate(_);if(u&&this.hasUntypedArgument){const D=Li(v),M=Li(C);if(D.kind!==M.kind||"string"!==D.kind&&"number"!==D.kind)throw new ti(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${D.kind}, ${M.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const D=Li(v),M=Li(C);if("string"!==D.kind||"string"!==M.kind)return r(_,v,C)}return this.collator?l(_,v,C,this.collator.evaluate(_)):r(_,v,C)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[a];return this.eachChild(v=>{_.push(v.serialize())}),_}}}const Mh=yr("==",function(a,r,l){return r===l},So),Fc=yr("!=",function(a,r,l){return r!==l},function(a,r,l,u){return!So(0,r,l,u)}),Oc=yr("<",function(a,r,l){return r<l},function(a,r,l,u){return u.compare(r,l)<0}),Go=yr(">",function(a,r,l){return r>l},function(a,r,l,u){return u.compare(r,l)>0}),Gp=yr("<=",function(a,r,l){return r<=l},function(a,r,l,u){return u.compare(r,l)<=0}),u_=yr(">=",function(a,r,l){return r>=l},function(a,r,l,u){return u.compare(r,l)>=0});class Sh{constructor(r,l,u,p,_){this.type=tn,this.number=r,this.locale=l,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(r,l){if(3!==r.length)return l.error("Expected two arguments.");const u=l.parse(r[1],1,dt);if(!u)return null;const p=r[2];if("object"!=typeof p||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=l.parse(p.locale,1,tn),!_))return null;let v=null;if(p.currency&&(v=l.parse(p.currency,1,tn),!v))return null;let C=null;if(p["min-fraction-digits"]&&(C=l.parse(p["min-fraction-digits"],1,dt),!C))return null;let D=null;return p["max-fraction-digits"]&&(D=l.parse(p["max-fraction-digits"],1,dt),!D)?null:new Sh(u,_,v,C,D)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class jl{constructor(r){this.type=dt,this.input=r}static parse(r,l){if(2!==r.length)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=l.parse(r[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?l.error(`Expected argument of type string or array, but found ${Pt(u.type)} instead.`):new jl(u):null}evaluate(r){const l=this.input.evaluate(r);if("string"==typeof l||Array.isArray(l))return l.length;throw new ti(`Expected value to be of type string or array, but found ${Pt(Li(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Hl={"==":Mh,"!=":Fc,">":Go,"<":Oc,">=":u_,"<=":Gp,array:ps,at:Ha,boolean:ps,case:ms,coalesce:Eu,collator:Bl,format:Ci,image:xu,in:Rc,"index-of":ha,interpolate:Di,"interpolate-hcl":Di,"interpolate-lab":Di,length:jl,let:Tu,literal:_r,match:$l,number:ps,"number-format":Sh,object:ps,slice:Hi,step:zl,string:ps,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:Ut,within:jo};function Kd(a,[r,l,u,p]){r=r.evaluate(a),l=l.evaluate(a),u=u.evaluate(a);const _=p?p.evaluate(a):1,v=Zd(r,l,u,_);if(v)throw new ti(v);return new Wt(r/255*_,l/255*_,u/255*_,_)}function qp(a,r){return a in r}function Qd(a,r){const l=r[a];return void 0===l?null:l}function Gl(a){return{type:a}}function ef(a){return{result:"success",value:a}}function ql(a){return{result:"error",value:a}}function Wl(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Ih(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function tf(a){return!!a.expression&&a.expression.interpolated}function Vn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function Ah(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function h_(a){return a}function Wp(a,r){const l="color"===r.type,u=a.stops&&"object"==typeof a.stops[0][0],p=u||!(u||void 0!==a.property),_=a.type||(tf(r)?"exponential":"interval");if(l&&((a=zt({},a)).stops&&(a.stops=a.stops.map(M=>[M[0],Wt.parse(M[1])])),a.default=Wt.parse(a.default?a.default:r.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!ja[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let v,C,D;if("exponential"===_)v=Su;else if("interval"===_)v=Zp;else if("categorical"===_){v=Mu,C=Object.create(null);for(const M of a.stops)C[M[0]]=M[1];D=typeof a.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);v=d_}if(u){const M={},I=[];for(let B=0;B<a.stops.length;B++){const G=a.stops[B],Z=G[0].zoom;void 0===M[Z]&&(M[Z]={zoom:Z,type:a.type,property:a.property,default:a.default,stops:[]},I.push(Z)),M[Z].stops.push([G[0].value,G[1]])}const P=[];for(const B of I)P.push([M[B].zoom,Wp(M[B],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Di.interpolationFactor.bind(void 0,N),zoomStops:P.map(B=>B[0]),evaluate:({zoom:B},G)=>Su({stops:P,base:a.base},r,B).evaluate(B,G)}}if(p){const M="exponential"===_?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Di.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(I=>I[0]),evaluate:({zoom:I})=>v(a,r,I,C,D)}}return{kind:"source",evaluate(M,I){const P=I&&I.properties?I.properties[a.property]:void 0;return void 0===P?Zl(a.default,r.default):v(a,r,P,C,D)}}}function Zl(a,r,l){return void 0!==a?a:void 0!==r?r:void 0!==l?l:void 0}function Mu(a,r,l,u,p){return Zl(typeof l===p?u[l]:void 0,a.default,r.default)}function Zp(a,r,l){if("number"!==Vn(l))return Zl(a.default,r.default);const u=a.stops.length;if(1===u||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[u-1][0])return a.stops[u-1][1];const p=Fr(a.stops.map(_=>_[0]),l);return a.stops[p][1]}function Su(a,r,l){const u=void 0!==a.base?a.base:1;if("number"!==Vn(l))return Zl(a.default,r.default);const p=a.stops.length;if(1===p||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const _=Fr(a.stops.map(I=>I[0]),l),v=function(I,P,N,B){const G=B-N,Z=I-N;return 0===G?0:1===P?Z/G:(Math.pow(P,Z)-1)/(Math.pow(P,G)-1)}(l,u,a.stops[_][0],a.stops[_+1][0]),C=a.stops[_][1],D=a.stops[_+1][1];let M=wt[r.type]||h_;if(a.colorSpace&&"rgb"!==a.colorSpace){const I=ja[a.colorSpace];M=(P,N)=>I.reverse(I.interpolate(I.forward(P),I.forward(N),v))}return"function"==typeof C.evaluate?{evaluate(...I){const P=C.evaluate.apply(void 0,I),N=D.evaluate.apply(void 0,I);if(void 0!==P&&void 0!==N)return M(P,N,v)}}:M(C,D,v)}function d_(a,r,l){return"color"===r.type?l=Wt.parse(l):"formatted"===r.type?l=Tt.fromString(l.toString()):"resolvedImage"===r.type?l=Rr.fromString(l.toString()):Vn(l)===r.type||"enum"===r.type&&r.values[l]||(l=void 0),Zl(l,a.default,r.default)}To.register(Hl,{error:[{kind:"error"},[tn],(a,[r])=>{throw new ti(r.evaluate(a))}],typeof:[tn,[sn],(a,[r])=>Pt(Li(r.evaluate(a)))],"to-rgba":[Eo(dt,4),[wi],(a,[r])=>r.evaluate(a).toArray()],rgb:[wi,[dt,dt,dt],Kd],rgba:[wi,[dt,dt,dt,dt],Kd],has:{type:nn,overloads:[[[tn],(a,[r])=>qp(r.evaluate(a),a.properties())],[[tn,ln],(a,[r,l])=>qp(r.evaluate(a),l.evaluate(a))]]},get:{type:sn,overloads:[[[tn],(a,[r])=>Qd(r.evaluate(a),a.properties())],[[tn,ln],(a,[r,l])=>Qd(r.evaluate(a),l.evaluate(a))]]},"feature-state":[sn,[tn],(a,[r])=>Qd(r.evaluate(a),a.featureState||{})],properties:[ln,[],a=>a.properties()],"geometry-type":[tn,[],a=>a.geometryType()],id:[sn,[],a=>a.id()],zoom:[dt,[],a=>a.globals.zoom],"heatmap-density":[dt,[],a=>a.globals.heatmapDensity||0],"line-progress":[dt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[dt,[],a=>a.globals.skyRadialProgress||0],accumulated:[sn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[dt,Gl(dt),(a,r)=>{let l=0;for(const u of r)l+=u.evaluate(a);return l}],"*":[dt,Gl(dt),(a,r)=>{let l=1;for(const u of r)l*=u.evaluate(a);return l}],"-":{type:dt,overloads:[[[dt,dt],(a,[r,l])=>r.evaluate(a)-l.evaluate(a)],[[dt],(a,[r])=>-r.evaluate(a)]]},"/":[dt,[dt,dt],(a,[r,l])=>r.evaluate(a)/l.evaluate(a)],"%":[dt,[dt,dt],(a,[r,l])=>r.evaluate(a)%l.evaluate(a)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(a,[r,l])=>Math.pow(r.evaluate(a),l.evaluate(a))],sqrt:[dt,[dt],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[dt,[dt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[dt,[dt],(a,[r])=>Math.log(r.evaluate(a))],log2:[dt,[dt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[dt,[dt],(a,[r])=>Math.sin(r.evaluate(a))],cos:[dt,[dt],(a,[r])=>Math.cos(r.evaluate(a))],tan:[dt,[dt],(a,[r])=>Math.tan(r.evaluate(a))],asin:[dt,[dt],(a,[r])=>Math.asin(r.evaluate(a))],acos:[dt,[dt],(a,[r])=>Math.acos(r.evaluate(a))],atan:[dt,[dt],(a,[r])=>Math.atan(r.evaluate(a))],min:[dt,Gl(dt),(a,r)=>Math.min(...r.map(l=>l.evaluate(a)))],max:[dt,Gl(dt),(a,r)=>Math.max(...r.map(l=>l.evaluate(a)))],abs:[dt,[dt],(a,[r])=>Math.abs(r.evaluate(a))],round:[dt,[dt],(a,[r])=>{const l=r.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[dt,[dt],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[dt,[dt],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[nn,[tn,sn],(a,[r,l])=>a.properties()[r.value]===l.value],"filter-id-==":[nn,[sn],(a,[r])=>a.id()===r.value],"filter-type-==":[nn,[tn],(a,[r])=>a.geometryType()===r.value],"filter-<":[nn,[tn,sn],(a,[r,l])=>{const u=a.properties()[r.value],p=l.value;return typeof u==typeof p&&u<p}],"filter-id-<":[nn,[sn],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<u}],"filter->":[nn,[tn,sn],(a,[r,l])=>{const u=a.properties()[r.value],p=l.value;return typeof u==typeof p&&u>p}],"filter-id->":[nn,[sn],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>u}],"filter-<=":[nn,[tn,sn],(a,[r,l])=>{const u=a.properties()[r.value],p=l.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[nn,[sn],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l<=u}],"filter->=":[nn,[tn,sn],(a,[r,l])=>{const u=a.properties()[r.value],p=l.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[nn,[sn],(a,[r])=>{const l=a.id(),u=r.value;return typeof l==typeof u&&l>=u}],"filter-has":[nn,[sn],(a,[r])=>r.value in a.properties()],"filter-has-id":[nn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[nn,[Eo(tn)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[nn,[Eo(sn)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[nn,[tn,Eo(sn)],(a,[r,l])=>l.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[nn,[tn,Eo(sn)],(a,[r,l])=>function(u,p,_,v){for(;_<=v;){const C=_+v>>1;if(p[C]===u)return!0;p[C]>u?v=C-1:_=C+1}return!1}(a.properties()[r.value],l.value,0,l.value.length-1)],all:{type:nn,overloads:[[[nn,nn],(a,[r,l])=>r.evaluate(a)&&l.evaluate(a)],[Gl(nn),(a,r)=>{for(const l of r)if(!l.evaluate(a))return!1;return!0}]]},any:{type:nn,overloads:[[[nn,nn],(a,[r,l])=>r.evaluate(a)||l.evaluate(a)],[Gl(nn),(a,r)=>{for(const l of r)if(l.evaluate(a))return!0;return!1}]]},"!":[nn,[nn],(a,[r])=>!r.evaluate(a)],"is-supported-script":[nn,[tn],(a,[r])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(r.evaluate(a))}],upcase:[tn,[tn],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[tn,[tn],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[tn,Gl(sn),(a,r)=>r.map(l=>Ac(l.evaluate(a))).join("")],"resolved-locale":[tn,[Ch],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Ls{constructor(r,l){var u;this.expression=r,this._warningHistory={},this._evaluator=new jn,this._defaultValue=l?"color"===(u=l).type&&Ah(u.default)?new Wt(0,0,0,0):"color"===u.type?Wt.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(r,l,u,p,_,v){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(r,l,u,p,_,v){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new ti(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,"undefined"!=typeof console&&console.warn(C.message)),this._defaultValue}}}function Lc(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Hl}function dn(a,r){const l=new Ho(Hl,[],r?function(p){const _={color:wi,string:tn,number:dt,enum:tn,boolean:nn,formatted:yu,resolvedImage:ht};return"array"===p.type?Eo(_[p.value]||sn,p.length):_[p.type]}(r):void 0),u=l.parse(a,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return u?ef(new Ls(u,r)):ql(l.errors)}class Bc{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent="constant"!==r&&!ut(l.expression)}evaluateWithoutErrorHandling(r,l,u,p,_,v){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,p,_,v)}evaluate(r,l,u,p,_,v){return this._styleExpression.evaluate(r,l,u,p,_,v)}}class da{constructor(r,l,u,p){this.kind=r,this.zoomStops=u,this._styleExpression=l,this.isStateDependent="camera"!==r&&!ut(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,u,p,_,v){return this._styleExpression.evaluateWithoutErrorHandling(r,l,u,p,_,v)}evaluate(r,l,u,p,_,v){return this._styleExpression.evaluate(r,l,u,p,_,v)}interpolationFactor(r,l,u){return this.interpolationType?Di.interpolationFactor(this.interpolationType,r,l,u):0}}function kh(a,r){if("error"===(a=dn(a,r)).result)return a;const l=a.value.expression,u=Vl(l);if(!u&&!Wl(r))return ql([new vn("","data expressions not supported")]);const p=dr(l,["zoom"]);if(!p&&!Ih(r))return ql([new vn("","zoom expressions not supported")]);const _=Ga(l);return _||p?_ instanceof vn?ql([_]):_ instanceof Di&&!tf(r)?ql([new vn("",'"interpolate" expressions cannot be used with this property')]):ef(_?new da(u?"camera":"composite",a.value,_.labels,_ instanceof Di?_.interpolation:void 0):new Bc(u?"constant":"source",a.value)):ql([new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vc{constructor(r,l){this._parameters=r,this._specification=l,zt(this,Wp(this._parameters,this._specification))}static deserialize(r){return new Vc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ga(a){let r=null;if(a instanceof Tu)r=Ga(a.result);else if(a instanceof Eu){for(const l of a.args)if(r=Ga(l),r)break}else(a instanceof zl||a instanceof Di)&&a.input instanceof To&&"zoom"===a.input.name&&(r=a);return r instanceof vn||a.eachChild(l=>{const u=Ga(l);u instanceof vn?r=u:!r&&u?r=new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Lr(a){const r=a.key,l=a.value,u=a.valueSpec||{},p=a.objectElementValidators||{},_=a.style,v=a.styleSpec;let C=[];const D=Vn(l);if("object"!==D)return[new Oe(r,l,`object expected, ${D} found`)];for(const M in l){const I=M.split(".")[0],P=u[I]||u["*"];let N;if(p[I])N=p[I];else if(u[I])N=It;else if(p["*"])N=p["*"];else{if(!u["*"]){C.push(new Oe(r,l[M],`unknown property "${M}"`));continue}N=It}C=C.concat(N({key:(r&&`${r}.`)+M,value:l[M],valueSpec:P,style:_,styleSpec:v,object:l,objectKey:M},l))}for(const M in u)p[M]||u[M].required&&void 0===u[M].default&&void 0===l[M]&&C.push(new Oe(r,l,`missing required property "${M}"`));return C}function zc(a){const r=a.value,l=a.valueSpec,u=a.style,p=a.styleSpec,_=a.key,v=a.arrayElementValidator||It;if("array"!==Vn(r))return[new Oe(_,r,`array expected, ${Vn(r)} found`)];if(l.length&&r.length!==l.length)return[new Oe(_,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Oe(_,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum};p.$version<7&&(C.function=l.function),"object"===Vn(l.value)&&(C=l.value);let D=[];for(let M=0;M<r.length;M++)D=D.concat(v({array:r,arrayIndex:M,value:r[M],valueSpec:C,style:u,styleSpec:p,key:`${_}[${M}]`}));return D}function Iu(a){const r=a.key,l=a.value,u=a.valueSpec;let p=Vn(l);if("number"===p&&l!=l&&(p="NaN"),"number"!==p)return[new Oe(r,l,`number expected, ${p} found`)];if("minimum"in u){let _=u.minimum;if("array"===Vn(u.minimum)&&(_=u.minimum[a.arrayIndex]),l<_)return[new Oe(r,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if("array"===Vn(u.maximum)&&(_=u.maximum[a.arrayIndex]),l>_)return[new Oe(r,l,`${l} is greater than the maximum value ${_}`)]}return[]}function Wr(a){const r=a.valueSpec,l=Ht(a.value.type);let u,p,_,v={};const C="categorical"!==l&&void 0===a.value.property,D=!C,M="array"===Vn(a.value.stops)&&"array"===Vn(a.value.stops[0])&&"object"===Vn(a.value.stops[0][0]),I=Lr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new Oe(B.key,B.value,'identity function may not have a "stops" property')];let G=[];const Z=B.value;return G=G.concat(zc({key:B.key,value:Z,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),"array"===Vn(Z)&&0===Z.length&&G.push(new Oe(B.key,Z,"array must have at least one stop")),G},default:function(B){return It({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&C&&I.push(new Oe(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||I.push(new Oe(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!tf(a.valueSpec)&&I.push(new Oe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!Wl(a.valueSpec)?I.push(new Oe(a.key,a.value,"property functions not supported")):C&&!Ih(a.valueSpec)&&I.push(new Oe(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!M||void 0!==a.value.property||I.push(new Oe(a.key,a.value,'"property" property is required')),I;function P(B){let G=[];const Z=B.value,re=B.key;if("array"!==Vn(Z))return[new Oe(re,Z,`array expected, ${Vn(Z)} found`)];if(2!==Z.length)return[new Oe(re,Z,`array length 2 expected, length ${Z.length} found`)];if(M){if("object"!==Vn(Z[0]))return[new Oe(re,Z,`object expected, ${Vn(Z[0])} found`)];if(void 0===Z[0].zoom)return[new Oe(re,Z,"object stop key must have zoom")];if(void 0===Z[0].value)return[new Oe(re,Z,"object stop key must have value")];if(_&&_>Ht(Z[0].zoom))return[new Oe(re,Z[0].zoom,"stop zoom values must appear in ascending order")];Ht(Z[0].zoom)!==_&&(_=Ht(Z[0].zoom),p=void 0,v={}),G=G.concat(Lr({key:`${re}[0]`,value:Z[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Iu,value:N}}))}else G=G.concat(N({key:`${re}[0]`,value:Z[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},Z));return Lc(Fn(Z[1]))?G.concat([new Oe(`${re}[1]`,Z[1],"expressions are not allowed in function stops.")]):G.concat(It({key:`${re}[1]`,value:Z[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function N(B,G){const Z=Vn(B.value),re=Ht(B.value),ue=null!==B.value?B.value:G;if(u){if(Z!==u)return[new Oe(B.key,ue,`${Z} stop domain type must match previous stop domain type ${u}`)]}else u=Z;if("number"!==Z&&"string"!==Z&&"boolean"!==Z)return[new Oe(B.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==Z&&"categorical"!==l){let ve=`number expected, ${Z} found`;return Wl(r)&&void 0===l&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(B.key,ue,ve)]}return"categorical"!==l||"number"!==Z||isFinite(re)&&Math.floor(re)===re?"categorical"!==l&&"number"===Z&&void 0!==p&&re<p?[new Oe(B.key,ue,"stop domain values must appear in ascending order")]:(p=re,"categorical"===l&&re in v?[new Oe(B.key,ue,"stop domain values must be unique")]:(v[re]=!0,[])):[new Oe(B.key,ue,`integer expected, found ${re}`)]}}function Bs(a){const r=("property"===a.expressionContext?kh:dn)(Fn(a.value),a.valueSpec);if("error"===r.result)return r.value.map(u=>new Oe(`${a.key}${u.key}`,a.value,u.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Oe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ut(l))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!ut(l))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!dr(l,["zoom","feature-state"]))return[new Oe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Vl(l))return[new Oe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qa(a){const r=a.key,l=a.value,u=a.valueSpec,p=[];return Array.isArray(u.values)?-1===u.values.indexOf(Ht(l))&&p.push(new Oe(r,l,`expected one of [${u.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(u.values).indexOf(Ht(l))&&p.push(new Oe(r,l,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Xl(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!Xl(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}const Ph={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fa(a){if(null==a)return{filter:()=>!0,needGeometry:!1};Xl(a)||(a=Yl(a));const r=dn(a,Ph);if("error"===r.result)throw new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,u,p)=>r.value.evaluate(l,u,{},p),needGeometry:Ei(a)}}function Xp(a,r){return a<r?-1:a>r?1:0}function Ei(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let r=1;r<a.length;r++)if(Ei(a[r]))return!0;return!1}function Yl(a){if(!a)return!0;const r=a[0];return a.length<=1?"any"!==r:"=="===r?Au(a[1],a[2],"=="):"!="===r?ku(Au(a[1],a[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Au(a[1],a[2],r):"any"===r?(l=a.slice(1),["any"].concat(l.map(Yl))):"all"===r?["all"].concat(a.slice(1).map(Yl)):"none"===r?["all"].concat(a.slice(1).map(Yl).map(ku)):"in"===r?nf(a[1],a.slice(2)):"!in"===r?ku(nf(a[1],a.slice(2))):"has"===r?zi(a[1]):"!has"===r?ku(zi(a[1])):"within"!==r||a;var l}function Au(a,r,l){switch(a){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,a,r]}}function nf(a,r){if(0===r.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Xp)]]:["filter-in-small",a,["literal",r]]}}function zi(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ku(a){return["!",a]}function rf(a){return Xl(Fn(a.value))?Bs(zt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pa(a)}function pa(a){const r=a.value,l=a.key;if("array"!==Vn(r))return[new Oe(l,r,`array expected, ${Vn(r)} found`)];const u=a.styleSpec;let p,_=[];if(r.length<1)return[new Oe(l,r,"filter array must have at least 1 element")];switch(_=_.concat(qa({key:`${l}[0]`,value:r[0],valueSpec:u.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ht(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Ht(r[1])&&_.push(new Oe(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&_.push(new Oe(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=Vn(r[1]),"string"!==p&&_.push(new Oe(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let v=2;v<r.length;v++)p=Vn(r[v]),"$type"===Ht(r[1])?_=_.concat(qa({key:`${l}[${v}]`,value:r[v],valueSpec:u.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&_.push(new Oe(`${l}[${v}]`,r[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<r.length;v++)_=_.concat(pa({key:`${l}[${v}]`,value:r[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Vn(r[1]),2!==r.length?_.push(new Oe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==p&&_.push(new Oe(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=Vn(r[1]),2!==r.length?_.push(new Oe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==p&&_.push(new Oe(`${l}[1]`,r[1],`object expected, ${p} found`))}return _}function vr(a,r){const l=a.key,u=a.style,p=a.styleSpec,_=a.value,v=a.objectKey,C=p[`${r}_${a.layerType}`];if(!C)return[];const D=v.match(/^(.*)-transition$/);if("paint"===r&&D&&C[D[1]]&&C[D[1]].transition)return It({key:l,value:_,valueSpec:p.transition,style:u,styleSpec:p});const M=a.valueSpec||C[v];if(!M)return[new Oe(l,_,`unknown property "${v}"`)];let I;if("string"===Vn(_)&&Wl(M)&&!M.tokens&&(I=/^{([^}]+)}$/.exec(_)))return[new Oe(l,_,`"${v}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const P=[];return"symbol"===a.layerType&&("text-field"===v&&u&&!u.glyphs&&P.push(new Oe(l,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Ah(Fn(_))&&"identity"===Ht(_.type)&&P.push(new Oe(l,_,'"text-font" does not support identity functions'))),P.concat(It({key:a.key,value:_,valueSpec:M,style:u,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:v}))}function Zr(a){return vr(a,"paint")}function Wa(a){return vr(a,"layout")}function Za(a){let r=[];const l=a.value,u=a.key,p=a.style,_=a.styleSpec;l.type||l.ref||r.push(new Oe(u,l,'either "type" or "ref" is required'));let v=Ht(l.type);const C=Ht(l.ref);if(l.id){const D=Ht(l.id);for(let M=0;M<a.arrayIndex;M++){const I=p.layers[M];Ht(I.id)===D&&r.push(new Oe(u,l.id,`duplicate layer id "${l.id}", previously used at line ${I.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(M=>{M in l&&r.push(new Oe(u,l[M],`"${M}" is prohibited for ref layers`))}),p.layers.forEach(M=>{Ht(M.id)===C&&(D=M)}),D?D.ref?r.push(new Oe(u,l.ref,"ref cannot reference another ref layer")):v=Ht(D.type):r.push(new Oe(u,l.ref,`ref layer "${C}" not found`))}else if("background"!==v&&"sky"!==v)if(l.source){const D=p.sources&&p.sources[l.source],M=D&&Ht(D.type);D?"vector"===M&&"raster"===v?r.push(new Oe(u,l.source,`layer "${l.id}" requires a raster source`)):"raster"===M&&"raster"!==v?r.push(new Oe(u,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==M||l["source-layer"]?"raster-dem"===M&&"hillshade"!==v?r.push(new Oe(u,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!l.paint||!l.paint["line-gradient"]||"geojson"===M&&D.lineMetrics||r.push(new Oe(u,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Oe(u,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Oe(u,l.source,`source "${l.source}" not found`))}else r.push(new Oe(u,l,'missing required property "source"'));return r=r.concat(Lr({key:u,value:l,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>It({key:`${u}.type`,value:l.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:rf,layout:D=>Lr({layer:l,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":M=>Wa(zt({layerType:v},M))}}),paint:D=>Lr({layer:l,key:D.key,value:D.value,style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":M=>Zr(zt({layerType:v},M))}})}})),r}function rr(a){const r=a.value,l=a.key,u=Vn(r);return"string"!==u?[new Oe(l,r,`string expected, ${u} found`)]:[]}const Nh={promoteId:function({key:a,value:r}){if("string"===Vn(r))return rr({key:a,value:r});{const l=[];for(const u in r)l.push(...rr({key:`${a}.${u}`,value:r[u]}));return l}}};function Pu(a){const r=a.value,l=a.key,u=a.styleSpec,p=a.style;if(!r.type)return[new Oe(l,r,'"type" is required')];const _=Ht(r.type);let v;switch(_){case"vector":case"raster":case"raster-dem":return v=Lr({key:l,value:r,valueSpec:u[`source_${_.replace("-","_")}`],style:a.style,styleSpec:u,objectElementValidators:Nh}),v;case"geojson":if(v=Lr({key:l,value:r,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Nh}),r.cluster)for(const C in r.clusterProperties){const[D,M]=r.clusterProperties[C],I="string"==typeof D?[D,["accumulated"],["get",C]]:D;v.push(...Bs({key:`${l}.${C}.map`,value:M,expressionContext:"cluster-map"})),v.push(...Bs({key:`${l}.${C}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return v;case"video":return Lr({key:l,value:r,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Lr({key:l,value:r,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new Oe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qa({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:u})}}function Nu(a){const r=a.value,l=a.styleSpec,u=l.light,p=a.style;let _=[];const v=Vn(r);if(void 0===r)return _;if("object"!==v)return _=_.concat([new Oe("light",r,`object expected, ${v} found`)]),_;for(const C in r){const D=C.match(/^(.*)-transition$/);_=_.concat(D&&u[D[1]]&&u[D[1]].transition?It({key:C,value:r[C],valueSpec:l.transition,style:p,styleSpec:l}):u[C]?It({key:C,value:r[C],valueSpec:u[C],style:p,styleSpec:l}):[new Oe(C,r[C],`unknown property "${C}"`)])}return _}function Vs(a){const r=a.value,l=a.key,u=a.style,p=a.styleSpec,_=p.terrain;let v=[];const C=Vn(r);if(void 0===r)return v;if("object"!==C)return v=v.concat([new Oe("terrain",r,`object expected, ${C} found`)]),v;for(const D in r){const M=D.match(/^(.*)-transition$/);v=v.concat(M&&_[M[1]]&&_[M[1]].transition?It({key:D,value:r[D],valueSpec:p.transition,style:u,styleSpec:p}):_[D]?It({key:D,value:r[D],valueSpec:_[D],style:u,styleSpec:p}):[new Oe(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=u.sources&&u.sources[r.source],M=D&&Ht(D.type);D?"raster-dem"!==M&&v.push(new Oe(l,r.source,`terrain cannot be used with a source of type ${M}, it only be used with a "raster-dem" source type`)):v.push(new Oe(l,r.source,`source "${r.source}" not found`))}else v.push(new Oe(l,r,'terrain is missing required property "source"'));return v}function Uc(a){const r=a.value,l=a.style,u=a.styleSpec,p=u.fog;let _=[];const v=Vn(r);if(void 0===r)return _;if("object"!==v)return _=_.concat([new Oe("fog",r,`object expected, ${v} found`)]),_;for(const C in r){const D=C.match(/^(.*)-transition$/);_=_.concat(D&&p[D[1]]&&p[D[1]].transition?It({key:C,value:r[C],valueSpec:u.transition,style:l,styleSpec:u}):p[C]?It({key:C,value:r[C],valueSpec:p[C],style:l,styleSpec:u}):[new Oe(C,r[C],`unknown property "${C}"`)])}return _}const Ru={"*":()=>[],array:zc,boolean:function(a){const r=a.value,l=a.key,u=Vn(r);return"boolean"!==u?[new Oe(l,r,`boolean expected, ${u} found`)]:[]},number:Iu,color:function(a){const r=a.key,l=a.value,u=Vn(l);return"string"!==u?[new Oe(r,l,`color expected, ${u} found`)]:null===Ll.parseCSSColor(l)?[new Oe(r,l,`color expected, "${l}" found`)]:[]},constants:Vt,enum:qa,filter:rf,function:Wr,layer:Za,object:Lr,source:Pu,light:Nu,terrain:Vs,fog:Uc,string:rr,formatted:function(a){return 0===rr(a).length?[]:Bs(a)},resolvedImage:function(a){return 0===rr(a).length?[]:Bs(a)}};function It(a){const r=a.value,l=a.valueSpec,u=a.styleSpec;return l.expression&&Ah(Ht(r))?Wr(a):l.expression&&Lc(Fn(r))?Bs(a):l.type&&Ru[l.type]?Ru[l.type](a):Lr(zt({},a,{valueSpec:l.type?u[l.type]:l}))}function of(a){const r=a.value,l=a.key,u=rr(a);return u.length||(-1===r.indexOf("{fontstack}")&&u.push(new Oe(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&u.push(new Oe(l,r,'"glyphs" url must include a "{range}" token'))),u}function zs(a,r=ge){let l=[];return l=l.concat(It({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:of,"*":()=>[]}})),a.constants&&(l=l.concat(Vt({key:"constants",value:a.constants,style:a,styleSpec:r}))),Rh(l)}function Rh(a){return[].concat(a).sort((r,l)=>r.line-l.line)}function Us(a){return function(...r){return Rh(a.apply(this,r))}}zs.source=Us(Pu),zs.light=Us(Nu),zs.terrain=Us(Vs),zs.fog=Us(Uc),zs.layer=Us(Za),zs.filter=Us(rf),zs.paintProperty=Us(Zr),zs.layoutProperty=Us(Wa);const Xa=zs,Fh=Xa.light,Fu=Xa.fog,tt=Xa.paintProperty,An=Xa.layoutProperty;function mn(a,r){let l=!1;if(r&&r.length)for(const u of r)a.fire(new Xe(new Error(u.message))),l=!0;return l}var Ti=oo;function oo(a,r,l){var u=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var _=0;_<this.d*this.d;_++){var v=p[3+_],C=p[3+_+1];u.push(v===C?null:p.subarray(v,C))}var D=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],D),this.bboxes=p.subarray(D),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var M=0;M<this.d*this.d;M++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=a,this.padding=l,this.scale=r/a,this.uid=0;var I=l/r*a;this.min=-I,this.max=a+I}oo.prototype.insert=function(a,r,l,u,p){this._forEachCell(r,l,u,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)},oo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},oo.prototype._insertCell=function(a,r,l,u,p,_){this.cells[p].push(_)},oo.prototype.query=function(a,r,l,u,p){var _=this.min,v=this.max;if(a<=_&&r<=_&&v<=l&&v<=u&&!p)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,r,l,u,this._queryCell,C,{},p),C},oo.prototype._queryCell=function(a,r,l,u,p,_,v,C){var D=this.cells[p];if(null!==D)for(var M=this.keys,I=this.bboxes,P=0;P<D.length;P++){var N=D[P];if(void 0===v[N]){var B=4*N;(C?C(I[B+0],I[B+1],I[B+2],I[B+3]):a<=I[B+2]&&r<=I[B+3]&&l>=I[B+0]&&u>=I[B+1])?(v[N]=!0,_.push(M[N])):v[N]=!1}}},oo.prototype._forEachCell=function(a,r,l,u,p,_,v,C){for(var D=this._convertToCellCoord(a),M=this._convertToCellCoord(r),I=this._convertToCellCoord(l),P=this._convertToCellCoord(u),N=D;N<=I;N++)for(var B=M;B<=P;B++){var G=this.d*B+N;if((!C||C(this._convertFromCellCoord(N),this._convertFromCellCoord(B),this._convertFromCellCoord(N+1),this._convertFromCellCoord(B+1)))&&p.call(this,a,r,l,u,G,_,v,C))return}},oo.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},oo.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},oo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,r=3+this.cells.length+1+1,l=0,u=0;u<this.cells.length;u++)l+=this.cells[u].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var _=r,v=0;v<a.length;v++){var C=a[v];p[3+v]=_,p.set(C,_),_+=C.length}return p[3+a.length]=_,p.set(this.keys,_),p[3+a.length+1]=_+=this.keys.length,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer};const{ImageData:Jl,ImageBitmap:qo}=ye,Ya={};function yt(a,r,l={}){Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),Ya[a]={klass:r,omit:l.omit||[],shallow:l.shallow||[]}}yt("Object",Object),Ti.serialize=function(a,r){const l=a.toArrayBuffer();return r&&r.push(l),{buffer:l}},Ti.deserialize=function(a){return new Ti(a.buffer)},yt("Grid",Ti),yt("Color",Wt),yt("Error",Error),yt("ResolvedImage",Rr),yt("StylePropertyFunction",Vc),yt("StyleExpression",Ls,{omit:["_evaluator"]}),yt("ZoomDependentExpression",da),yt("ZoomConstantExpression",Bc),yt("CompoundExpression",To,{omit:["_evaluate"]});for(const a in Hl)Hl[a]._classRegistryKey||yt(`Expression_${a}`,Hl[a]);function sf(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function af(a){return qo&&a instanceof qo}function ga(a,r){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(sf(a)||af(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return r&&r.push(l.buffer),l}if(a instanceof Jl)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const u of a)l.push(ga(u,r));return l}if("object"==typeof a){const l=a.constructor,u=l._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");const p=l.serialize?l.serialize(a,r):{};if(!l.serialize){for(const _ in a){if(!a.hasOwnProperty(_)||Ya[u].omit.indexOf(_)>=0)continue;const v=a[_];p[_]=Ya[u].shallow.indexOf(_)>=0?v:ga(v,r)}a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof a)}function ma(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||sf(a)||af(a)||ArrayBuffer.isView(a)||a instanceof Jl)return a;if(Array.isArray(a))return a.map(ma);if("object"==typeof a){const r=a.$name||"Object",{klass:l}=Ya[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(a);const u=Object.create(l.prototype);for(const p of Object.keys(a)){if("$name"===p)continue;const _=a[p];u[p]=Ya[r].shallow.indexOf(p)>=0?_:ma(_)}return u}throw new Error("can't deserialize object of type "+typeof a)}class br{constructor(){this.first=!0}update(r,l){const u=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=u,!0))}}const Wo=a=>a>=1536&&a<=1791,Oh=a=>a>=1872&&a<=1919,Ja=a=>a>=2208&&a<=2303,so=a=>a>=11904&&a<=12031,lf=a=>a>=12032&&a<=12255,Lh=a=>a>=12272&&a<=12287,Ka=a=>a>=12288&&a<=12351,Bh=a=>a>=12352&&a<=12447,Kl=a=>a>=12448&&a<=12543,$c=a=>a>=12544&&a<=12591,Ou=a=>a>=12704&&a<=12735,jc=a=>a>=12736&&a<=12783,Vh=a=>a>=12784&&a<=12799,Hc=a=>a>=12800&&a<=13055,Qa=a=>a>=13056&&a<=13311,zh=a=>a>=13312&&a<=19903,Lu=a=>a>=19968&&a<=40959,Ql=a=>a>=40960&&a<=42127,Uh=a=>a>=42128&&a<=42191,_s=a=>a>=44032&&a<=55215,cf=a=>a>=63744&&a<=64255,Gc=a=>a>=64336&&a<=65023,xr=a=>a>=65040&&a<=65055,ys=a=>a>=65072&&a<=65103,Mi=a=>a>=65104&&a<=65135,Zo=a=>a>=65136&&a<=65279,ec=a=>a>=65280&&a<=65519;function $s(a){for(const r of a)if(el(r.charCodeAt(0)))return!0;return!1}function Yp(a){for(const r of a)if(!uf(r.charCodeAt(0)))return!1;return!0}function uf(a){return!(Wo(a)||Oh(a)||Ja(a)||Gc(a)||Zo(a))}function el(a){return!(746!==a&&747!==a&&(a<4352||!(Ou(a)||$c(a)||ys(a)&&!(a>=65097&&a<=65103)||cf(a)||Qa(a)||so(a)||jc(a)||!(!Ka(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||zh(a)||Lu(a)||Hc(a)||(r=a,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(a)||(r=>r>=55216&&r<=55295)(a)||(r=>r>=4352&&r<=4607)(a)||_s(a)||Bh(a)||Lh(a)||(r=>r>=12688&&r<=12703)(a)||lf(a)||Vh(a)||Kl(a)&&12540!==a||!(!ec(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Mi(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(r=>r>=5120&&r<=5759)(a)||(r=>r>=6320&&r<=6399)(a)||xr(a)||(r=>r>=19904&&r<=19967)(a)||Ql(a)||Uh(a))));var r}function qc(a){return!(el(a)||(r=a,(l=r)>=128&&l<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(l=>l>=8192&&l<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(l=>l>=8448&&l<=8527)(r)||(l=>l>=8528&&l<=8591)(r)||(l=>l>=8960&&l<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(l=>l>=9216&&l<=9279)(r)&&9251!==r||(l=>l>=9280&&l<=9311)(r)||(l=>l>=9312&&l<=9471)(r)||(l=>l>=9632&&l<=9727)(r)||(l=>l>=9728&&l<=9983)(r)&&!(r>=9754&&r<=9759)||(l=>l>=11008&&l<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ka(r)||Kl(r)||(l=>l>=57344&&l<=63743)(r)||ys(r)||Mi(r)||ec(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,l}function Wc(a){return a>=1424&&a<=2303||Gc(a)||Zo(a)}function tl(a,r){return!(!r&&Wc(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function g(a){for(const r of a)if(Wc(r.charCodeAt(0)))return!0;return!1}const s="deferred",h="loading",m="loaded";let b=null,x="unavailable",E=null;const S=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(x="error"),b&&b(a)};function k(){R.fire(new lt("pluginStateChange",{pluginStatus:x,pluginURL:E}))}const R=new Ct,L=function(){return x},z=function(){if(x!==s||!E)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");x=h,k(),E&&F({url:E},a=>{a?S(a):(x=m,k())})},$={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>x===m||null!=$.applyArabicShaping,isLoading:()=>x===h,setState(a){x=a.pluginStatus,E=a.pluginURL},isParsed:()=>null!=$.applyArabicShaping&&null!=$.processBidirectionalText&&null!=$.processStyledBidirectionalText,getPluginURL:()=>E};class H{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new br,this.transition={})}isSupportedScript(r){return function(l,u){for(const p of l)if(!tl(p.charCodeAt(0),u))return!1;return!0}(r,$.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),u=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*l}}}class J{constructor(r,l){this.property=r,this.value=l,this.expression=function(u,p){if(Ah(u))return new Vc(u,p);if(Lc(u)){const _=kh(u,p);if("error"===_.result)throw new Error(_.value.map(v=>`${v.key}: ${v.message}`).join(", "));return _.value}{let _=u;return"string"==typeof u&&"color"===p.type&&(_=Wt.parse(u)),{kind:"constant",evaluate:()=>_}}}(void 0===l?r.specification.default:l,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,l,u){return this.property.possiblyEvaluate(this,r,l,u)}}class Q{constructor(r){this.property=r,this.value=new J(r,void 0)}transitioned(r,l){return new X(this.property,this.value,l,Bt({},r.transition,this.transition),r.now)}untransitioned(){return new X(this.property,this.value,null,{},0)}}class le{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return fi(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Q(this._values[r].property)),this._values[r].value=new J(this._values[r].property,null===l?void 0:fi(l))}getTransition(r){return fi(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new Q(this._values[r].property)),this._values[r].transition=fi(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u);const p=this.getTransition(l);void 0!==p&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const u=new te(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(r,l._values[p]);return u}untransitioned(){const r=new te(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class X{constructor(r,l,u,p,_){const v=p.delay||0,C=p.duration||0;_=_||0,this.property=r,this.value=l,this.begin=_+v,this.end=this.begin+C,r.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(r,l,u){const p=r.now||0,_=this.value.possiblyEvaluate(r,l,u),v=this.prior;if(v){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return v.possiblyEvaluate(r,l,u);{const C=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(r,l,u),_,xt(C))}}return _}}class te{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,u){const p=new _e(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(r,l,u);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class se{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return fi(this._values[r].value)}setValue(r,l){this._values[r]=new J(this._values[r].property,null===l?void 0:fi(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const u=this.getValue(l);void 0!==u&&(r[l]=u)}return r}possiblyEvaluate(r,l,u){const p=new _e(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(r,l,u);return p}}class he{constructor(r,l,u){this.property=r,this.value=l,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,l,u,p){return this.property.evaluate(this.value,this.parameters,r,l,u,p)}}class _e{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class oe{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,u){const p=wt[this.specification.type];return p?p(r,l,u):r}}class we{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,u,p){return new he(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(l,null,{},u,p)}:r.expression,l)}interpolate(r,l,u){if("constant"!==r.value.kind||"constant"!==l.value.kind)return r;if(void 0===r.value.value||void 0===l.value.value)return new he(this,{kind:"constant",value:void 0},r.parameters);const p=wt[this.specification.type];return p?new he(this,{kind:"constant",value:p(r.value.value,l.value.value,u)},r.parameters):r}evaluate(r,l,u,p,_,v){return"constant"===r.kind?r.value:r.evaluate(l,u,p,_,v)}}class ze extends we{possiblyEvaluate(r,l,u,p){if(void 0===r.value)return new he(this,{kind:"constant",value:void 0},l);if("constant"===r.expression.kind){const _=r.expression.evaluate(l,null,{},u,p),v="resolvedImage"===r.property.specification.type&&"string"!=typeof _?_.name:_,C=this._calculate(v,v,v,l);return new he(this,{kind:"constant",value:C},l)}if("camera"===r.expression.kind){const _=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new he(this,{kind:"constant",value:_},l)}return new he(this,r.expression,l)}evaluate(r,l,u,p,_,v){if("source"===r.kind){const C=r.evaluate(l,u,p,_,v);return this._calculate(C,C,C,l)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},u,p),r.evaluate({zoom:Math.floor(l.zoom)},u,p),r.evaluate({zoom:Math.floor(l.zoom)+1},u,p),l):r.value}_calculate(r,l,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:l,other:u}:{from:u,to:l,other:r}}interpolate(r){return r}}class Ye{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,p){if(void 0!==r.value){if("constant"===r.expression.kind){const _=r.expression.evaluate(l,null,{},u,p);return this._calculate(_,_,_,l)}return this._calculate(r.expression.evaluate(new H(Math.floor(l.zoom-1),l)),r.expression.evaluate(new H(Math.floor(l.zoom),l)),r.expression.evaluate(new H(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:u,to:l}}interpolate(r){return r}}class xe{constructor(r){this.specification=r}possiblyEvaluate(r,l,u,p){return!!r.expression.evaluate(l,null,{},u,p)}interpolate(){return!1}}class Fe{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const u=r[l];u.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new J(u,void 0),_=this.defaultTransitionablePropertyValues[l]=new Q(u);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate({})}}}function gt(a,r){return 256*(a=wn(Math.floor(a),0,255))+wn(Math.floor(r),0,255)}yt("DataDrivenProperty",we),yt("DataConstantProperty",oe),yt("CrossFadedDataDrivenProperty",ze),yt("CrossFadedProperty",Ye),yt("ColorRampProperty",xe);const mt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _t{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class it{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function vt(a,r=1){let l=0,u=0;return{members:a.map(p=>{const _=mt[p.type].BYTES_PER_ELEMENT,v=l=Xt(l,Math.max(r,_)),C=p.components||1;return u=Math.max(u,_),l+=_*C,{name:p.name,type:p.type,components:C,offset:v}}),size:Xt(l,Math.max(u,r)),alignment:r}}function Xt(a,r){return Math.ceil(a/r)*r}class $t extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=u,r}}$t.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",$t);class bi extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,u,p)}emplace(r,l,u,p,_){const v=4*r;return this.int16[v+0]=l,this.int16[v+1]=u,this.int16[v+2]=p,this.int16[v+3]=_,r}}bi.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",bi);class li extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,u,p,_,v,C)}emplace(r,l,u,p,_,v,C,D){const M=6*r,I=12*r,P=3*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.uint8[I+4]=p,this.uint8[I+5]=_,this.uint8[I+6]=v,this.uint8[I+7]=C,this.float32[P+2]=D,r}}li.prototype.bytesPerElement=12,yt("StructArrayLayout2i4ub1f12",li);class Zt extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,u)}emplace(r,l,u,p){const _=3*r;return this.float32[_+0]=l,this.float32[_+1]=u,this.float32[_+2]=p,r}}Zt.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",Zt);class rn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D,M,I){const P=this.length;return this.resize(P+1),this.emplace(P,r,l,u,p,_,v,C,D,M,I)}emplace(r,l,u,p,_,v,C,D,M,I,P){const N=10*r;return this.uint16[N+0]=l,this.uint16[N+1]=u,this.uint16[N+2]=p,this.uint16[N+3]=_,this.uint16[N+4]=v,this.uint16[N+5]=C,this.uint16[N+6]=D,this.uint16[N+7]=M,this.uint16[N+8]=I,this.uint16[N+9]=P,r}}rn.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",rn);class mi extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D){const M=this.length;return this.resize(M+1),this.emplace(M,r,l,u,p,_,v,C,D)}emplace(r,l,u,p,_,v,C,D,M){const I=8*r;return this.uint16[I+0]=l,this.uint16[I+1]=u,this.uint16[I+2]=p,this.uint16[I+3]=_,this.uint16[I+4]=v,this.uint16[I+5]=C,this.uint16[I+6]=D,this.uint16[I+7]=M,r}}mi.prototype.bytesPerElement=16,yt("StructArrayLayout8ui16",mi);class Io extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re)}emplace(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue){const ve=16*r;return this.int16[ve+0]=l,this.int16[ve+1]=u,this.int16[ve+2]=p,this.int16[ve+3]=_,this.uint16[ve+4]=v,this.uint16[ve+5]=C,this.uint16[ve+6]=D,this.uint16[ve+7]=M,this.int16[ve+8]=I,this.int16[ve+9]=P,this.int16[ve+10]=N,this.int16[ve+11]=B,this.int16[ve+12]=G,this.int16[ve+13]=Z,this.int16[ve+14]=re,this.int16[ve+15]=ue,r}}Io.prototype.bytesPerElement=32,yt("StructArrayLayout4i4ui4i4i32",Io);class ao extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}ao.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",ao);class Gi extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D,M,I,P,N,B){const G=this.length;return this.resize(G+1),this.emplace(G,r,l,u,p,_,v,C,D,M,I,P,N,B)}emplace(r,l,u,p,_,v,C,D,M,I,P,N,B,G){const Z=20*r,re=10*r;return this.int16[Z+0]=l,this.int16[Z+1]=u,this.int16[Z+2]=p,this.int16[Z+3]=_,this.int16[Z+4]=v,this.float32[re+3]=C,this.float32[re+4]=D,this.float32[re+5]=M,this.float32[re+6]=I,this.int16[Z+14]=P,this.uint32[re+8]=N,this.uint16[Z+18]=B,this.uint16[Z+19]=G,r}}Gi.prototype.bytesPerElement=40,yt("StructArrayLayout5i4f1i1ul2ui40",Gi);class Xr extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C){const D=this.length;return this.resize(D+1),this.emplace(D,r,l,u,p,_,v,C)}emplace(r,l,u,p,_,v,C,D){const M=8*r;return this.int16[M+0]=l,this.int16[M+1]=u,this.int16[M+2]=p,this.int16[M+4]=_,this.int16[M+5]=v,this.int16[M+6]=C,this.int16[M+7]=D,r}}Xr.prototype.bytesPerElement=16,yt("StructArrayLayout3i2i2i16",Xr);class Xo extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,l,u,p,_)}emplace(r,l,u,p,_,v){const C=4*r,D=8*r;return this.float32[C+0]=l,this.float32[C+1]=u,this.float32[C+2]=p,this.int16[D+6]=_,this.int16[D+7]=v,r}}Xo.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",Xo);class vs extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,u,p)}emplace(r,l,u,p,_){const v=12*r,C=3*r;return this.uint8[v+0]=l,this.uint8[v+1]=u,this.float32[C+1]=p,this.float32[C+2]=_,r}}vs.prototype.bytesPerElement=12,yt("StructArrayLayout2ub2f12",vs);class kn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,u)}emplace(r,l,u,p){const _=3*r;return this.uint16[_+0]=l,this.uint16[_+1]=u,this.uint16[_+2]=p,r}}kn.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",kn);class fn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se)}emplace(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se,Ae){const He=30*r,We=15*r,et=60*r;return this.int16[He+0]=l,this.int16[He+1]=u,this.int16[He+2]=p,this.float32[We+2]=_,this.float32[We+3]=v,this.uint16[He+8]=C,this.uint16[He+9]=D,this.uint32[We+5]=M,this.uint32[We+6]=I,this.uint32[We+7]=P,this.uint16[He+16]=N,this.uint16[He+17]=B,this.uint16[He+18]=G,this.float32[We+10]=Z,this.float32[We+11]=re,this.uint8[et+48]=ue,this.uint8[et+49]=ve,this.uint8[et+50]=Ee,this.uint32[We+13]=Te,this.int16[He+28]=Se,this.uint8[et+58]=Ae,r}}fn.prototype.bytesPerElement=60,yt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",fn);class Tn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se,Ae,He,We,et,st,Ze,Qe,at,Ke){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se,Ae,He,We,et,st,Ze,Qe,at,Ke)}emplace(r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z,re,ue,ve,Ee,Te,Se,Ae,He,We,et,st,Ze,Qe,at,Ke,Ft){const bt=38*r,Mn=19*r;return this.int16[bt+0]=l,this.int16[bt+1]=u,this.int16[bt+2]=p,this.float32[Mn+2]=_,this.float32[Mn+3]=v,this.int16[bt+8]=C,this.int16[bt+9]=D,this.int16[bt+10]=M,this.int16[bt+11]=I,this.int16[bt+12]=P,this.int16[bt+13]=N,this.uint16[bt+14]=B,this.uint16[bt+15]=G,this.uint16[bt+16]=Z,this.uint16[bt+17]=re,this.uint16[bt+18]=ue,this.uint16[bt+19]=ve,this.uint16[bt+20]=Ee,this.uint16[bt+21]=Te,this.uint16[bt+22]=Se,this.uint16[bt+23]=Ae,this.uint16[bt+24]=He,this.uint16[bt+25]=We,this.uint16[bt+26]=et,this.uint16[bt+27]=st,this.uint16[bt+28]=Ze,this.uint32[Mn+15]=Qe,this.float32[Mn+16]=at,this.float32[Mn+17]=Ke,this.float32[Mn+18]=Ft,r}}Tn.prototype.bytesPerElement=76,yt("StructArrayLayout3i2f6i15ui1ul3f76",Tn);class Zn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}Zn.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",Zn);class Yi extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,u)}emplace(r,l,u,p){const _=3*r;return this.int16[_+0]=l,this.int16[_+1]=u,this.int16[_+2]=p,r}}Yi.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",Yi);class zn extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,u,p)}emplace(r,l,u,p,_){const v=6*r;return this.uint32[3*r+0]=l,this.uint16[v+2]=u,this.uint16[v+3]=p,this.uint16[v+4]=_,r}}zn.prototype.bytesPerElement=12,yt("StructArrayLayout1ul3ui12",zn);class ki extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=u,r}}ki.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",ki);class wr extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}wr.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",wr);class Ao extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,r,l,u,p,_)}emplace(r,l,u,p,_,v){const C=5*r;return this.float32[C+0]=l,this.float32[C+1]=u,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=v,r}}Ao.prototype.bytesPerElement=20,yt("StructArrayLayout5f20",Ao);class bs extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const u=this.length;return this.resize(u+1),this.emplace(u,r,l)}emplace(r,l,u){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=u,r}}bs.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",bs);class hf extends it{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,u,p)}emplace(r,l,u,p,_){const v=4*r;return this.float32[v+0]=l,this.float32[v+1]=u,this.float32[v+2]=p,this.float32[v+3]=_,r}}hf.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",hf);class $h extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$h.prototype.size=40;class nl extends Gi{get(r){return new $h(this,r)}}yt("CollisionBoxArray",nl);class Jp extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Jp.prototype.size=60;class Zc extends fn{get(r){return new Jp(this,r)}}yt("PlacedSymbolArray",Zc);class Yt extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Yt.prototype.size=76;class f_ extends Tn{get(r){return new Yt(this,r)}}yt("SymbolInstanceArray",f_);class Kp extends Zn{getoffsetX(r){return this.float32[1*r+0]}}yt("GlyphOffsetArray",Kp);class iv extends Yi{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}yt("SymbolLineVertexArray",iv);class rv extends _t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rv.prototype.size=12;class ov extends zn{get(r){return new rv(this,r)}}yt("FeatureIndexArray",ov);class sv extends _t{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}sv.prototype.size=4;class av extends ki{get(r){return new sv(this,r)}}yt("FillExtrusionCentroidArray",av);const Dw=vt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ew=vt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var lv=fs(function(a){a.exports=function(r,l){var u,p,_,v,C,D,M,I;for(p=r.length-(u=3&r.length),_=l,C=3432918353,D=461845907,I=0;I<p;)M=255&r.charCodeAt(I)|(255&r.charCodeAt(++I))<<8|(255&r.charCodeAt(++I))<<16|(255&r.charCodeAt(++I))<<24,++I,_=27492+(65535&(v=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(M=0,u){case 3:M^=(255&r.charCodeAt(I+2))<<16;case 2:M^=(255&r.charCodeAt(I+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(I)))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}}),Tw=fs(function(a){a.exports=function(r,l){for(var u,p=r.length,_=l^p,v=0;p>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}}),il=lv,Mw=Tw;il.murmur3=lv,il.murmur2=Mw;class qi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,u,p){this.ids.push(jh(r)),this.positions.push(l,u,p)}getPositions(r){const l=jh(r);let u=0,p=this.ids.length-1;for(;u<p;){const v=u+p>>1;this.ids[v]>=l?p=v:u=v+1}const _=[];for(;this.ids[u]===l;)_.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return _}static serialize(r,l){const u=new Float64Array(r.ids),p=new Uint32Array(r.positions);return Bu(u,p,0,u.length-1),l&&l.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(r){const l=new qi;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function jh(a){const r=+a;return!isNaN(r)&&r<=K?r:il(String(a))}function Bu(a,r,l,u){for(;l<u;){const p=a[l+u>>1];let _=l-1,v=u+1;for(;;){do{_++}while(a[_]<p);do{v--}while(a[v]>p);if(_>=v)break;Qp(a,_,v),Qp(r,3*_,3*v),Qp(r,3*_+1,3*v+1),Qp(r,3*_+2,3*v+2)}v-l<u-v?(Bu(a,r,l,v),l=v+1):(Bu(a,r,v+1,u),u=v)}}function Qp(a,r,l){const u=a[r];a[r]=a[l],a[l]=u}yt("FeaturePositionMap",qi);class tc{constructor(r,l){this.gl=r.gl,this.location=l}}class lo extends tc{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class js extends tc{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Hh extends tc{constructor(r,l){super(r,l),this.current=Wt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Xc=new Float32Array(16),nc=new Float32Array(9);function df(a){return[gt(255*a.r,255*a.g),gt(255*a.b,255*a.a)]}class Gh{constructor(r,l,u){this.value=r,this.uniformNames=l.map(p=>`u_${p}`),this.type=u}setUniform(r,l,u){r.set(u.constantOr(this.value))}getBinding(r,l,u){return"color"===this.type?new Hh(r,l):new lo(r,l)}}class Vu{constructor(r,l){this.uniformNames=l.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=l.tl.concat(l.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,l,u,p){const _="u_pattern_to"===p||"u_dash_to"===p?this.patternTo:"u_pattern_from"===p||"u_dash_from"===p?this.patternFrom:"u_pixel_ratio_to"===p?this.pixelRatioTo:"u_pixel_ratio_from"===p?this.pixelRatioFrom:null;_&&r.set(_)}getBinding(r,l,u){return"u_pattern_from"===u||"u_pattern_to"===u||"u_dash_from"===u||"u_dash_to"===u?new js(r,l):new lo(r,l)}}class ic{constructor(r,l,u,p){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,l,u,p,_){const v=this.paintVertexArray.length,C=this.expression.evaluate(new H(0),l,{},p,[],_);this.paintVertexArray.resize(r),this._setPaintValue(v,r,C)}updatePaintArray(r,l,u,p){const _=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(r,l,_)}_setPaintValue(r,l,u){if("color"===this.type){const p=df(u);for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _a{constructor(r,l,u,p,_,v){this.expression=r,this.uniformNames=l.map(C=>`u_${C}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(r,l,u,p,_){const v=this.expression.evaluate(new H(this.zoom),l,{},p,[],_),C=this.expression.evaluate(new H(this.zoom+1),l,{},p,[],_),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,v,C)}updatePaintArray(r,l,u,p){const _=this.expression.evaluate({zoom:this.zoom},u,p),v=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(r,l,_,v)}_setPaintValue(r,l,u,p){if("color"===this.type){const _=df(u),v=df(p);for(let C=r;C<l;C++)this.paintVertexArray.emplace(C,_[0],_[1],v[0],v[1])}else{for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const u=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,p=wn(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);r.set(p)}getBinding(r,l,u){return new lo(r,l)}}class rl{constructor(r,l,u,p,_,v,C){this.expression=r,this.type=u,this.useIntegerZoom=p,this.zoom=_,this.layerId=C,this.paintVertexAttributes=("array"===u?Ew:Dw).members;for(let D=0;D<l.length;++D);this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(r,l,u){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],u)}updatePaintArray(r,l,u,p,_){this._setPaintValues(r,l,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(r,l,u,p){if(!p||!u)return;const{min:_,mid:v,max:C}=u,D=p[_],M=p[v],I=p[C];if(D&&M&&I)for(let P=r;P<l;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,M,D),this._setPaintValue(this.zoomOutPaintVertexArray,P,M,I)}_setPaintValue(r,l,u,p){r.emplace(l,u.tl[0],u.tl[1],u.br[0],u.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],u.pixelRatio,p.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ji{constructor(r,l,u=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const _ in r.paint._values){if(!u(_))continue;const v=r.paint.get(_);if(!(v instanceof he&&Wl(v.property.specification)))continue;const C=Sw(_,r.type),D=v.value,M=v.property.specification.type,I=v.property.useIntegerZoom,P=v.property.specification["property-type"],N="cross-faded"===P||"cross-faded-data-driven"===P,B="line-dasharray"===String(_)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==D.kind||B)if("source"===D.kind||B||N){const G=g_(_,M,"source");this.binders[_]=N?new rl(D,C,M,I,l,G,r.id):new ic(D,C,M,G),p.push(`/a_${_}`)}else{const G=g_(_,M,"composite");this.binders[_]=new _a(D,C,M,I,l,G),p.push(`/z_${_}`)}else this.binders[_]=N?new Vu(D.value,C):new Gh(D.value,C,M),p.push(`/u_${_}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof ic||l instanceof _a?l.maxValue:0}populatePaintArrays(r,l,u,p,_){for(const v in this.binders){const C=this.binders[v];(C instanceof ic||C instanceof _a||C instanceof rl)&&C.populatePaintArray(r,l,u,p,_)}}setConstantPatternPositions(r,l){for(const u in this.binders){const p=this.binders[u];p instanceof Vu&&p.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,u,p,_){let v=!1;for(const C in r){const D=l.getPositions(C);for(const M of D){const I=u.feature(M.index);for(const P in this.binders){const N=this.binders[P];if((N instanceof ic||N instanceof _a||N instanceof rl)&&!0===N.expression.isStateDependent){const B=p.paint.get(P);N.expression=B.value,N.updatePaintArray(M.start,M.end,I,r[C],_),v=!0}}}}return v}defines(){const r=[];for(const l in this.binders){const u=this.binders[l];(u instanceof Gh||u instanceof Vu)&&r.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof ic||u instanceof _a||u instanceof rl)for(let p=0;p<u.paintVertexAttributes.length;p++)r.push(u.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Gh||u instanceof Vu||u instanceof _a)for(const p of u.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const u=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof Gh||_ instanceof Vu||_ instanceof _a)for(const v of _.uniformNames)if(l[v]){const C=_.getBinding(r,l[v],v);u.push({name:v,property:p,binding:C})}}return u}setUniforms(r,l,u,p){for(const{name:_,property:v,binding:C}of l)this.binders[v].setUniform(C,p,u.get(v),_)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const u=this.binders[l];if(r&&u instanceof rl){const p=2===r.fromScale?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ic||u instanceof _a)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(r){for(const l in this.binders){const u=this.binders[l];(u instanceof ic||u instanceof _a||u instanceof rl)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof ic||l instanceof _a||l instanceof rl)&&l.destroy()}}}class ol{constructor(r,l,u=(()=>!0)){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new Ji(p,l,u);this.needsUpload=!1,this._featureMap=new qi,this._bufferOffset=0}populatePaintArrays(r,l,u,p,_,v){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(r,l,p,_,v);void 0!==l.id&&this._featureMap.add(l.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,u,p){for(const _ of u)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,l,_,p)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const zu={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Sw(a,r){return zu[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const p_={"line-pattern":{source:rn,composite:rn},"fill-pattern":{source:rn,composite:rn},"fill-extrusion-pattern":{source:rn,composite:rn},"line-dasharray":{source:mi,composite:mi}},cv={color:{source:bs,composite:hf},number:{source:Zn,composite:bs}};function g_(a,r,l){const u=p_[a];return u&&u[l]||cv[r][l]}yt("ConstantBinder",Gh),yt("CrossFadedConstantBinder",Vu),yt("SourceExpressionBinder",ic),yt("CrossFadedCompositeBinder",rl),yt("CompositeExpressionBinder",_a),yt("ProgramConfiguration",Ji,{omit:["_buffers"]}),yt("ProgramConfigurationSet",ol);const ff="-transition";class Hs extends Ct{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new se(l.layout)),l.paint)){this._transitionablePaint=new le(l.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _e(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,u={}){null!=l&&this._validate(An,`layers.${this.id}.layout.${r}`,r,l,u)||("visibility"!==r?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return As(r,ff)?this._transitionablePaint.getTransition(r.slice(0,-ff.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,u={}){if(null!=l&&this._validate(tt,`layers.${this.id}.paint.${r}`,r,l,u))return!1;if(As(r,ff))return this._transitionablePaint.setTransition(r.slice(0,-ff.length),l||void 0),!1;{const p=this._transitionablePaint._values[r],_="cross-faded-data-driven"===p.property.specification["property-type"],v=p.value.isDataDriven(),C=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const D=this._transitionablePaint._values[r].value;return D.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(r,C,D)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Rt(r,(l,u)=>!(void 0===l||"layout"===u&&!Object.keys(l).length||"paint"===u&&!Object.keys(l).length))}_validate(r,l,u,p,_={}){return(!_||!1!==_.validate)&&mn(this,r.call(Xa,{key:l,layerType:this.type,objectKey:u,value:p,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof he&&Wl(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const uv=vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:qh}=uv;class fr{constructor(r=[]){this.segments=r}prepareSegment(r,l,u,p){let _=this.segments[this.segments.length-1];return r>fr.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${fr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>fr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:l.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==p&&(_.sortKey=p),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,u,p){return new fr([{vertexOffset:r,primitiveOffset:l,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}fr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",fr);var Pn=8192;const m_=Math.pow(2,14)-1,Uu=-m_-1;function sl(a){const r=Pn/a.extent,l=a.loadGeometry();for(let u=0;u<l.length;u++){const p=l[u];for(let _=0;_<p.length;_++){const v=p[_],C=Math.round(v.x*r),D=Math.round(v.y*r);v.x=wn(C,Uu,m_),v.y=wn(D,Uu,m_),(C<v.x||C>v.x+1||D<v.y||D>v.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function xs(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?sl(a):[]}}function pf(a,r,l,u,p){a.emplaceBack(2*r+(u+1)/2,2*l+(p+1)/2)}class eg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new $t,this.indexArray=new kn,this.segments=new fr,this.programConfigurations=new ol(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u){const p=this.layers[0],_=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:C,id:D,index:M,sourceLayerIndex:I}of r){const P=this.layers[0]._featureFilter.needGeometry,N=xs(C,P);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),N,u))continue;const B=v?v.evaluate(N,{},u):void 0,G={id:D,properties:C.properties,type:C.type,sourceLayerIndex:I,index:M,geometry:P?N.geometry:sl(C),patterns:{},sortKey:B};_.push(G)}v&&_.sort((C,D)=>C.sortKey-D.sortKey);for(const C of _){const{geometry:D,index:M,sourceLayerIndex:I}=C,P=r[M].feature;this.addFeature(C,D,M,u),l.featureIndex.insert(P,D,M,I,this.index)}}update(r,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,qh),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,p){for(const _ of l)for(const v of _){const C=v.x,D=v.y;if(C<0||C>=Pn||D<0||D>=Pn)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),I=M.vertexLength;pf(this.layoutVertexArray,C,D,-1,-1),pf(this.layoutVertexArray,C,D,1,-1),pf(this.layoutVertexArray,C,D,1,1),pf(this.layoutVertexArray,C,D,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},p)}}function __(a,r){for(let l=0;l<a.length;l++)if(Wh(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(Wh(a,r[l]))return!0;return!!Yc(a,r)}function tg(a,r,l){return!!Wh(a,r)||!!ig(r,a,l)}function hv(a,r){if(1===a.length)return rg(r,a[0]);for(let l=0;l<r.length;l++){const u=r[l];for(let p=0;p<u.length;p++)if(Wh(a,u[p]))return!0}for(let l=0;l<a.length;l++)if(rg(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(Yc(a,r[l]))return!0;return!1}function ng(a,r,l){if(a.length>1){if(Yc(a,r))return!0;for(let u=0;u<r.length;u++)if(ig(r[u],a,l))return!0}for(let u=0;u<a.length;u++)if(ig(a[u],r,l))return!0;return!1}function Yc(a,r){if(0===a.length||0===r.length)return!1;for(let l=0;l<a.length-1;l++){const u=a[l],p=a[l+1];for(let _=0;_<r.length-1;_++)if($u(u,p,r[_],r[_+1]))return!0}return!1}function $u(a,r,l,u){return zo(a,l,u)!==zo(r,l,u)&&zo(a,r,l)!==zo(a,r,u)}function ig(a,r,l){const u=l*l;if(1===r.length)return a.distSqr(r[0])<u;for(let p=1;p<r.length;p++)if(je(a,r[p-1],r[p])<u)return!0;return!1}function je(a,r,l){const u=r.distSqr(l);if(0===u)return a.distSqr(r);const p=((a.x-r.x)*(l.x-r.x)+(a.y-r.y)*(l.y-r.y))/u;return a.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function rg(a,r){let l,u,p,_=!1;for(let v=0;v<a.length;v++){l=a[v];for(let C=0,D=l.length-1;C<l.length;D=C++)u=l[C],p=l[D],u.y>r.y!=p.y>r.y&&r.x<(p.x-u.x)*(r.y-u.y)/(p.y-u.y)+u.x&&(_=!_)}return _}function Wh(a,r){let l=!1;for(let u=0,p=a.length-1;u<a.length;p=u++){const _=a[u],v=a[p];_.y>r.y!=v.y>r.y&&r.x<(v.x-_.x)*(r.y-_.y)/(v.y-_.y)+_.x&&(l=!l)}return l}function rc(a,r,l,u,p){for(const v of a)if(r<=v.x&&l<=v.y&&u>=v.x&&p>=v.y)return!0;const _=[new q(r,l),new q(r,p),new q(u,p),new q(u,l)];if(a.length>2)for(const v of _)if(Wh(a,v))return!0;for(let v=0;v<a.length-1;v++)if(Zh(a[v],a[v+1],_))return!0;return!1}function Zh(a,r,l){const u=l[0],p=l[2];if(a.x<u.x&&r.x<u.x||a.x>p.x&&r.x>p.x||a.y<u.y&&r.y<u.y||a.y>p.y&&r.y>p.y)return!1;const _=zo(a,r,l[0]);return _!==zo(a,r,l[1])||_!==zo(a,r,l[2])||_!==zo(a,r,l[3])}function ju(a,r,l){const u=r.paint.get(a).value;return"constant"===u.kind?u.value:l.programConfigurations.get(r.id).getMaxValue(a)}function Xh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function og(a,r,l,u,p){if(!r[0]&&!r[1])return a;const _=q.convert(r)._mult(p);"viewport"===l&&_._rotate(-u);const v=[];for(let C=0;C<a.length;C++)v.push(a[C].sub(_));return v}function dv(a,r,l,u){const p=q.convert(a)._mult(u);return"viewport"===r&&p._rotate(-l),p}yt("CircleBucket",eg,{omit:["layers"]});const Hu=new Fe({"circle-sort-key":new we(ge.layout_circle["circle-sort-key"])});var ko={paint:new Fe({"circle-radius":new we(ge.paint_circle["circle-radius"]),"circle-color":new we(ge.paint_circle["circle-color"]),"circle-blur":new we(ge.paint_circle["circle-blur"]),"circle-opacity":new we(ge.paint_circle["circle-opacity"]),"circle-translate":new oe(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new oe(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oe(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oe(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(ge.paint_circle["circle-stroke-opacity"])}),layout:Hu},Br="undefined"!=typeof Float32Array?Float32Array:Array;function al(){var a=new Br(9);return Br!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function sg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ag(a,r,l){var u=r[0],p=r[1],_=r[2],v=r[3],C=r[4],D=r[5],M=r[6],I=r[7],P=r[8],N=r[9],B=r[10],G=r[11],Z=r[12],re=r[13],ue=r[14],ve=r[15],Ee=l[0],Te=l[1],Se=l[2],Ae=l[3];return a[0]=Ee*u+Te*C+Se*P+Ae*Z,a[1]=Ee*p+Te*D+Se*N+Ae*re,a[2]=Ee*_+Te*M+Se*B+Ae*ue,a[3]=Ee*v+Te*I+Se*G+Ae*ve,a[4]=(Ee=l[4])*u+(Te=l[5])*C+(Se=l[6])*P+(Ae=l[7])*Z,a[5]=Ee*p+Te*D+Se*N+Ae*re,a[6]=Ee*_+Te*M+Se*B+Ae*ue,a[7]=Ee*v+Te*I+Se*G+Ae*ve,a[8]=(Ee=l[8])*u+(Te=l[9])*C+(Se=l[10])*P+(Ae=l[11])*Z,a[9]=Ee*p+Te*D+Se*N+Ae*re,a[10]=Ee*_+Te*M+Se*B+Ae*ue,a[11]=Ee*v+Te*I+Se*G+Ae*ve,a[12]=(Ee=l[12])*u+(Te=l[13])*C+(Se=l[14])*P+(Ae=l[15])*Z,a[13]=Ee*p+Te*D+Se*N+Ae*re,a[14]=Ee*_+Te*M+Se*B+Ae*ue,a[15]=Ee*v+Te*I+Se*G+Ae*ve,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var lg=ag;function Jc(){var a=new Br(3);return Br!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function cg(a){return Math.hypot(a[0],a[1],a[2])}function Gu(a,r,l){var u=new Br(3);return u[0]=a,u[1]=r,u[2]=l,u}function y_(a,r,l){return a[0]=r[0]-l[0],a[1]=r[1]-l[1],a[2]=r[2]-l[2],a}function Kc(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a}function qu(a,r,l,u){return a[0]=r[0]+l[0]*u,a[1]=r[1]+l[1]*u,a[2]=r[2]+l[2]*u,a}function v_(a,r){var l=r[0],u=r[1],p=r[2],_=l*l+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),a[0]=r[0]*_,a[1]=r[1]*_,a[2]=r[2]*_,a}function fv(a,r,l){var u=l[0],p=l[1],_=l[2],v=r[0],C=r[1],D=r[2],M=p*D-_*C,I=_*v-u*D,P=u*C-p*v,N=p*P-_*I,B=_*M-u*P,G=u*I-p*M,Z=2*l[3];return I*=Z,P*=Z,B*=2,G*=2,a[0]=v+(M*=Z)+(N*=2),a[1]=C+I+B,a[2]=D+P+G,a}var Wu,pv=y_,Iw=Kc,gv=cg;function Yh(a,r,l){var u=r[0],p=r[1],_=r[2],v=r[3];return a[0]=l[0]*u+l[4]*p+l[8]*_+l[12]*v,a[1]=l[1]*u+l[5]*p+l[9]*_+l[13]*v,a[2]=l[2]*u+l[6]*p+l[10]*_+l[14]*v,a[3]=l[3]*u+l[7]*p+l[11]*_+l[15]*v,a}function ug(){var a=new Br(4);return Br!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Jh(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function gf(a,r,l){l*=.5;var u=r[0],p=r[1],_=r[2],v=r[3],C=Math.sin(l),D=Math.cos(l);return a[0]=u*D+v*C,a[1]=p*D+_*C,a[2]=_*D-p*C,a[3]=v*D-u*C,a}function Qc(a,r,l,u,p,_,v,C,D){if(_&&a.queryGeometry.isAboveHorizon)return!1;_&&(D*=a.pixelToTileUnitsFactor);for(const M of r)for(const I of M){const P=I.add(C),N=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(P.x,P.y,!0):0,B=_?P:mv(P,N,u),G=_?a.tilespaceRays.map(re=>mf(re,N)):a.queryGeometry.screenGeometry,Z=Yh([],[I.x,I.y,N,1],u);if(!v&&_?D*=Z[3]/l.cameraToCenterDistance:v&&!_&&(D*=l.cameraToCenterDistance/Z[3]),tg(G,B,D))return!0}return!1}function mv(a,r,l){const u=Yh([],[a.x,a.y,r,1],l);return new q(u[0]/u[3],u[1]/u[3])}Jc(),Wu=new Br(4),Br!=Float32Array&&(Wu[0]=0,Wu[1]=0,Wu[2]=0,Wu[3]=0),Jc(),Gu(1,0,0),Gu(0,1,0),ug(),ug(),al();const b_=Gu(0,0,0),Aw=Gu(0,0,1);function mf(a,r){const l=Jc();return b_[2]=r,a.intersectsPlane(b_,Aw,l),new q(l[0],l[1])}class _f extends eg{}function yf(a,{width:r,height:l},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*u);return a.width=r,a.height=l,a.data=p,a}function hg(a,{width:r,height:l},u){if(r===a.width&&l===a.height)return;const p=yf({},{width:r,height:l},u);vf(a,p,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,l)},u),a.width=r,a.height=l,a.data=p.data}function vf(a,r,l,u,p,_){if(0===p.width||0===p.height)return r;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||u.x>r.width-p.width||u.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,C=r.data;for(let D=0;D<p.height;D++){const M=((l.y+D)*a.width+l.x)*_,I=((u.y+D)*r.width+u.x)*_;for(let P=0;P<p.width*_;P++)C[I+P]=v[M+P]}return r}yt("HeatmapBucket",_f,{omit:["layers"]});class Po{constructor(r,l){yf(this,r,1,l)}resize(r){hg(this,r,1)}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,p,_){vf(r,l,u,p,_,1)}}class Yo{constructor(r,l){yf(this,r,4,l)}resize(r){hg(this,r,4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Yo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,u,p,_){vf(r,l,u,p,_,4)}}yt("AlphaImage",Po),yt("RGBAImage",Yo);var _v={paint:new Fe({"heatmap-radius":new we(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oe(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oe(ge.paint_heatmap["heatmap-opacity"])})};function dg(a){const r={},l=a.resolution||256,u=a.clips?a.clips.length:1,p=a.image||new Yo({width:l,height:u}),_=(v,C,D)=>{r[a.evaluationKey]=D;const M=a.expression.evaluate(r);p.data[v+C+0]=Math.floor(255*M.r/M.a),p.data[v+C+1]=Math.floor(255*M.g/M.a),p.data[v+C+2]=Math.floor(255*M.b/M.a),p.data[v+C+3]=Math.floor(255*M.a)};if(a.clips)for(let v=0,C=0;v<u;++v,C+=4*l)for(let D=0,M=0;D<l;D++,M+=4){const I=D/(l-1),{start:P,end:N}=a.clips[v];_(C,M,P*(1-I)+N*I)}else for(let v=0,C=0;v<l;v++,C+=4)_(0,C,v/(l-1));return p}var yv={paint:new Fe({"hillshade-illumination-direction":new oe(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oe(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oe(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oe(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oe(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oe(ge.paint_hillshade["hillshade-accent-color"])})};const vv=vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Jo}=vv;var ws=bf,x_=bf;function bf(a,r,l){l=l||2;var u,p,_,v,C,D,M,I=r&&r.length,P=I?r[0]*l:a.length,N=w_(a,0,P,l,!0),B=[];if(!N||N.next===N.prev)return B;if(I&&(N=function(Z,re,ue,ve){var Ee,Te,Se,Ae=[];for(Ee=0,Te=re.length;Ee<Te;Ee++)(Se=w_(Z,re[Ee]*ve,Ee<Te-1?re[Ee+1]*ve:Z.length,ve,!1))===Se.next&&(Se.steiner=!0),Ae.push(Qh(Se));for(Ae.sort(Cv),Ee=0;Ee<Ae.length;Ee++)Dv(Ae[Ee],ue),ue=oc(ue,ue.next);return ue}(a,r,N,l)),a.length>80*l){u=_=a[0],p=v=a[1];for(var G=l;G<P;G+=l)(C=a[G])<u&&(u=C),(D=a[G+1])<p&&(p=D),C>_&&(_=C),D>v&&(v=D);M=0!==(M=Math.max(_-u,v-p))?1/M:0}return Kh(N,B,l,u,p,M),B}function w_(a,r,l,u,p){var _,v;if(p===D_(a,r,l,u)>0)for(_=r;_<l;_+=u)v=wf(_,a[_],a[_+1],v);else for(_=l-u;_>=r;_-=u)v=wf(_,a[_],a[_+1],v);return v&&ed(v,v.next)&&(tu(v),v=v.next),v}function oc(a,r){if(!a)return a;r||(r=a);var l,u=a;do{if(l=!1,u.steiner||!ed(u,u.next)&&0!==_i(u.prev,u,u.next))u=u.next;else{if(tu(u),(u=r=u.prev)===u.next)break;l=!0}}while(l||u!==r);return r}function Kh(a,r,l,u,p,_,v){if(a){!v&&_&&function(I,P,N,B){var G=I;do{null===G.z&&(G.z=fg(G.x,G.y,P,N,B)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==I);G.prevZ.nextZ=null,G.prevZ=null,function(Z){var re,ue,ve,Ee,Te,Se,Ae,He,We=1;do{for(ue=Z,Z=null,Te=null,Se=0;ue;){for(Se++,ve=ue,Ae=0,re=0;re<We&&(Ae++,ve=ve.nextZ);re++);for(He=We;Ae>0||He>0&&ve;)0!==Ae&&(0===He||!ve||ue.z<=ve.z)?(Ee=ue,ue=ue.nextZ,Ae--):(Ee=ve,ve=ve.nextZ,He--),Te?Te.nextZ=Ee:Z=Ee,Ee.prevZ=Te,Te=Ee;ue=ve}Te.nextZ=null,We*=2}while(Se>1)}(G)}(a,u,p,_);for(var C,D,M=a;a.prev!==a.next;)if(C=a.prev,D=a.next,_?C_(a,u,p,_):bv(a))r.push(C.i/l),r.push(a.i/l),r.push(D.i/l),tu(a),a=D.next,M=D.next;else if((a=D)===M){v?1===v?Kh(a=xv(oc(a),r,l),r,l,u,p,_,2):2===v&&wv(a,r,l,u,p,_):Kh(oc(a),r,l,u,p,_,1);break}}}function bv(a){var r=a.prev,l=a,u=a.next;if(_i(r,l,u)>=0)return!1;for(var p=a.next.next;p!==a.prev;){if(eu(r.x,r.y,l.x,l.y,u.x,u.y,p.x,p.y)&&_i(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function C_(a,r,l,u){var p=a.prev,_=a,v=a.next;if(_i(p,_,v)>=0)return!1;for(var C=p.x>_.x?p.x>v.x?p.x:v.x:_.x>v.x?_.x:v.x,D=p.y>_.y?p.y>v.y?p.y:v.y:_.y>v.y?_.y:v.y,M=fg(p.x<_.x?p.x<v.x?p.x:v.x:_.x<v.x?_.x:v.x,p.y<_.y?p.y<v.y?p.y:v.y:_.y<v.y?_.y:v.y,r,l,u),I=fg(C,D,r,l,u),P=a.prevZ,N=a.nextZ;P&&P.z>=M&&N&&N.z<=I;){if(P!==a.prev&&P!==a.next&&eu(p.x,p.y,_.x,_.y,v.x,v.y,P.x,P.y)&&_i(P.prev,P,P.next)>=0||(P=P.prevZ,N!==a.prev&&N!==a.next&&eu(p.x,p.y,_.x,_.y,v.x,v.y,N.x,N.y)&&_i(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;P&&P.z>=M;){if(P!==a.prev&&P!==a.next&&eu(p.x,p.y,_.x,_.y,v.x,v.y,P.x,P.y)&&_i(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;N&&N.z<=I;){if(N!==a.prev&&N!==a.next&&eu(p.x,p.y,_.x,_.y,v.x,v.y,N.x,N.y)&&_i(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function xv(a,r,l){var u=a;do{var p=u.prev,_=u.next.next;!ed(p,_)&&pg(p,u,u.next,_)&&xf(p,_)&&xf(_,p)&&(r.push(p.i/l),r.push(u.i/l),r.push(_.i/l),tu(u),tu(u.next),u=a=_),u=u.next}while(u!==a);return oc(u)}function wv(a,r,l,u,p,_){var v=a;do{for(var C=v.next.next;C!==v.prev;){if(v.i!==C.i&&ya(v,C)){var D=Ev(v,C);return v=oc(v,v.next),D=oc(D,D.next),Kh(v,r,l,u,p,_),void Kh(D,r,l,u,p,_)}C=C.next}v=v.next}while(v!==a)}function Cv(a,r){return a.x-r.x}function Dv(a,r){if(r=function(u,p){var _,v=p,C=u.x,D=u.y,M=-1/0;do{if(D<=v.y&&D>=v.next.y&&v.next.y!==v.y){var I=v.x+(D-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(I<=C&&I>M){if(M=I,I===C){if(D===v.y)return v;if(D===v.next.y)return v.next}_=v.x<v.next.x?v:v.next}}v=v.next}while(v!==p);if(!_)return null;if(C===M)return _;var P,N=_,B=_.x,G=_.y,Z=1/0;v=_;do{C>=v.x&&v.x>=B&&C!==v.x&&eu(D<G?C:M,D,B,G,D<G?M:C,D,v.x,v.y)&&(P=Math.abs(D-v.y)/(C-v.x),xf(v,u)&&(P<Z||P===Z&&(v.x>_.x||v.x===_.x&&kw(_,v)))&&(_=v,Z=P)),v=v.next}while(v!==N);return _}(a,r)){var l=Ev(r,a);oc(r,r.next),oc(l,l.next)}}function kw(a,r){return _i(a.prev,a,r.prev)<0&&_i(r.next,a,a.next)<0}function fg(a,r,l,u,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*p)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-u)*p)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Qh(a){var r=a,l=a;do{(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next}while(r!==a);return l}function eu(a,r,l,u,p,_,v,C){return(p-v)*(r-C)-(a-v)*(_-C)>=0&&(a-v)*(u-C)-(l-v)*(r-C)>=0&&(l-v)*(_-C)-(p-v)*(u-C)>=0}function ya(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(l,u){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==u.i&&p.next.i!==u.i&&pg(p,p.next,l,u))return!0;p=p.next}while(p!==l);return!1}(a,r)&&(xf(a,r)&&xf(r,a)&&function(l,u){var p=l,_=!1,v=(l.x+u.x)/2,C=(l.y+u.y)/2;do{p.y>C!=p.next.y>C&&p.next.y!==p.y&&v<(p.next.x-p.x)*(C-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next}while(p!==l);return _}(a,r)&&(_i(a.prev,a,r.prev)||_i(a,r.prev,r))||ed(a,r)&&_i(a.prev,a,a.next)>0&&_i(r.prev,r,r.next)>0)}function _i(a,r,l){return(r.y-a.y)*(l.x-r.x)-(r.x-a.x)*(l.y-r.y)}function ed(a,r){return a.x===r.x&&a.y===r.y}function pg(a,r,l,u){var p=gg(_i(a,r,l)),_=gg(_i(a,r,u)),v=gg(_i(l,u,a)),C=gg(_i(l,u,r));return p!==_&&v!==C||!(0!==p||!td(a,l,r))||!(0!==_||!td(a,u,r))||!(0!==v||!td(l,a,u))||!(0!==C||!td(l,r,u))}function td(a,r,l){return r.x<=Math.max(a.x,l.x)&&r.x>=Math.min(a.x,l.x)&&r.y<=Math.max(a.y,l.y)&&r.y>=Math.min(a.y,l.y)}function gg(a){return a>0?1:a<0?-1:0}function xf(a,r){return _i(a.prev,a,a.next)<0?_i(a,r,a.next)>=0&&_i(a,a.prev,r)>=0:_i(a,r,a.prev)<0||_i(a,a.next,r)<0}function Ev(a,r){var l=new nd(a.i,a.x,a.y),u=new nd(r.i,r.x,r.y),p=a.next,_=r.prev;return a.next=r,r.prev=a,l.next=p,p.prev=l,u.next=l,l.prev=u,_.next=u,u.prev=_,u}function wf(a,r,l,u){var p=new nd(a,r,l);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function tu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function nd(a,r,l){this.i=a,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D_(a,r,l,u){for(var p=0,_=r,v=l-u;_<l;_+=u)p+=(a[v]-a[_])*(a[_+1]+a[v+1]),v=_;return p}function Pw(a,r,l,u,p){mg(a,r,l||0,u||a.length-1,p||Tv)}function mg(a,r,l,u,p){for(;u>l;){if(u-l>600){var _=u-l+1,v=r-l+1,C=Math.log(_),D=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*D*(_-D)/_)*(v-_/2<0?-1:1);mg(a,r,Math.max(l,Math.floor(r-v*D/_+M)),Math.min(u,Math.floor(r+(_-v)*D/_+M)),p)}var I=a[r],P=l,N=u;for(id(a,l,r),p(a[u],I)>0&&id(a,l,u);P<N;){for(id(a,P,N),P++,N--;p(a[P],I)<0;)P++;for(;p(a[N],I)>0;)N--}0===p(a[l],I)?id(a,l,N):id(a,++N,u),N<=r&&(l=N+1),r<=N&&(u=N-1)}}function id(a,r,l){var u=a[r];a[r]=a[l],a[l]=u}function Tv(a,r){return a<r?-1:a>r?1:0}function _g(a,r){const l=a.length;if(l<=1)return[a];const u=[];let p,_;for(let v=0;v<l;v++){const C=wc(a[v]);0!==C&&(a[v].area=Math.abs(C),void 0===_&&(_=C<0),_===C<0?(p&&u.push(p),p=[a[v]]):p.push(a[v]))}if(p&&u.push(p),r>1)for(let v=0;v<u.length;v++)u[v].length<=r||(Pw(u[v],r,1,u[v].length-1,Mv),u[v]=u[v].slice(0,r));return u}function Mv(a,r){return r.area-a.area}function Cf(a,r,l){const u=l.patternDependencies;let p=!1;for(const _ of r){const v=_.paint.get(`${a}-pattern`);v.isConstant()||(p=!0);const C=v.constantOr(null);C&&(p=!0,u[C.to]=!0,u[C.from]=!0)}return p}function Zu(a,r,l,u,p){const _=p.patternDependencies;for(const v of r){const C=v.paint.get(`${a}-pattern`).value;if("constant"!==C.kind){let D=C.evaluate({zoom:u-1},l,{},p.availableImages),M=C.evaluate({zoom:u},l,{},p.availableImages),I=C.evaluate({zoom:u+1},l,{},p.availableImages);D=D&&D.name?D.name:D,M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,_[D]=!0,_[M]=!0,_[I]=!0,l.patterns[v.id]={min:D,mid:M,max:I}}}return l}bf.deviation=function(a,r,l,u){var p=r&&r.length,_=Math.abs(D_(a,0,p?r[0]*l:a.length,l));if(p)for(var v=0,C=r.length;v<C;v++)_-=Math.abs(D_(a,r[v]*l,v<C-1?r[v+1]*l:a.length,l));var D=0;for(v=0;v<u.length;v+=3){var M=u[v]*l,I=u[v+1]*l,P=u[v+2]*l;D+=Math.abs((a[M]-a[P])*(a[I+1]-a[M+1])-(a[M]-a[I])*(a[P+1]-a[M+1]))}return 0===_&&0===D?0:Math.abs((D-_)/_)},bf.flatten=function(a){for(var r=a[0][0].length,l={vertices:[],holes:[],dimensions:r},u=0,p=0;p<a.length;p++){for(var _=0;_<a[p].length;_++)for(var v=0;v<r;v++)l.vertices.push(a[p][_][v]);p>0&&l.holes.push(u+=a[p-1].length)}return l},ws.default=x_;class Df{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $t,this.indexArray=new kn,this.indexArray2=new ki,this.programConfigurations=new ol(r.layers,r.zoom),this.segments=new fr,this.segments2=new fr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u){this.hasPattern=Cf("fill",this.layers,l);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:C,index:D,sourceLayerIndex:M}of r){const I=this.layers[0]._featureFilter.needGeometry,P=xs(v,I);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),P,u))continue;const N=p?p.evaluate(P,{},u,l.availableImages):void 0,B={id:C,properties:v.properties,type:v.type,sourceLayerIndex:M,index:D,geometry:I?P.geometry:sl(v),patterns:{},sortKey:N};_.push(B)}p&&_.sort((v,C)=>v.sortKey-C.sortKey);for(const v of _){const{geometry:C,index:D,sourceLayerIndex:M}=v;if(this.hasPattern){const I=Zu("fill",this.layers,v,this.zoom,l);this.patternFeatures.push(I)}else this.addFeature(v,C,D,u,{});l.featureIndex.insert(r[D].feature,C,D,M,this.index)}}update(r,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u)}addFeatures(r,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Jo),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,u,p,_){for(const v of _g(l,500)){let C=0;for(const B of v)C+=B.length;const D=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),M=D.vertexLength,I=[],P=[];for(const B of v){if(0===B.length)continue;B!==v[0]&&P.push(I.length/2);const G=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),I.push(B[0].x),I.push(B[0].y);for(let re=1;re<B.length;re++)this.layoutVertexArray.emplaceBack(B[re].x,B[re].y),this.indexArray2.emplaceBack(Z+re-1,Z+re),I.push(B[re].x),I.push(B[re].y);G.vertexLength+=B.length,G.primitiveLength+=B.length}const N=ws(I,P);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(M+N[B],M+N[B+1],M+N[B+2]);D.vertexLength+=C,D.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,_,p)}}yt("FillBucket",Df,{omit:["layers","patternFeatures"]});const yg=new Fe({"fill-sort-key":new we(ge.layout_fill["fill-sort-key"])});var Sv={paint:new Fe({"fill-antialias":new oe(ge.paint_fill["fill-antialias"]),"fill-opacity":new we(ge.paint_fill["fill-opacity"]),"fill-color":new we(ge.paint_fill["fill-color"]),"fill-outline-color":new we(ge.paint_fill["fill-outline-color"]),"fill-translate":new oe(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new oe(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new ze(ge.paint_fill["fill-pattern"])}),layout:yg};const yi=vt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Iv=vt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Av}=yi;var Ef=nu;function nu(a,r,l,u,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=u,this._values=p,a.readFields(kv,this,r)}function kv(a,r,l){1==a?r.id=l.readVarint():2==a?function(u,p){for(var _=u.readVarint()+u.pos;u.pos<_;){var v=p._keys[u.readVarint()],C=p._values[u.readVarint()];p.properties[v]=C}}(l,r):3==a?r.type=l.readVarint():4==a&&(r._geometry=l.pos)}function Pv(a){for(var r,l,u=0,p=0,_=a.length,v=_-1;p<_;v=p++)u+=((l=a[v]).x-(r=a[p]).x)*(r.y+l.y);return u}nu.types=["Unknown","Point","LineString","Polygon"],nu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,l=a.readVarint()+a.pos,u=1,p=0,_=0,v=0,C=[];a.pos<l;){if(p<=0){var D=a.readVarint();u=7&D,p=D>>3}if(p--,1===u||2===u)_+=a.readSVarint(),v+=a.readSVarint(),1===u&&(r&&C.push(r),r=[]),r.push(new q(_,v));else{if(7!==u)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&C.push(r),C},nu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,l=1,u=0,p=0,_=0,v=1/0,C=-1/0,D=1/0,M=-1/0;a.pos<r;){if(u<=0){var I=a.readVarint();l=7&I,u=I>>3}if(u--,1===l||2===l)(p+=a.readSVarint())<v&&(v=p),p>C&&(C=p),(_+=a.readSVarint())<D&&(D=_),_>M&&(M=_);else if(7!==l)throw new Error("unknown command "+l)}return[v,D,C,M]},nu.prototype.toGeoJSON=function(a,r,l){var u,p,_=this.extent*Math.pow(2,l),v=this.extent*a,C=this.extent*r,D=this.loadGeometry(),M=nu.types[this.type];function I(B){for(var G=0;G<B.length;G++){var Z=B[G];B[G]=[360*(Z.x+v)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+C)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<D.length;u++)P[u]=D[u][0];I(D=P);break;case 2:for(u=0;u<D.length;u++)I(D[u]);break;case 3:for(D=function(B){var G=B.length;if(G<=1)return[B];for(var Z,re,ue=[],ve=0;ve<G;ve++){var Ee=Pv(B[ve]);0!==Ee&&(void 0===re&&(re=Ee<0),re===Ee<0?(Z&&ue.push(Z),Z=[B[ve]]):Z.push(B[ve]))}return Z&&ue.push(Z),ue}(D),u=0;u<D.length;u++)for(p=0;p<D[u].length;p++)I(D[u][p])}1===D.length?D=D[0]:M="Multi"+M;var N={type:"Feature",geometry:{type:M,coordinates:D},properties:this.properties};return"id"in this&&(N.id=this.id),N};var E_=T_;function T_(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Nv,this,r),this.length=this._features.length}function Nv(a,r,l){15===a?r.version=l.readVarint():1===a?r.name=l.readString():5===a?r.extent=l.readVarint():2===a?r._features.push(l.pos):3===a?r._keys.push(l.readString()):4===a&&r._values.push(function(u){for(var p=null,_=u.readVarint()+u.pos;u.pos<_;){var v=u.readVarint()>>3;p=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return p}(l))}function Nw(a,r,l){if(3===a){var u=new E_(l,l.readVarint()+l.pos);u.length&&(r[u.name]=u)}}T_.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new Ef(this._pbf,r,this.extent,this._keys,this._values)};var Xu={VectorTile:function(a,r){this.layers=a.readFields(Nw,{},r)},VectorTileFeature:Ef,VectorTileLayer:E_};const rd=Xu.VectorTileFeature.types,co=Math.pow(2,13);function iu(a,r,l,u,p,_,v,C){a.emplaceBack((r<<1)+v,(l<<1)+_,(Math.floor(u*co)<<1)+p,Math.round(C))}class vg{constructor(){this.acc=new q(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new q(r.x,r.y),this.max=new q(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);let u=!!this.borders;const p=this.min,_=this.max;r.x<p.x?(p.x=r.x,u=!0):r.x>_.x&&(_.x=r.x,u=!0),r.y<p.y?(p.y=r.y,u=!0):r.y>_.y&&(_.y=r.y,u=!0),((0===r.x||r.x===Pn)&&r.x===l.x)!=((0===r.y||r.y===Pn)&&r.y===l.y)&&this.processBorderOverlap(r,l),u&&this.checkBorderIntersection(r,l)}checkBorderIntersection(r,l){l.x<0!=r.x<0&&this.addBorderIntersection(0,Qt(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Pn!=r.x>Pn&&this.addBorderIntersection(1,Qt(l.y,r.y,(Pn-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,Qt(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Pn!=r.y>Pn&&this.addBorderIntersection(3,Qt(l.x,r.x,(Pn-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];l<u[0]&&(u[0]=l),l>u[1]&&(u[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const u=0===r.x?0:1;this.addBorderIntersection(u,l.y),this.addBorderIntersection(u,r.y)}else{const u=0===r.y?2:3;this.addBorderIntersection(u,l.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((l,u)=>l+u.edges,0);return 0!==r?this.acc.div(r)._round():new q(0,0)}span(){return new q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class Tf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new bi,this.centroidVertexArray=new av,this.indexArray=new kn,this.programConfigurations=new ol(r.layers,r.zoom),this.segments=new fr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,u){this.features=[],this.hasPattern=Cf("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/Pn/(1<<p.z)}(u);for(const{feature:p,id:_,index:v,sourceLayerIndex:C}of r){const D=this.layers[0]._featureFilter.needGeometry,M=xs(p,D);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),M,u))continue;const I={id:_,sourceLayerIndex:C,index:v,geometry:D?M.geometry:sl(p),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Zu("fill-extrusion",this.layers,I,this.zoom,l)):this.addFeature(I,I.geometry,v,u,{}),l.featureIndex.insert(p,I.geometry,v,C,this.index,P)}this.sortBorders()}addFeatures(r,l,u){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,l,u)}this.sortBorders()}update(r,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Av),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Iv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,u,p,_){const v=this.enableTerrain?new vg:null;for(const D of _g(l,500)){let M=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===D.length||(C=D[0]).every(Z=>Z.x<=0)||C.every(Z=>Z.x>=Pn)||C.every(Z=>Z.y<=0)||C.every(Z=>Z.y>=Pn))continue;for(let Z=0;Z<D.length;Z++){const re=D[Z];if(0===re.length)continue;M+=re.length;let ue=0;v&&v.startRing(re[0]);for(let ve=0;ve<re.length;ve++){const Ee=re[ve];if(ve>=1){const Te=re[ve-1];if(!Yr(Ee,Te)){v&&v.append(Ee,Te),I.vertexLength+4>fr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Se=Ee.sub(Te)._perp(),Ae=Se.x/(Math.abs(Se.x)+Math.abs(Se.y)),He=Se.y>0?1:0,We=Te.dist(Ee);ue+We>32768&&(ue=0),iu(this.layoutVertexArray,Ee.x,Ee.y,Ae,He,0,0,ue),iu(this.layoutVertexArray,Ee.x,Ee.y,Ae,He,0,1,ue),ue+=We,iu(this.layoutVertexArray,Te.x,Te.y,Ae,He,0,0,ue),iu(this.layoutVertexArray,Te.x,Te.y,Ae,He,0,1,ue);const et=I.vertexLength;this.indexArray.emplaceBack(et,et+2,et+1),this.indexArray.emplaceBack(et+1,et+2,et+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+M>fr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),"Polygon"!==rd[r.type])continue;const P=[],N=[],B=I.vertexLength;for(let Z=0;Z<D.length;Z++){const re=D[Z];if(0!==re.length){re!==D[0]&&N.push(P.length/2);for(let ue=0;ue<re.length;ue++){const ve=re[ue];iu(this.layoutVertexArray,ve.x,ve.y,0,0,1,1,0),P.push(ve.x),P.push(ve.y),v&&v.currentPolyCount.top++}}}const G=ws(P,N);for(let Z=0;Z<G.length;Z+=3)this.indexArray.emplaceBack(B+G[Z],B+G[Z+2],B+G[Z+1]);I.primitiveLength+=G.length/3,I.vertexLength+=M}var C;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const D=v.borders,M=this.featuresOnBorder.push(v)-1;for(let I=0;I<4;I++)D[I][0]!==Number.MAX_VALUE&&this.borders[I].push(M)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,_,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,u)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,l,u=!0){let p,_;if(r)if(0!==r.y){const C=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(C.x/10)),_=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else p=Math.ceil(7*(r.x+450)),_=0;else p=0,_=+u;let v=u?this.centroidVertexArray.length:l.vertexArrayOffset;for(const C of l.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let D=0;D<2*C.edges;D++)this.centroidVertexArray.emplace(v++,0,_),this.centroidVertexArray.emplace(v++,p,_);for(let D=0;D<C.top;D++)this.centroidVertexArray.emplace(v++,p,_)}}}function Yr(a,r){return a.x===r.x&&(a.x<0||a.x>Pn)||a.y===r.y&&(a.y<0||a.y>Pn)}yt("FillExtrusionBucket",Tf,{omit:["layers","features"]}),yt("PartMetadata",vg);var od={paint:new Fe({"fill-extrusion-opacity":new oe(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oe(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oe(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ze(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oe(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ru(a,r){return a.x*r.x+a.y*r.y}function M_(a,r){if(1===a.length){let l=0;const u=r[l++];let p;for(;!p||u.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const _=r[l],v=a[0],C=p.sub(u),D=_.sub(u),M=v.sub(u),I=ru(C,C),P=ru(C,D),N=ru(D,D),B=ru(M,C),G=ru(M,D),Z=I*N-P*P,re=(N*B-P*G)/Z,ue=(I*G-P*B)/Z,ve=u.z*(1-re-ue)+p.z*re+_.z*ue;if(isFinite(ve))return ve}return 1/0}{let l=1/0;for(const u of r)l=Math.min(l,u.z);return l}}function S_(a){const r=new q(a[0],a[1]);return r.z=a[2],r}function I_(a,r,l,u,p,_,v,C){const D=v*p.getElevationAt(a,r,!0,!0),M=0!==_[0],I=M?0===_[1]?v*(_[0]/7-450):v*function(P,N,B){const G=Math.floor(N[0]/8),Z=Math.floor(N[1]/8),re=10*(N[0]-8*G),ue=10*(N[1]-8*Z),ve=P.getElevationAt(G,Z,!0,!0),Ee=P.getMeterToDEM(B),Te=Math.floor(.5*(re*Ee-1)),Se=Math.floor(.5*(ue*Ee-1)),Ae=P.tileCoordToPixel(G,Z),He=2*Te+1,We=2*Se+1,et=(Lt=He,_n=We,[(Ft=P).getElevationAtPixel(bt=Ae.x-Te,Mn=Ae.y-Se,!0),Ft.getElevationAtPixel(bt+_n,Mn,!0),Ft.getElevationAtPixel(bt,Mn+_n,!0),Ft.getElevationAtPixel(bt+Lt,Mn+_n,!0)]),st=Math.abs(et[0]-et[1]),Ze=Math.abs(et[2]-et[3]),Qe=Math.abs(et[0]-et[2])+Math.abs(et[1]-et[3]),at=Math.min(.25,.5*Ee*(st+Ze)/He),Ke=Math.min(.25,.5*Ee*Qe/We);var Ft,bt,Mn,Lt,_n;return ve+Math.max(at*re,Ke*ue)}(p,_,C):D;return{base:D+(0===l)?-1:l,top:M?Math.max(I+u,D+l+2):D+u}}const Rv=vt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:A_}=Rv,Fv=vt([{name:"a_packed",components:3,type:"Float32"}]),{members:k_}=Fv,Ov=Xu.VectorTileFeature.types,Lv=Math.cos(Math.PI/180*37.5);class bg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new li,this.layoutVertexArray2=new Zt,this.indexArray=new kn,this.programConfigurations=new ol(r.layers,r.zoom),this.segments=new fr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,u){this.hasPattern=Cf("line",this.layers,l);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:M,id:I,index:P,sourceLayerIndex:N}of r){const B=this.layers[0]._featureFilter.needGeometry,G=xs(M,B);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),G,u))continue;const Z=p?p.evaluate(G,{},u):void 0,re={id:I,properties:M.properties,type:M.type,sourceLayerIndex:N,index:P,geometry:B?G.geometry:sl(M),patterns:{},sortKey:Z};_.push(re)}p&&_.sort((M,I)=>M.sortKey-I.sortKey);const{lineAtlas:v,featureIndex:C}=l,D=this.addConstantDashes(v);for(const M of _){const{geometry:I,index:P,sourceLayerIndex:N}=M;if(D&&this.addFeatureDashes(M,v),this.hasPattern){const B=Zu("line",this.layers,M,this.zoom,l);this.patternFeatures.push(B)}else this.addFeature(M,I,P,u,v.positions);C.insert(r[P].feature,I,P,N,this.index)}}addConstantDashes(r){let l=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==_.kind)l=!0;else{const v=_.value,C=p.value;if(!C)continue;r.addDash(C.from,v),r.addDash(C.to,v),C.other&&r.addDash(C.other,v)}}return l}addFeatureDashes(r,l){const u=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,v=p.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===v.kind)continue;let C,D,M,I,P,N;if("constant"===_.kind){const re=_.value;if(!re)continue;C=re.other||re.to,D=re.to,M=re.from}else C=_.evaluate({zoom:u-1},r),D=_.evaluate({zoom:u},r),M=_.evaluate({zoom:u+1},r);"constant"===v.kind?I=P=N=v.value:(I=v.evaluate({zoom:u-1},r),P=v.evaluate({zoom:u},r),N=v.evaluate({zoom:u+1},r)),l.addDash(C,I),l.addDash(D,P),l.addDash(M,N);const B=l.getKey(C,I),G=l.getKey(D,P),Z=l.getKey(M,N);r.patterns[p.id]={min:B,mid:G,max:Z}}}update(r,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,u)}addFeatures(r,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,k_)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,A_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,u,p,_){const v=this.layers[0].layout,C=v.get("line-join").evaluate(r,{}),D=v.get("line-cap").evaluate(r,{}),M=v.get("line-miter-limit"),I=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const P of l)this.addLine(P,r,C,D,M,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,_,p)}addLine(r,l,u,p,_,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<r.length-1;ue++)this.totalDistance+=r[ue].dist(r[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C="Polygon"===Ov[l.type];let D=r.length;for(;D>=2&&r[D-1].equals(r[D-2]);)D--;let M=0;for(;M<D-1&&r[M].equals(r[M+1]);)M++;if(D<(C?3:2))return;"bevel"===u&&(_=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let N,B,G,Z,re;this.e1=this.e2=-1,C&&(N=r[D-2],re=r[M].sub(N)._unit()._perp());for(let ue=M;ue<D;ue++){if(G=ue===D-1?C?r[M+1]:void 0:r[ue+1],G&&r[ue].equals(G))continue;re&&(Z=re),N&&(B=N),N=r[ue],re=G?G.sub(N)._unit()._perp():Z,Z=Z||re;let ve=Z.add(re);0===ve.x&&0===ve.y||ve._unit();const Ee=Z.x*re.x+Z.y*re.y,Te=ve.x*re.x+ve.y*re.y,Se=0!==Te?1/Te:1/0,Ae=2*Math.sqrt(2-2*Te),He=Te<Lv&&B&&G,We=Z.x*re.y-Z.y*re.x>0;if(He&&ue>M){const Ze=N.dist(B);if(Ze>2*I){const Qe=N.sub(N.sub(B)._mult(I/Ze)._round());this.updateDistance(B,Qe),this.addCurrentVertex(Qe,Z,0,0,P),B=Qe}}const et=B&&G;let st=et?u:C?"butt":p;if(et&&"round"===st&&(Se<v?st="miter":Se<=2&&(st="fakeround")),"miter"===st&&Se>_&&(st="bevel"),"bevel"===st&&(Se>2&&(st="flipbevel"),Se<_&&(st="miter")),B&&this.updateDistance(B,N),"miter"===st)ve._mult(Se),this.addCurrentVertex(N,ve,0,0,P);else if("flipbevel"===st){if(Se>100)ve=re.mult(-1);else{const Ze=Se*Z.add(re).mag()/Z.sub(re).mag();ve._perp()._mult(Ze*(We?-1:1))}this.addCurrentVertex(N,ve,0,0,P),this.addCurrentVertex(N,ve.mult(-1),0,0,P)}else if("bevel"===st||"fakeround"===st){const Ze=-Math.sqrt(Se*Se-1),Qe=We?Ze:0,at=We?0:Ze;if(B&&this.addCurrentVertex(N,Z,Qe,at,P),"fakeround"===st){const Ke=Math.round(180*Ae/Math.PI/20);for(let Ft=1;Ft<Ke;Ft++){let bt=Ft/Ke;if(.5!==bt){const Lt=bt-.5;bt+=bt*Lt*(bt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*Lt*Lt+(.848013+Ee*(.215638*Ee-1.06021)))}const Mn=re.sub(Z)._mult(bt)._add(Z)._unit()._mult(We?-1:1);this.addHalfVertex(N,Mn.x,Mn.y,!1,We,0,P)}}G&&this.addCurrentVertex(N,re,-Qe,-at,P)}else if("butt"===st)this.addCurrentVertex(N,ve,0,0,P);else if("square"===st){const Ze=B?1:-1;B||this.addCurrentVertex(N,ve,Ze,Ze,P),this.addCurrentVertex(N,ve,0,0,P),B&&this.addCurrentVertex(N,ve,Ze,Ze,P)}else"round"===st&&(B&&(this.addCurrentVertex(N,Z,0,0,P),this.addCurrentVertex(N,Z,1,1,P,!0)),G&&(this.addCurrentVertex(N,re,-1,-1,P,!0),this.addCurrentVertex(N,re,0,0,P)));if(He&&ue<D-1){const Ze=N.dist(G);if(Ze>2*I){const Qe=N.add(G.sub(N)._mult(I/Ze)._round());this.updateDistance(N,Qe),this.addCurrentVertex(Qe,re,0,0,P),N=Qe}}}}addCurrentVertex(r,l,u,p,_,v=!1){const C=l.y*p-l.x,D=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*u,l.y-l.x*u,v,!1,u,_),this.addHalfVertex(r,C,D,v,!0,-p,_)}addHalfVertex({x:r,y:l},u,p,_,v,C,D){this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(l<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const M=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),D.primitiveLength++),v?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}yt("LineBucket",bg,{omit:["layers","patternFeatures"]});const P_=new Fe({"line-cap":new we(ge.layout_line["line-cap"]),"line-join":new we(ge.layout_line["line-join"]),"line-miter-limit":new oe(ge.layout_line["line-miter-limit"]),"line-round-limit":new oe(ge.layout_line["line-round-limit"]),"line-sort-key":new we(ge.layout_line["line-sort-key"])});var Mf={paint:new Fe({"line-opacity":new we(ge.paint_line["line-opacity"]),"line-color":new we(ge.paint_line["line-color"]),"line-translate":new oe(ge.paint_line["line-translate"]),"line-translate-anchor":new oe(ge.paint_line["line-translate-anchor"]),"line-width":new we(ge.paint_line["line-width"]),"line-gap-width":new we(ge.paint_line["line-gap-width"]),"line-offset":new we(ge.paint_line["line-offset"]),"line-blur":new we(ge.paint_line["line-blur"]),"line-dasharray":new ze(ge.paint_line["line-dasharray"]),"line-pattern":new ze(ge.paint_line["line-pattern"]),"line-gradient":new xe(ge.paint_line["line-gradient"])}),layout:P_};const xg=new class extends we{possiblyEvaluate(a,r){return r=new H(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,l,u){return r=Bt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,l,u)}}(Mf.paint.properties["line-width"].specification);function N_(a,r){return r>0?r+2*a:a}xg.useIntegerZoom=!0;const Rw=vt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),R_=vt([{name:"a_projected_pos",components:3,type:"Float32"}],4);vt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sf=vt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Bv=vt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);vt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const F_=vt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ou=vt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);vt([{name:"triangle",components:3,type:"Uint16"}]),vt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),vt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),vt([{type:"Float32",name:"offsetX"}]),vt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const va=128;function wg(a,r){const{expression:l}=r;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new H(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:p}=l;let _=0;for(;_<u.length&&u[_]<=a;)_++;_=Math.max(0,_-1);let v=_;for(;v<u.length&&u[v]<a+1;)v++;v=Math.min(u.length-1,v);const C=u[_],D=u[v];return"composite"===l.kind?{kind:"composite",minZoom:C,maxZoom:D,interpolationType:p}:{kind:"camera",minZoom:C,maxZoom:D,minSize:l.evaluate(new H(C)),maxSize:l.evaluate(new H(D)),interpolationType:p}}}function If(a,{uSize:r,uSizeT:l},{lowerSize:u,upperSize:p}){return"source"===a.kind?u/va:"composite"===a.kind?Qt(u/va,p/va,l):r}function Yu(a,r){let l=0,u=0;if("constant"===a.kind)u=a.layoutSize;else if("source"!==a.kind){const{interpolationType:p,minZoom:_,maxZoom:v}=a,C=p?wn(Di.interpolationFactor(p,r,_,v),0,1):0;"camera"===a.kind?u=Qt(a.minSize,a.maxSize,C):l=C}return{uSizeT:l,uSize:u}}var Af=Object.freeze({__proto__:null,getSizeData:wg,evaluateSizeForFeature:If,evaluateSizeForZoom:Yu,SIZE_PACK_FACTOR:va});function Cs(a,r,l){return a.sections.forEach(u=>{u.text=function(p,_,v){const C=_.layout.get("text-transform").evaluate(v,{});return"uppercase"===C?p=p.toLocaleUpperCase():"lowercase"===C&&(p=p.toLocaleLowerCase()),$.applyArabicShaping&&(p=$.applyArabicShaping(p)),p}(u.text,r,l)}),a}const Ju={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Vv(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function zv(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Cg=function(a,r,l,u,p){var _,v,C=8*p-u-1,D=(1<<C)-1,M=D>>1,I=-7,P=l?p-1:0,N=l?-1:1,B=a[r+P];for(P+=N,_=B&(1<<-I)-1,B>>=-I,I+=C;I>0;_=256*_+a[r+P],P+=N,I-=8);for(v=_&(1<<-I)-1,_>>=-I,I+=u;I>0;v=256*v+a[r+P],P+=N,I-=8);if(0===_)_=1-M;else{if(_===D)return v?NaN:1/0*(B?-1:1);v+=Math.pow(2,u),_-=M}return(B?-1:1)*v*Math.pow(2,_-u)},Uv=function(a,r,l,u,p,_){var v,C,D,M=8*_-p-1,I=(1<<M)-1,P=I>>1,N=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:_-1,G=u?1:-1,Z=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(C=isNaN(r)?1:0,v=I):(v=Math.floor(Math.log(r)/Math.LN2),r*(D=Math.pow(2,-v))<1&&(v--,D*=2),(r+=v+P>=1?N/D:N*Math.pow(2,1-P))*D>=2&&(v++,D/=2),v+P>=I?(C=0,v=I):v+P>=1?(C=(r*D-1)*Math.pow(2,p),v+=P):(C=r*Math.pow(2,P-1)*Math.pow(2,p),v=0));p>=8;a[l+B]=255&C,B+=G,C/=256,p-=8);for(v=v<<p|C,M+=p;M>0;a[l+B]=255&v,B+=G,v/=256,M-=8);a[l+B-G]|=128*Z},Ku=Jn;function Jn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Jn.Varint=0,Jn.Fixed64=1,Jn.Bytes=2,Jn.Fixed32=5;var Dg=4294967296,O_=1/Dg,su="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Dr(a){return a.type===Jn.Bytes?a.readVarint()+a.pos:a.pos+1}function $v(a,r,l){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(u);for(var p=l.pos-1;p>=a;p--)l.buf[p+u]=l.buf[p]}function L_(a,r){for(var l=0;l<a.length;l++)r.writeVarint(a[l])}function Fw(a,r){for(var l=0;l<a.length;l++)r.writeSVarint(a[l])}function Ko(a,r){for(var l=0;l<a.length;l++)r.writeFloat(a[l])}function Eg(a,r){for(var l=0;l<a.length;l++)r.writeDouble(a[l])}function Tg(a,r){for(var l=0;l<a.length;l++)r.writeBoolean(a[l])}function jv(a,r){for(var l=0;l<a.length;l++)r.writeFixed32(a[l])}function B_(a,r){for(var l=0;l<a.length;l++)r.writeSFixed32(a[l])}function ad(a,r){for(var l=0;l<a.length;l++)r.writeFixed64(a[l])}function V_(a,r){for(var l=0;l<a.length;l++)r.writeSFixed64(a[l])}function ld(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function sc(a,r,l){a[l]=r,a[l+1]=r>>>8,a[l+2]=r>>>16,a[l+3]=r>>>24}function kf(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function z_(a,r,l){r.glyphs=[],1===a&&l.readMessage(Ow,r)}function Ow(a,r,l){if(3===a){const{id:u,bitmap:p,width:_,height:v,left:C,top:D,advance:M}=l.readMessage(Qu,{});r.glyphs.push({id:u,bitmap:new Po({width:_+6,height:v+6},p),metrics:{width:_,height:v,left:C,top:D,advance:M}})}else 4===a?r.ascender=l.readSVarint():5===a&&(r.descender=l.readSVarint())}function Qu(a,r,l){1===a?r.id=l.readVarint():2===a?r.bitmap=l.readBytes():3===a?r.width=l.readVarint():4===a?r.height=l.readVarint():5===a?r.left=l.readSVarint():6===a?r.top=l.readSVarint():7===a&&(r.advance=l.readVarint())}function cd(a){let r=0,l=0;for(const v of a)r+=v.w*v.h,l=Math.max(l,v.w);a.sort((v,C)=>C.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,_=0;for(const v of a)for(let C=u.length-1;C>=0;C--){const D=u[C];if(!(v.w>D.w||v.h>D.h)){if(v.x=D.x,v.y=D.y,_=Math.max(_,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===D.w&&v.h===D.h){const M=u.pop();C<u.length&&(u[C]=M)}else v.h===D.h?(D.x+=v.w,D.w-=v.w):v.w===D.w?(D.y+=v.h,D.h-=v.h):(u.push({x:D.x+v.w,y:D.y,w:D.w-v.w,h:v.h}),D.y+=v.h,D.h-=v.h);break}}return{w:p,h:_,fill:r/(p*_)||0}}Jn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,l){for(l=l||this.length;this.pos<l;){var u=this.readVarint(),p=u>>3,_=this.pos;this.type=7&u,a(p,r,this),this.pos===_&&this.skip(u)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=ld(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=kf(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=ld(this.buf,this.pos)+ld(this.buf,this.pos+4)*Dg;return this.pos+=8,a},readSFixed64:function(){var a=ld(this.buf,this.pos)+kf(this.buf,this.pos+4)*Dg;return this.pos+=8,a},readFloat:function(){var a=Cg(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Cg(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,l,u=this.buf;return r=127&(l=u[this.pos++]),l<128?r:(r|=(127&(l=u[this.pos++]))<<7,l<128?r:(r|=(127&(l=u[this.pos++]))<<14,l<128?r:(r|=(127&(l=u[this.pos++]))<<21,l<128?r:function(p,_,v){var C,D,M=v.buf;if(C=(112&(D=M[v.pos++]))>>4,D<128||(C|=(127&(D=M[v.pos++]))<<3,D<128)||(C|=(127&(D=M[v.pos++]))<<10,D<128)||(C|=(127&(D=M[v.pos++]))<<17,D<128)||(C|=(127&(D=M[v.pos++]))<<24,D<128)||(C|=(1&(D=M[v.pos++]))<<31,D<128))return function(a,r,l){return l?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}(p,C,_);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=u[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&su?su.decode(this.buf.subarray(r,a)):function(l,u,p){for(var _="",v=u;v<p;){var C,D,M,I=l[v],P=null,N=I>239?4:I>223?3:I>191?2:1;if(v+N>p)break;1===N?I<128&&(P=I):2===N?128==(192&(C=l[v+1]))&&(P=(31&I)<<6|63&C)<=127&&(P=null):3===N?(D=l[v+2],128==(192&(C=l[v+1]))&&128==(192&D)&&((P=(15&I)<<12|(63&C)<<6|63&D)<=2047||P>=55296&&P<=57343)&&(P=null)):4===N&&(D=l[v+2],M=l[v+3],128==(192&(C=l[v+1]))&&128==(192&D)&&128==(192&M)&&((P=(15&I)<<18|(63&C)<<12|(63&D)<<6|63&M)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,N=1):P>65535&&(P-=65536,_+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),_+=String.fromCharCode(P),v+=N}return _}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==Jn.Bytes)return a.push(this.readVarint(r));var l=Dr(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==Jn.Bytes)return a.push(this.readSVarint());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Jn.Bytes)return a.push(this.readBoolean());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Jn.Bytes)return a.push(this.readFloat());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Jn.Bytes)return a.push(this.readDouble());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Jn.Bytes)return a.push(this.readFixed32());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Jn.Bytes)return a.push(this.readSFixed32());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Jn.Bytes)return a.push(this.readFixed64());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Jn.Bytes)return a.push(this.readSFixed64());var r=Dr(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===Jn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Jn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Jn.Fixed32)this.pos+=4;else{if(r!==Jn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),sc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),sc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),sc(this.buf,-1&a,this.pos),sc(this.buf,Math.floor(a*O_),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),sc(this.buf,-1&a,this.pos),sc(this.buf,Math.floor(a*O_),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,l){var u,p,_,C;if(r>=0?(u=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,p=p+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=u,(C=l).buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,C.buf[C.pos]=127&(_>>>=7),function(_,v){var C=(7&_)<<4;v.buf[v.pos++]|=C|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(u,p,_){for(var v,C,D=0;D<p.length;D++){if((v=p.charCodeAt(D))>55295&&v<57344){if(!C){v>56319||D+1===p.length?(u[_++]=239,u[_++]=191,u[_++]=189):C=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,C=v;continue}v=C-55296<<10|v-56320|65536,C=null}else C&&(u[_++]=239,u[_++]=191,u[_++]=189,C=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _}(this.buf,a,this.pos);var l=this.pos-r;l>=128&&$v(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Uv(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Uv(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,r){this.pos++;var l=this.pos;a(r,this);var u=this.pos-l;u>=128&&$v(l,u,this),this.pos=l-1,this.writeVarint(u),this.pos+=u},writeMessage:function(a,r,l){this.writeTag(a,Jn.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,L_,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,Fw,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,Tg,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,Ko,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,Eg,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,jv,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,B_,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,ad,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,V_,r)},writeBytesField:function(a,r){this.writeTag(a,Jn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,Jn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,Jn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,Jn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,Jn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,Jn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,Jn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,Jn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,Jn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,Jn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,Boolean(r))}};class Pf{constructor(r,{pixelRatio:l,version:u,stretchX:p,stretchY:_,content:v}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=_,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class U_{constructor(r,l){const u={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(r,u,_),this.addImages(l,p,_);const{w:v,h:C}=cd(_),D=new Yo({width:v||1,height:C||1});for(const M in r){const I=r[M],P=u[M].paddedRect;Yo.copy(I.data,D,{x:0,y:0},{x:P.x+1,y:P.y+1},I.data)}for(const M in l){const I=l[M],P=p[M].paddedRect,N=P.x+1,B=P.y+1,G=I.data.width,Z=I.data.height;Yo.copy(I.data,D,{x:0,y:0},{x:N,y:B},I.data),Yo.copy(I.data,D,{x:0,y:Z-1},{x:N,y:B-1},{width:G,height:1}),Yo.copy(I.data,D,{x:0,y:0},{x:N,y:B+Z},{width:G,height:1}),Yo.copy(I.data,D,{x:G-1,y:0},{x:N-1,y:B},{width:1,height:Z}),Yo.copy(I.data,D,{x:0,y:0},{x:N+G,y:B},{width:1,height:Z})}this.image=D,this.iconPositions=u,this.patternPositions=p}addImages(r,l,u){for(const p in r){const _=r[p],v={x:0,y:0,w:_.data.width+2,h:_.data.height+2};u.push(v),l[p]=new Pf(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),l),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),l)}patchUpdatedImage(r,l,u){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,_]=r.tl;u.update(l.data,void 0,{x:p,y:_})}}yt("ImagePosition",Pf),yt("ImageAtlas",U_);const uo={horizontal:1,vertical:2,horizontalOnly:3};class ud{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const u=new ud;return u.scale=r||1,u.fontStack=l,u}static forImage(r){const l=new ud;return l.imageName=r,l}}class eh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const u=new eh;for(let p=0;p<r.sections.length;p++){const _=r.sections[p];_.image?u.addImageSection(_):u.addTextSection(_,l)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,u){let p="";for(let _=0;_<l.length;_++){const v=l.charCodeAt(_+1)||null,C=l.charCodeAt(_-1)||null;p+=!u&&(v&&qc(v)&&!Ju[l[_+1]]||C&&qc(C)&&!Ju[l[_-1]])||!Ju[l[_]]?l[_]:Ju[l[_]]}return p}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Nf[this.text.charCodeAt(u)];u++)r++;let l=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Nf[this.text.charCodeAt(u)];u--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const u=new eh;return u.text=this.text.substring(r,l),u.sectionIndex=this.sectionIndex.slice(r,l),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(ud.forText(r.scale,r.fontStack||l));const u=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(u)}addImageSection(r){const l=r.image?r.image.name:"";if(0===l.length)return void pi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(ud.forImage(l)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mg(a,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z){const re=eh.fromFeature(a,p);let ue;P===uo.vertical&&re.verticalizePunctuation(N);const{processBidirectionalText:ve,processStyledBidirectionalText:Ee}=$;if(ve&&1===re.sections.length){ue=[];const Ae=ve(re.toString(),kg(re,M,_,r,u,B,G));for(const He of Ae){const We=new eh;We.text=He,We.sections=re.sections;for(let et=0;et<He.length;et++)We.sectionIndex.push(0);ue.push(We)}}else if(Ee){ue=[];const Ae=Ee(re.text,re.sectionIndex,kg(re,M,_,r,u,B,G));for(const He of Ae){const We=new eh;We.text=He[0],We.sectionIndex=He[1],We.sections=re.sections,ue.push(We)}}else ue=function(Ae,He){const We=[],et=Ae.text;let st=0;for(const Ze of He)We.push(Ae.substring(st,Ze)),st=Ze;return st<et.length&&We.push(Ae.substring(st,et.length)),We}(re,kg(re,M,_,r,u,B,G));const Te=[],Se={positionedLines:Te,text:re.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ae,He,We,et,st,Ze,Qe,at,Ke,Ft,bt,Mn){let Lt=0,_n=0,St=0;const Ot="right"===at?1:"left"===at?0:.5;let En=!1;for(const On of st){const Kn=On.getSections();for(const pr of Kn){if(pr.imageName)continue;const Si=He[pr.fontStack];if(Si&&(En=void 0!==Si.ascender&&void 0!==Si.descender,!En))break}if(!En)break}let Ki=0;for(const On of st){On.trim();const Kn=On.getMaxScale(),pr=24*(Kn-1),Si={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[Ki]=Si;const sr=Si.positionedGlyphs;let er=0;if(!On.length()){_n+=Ze,++Ki;continue}let Xn=0,Vr=0;for(let Qn=0;Qn<On.length();Qn++){const Ni=On.getSection(Qn),Jr=On.getSectionIndex(Qn),Er=On.getCharCode(Qn);let ii=Ni.scale,Nn=null,ar=null,Tr=null,Xs=24,Ro=0;const Es=!(Ke===uo.horizontal||!bt&&!el(Er)||bt&&(Nf[Er]||(vi=Er,Wo(vi)||Oh(vi)||Ja(vi)||Gc(vi)||Zo(vi))));if(Ni.imageName){const wa=et[Ni.imageName];if(!wa)continue;Tr=Ni.imageName,Ae.iconsInText=Ae.iconsInText||!0,ar=wa.paddedRect;const Mr=wa.displaySize;ii=24*ii/Mn,Nn={width:Mr[0],height:Mr[1],left:1,top:-3,advance:Es?Mr[1]:Mr[0],localGlyph:!1},Ro=En?-Nn.height*ii:24*Kn-17-Mr[1]*ii,Xs=Nn.advance;const Ca=(Es?Mr[0]:Mr[1])*ii-24*Kn;Ca>0&&Ca>er&&(er=Ca)}else{const wa=We[Ni.fontStack];if(!wa)continue;wa[Er]&&(ar=wa[Er]);const Mr=He[Ni.fontStack];if(!Mr)continue;const Ca=Mr.glyphs[Er];if(!Ca)continue;if(Nn=Ca.metrics,Xs=8203!==Er?24:0,En){const hl=void 0!==Mr.ascender?Math.abs(Mr.ascender):0,Qo=void 0!==Mr.descender?Math.abs(Mr.descender):0,xd=(hl+Qo)*ii;Xn<xd&&(Xn=xd,Vr=(hl-Qo)/2*ii),Ro=-hl*ii}else Ro=24*(Kn-ii)-17}Es?(Ae.verticalizable=!0,sr.push({glyph:Er,imageName:Tr,x:Lt,y:_n+Ro,vertical:Es,scale:ii,localGlyph:Nn.localGlyph,fontStack:Ni.fontStack,sectionIndex:Jr,metrics:Nn,rect:ar}),Lt+=Xs*ii+Ft):(sr.push({glyph:Er,imageName:Tr,x:Lt,y:_n+Ro,vertical:Es,scale:ii,localGlyph:Nn.localGlyph,fontStack:Ni.fontStack,sectionIndex:Jr,metrics:Nn,rect:ar}),Lt+=Nn.advance*ii+Ft)}0!==sr.length&&(St=Math.max(Lt-Ft,St),En?Ng(sr,Ot,er,Vr,Ze*Kn/2):Ng(sr,Ot,er,0,Ze/2)),Lt=0;const Hn=Ze*Kn+er;Si.lineOffset=Math.max(er,pr),_n+=Hn,++Ki}var vi;const Qi=_n,{horizontalAlign:or,verticalAlign:Pi}=Pg(Qe);(function(On,Kn,pr,Si,sr,er){const Xn=(Kn-pr)*sr,Vr=-er*Si;for(const Hn of On)for(const Qn of Hn.positionedGlyphs)Qn.x+=Xn,Qn.y+=Vr})(Ae.positionedLines,Ot,or,Pi,St,Qi),Ae.top+=-Pi*Qi,Ae.bottom=Ae.top+Qi,Ae.left+=-or*St,Ae.right=Ae.left+St,Ae.hasBaseline=En}(Se,r,l,u,ue,v,C,D,P,M,N,Z),!function(Ae){for(const He of Ae)if(0!==He.positionedGlyphs.length)return!1;return!0}(Te)&&Se}const Nf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $_(a,r,l,u,p,_){if(r.imageName){const v=u[r.imageName];return v?v.displaySize[0]*r.scale*24/_+p:0}{const v=l[r.fontStack],C=v&&v.glyphs[a];return C?C.metrics.advance*r.scale+p:0}}function Sg(a,r,l,u){const p=Math.pow(a-r,2);return u?a<r?p/2:2*p:p+Math.abs(l)*l}function Ig(a,r,l){let u=0;return 10===a&&(u-=1e4),l&&(u+=150),40!==a&&65288!==a||(u+=50),41!==r&&65289!==r||(u+=50),u}function Ag(a,r,l,u,p,_){let v=null,C=Sg(r,l,p,_);for(const D of u){const M=Sg(r-D.x,l,p,_)+D.badness;M<=C&&(v=D,C=M)}return{index:a,x:r,priorBreak:v,badness:C}}function Rf(a){return a?Rf(a.priorBreak).concat(a.index):[]}function kg(a,r,l,u,p,_,v){if("point"!==_)return[];if(!a)return[];const C=[],D=function(N,B,G,Z,re,ue){let ve=0;for(let Ee=0;Ee<N.length();Ee++){const Te=N.getSection(Ee);ve+=$_(N.getCharCode(Ee),Te,Z,re,B,ue)}return ve/Math.max(1,Math.ceil(ve/G))}(a,r,l,u,p,v),M=a.text.indexOf("\u200b")>=0;let I=0;for(let N=0;N<a.length();N++){const B=a.getSection(N),G=a.getCharCode(N);if(Nf[G]||(I+=$_(G,B,u,p,r,v)),N<a.length()-1){const Z=!((P=G)<11904||!(Ou(P)||$c(P)||ys(P)||cf(P)||Qa(P)||so(P)||jc(P)||Ka(P)||zh(P)||Lu(P)||Hc(P)||ec(P)||Bh(P)||Lh(P)||lf(P)||Vh(P)||Kl(P)||xr(P)||Uh(P)||Ql(P)));(Hv[G]||Z||B.imageName)&&C.push(Ag(N+1,I,D,C,Ig(G,a.getCharCode(N+1),Z&&M),!1))}}var P;return Rf(Ag(a.length(),I,D,C,0,!0))}function Pg(a){let r=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function Ng(a,r,l,u,p){if(!(r||l||u||p))return;const _=a.length-1,v=a[_],C=(v.x+v.metrics.advance*v.scale)*r;for(let D=0;D<=_;D++)a[D].x-=C,a[D].y+=l+u+p}function j_(a,r,l){const{horizontalAlign:u,verticalAlign:p}=Pg(l),_=r[0]-a.displaySize[0]*u,v=r[1]-a.displaySize[1]*p;return{image:a,top:v,bottom:v+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function ac(a,r,l,u,p,_){const v=a.image;let C;if(v.content){const re=v.content,ue=v.pixelRatio||1;C=[re[0]/ue,re[1]/ue,v.displaySize[0]-re[2]/ue,v.displaySize[1]-re[3]/ue]}const D=r.left*_,M=r.right*_;let I,P,N,B;"width"===l||"both"===l?(B=p[0]+D-u[3],P=p[0]+M+u[1]):(B=p[0]+(D+M-v.displaySize[0])/2,P=B+v.displaySize[0]);const G=r.top*_,Z=r.bottom*_;return"height"===l||"both"===l?(I=p[1]+G-u[0],N=p[1]+Z+u[2]):(I=p[1]+(G+Z-v.displaySize[1])/2,N=I+v.displaySize[1]),{image:v,top:I,right:P,bottom:N,left:B,collisionPadding:C}}class ll extends q{constructor(r,l,u,p,_){super(r,l),this.angle=p,this.z=u,void 0!==_&&(this.segment=_)}clone(){return new ll(this.x,this.y,this.z,this.angle,this.segment)}}function Rg(a,r,l,u,p){if(void 0===r.segment)return!0;let _=r,v=r.segment+1,C=0;for(;C>-l/2;){if(v--,v<0)return!1;C-=a[v].dist(_),_=a[v]}C+=a[v].dist(a[v+1]),v++;const D=[];let M=0;for(;C<l/2;){const I=a[v],P=a[v+1];if(!P)return!1;let N=a[v-1].angleTo(I)-I.angleTo(P);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:C,angleDelta:N}),M+=N;C-D[0].distance>u;)M-=D.shift().angleDelta;if(M>p)return!1;v++,C+=I.dist(P)}return!0}function H_(a){let r=0;for(let l=0;l<a.length-1;l++)r+=a[l].dist(a[l+1]);return r}function hd(a,r,l){return a?.6*r*l:0}function G_(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function q_(a,r,l,u,p,_){const v=hd(l,p,_),C=G_(l,u)*_;let D=0;const M=H_(a)/2;for(let I=0;I<a.length-1;I++){const P=a[I],N=a[I+1],B=P.dist(N);if(D+B>M){const G=(M-D)/B,Z=Qt(P.x,N.x,G),re=Qt(P.y,N.y,G),ue=new ll(Z,re,0,N.angleTo(P),I);return!v||Rg(a,ue,C,v,r)?ue:void 0}D+=B}}function W_(a,r,l,u,p,_,v,C,D){const M=hd(u,_,v),I=G_(u,p),P=I*v,N=0===a[0].x||a[0].x===D||0===a[0].y||a[0].y===D;return r-P<r/4&&(r=P+r/4),Fg(a,N?r/2*C%r:(I/2+2*_)*v*C%r,r,M,l,P,N,!1,D)}function Fg(a,r,l,u,p,_,v,C,D){const M=_/2,I=H_(a);let P=0,N=r-l,B=[];for(let G=0;G<a.length-1;G++){const Z=a[G],re=a[G+1],ue=Z.dist(re),ve=re.angleTo(Z);for(;N+l<P+ue;){N+=l;const Ee=(N-P)/ue,Te=Qt(Z.x,re.x,Ee),Se=Qt(Z.y,re.y,Ee);if(Te>=0&&Te<D&&Se>=0&&Se<D&&N-M>=0&&N+M<=I){const Ae=new ll(Te,Se,0,ve,G);Ae._round(),u&&!Rg(a,Ae,_,u,p)||B.push(Ae)}}P+=ue}return C||B.length||v||(B=Fg(a,P/2,l,u,p,_,v,!0,D)),B}function Ff(a,r,l,u,p){const _=[];for(let v=0;v<a.length;v++){const C=a[v];let D;for(let M=0;M<C.length-1;M++){let I=C[M],P=C[M+1];I.x<r&&P.x<r||(I.x<r?I=new q(r,I.y+(r-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<r&&(P=new q(r,I.y+(r-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<l&&P.y<l||(I.y<l?I=new q(I.x+(l-I.y)/(P.y-I.y)*(P.x-I.x),l)._round():P.y<l&&(P=new q(I.x+(l-I.y)/(P.y-I.y)*(P.x-I.x),l)._round()),I.x>=u&&P.x>=u||(I.x>=u?I=new q(u,I.y+(u-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=u&&(P=new q(u,I.y+(u-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=p&&P.y>=p||(I.y>=p?I=new q(I.x+(p-I.y)/(P.y-I.y)*(P.x-I.x),p)._round():P.y>=p&&(P=new q(I.x+(p-I.y)/(P.y-I.y)*(P.x-I.x),p)._round()),D&&I.equals(D[D.length-1])||(D=[I],_.push(D)),D.push(P)))))}}return _}yt("Anchor",ll);const th=1e20;function dd(a,r,l,u,p,_,v,C,D){for(let M=r;M<r+u;M++)fd(a,l*_+M,_,p,v,C,D);for(let M=l;M<l+p;M++)fd(a,M*_+r,1,u,v,C,D)}function fd(a,r,l,u,p,_,v){_[0]=0,v[0]=-th,v[1]=th,p[0]=a[r];for(let C=1,D=0,M=0;C<u;C++){p[C]=a[r+C*l];const I=C*C;do{const P=_[D];M=(p[C]-p[P]+I-P*P)/(C-P)/2}while(M<=v[D]&&--D>-1);D++,_[D]=C,v[D]=M,v[D+1]=th}for(let C=0,D=0;C<u;C++){for(;v[D+1]<C;)D++;const M=_[D],I=C-M;a[r+C*l]=p[M]+I*I}}const Of={none:0,ideographs:1,all:2};class lc{constructor(r,l,u){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const u=[];for(const p in r)for(const _ of r[p])u.push({stack:p,id:_});Gr(u,({stack:p,id:_},v)=>{let C=this.entries[p];C||(C=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=C.glyphs[_];if(void 0!==D)return void v(null,{stack:p,id:_,glyph:D});if(D=this._tinySDF(C,p,_),D)return C.glyphs[_]=D,void v(null,{stack:p,id:_,glyph:D});const M=Math.floor(_/256);if(256*M>65535)return void v(new Error("glyphs > 65535 not supported"));if(C.ranges[M])return void v(null,{stack:p,id:_,glyph:D});let I=C.requests[M];I||(I=C.requests[M]=[],lc.loadGlyphRange(p,M,this.url,this.requestManager,(P,N)=>{if(N){C.ascender=N.ascender,C.descender=N.descender;for(const B in N.glyphs)this._doesCharSupportLocalGlyph(+B)||(C.glyphs[+B]=N.glyphs[+B]);C.ranges[M]=!0}for(const B of I)B(P,N);delete C.requests[M]})),I.push((P,N)=>{P?v(P):N&&v(null,{stack:p,id:_,glyph:N.glyphs[_]||null})})},(p,_)=>{if(p)l(p);else if(_){const v={};for(const{stack:C,id:D,glyph:M}of _)void 0===v[C]&&(v[C]={}),void 0===v[C].glyphs&&(v[C].glyphs={}),v[C].glyphs[D]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},v[C].ascender=this.entries[C].ascender,v[C].descender=this.entries[C].descender;l(null,v)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Of.none&&(this.localGlyphMode===Of.all?!!this.localFontFamily:!!this.localFontFamily&&(Lu(r)||_s(r)||Bh(r)||Kl(r))||Ka(r))}_tinySDF(r,l,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let _=r.tinySDF;if(!_){let Z="400";/bold/i.test(l)?Z="900":/medium/i.test(l)?Z="500":/light/i.test(l)&&(Z="200"),_=r.tinySDF=new lc.TinySDF({fontFamily:p,fontWeight:Z,fontSize:48,buffer:6,radius:16}),_.fontWeight=Z}if(this.localGlyphs[_.fontWeight][u])return this.localGlyphs[_.fontWeight][u];const v=String.fromCharCode(u),{data:C,width:D,height:M,glyphWidth:I,glyphHeight:P,glyphLeft:N,glyphTop:B,glyphAdvance:G}=_.draw(v);return this.localGlyphs[_.fontWeight][u]={id:u,bitmap:new Po({width:D,height:M},C),metrics:{width:I/2,height:P/2,left:N/2,top:B/2-27,advance:G/2,localGlyph:!0}}}}function Og(a,r,l,u){const p=[],_=a.image,v=_.pixelRatio,C=_.paddedRect.w-2,D=_.paddedRect.h-2,M=a.right-a.left,I=a.bottom-a.top,P=_.stretchX||[[0,C]],N=_.stretchY||[[0,D]],B=(Ze,Qe)=>Ze+Qe[1]-Qe[0],G=P.reduce(B,0),Z=N.reduce(B,0),re=C-G,ue=D-Z;let ve=0,Ee=G,Te=0,Se=Z,Ae=0,He=re,We=0,et=ue;if(_.content&&u){const Ze=_.content;ve=nh(P,0,Ze[0]),Te=nh(N,0,Ze[1]),Ee=nh(P,Ze[0],Ze[2]),Se=nh(N,Ze[1],Ze[3]),Ae=Ze[0]-ve,We=Ze[1]-Te,He=Ze[2]-Ze[0]-Ee,et=Ze[3]-Ze[1]-Se}const st=(Ze,Qe,at,Ke)=>{const Ft=Lf(Ze.stretch-ve,Ee,M,a.left),bt=pd(Ze.fixed-Ae,He,Ze.stretch,G),Mn=Lf(Qe.stretch-Te,Se,I,a.top),Lt=pd(Qe.fixed-We,et,Qe.stretch,Z),_n=Lf(at.stretch-ve,Ee,M,a.left),St=pd(at.fixed-Ae,He,at.stretch,G),Ot=Lf(Ke.stretch-Te,Se,I,a.top),En=pd(Ke.fixed-We,et,Ke.stretch,Z),Ki=new q(Ft,Mn),vi=new q(_n,Mn),Qi=new q(_n,Ot),or=new q(Ft,Ot),Pi=new q(bt/v,Lt/v),On=new q(St/v,En/v),Kn=r*Math.PI/180;if(Kn){const sr=Math.sin(Kn),er=Math.cos(Kn),Xn=[er,-sr,sr,er];Ki._matMult(Xn),vi._matMult(Xn),or._matMult(Xn),Qi._matMult(Xn)}const pr=Ze.stretch+Ze.fixed,Si=Qe.stretch+Qe.fixed;return{tl:Ki,tr:vi,bl:or,br:Qi,tex:{x:_.paddedRect.x+1+pr,y:_.paddedRect.y+1+Si,w:at.stretch+at.fixed-pr,h:Ke.stretch+Ke.fixed-Si},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pi,pixelOffsetBR:On,minFontScaleX:He/v/M,minFontScaleY:et/v/I,isSDF:l}};if(u&&(_.stretchX||_.stretchY)){const Ze=ih(P,re,G),Qe=ih(N,ue,Z);for(let at=0;at<Ze.length-1;at++){const Ke=Ze[at],Ft=Ze[at+1];for(let bt=0;bt<Qe.length-1;bt++)p.push(st(Ke,Qe[bt],Ft,Qe[bt+1]))}}else p.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:D+1}));return p}function nh(a,r,l){let u=0;for(const p of a)u+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return u}function ih(a,r,l){const u=[{fixed:-1,stretch:0}];for(const[p,_]of a){const v=u[u.length-1];u.push({fixed:p-v.stretch,stretch:v.stretch}),u.push({fixed:p-v.stretch,stretch:v.stretch+(_-p)})}return u.push({fixed:r+1,stretch:l}),u}function Lf(a,r,l,u){return a/r*l+u}function pd(a,r,l,u){return a-r*l/u}function Gv(a,r,l,u){const p=r+a.positionedLines[u].lineOffset;return 0===u?l+p/2:l+(p+(r+a.positionedLines[u-1].lineOffset))/2}lc.loadGlyphRange=function(a,r,l,u,p){const _=256*r,v=_+255,C=u.transformRequest(u.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${_}-${v}`),qt.Glyphs);F(C,(D,M)=>{if(D)p(D);else if(M){const I={},P=new Ku(M).readFields(z_,{});for(const N of P.glyphs)I[N.id]=N;p(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},lc.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:l=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:v="normal"}){this.buffer=r,this.cutoff=u,this.radius=l;const C=this.size=a+4*r,D=this._createCanvas(C),M=this.ctx=D.getContext("2d",{willReadFrequently:!0});M.font=`${v} ${_} ${a}px ${p}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(a),v=Math.floor(l),C=Math.min(this.size-this.buffer,Math.ceil(_-p)),D=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(u)),M=C+2*this.buffer,I=D+2*this.buffer,P=M*I,N=new Uint8ClampedArray(P),B={data:N,width:M,height:I,glyphWidth:C,glyphHeight:D,glyphTop:v,glyphLeft:0,glyphAdvance:r};if(0===C||0===D)return B;const{ctx:G,buffer:Z,gridInner:re,gridOuter:ue}=this;G.clearRect(Z,Z,C,D),G.fillText(a,Z,Z+v+1);const ve=G.getImageData(Z,Z,C,D);ue.fill(th,0,P),re.fill(0,0,P);for(let Ee=0;Ee<D;Ee++)for(let Te=0;Te<C;Te++){const Se=ve.data[4*(Ee*C+Te)+3]/255;if(0===Se)continue;const Ae=(Ee+Z)*M+Te+Z;if(1===Se)ue[Ae]=0,re[Ae]=th;else{const He=.5-Se;ue[Ae]=He>0?He*He:0,re[Ae]=He<0?He*He:0}}dd(ue,0,0,M,I,M,this.f,this.v,this.z),dd(re,Z,Z,C,D,M,this.f,this.v,this.z);for(let Ee=0;Ee<P;Ee++){const Te=Math.sqrt(ue[Ee])-Math.sqrt(re[Ee]);N[Ee]=Math.round(255-255*(Te/this.radius+this.cutoff))}return B}};class qv{constructor(r=[],l=Z_){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:u}=this,p=l[r];for(;r>0;){const _=r-1>>1,v=l[_];if(u(p,v)>=0)break;l[r]=v,r=_}l[r]=p}_down(r){const{data:l,compare:u}=this,p=this.length>>1,_=l[r];for(;r<p;){let v=1+(r<<1),C=l[v];const D=v+1;if(D<this.length&&u(l[D],C)<0&&(v=D,C=l[D]),u(C,_)>=0)break;l[r]=C,r=v}l[r]=_}}function Z_(a,r){return a<r?-1:a>r?1:0}function Lg(a,r=1,l=!1){let u=1/0,p=1/0,_=-1/0,v=-1/0;const C=a[0];for(let B=0;B<C.length;B++){const G=C[B];(!B||G.x<u)&&(u=G.x),(!B||G.y<p)&&(p=G.y),(!B||G.x>_)&&(_=G.x),(!B||G.y>v)&&(v=G.y)}const D=Math.min(_-u,v-p);let M=D/2;const I=new qv([],X_);if(0===D)return new q(u,p);for(let B=u;B<_;B+=D)for(let G=p;G<v;G+=D)I.push(new gd(B+M,G+M,M,a));let P=function(B){let G=0,Z=0,re=0;const ue=B[0];for(let ve=0,Ee=ue.length,Te=Ee-1;ve<Ee;Te=ve++){const Se=ue[ve],Ae=ue[Te],He=Se.x*Ae.y-Ae.x*Se.y;Z+=(Se.x+Ae.x)*He,re+=(Se.y+Ae.y)*He,G+=3*He}return new gd(Z/G,re/G,0,B)}(a),N=I.length;for(;I.length;){const B=I.pop();(B.d>P.d||!P.d)&&(P=B,l&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,N)),B.max-P.d<=r||(M=B.h/2,I.push(new gd(B.p.x-M,B.p.y-M,M,a)),I.push(new gd(B.p.x+M,B.p.y-M,M,a)),I.push(new gd(B.p.x-M,B.p.y+M,M,a)),I.push(new gd(B.p.x+M,B.p.y+M,M,a)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${P.d}`)),P.p}function X_(a,r){return r.max-a.max}function gd(a,r,l,u){this.p=new q(a,r),this.h=l,this.d=function(p,_){let v=!1,C=1/0;for(let D=0;D<_.length;D++){const M=_[D];for(let I=0,P=M.length,N=P-1;I<P;N=I++){const B=M[I],G=M[N];B.y>p.y!=G.y>p.y&&p.x<(G.x-B.x)*(p.y-B.y)/(G.y-B.y)+B.x&&(v=!v),C=Math.min(C,je(p,B,G))}}return(v?1:-1)*Math.sqrt(C)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Bf=Number.POSITIVE_INFINITY,Wv=Math.sqrt(2);function Bg(a,r){return r[1]!==Bf?function(l,u,p){let _=0,v=0;switch(u=Math.abs(u),p=Math.abs(p),l){case"top-right":case"top-left":case"top":v=p-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-p}switch(l){case"top-right":case"bottom-right":case"right":_=-u;break;case"top-left":case"bottom-left":case"left":_=u}return[_,v]}(a,r[0],r[1]):function(l,u){let p=0,_=0;u<0&&(u=0);const v=u/Wv;switch(l){case"top-right":case"top-left":_=v-7;break;case"bottom-right":case"bottom-left":_=7-v;break;case"bottom":_=7-u;break;case"top":_=u-7}switch(l){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=u;break;case"right":p=-u}return[p,_]}(a,r[0])}function Zv(a,r,l,u,p,_,v,C){a.createArrays(),a.tilePixelRatio=Pn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const D=a.layers[0].layout,M=a.layers[0]._unevaluatedLayout._values,I={};if("composite"===a.textSizeData.kind){const{minZoom:B,maxZoom:G}=a.textSizeData;I.compositeTextSizes=[M["text-size"].possiblyEvaluate(new H(B),v),M["text-size"].possiblyEvaluate(new H(G),v)]}if("composite"===a.iconSizeData.kind){const{minZoom:B,maxZoom:G}=a.iconSizeData;I.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new H(B),v),M["icon-size"].possiblyEvaluate(new H(G),v)]}I.layoutTextSize=M["text-size"].possiblyEvaluate(new H(C+1),v),I.layoutIconSize=M["icon-size"].possiblyEvaluate(new H(C+1),v),I.textMaxSize=M["text-size"].possiblyEvaluate(new H(18),v);const P="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),N=D.get("text-size");for(const B of a.features){const G=D.get("text-font").evaluate(B,{},v).join(","),Z=N.evaluate(B,{},v),re=I.layoutTextSize.evaluate(B,{},v),ue=(I.layoutIconSize.evaluate(B,{},v),{horizontal:{},vertical:void 0}),ve=B.text;let Ee,Te=[0,0];if(ve){const He=ve.toString(),We=24*D.get("text-letter-spacing").evaluate(B,{},v),et=24*D.get("text-line-height").evaluate(B,{},v),st=Yp(He)?We:0,Ze=D.get("text-anchor").evaluate(B,{},v),Qe=D.get("text-variable-anchor");if(!Qe){const Lt=D.get("text-radial-offset").evaluate(B,{},v);Te=Lt?Bg(Ze,[24*Lt,Bf]):D.get("text-offset").evaluate(B,{},v).map(_n=>24*_n)}let at=P?"center":D.get("text-justify").evaluate(B,{},v);const Ke=D.get("symbol-placement"),Ft="point"===Ke,bt="point"===Ke?24*D.get("text-max-width").evaluate(B,{},v):0,Mn=Lt=>{a.allowVerticalPlacement&&$s(He)&&(ue.vertical=Mg(ve,r,l,p,G,bt,et,Ze,Lt,st,Te,uo.vertical,!0,Ke,re,Z))};if(!P&&Qe){const Lt="auto"===at?Qe.map(St=>Vg(St)):[at];let _n=!1;for(let St=0;St<Lt.length;St++){const Ot=Lt[St];if(!ue.horizontal[Ot])if(_n)ue.horizontal[Ot]=ue.horizontal[0];else{const En=Mg(ve,r,l,p,G,bt,et,"center",Ot,st,Te,uo.horizontal,!1,Ke,re,Z);En&&(ue.horizontal[Ot]=En,_n=1===En.positionedLines.length)}}Mn("left")}else{if("auto"===at&&(at=Vg(Ze)),Ft||D.get("text-writing-mode").indexOf("horizontal")>=0||!$s(He)){const Lt=Mg(ve,r,l,p,G,bt,et,Ze,at,st,Te,uo.horizontal,!1,Ke,re,Z);Lt&&(ue.horizontal[at]=Lt)}Mn("point"===Ke?"left":at)}}let Se=!1;if(B.icon&&B.icon.name){const He=u[B.icon.name];He&&(Ee=j_(p[B.icon.name],D.get("icon-offset").evaluate(B,{},v),D.get("icon-anchor").evaluate(B,{},v)),Se=He.sdf,void 0===a.sdfIcons?a.sdfIcons=He.sdf:a.sdfIcons!==He.sdf&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==a.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Ae=Y_(ue.horizontal)||ue.vertical;a.iconsInText||(a.iconsInText=!!Ae&&Ae.iconsInText),(Ae||Ee)&&Gs(a,B,ue,Ee,u,I,re,0,Te,Se,v)}_&&a.generateCollisionDebugBuffers(C,a.collisionBoxArray)}function Vg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gs(a,r,l,u,p,_,v,C,D,M,I){let P=_.textMaxSize.evaluate(r,{},I);void 0===P&&(P=v);const N=a.layers[0].layout,B=N.get("icon-offset").evaluate(r,{},I),G=Y_(l.horizontal)||l.vertical,Z=v/24,re=a.tilePixelRatio*P/24,ue=a.tilePixelRatio*N.get("symbol-spacing"),ve=N.get("text-padding")*a.tilePixelRatio,Ee=N.get("icon-padding")*a.tilePixelRatio,Te=nt(N.get("text-max-angle")),Se="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Ae="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),He=N.get("symbol-placement"),We=ue/2,et=N.get("icon-text-fit");let st;u&&"none"!==et&&(a.allowVerticalPlacement&&l.vertical&&(st=ac(u,l.vertical,et,N.get("icon-text-fit-padding"),B,Z)),G&&(u=ac(u,G,et,N.get("icon-text-fit-padding"),B,Z)));const Ze=(Qe,at)=>{at.x<0||at.x>=Pn||at.y<0||at.y>=Pn||function(Ke,Ft,bt,Mn,Lt,_n,St,Ot,En,Ki,vi,Qi,or,Pi,On,Kn,pr,Si,sr,er,Xn,Vr,Hn,Qn){const Ni=Ke.addToLineVertexArray(Ft,Mn);let Jr,Er,ii,Nn,ar,Tr,Xs,Ro=0,Es=0,wa=0,Mr=0,Ca=-1,hl=-1;const Qo={};let xd=il(""),Yf=0,pc=0;if(void 0===En._unevaluatedLayout.getValue("text-radial-offset")?[Yf,pc]=En.layout.get("text-offset").evaluate(Xn,{},Qn).map(gr=>24*gr):(Yf=24*En.layout.get("text-radial-offset").evaluate(Xn,{},Qn),pc=Bf),Ke.allowVerticalPlacement&&Lt.vertical){const gr=Lt.vertical;if(On)Tr=Ug(gr),Ot&&(Xs=Ug(Ot));else{const Fo=En.layout.get("text-rotate").evaluate(Xn,{},Qn)+90;ii=Vf(Ki,bt,Ft,vi,Qi,or,gr,Pi,Fo,Kn),Ot&&(Nn=Vf(Ki,bt,Ft,vi,Qi,or,Ot,Si,Fo))}}if(_n){const gr=En.layout.get("icon-rotate").evaluate(Xn,{},Qn),Fo="none"!==En.layout.get("icon-text-fit"),wd=Og(_n,gr,Hn,Fo),im=Ot?Og(Ot,gr,Hn,Fo):void 0;Er=Vf(Ki,bt,Ft,vi,Qi,or,_n,Si,gr),Ro=4*wd.length;const dy=Ke.iconSizeData;let lh=null;"source"===dy.kind?(lh=[va*En.layout.get("icon-size").evaluate(Xn,{},Qn)],lh[0]>cc&&pi(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===dy.kind&&(lh=[va*Vr.compositeIconSizes[0].evaluate(Xn,{},Qn),va*Vr.compositeIconSizes[1].evaluate(Xn,{},Qn)],(lh[0]>cc||lh[1]>cc)&&pi(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ke.addSymbols(Ke.icon,wd,lh,er,sr,Xn,!1,bt,Ft,Ni.lineStartIndex,Ni.lineLength,-1,Qn),Ca=Ke.icon.placedSymbolArray.length-1,im&&(Es=4*im.length,Ke.addSymbols(Ke.icon,im,lh,er,sr,Xn,uo.vertical,bt,Ft,Ni.lineStartIndex,Ni.lineLength,-1,Qn),hl=Ke.icon.placedSymbolArray.length-1)}for(const gr in Lt.horizontal){const Fo=Lt.horizontal[gr];Jr||(xd=il(Fo.text),On?ar=Ug(Fo):Jr=Vf(Ki,bt,Ft,vi,Qi,or,Fo,Pi,En.layout.get("text-rotate").evaluate(Xn,{},Qn),Kn));const wd=1===Fo.positionedLines.length;if(wa+=zg(Ke,bt,Ft,Fo,St,En,On,Xn,Kn,Ni,Lt.vertical?uo.horizontal:uo.horizontalOnly,wd?Object.keys(Lt.horizontal):[gr],Qo,Ca,Vr,Qn),wd)break}Lt.vertical&&(Mr+=zg(Ke,bt,Ft,Lt.vertical,St,En,On,Xn,Kn,Ni,uo.vertical,["vertical"],Qo,hl,Vr,Qn));let dl=-1;const nm=(gr,Fo)=>gr?Math.max(gr,Fo):Fo;dl=nm(ar,dl),dl=nm(Tr,dl),dl=nm(Xs,dl);const o1=dl>-1?1:0;Ke.glyphOffsetArray.length>=qs.MAX_GLYPHS&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Xn.sortKey&&Ke.addToSortKeyRanges(Ke.symbolInstances.length,Xn.sortKey),Ke.symbolInstances.emplaceBack(bt.x,bt.y,bt.z,Ft.x,Ft.y,Qo.right>=0?Qo.right:-1,Qo.center>=0?Qo.center:-1,Qo.left>=0?Qo.left:-1,Qo.vertical>=0?Qo.vertical:-1,Ca,hl,xd,void 0!==Jr?Jr:Ke.collisionBoxArray.length,void 0!==Jr?Jr+1:Ke.collisionBoxArray.length,void 0!==ii?ii:Ke.collisionBoxArray.length,void 0!==ii?ii+1:Ke.collisionBoxArray.length,void 0!==Er?Er:Ke.collisionBoxArray.length,void 0!==Er?Er+1:Ke.collisionBoxArray.length,Nn||Ke.collisionBoxArray.length,Nn?Nn+1:Ke.collisionBoxArray.length,vi,wa,Mr,Ro,Es,o1,0,Yf,pc,dl)}(a,at,at,Qe,l,u,p,st,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,ve,Se,D,0,Ee,Ae,B,r,_,M,I)};if("line"===He)for(const Qe of Ff(r.geometry,0,0,Pn,Pn)){const at=W_(Qe,ue,Te,l.vertical||G,u,24,re,a.overscaling,Pn);for(const Ke of at){const Ft=G;Ft&&Xv(a,Ft.text,We,Ke)||Ze(Qe,Ke)}}else if("line-center"===He){for(const Qe of r.geometry)if(Qe.length>1){const at=q_(Qe,Te,l.vertical||G,u,24,re);at&&Ze(Qe,at)}}else if("Polygon"===r.type)for(const Qe of _g(r.geometry,0)){const at=Lg(Qe,16);Ze(Qe[0],new ll(at.x,at.y,0,0,void 0))}else if("LineString"===r.type)for(const Qe of r.geometry)Ze(Qe,new ll(Qe[0].x,Qe[0].y,0,0,void 0));else if("Point"===r.type)for(const Qe of r.geometry)for(const at of Qe)Ze([at],new ll(at.x,at.y,0,0,void 0))}const cc=32640;function zg(a,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z){const re=function(Ee,Te,Se,Ae,He,We,et,st){const Ze=[];if(0===Te.positionedLines.length)return Ze;const Qe=Ae.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,at=function(Lt){const _n=Lt[0],St=Lt[1],Ot=_n*St;return Ot>0?[_n,-St]:Ot<0?[-_n,St]:0===_n?[St,_n]:[St,-_n]}(Se);let Ke=Math.abs(Te.top-Te.bottom);for(const Lt of Te.positionedLines)Ke-=Lt.lineOffset;const Ft=Te.positionedLines.length,bt=Ke/Ft;let Mn=Te.top-Se[1];for(let Lt=0;Lt<Ft;++Lt){const _n=Te.positionedLines[Lt];Mn=Gv(Te,bt,Mn,Lt);for(const St of _n.positionedGlyphs){if(!St.rect)continue;const Ot=St.rect||{};let En=4,Ki=!0,vi=1,Qi=0;if(St.imageName){const Nn=et[St.imageName];if(!Nn)continue;if(Nn.sdf){pi("SDF images are not supported in formatted text and will be ignored.");continue}Ki=!1,vi=Nn.pixelRatio,En=1/vi}const or=(He||st)&&St.vertical,Pi=St.metrics.advance*St.scale/2,On=St.metrics,Kn=St.rect;if(null===Kn)continue;st&&Te.verticalizable&&(Qi=St.imageName?Pi-St.metrics.width*St.scale/2:0);const pr=He?[St.x+Pi,St.y]:[0,0];let Si=[0,0],sr=[0,0],er=!1;He||(or?(sr=[St.x+Pi+at[0],St.y+at[1]-Qi],er=!0):Si=[St.x+Pi+Se[0],St.y+Se[1]-Qi]);const Xn=Kn.w*St.scale/(vi*(St.localGlyph?2:1)),Vr=Kn.h*St.scale/(vi*(St.localGlyph?2:1));let Hn,Qn,Ni,Jr;if(or){const Nn=St.y-Mn,ar=new q(-Pi,Pi-Nn),Tr=-Math.PI/2,Xs=new q(...sr);Hn=new q(-Pi+Si[0],Si[1]),Hn._rotateAround(Tr,ar)._add(Xs),Hn.x+=-Nn+Pi,Hn.y-=(On.left-En)*St.scale;const Ro=St.imageName?On.advance*St.scale:24*St.scale,Es=String.fromCharCode(St.glyph);Vv(Es)?Hn.x+=(1-En)*St.scale:zv(Es)?Hn.x+=Ro-On.height*St.scale+(-En-1)*St.scale:Hn.x+=St.imageName||On.width+2*En===Kn.w&&On.height+2*En===Kn.h?(Ro-Vr)/2:(Ro-(On.height+2*En)*St.scale)/2,Qn=new q(Hn.x,Hn.y-Xn),Ni=new q(Hn.x+Vr,Hn.y),Jr=new q(Hn.x+Vr,Hn.y-Xn)}else{const Nn=(On.left-En)*St.scale-Pi+Si[0],ar=(-On.top-En)*St.scale+Si[1],Tr=Nn+Xn,Xs=ar+Vr;Hn=new q(Nn,ar),Qn=new q(Tr,ar),Ni=new q(Nn,Xs),Jr=new q(Tr,Xs)}if(Qe){let Nn;Nn=He?new q(0,0):er?new q(at[0],at[1]):new q(Se[0],Se[1]),Hn._rotateAround(Qe,Nn),Qn._rotateAround(Qe,Nn),Ni._rotateAround(Qe,Nn),Jr._rotateAround(Qe,Nn)}const Er=new q(0,0),ii=new q(0,0);Ze.push({tl:Hn,tr:Qn,bl:Ni,br:Jr,tex:Ot,writingMode:Te.writingMode,glyphOffset:pr,sectionIndex:St.sectionIndex,isSDF:Ki,pixelOffsetTL:Er,pixelOffsetBR:ii,minFontScaleX:0,minFontScaleY:0})}}return Ze}(0,u,D,_,v,C,p,a.allowVerticalPlacement),ue=a.textSizeData;let ve=null;"source"===ue.kind?(ve=[va*_.layout.get("text-size").evaluate(C,{},Z)],ve[0]>cc&&pi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ue.kind&&(ve=[va*G.compositeTextSizes[0].evaluate(C,{},Z),va*G.compositeTextSizes[1].evaluate(C,{},Z)],(ve[0]>cc||ve[1]>cc)&&pi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,re,ve,D,v,C,I,r,l,M.lineStartIndex,M.lineLength,B,Z);for(const Ee of P)N[Ee]=a.text.placedSymbolArray.length-1;return 4*re.length}function Y_(a){for(const r in a)return a[r];return null}function Vf(a,r,l,u,p,_,v,C,D,M){let I=v.top,P=v.bottom,N=v.left,B=v.right;const G=v.collisionPadding;if(G&&(N-=G[0],I-=G[1],B+=G[2],P+=G[3]),D){const Z=new q(N,I),re=new q(B,I),ue=new q(N,P),ve=new q(B,P),Ee=nt(D);let Te=new q(0,0);M&&(Te=new q(M[0],M[1])),Z._rotateAround(Ee,Te),re._rotateAround(Ee,Te),ue._rotateAround(Ee,Te),ve._rotateAround(Ee,Te),N=Math.min(Z.x,re.x,ue.x,ve.x),B=Math.max(Z.x,re.x,ue.x,ve.x),I=Math.min(Z.y,re.y,ue.y,ve.y),P=Math.max(Z.y,re.y,ue.y,ve.y)}return a.emplaceBack(r.x,r.y,r.z,l.x,l.y,N,I,B,P,C,u,p,_),a.length-1}function Ug(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function Xv(a,r,l,u){const p=a.compareText;if(r in p){const _=p[r];for(let v=_.length-1;v>=0;v--)if(u.dist(_[v])<l)return!0}else p[r]=[];return p[r].push(u),!1}const J_=Xu.VectorTileFeature.types,Yv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zf(a,r,l,u,p,_,v,C,D,M,I,P,N,B,G,Z){const re=I?Math.min(cc,Math.round(I[0])):0,ue=I?Math.min(cc,Math.round(I[1])):0;a.emplaceBack(r,l,Math.round(32*v),Math.round(32*C),D,M,(re<<1)+(P?1:0),ue,16*N,16*B,256*G,256*Z,u,p,_,0)}function $g(a,r,l){a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l)}function on(a){for(const r of a.sections)if(g(r.text))return!0;return!1}class ot{constructor(r){this.layoutVertexArray=new Io,this.indexArray=new kn,this.programConfigurations=r,this.segments=new fr,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new ao,this.placedSymbolArray=new Zc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,l,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Rw.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,R_.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Yv,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",ot);class Uf{constructor(r,l,u){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new u,this.segments=new fr,this.collisionVertexArray=new vs,this.collisionVertexArrayExt=new Zt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Sf.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,Bv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt("CollisionBuffers",Uf);class qs{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(v=>v.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sg([]),this.placementViewportMatrix=sg([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wg(this.zoom,l["text-size"]),this.iconSizeData=wg(this.zoom,l["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>uo[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=r.sourceID}createArrays(){this.text=new ot(new ol(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new ot(new ol(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Kp,this.lineVertexArray=new iv,this.symbolInstances=new f_}calculateGlyphDependencies(r,l,u,p,_){for(let v=0;v<r.length;v++)if(l[r.charCodeAt(v)]=!0,p&&_){const C=Ju[r.charAt(v)];C&&(l[C.charCodeAt(0)]=!0)}}populate(r,l,u){const p=this.layers[0],_=p.layout,v=_.get("text-font"),C=_.get("text-field"),D=_.get("icon-image"),M=("constant"!==C.value.kind||C.value.value instanceof Tt&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),I="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const N=l.iconDependencies,B=l.glyphDependencies,G=l.availableImages,Z=new H(this.zoom);for(const{feature:re,id:ue,index:ve,sourceLayerIndex:Ee}of r){const Te=p._featureFilter.needGeometry,Se=xs(re,Te);if(!p._featureFilter.filter(Z,Se,u))continue;let Ae,He;if(Te||(Se.geometry=sl(re)),M){const et=p.getValueAndResolveTokens("text-field",Se,u,G),st=Tt.factory(et);on(st)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===L()||this.hasRTLText&&$.isParsed())&&(Ae=Cs(st,p,Se))}if(I){const et=p.getValueAndResolveTokens("icon-image",Se,u,G);He=et instanceof Rr?et:Rr.fromString(et)}if(!Ae&&!He)continue;const We=this.sortFeaturesByKey?P.evaluate(Se,{},u):void 0;if(this.features.push({id:ue,text:Ae,icon:He,index:ve,sourceLayerIndex:Ee,geometry:Se.geometry,properties:re.properties,type:J_[re.type],sortKey:We}),He&&(N[He.name]=!0),Ae){const et=v.evaluate(Se,{},u).join(","),st="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(uo.vertical)>=0;for(const Ze of Ae.sections)if(Ze.image)N[Ze.image.name]=!0;else{const Qe=$s(Ae.toString()),at=Ze.fontStack||et,Ke=B[at]=B[at]||{};this.calculateGlyphDependencies(Ze.text,Ke,st,this.allowVerticalPlacement,Qe)}}}"line"===_.get("symbol-placement")&&(this.features=function(re){const ue={},ve={},Ee=[];let Te=0;function Se(et){Ee.push(re[et]),Te++}function Ae(et,st,Ze){const Qe=ve[et];return delete ve[et],ve[st]=Qe,Ee[Qe].geometry[0].pop(),Ee[Qe].geometry[0]=Ee[Qe].geometry[0].concat(Ze[0]),Qe}function He(et,st,Ze){const Qe=ue[st];return delete ue[st],ue[et]=Qe,Ee[Qe].geometry[0].shift(),Ee[Qe].geometry[0]=Ze[0].concat(Ee[Qe].geometry[0]),Qe}function We(et,st,Ze){const Qe=Ze?st[0][st[0].length-1]:st[0][0];return`${et}:${Qe.x}:${Qe.y}`}for(let et=0;et<re.length;et++){const st=re[et],Ze=st.geometry,Qe=st.text?st.text.toString():null;if(!Qe){Se(et);continue}const at=We(Qe,Ze),Ke=We(Qe,Ze,!0);if(at in ve&&Ke in ue&&ve[at]!==ue[Ke]){const Ft=He(at,Ke,Ze),bt=Ae(at,Ke,Ee[Ft].geometry);delete ue[at],delete ve[Ke],ve[We(Qe,Ee[bt].geometry,!0)]=bt,Ee[Ft].geometry=null}else at in ve?Ae(at,Ke,Ze):Ke in ue?He(at,Ke,Ze):(Se(et),ue[at]=Te-1,ve[Ke]=Te-1)}return Ee.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,ue)=>re.sortKey-ue.sortKey)}update(r,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,u),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const u=this.lineVertexArray.length;if(void 0!==r.segment){let p=r.dist(l[r.segment+1]),_=r.dist(l[r.segment]);const v={};for(let C=r.segment+1;C<l.length;C++)v[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:p},C<l.length-1&&(p+=l[C+1].dist(l[C]));for(let C=r.segment||0;C>=0;C--)v[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=l[C-1].dist(l[C]));for(let C=0;C<l.length;C++){const D=v[C];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,l,u,p,_,v,C,D,M,I,P,N,B){const G=r.indexArray,Z=r.layoutVertexArray,re=r.segments.prepareSegment(4*l.length,Z,G,this.canOverlap?v.sortKey:void 0),ue=this.glyphOffsetArray.length,ve=re.vertexLength,Ee=this.allowVerticalPlacement&&C===uo.vertical?Math.PI/2:0,Te=v.text&&v.text.sections;for(let Se=0;Se<l.length;Se++){const{tl:Ae,tr:He,bl:We,br:et,tex:st,pixelOffsetTL:Ze,pixelOffsetBR:Qe,minFontScaleX:at,minFontScaleY:Ke,glyphOffset:Ft,isSDF:bt,sectionIndex:Mn}=l[Se],Lt=re.vertexLength,_n=Ft[1];zf(Z,D.x,D.y,D.z,M.x,M.y,Ae.x,_n+Ae.y,st.x,st.y,u,bt,Ze.x,Ze.y,at,Ke),zf(Z,D.x,D.y,D.z,M.x,M.y,He.x,_n+He.y,st.x+st.w,st.y,u,bt,Qe.x,Ze.y,at,Ke),zf(Z,D.x,D.y,D.z,M.x,M.y,We.x,_n+We.y,st.x,st.y+st.h,u,bt,Ze.x,Qe.y,at,Ke),zf(Z,D.x,D.y,D.z,M.x,M.y,et.x,_n+et.y,st.x+st.w,st.y+st.h,u,bt,Qe.x,Qe.y,at,Ke),$g(r.dynamicLayoutVertexArray,D,Ee),G.emplaceBack(Lt,Lt+1,Lt+2),G.emplaceBack(Lt+1,Lt+2,Lt+3),re.vertexLength+=4,re.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ft[0]),Se!==l.length-1&&Mn===l[Se+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,v,v.index,{},B,Te&&Te[Mn])}r.placedSymbolArray.emplaceBack(D.x,D.y,D.z,M.x,M.y,ue,this.glyphOffsetArray.length-ue,ve,I,P,M.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],C,0,!1,0,N,0)}_commitLayoutVertex(r,l,u,p,_,v,C){r.emplaceBack(l,u,p,_,v,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(r,l,u,p,_,v,C){const D=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),M=D.vertexLength,I=C.tileAnchorX,P=C.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,p,_,v,I,P,new q(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,_,v,I,P,new q(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,_,v,I,P,new q(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,_,v,I,P,new q(r.x1,r.y2)),D.vertexLength+=4;const N=u.indexArray;N.emplaceBack(M,M+1),N.emplaceBack(M+1,M+2),N.emplaceBack(M+2,M+3),N.emplaceBack(M+3,M),D.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,u,p,_,v){for(let C=p;C<_;C++){const D=u.get(C),M=this.getSymbolInstanceTextSize(r,v,l,C);this._addCollisionDebugVertices(D,M,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(r,l,u,p,_,v){for(let C=p;C<_;C++){const D=u.get(C),M=this.getSymbolInstanceIconSize(r,l,C);this._addCollisionDebugVertices(D,M,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,v)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uf(Xr,F_.members,ki),this.iconCollisionBox=new Uf(Xr,F_.members,ki);const u=Yu(this.iconSizeData,r),p=Yu(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,r,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,r,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,l,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(r,l,u,p){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),v=If(this.textSizeData,r,_)/24;return this.tilePixelRatio*v}getSymbolInstanceIconSize(r,l,u){const p=this.icon.placedSymbolArray.get(u),_=If(this.iconSizeData,r,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(r,l,u){r.emplaceBack(l,-u,-u),r.emplaceBack(l,u,-u),r.emplaceBack(l,u,u),r.emplaceBack(l,-u,u)}_updateTextDebugCollisionBoxes(r,l,u,p,_,v){for(let C=p;C<_;C++){const D=u.get(C),M=this.getSymbolInstanceTextSize(r,v,l,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,D.padding)}}_updateIconDebugCollisionBoxes(r,l,u,p,_){for(let v=p;v<_;v++){const C=u.get(v),D=this.getSymbolInstanceIconSize(r,l,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,C.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Yu(this.iconSizeData,r),p=Yu(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(p,r,l,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(p,r,l,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,r,l,v.iconBoxStartIndex,v.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,r,l,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,u,p,_,v,C,D,M){const I={};for(let P=l;P<u;P++){const N=r.get(P);I.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},I.textFeatureIndex=N.featureIndex;break}for(let P=p;P<_;P++){const N=r.get(P);I.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},I.verticalTextFeatureIndex=N.featureIndex;break}for(let P=v;P<C;P++){const N=r.get(P);I.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},I.iconFeatureIndex=N.featureIndex;break}for(let P=D;P<M;P++){const N=r.get(P);I.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},I.verticalIconFeatureIndex=N.featureIndex;break}return I}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const u=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const u=r.placedSymbolArray.get(l),p=u.vertexStartIndex+4*u.numGlyphs;for(let _=u.vertexStartIndex;_<p;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(r),u=Math.cos(r),p=[],_=[],v=[];for(let C=0;C<this.symbolInstances.length;++C){v.push(C);const D=this.symbolInstances.get(C);p.push(0|Math.round(l*D.tileAnchorX+u*D.tileAnchorY)),_.push(D.featureIndex)}return v.sort((C,D)=>p[C]-p[D]||_[D]-_[C]),v}addToSortKeyRanges(r,l){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===l?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const u=this.symbolInstances.get(l);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,_,v)=>{p>=0&&v.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yt("SymbolBucket",qs,{omit:["layers","collisionBoxArray","features","compareText"]}),qs.MAX_GLYPHS=65535,qs.addDynamicAttributes=$g;const Ws=new Fe({"symbol-placement":new oe(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new oe(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oe(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oe(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new oe(ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new oe(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new oe(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oe(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(ge.layout_symbol["icon-size"]),"icon-text-fit":new oe(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new oe(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(ge.layout_symbol["icon-image"]),"icon-rotate":new we(ge.layout_symbol["icon-rotate"]),"icon-padding":new oe(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new oe(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new we(ge.layout_symbol["icon-offset"]),"icon-anchor":new we(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oe(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oe(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oe(ge.layout_symbol["text-rotation-alignment"]),"text-field":new we(ge.layout_symbol["text-field"]),"text-font":new we(ge.layout_symbol["text-font"]),"text-size":new we(ge.layout_symbol["text-size"]),"text-max-width":new we(ge.layout_symbol["text-max-width"]),"text-line-height":new we(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new we(ge.layout_symbol["text-letter-spacing"]),"text-justify":new we(ge.layout_symbol["text-justify"]),"text-radial-offset":new we(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oe(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new we(ge.layout_symbol["text-anchor"]),"text-max-angle":new oe(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new oe(ge.layout_symbol["text-writing-mode"]),"text-rotate":new we(ge.layout_symbol["text-rotate"]),"text-padding":new oe(ge.layout_symbol["text-padding"]),"text-keep-upright":new oe(ge.layout_symbol["text-keep-upright"]),"text-transform":new we(ge.layout_symbol["text-transform"]),"text-offset":new we(ge.layout_symbol["text-offset"]),"text-allow-overlap":new oe(ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new oe(ge.layout_symbol["text-ignore-placement"]),"text-optional":new oe(ge.layout_symbol["text-optional"])});var $f={paint:new Fe({"icon-opacity":new we(ge.paint_symbol["icon-opacity"]),"icon-color":new we(ge.paint_symbol["icon-color"]),"icon-halo-color":new we(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new oe(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new oe(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(ge.paint_symbol["text-opacity"]),"text-color":new we(ge.paint_symbol["text-color"],{runtimeType:wi,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new we(ge.paint_symbol["text-halo-color"]),"text-halo-width":new we(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new we(ge.paint_symbol["text-halo-blur"]),"text-translate":new oe(ge.paint_symbol["text-translate"]),"text-translate-anchor":new oe(ge.paint_symbol["text-translate-anchor"])}),layout:Ws};class K_{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Rs,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",K_,{omit:["defaultValue"]});class rh extends Hs{constructor(r){super(r,$f)}recalculate(r,l){super.recalculate(r,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const _ of u)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,u,p){const _=this.layout.get(r).evaluate(l,{},u,p),v=this._unevaluatedLayout._values[r];return v.isDataDriven()||Lc(v.value)||!_?_:(C=l.properties,_.replace(/{([^{}]+)}/g,(M,I)=>I in C?String(C[I]):""));var C}createBucket(r){return new qs(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of $f.paint.overridableProperties){if(!rh.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),u=new K_(l),p=new Ls(u,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new Bc("source",p):new da("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new he(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,u){return!(!this.layout||l.isDataDriven()||u.isDataDriven())&&rh.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const u=r.get("text-field"),p=$f.paint.properties[l];let _=!1;const v=C=>{for(const D of C)if(p.overrides&&p.overrides.hasOverride(D))return void(_=!0)};if("constant"===u.value.kind&&u.value.value instanceof Tt)v(u.value.value.sections);else if("source"===u.value.kind){const C=M=>{_||(M instanceof _r&&Li(M.value)===yu?v(M.value.sections):M instanceof Ci?v(M.sections):M.eachChild(C))},D=u.value;D._styleExpression&&C(D._styleExpression.expression)}return _}getProgramConfiguration(r){return new Ji(this,r)}}var cl={paint:new Fe({"background-color":new oe(ge.paint_background["background-color"]),"background-pattern":new Ye(ge.paint_background["background-pattern"]),"background-opacity":new oe(ge.paint_background["background-opacity"])})},jg={paint:new Fe({"raster-opacity":new oe(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new oe(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oe(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oe(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new oe(ge.paint_raster["raster-saturation"]),"raster-contrast":new oe(ge.paint_raster["raster-contrast"]),"raster-resampling":new oe(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new oe(ge.paint_raster["raster-fade-duration"])})};class Q_ extends Hs{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Hg={paint:new Fe({"sky-type":new oe(ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new oe(ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new oe(ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new oe(ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new oe(ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new oe(ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new oe(ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new oe(ge.paint_sky["sky-opacity"])})};function ey(a,r,l){const u=Gu(0,0,1),p=Jh(ug());return function(_,v,C){C*=.5;var D=v[0],M=v[1],I=v[2],P=v[3],N=Math.sin(C),B=Math.cos(C);_[0]=D*B-I*N,_[1]=M*B+P*N,_[2]=I*B+D*N,_[3]=P*B-M*N}(p,p,l?-nt(a)+Math.PI:nt(a)),gf(p,p,-nt(r)),fv(u,u,p),v_(u,u)}const ty={circle:class extends Hs{constructor(a){super(a,ko)}createBucket(a){return new eg(a)}queryRadius(a){const r=a;return ju("circle-radius",this,r)+ju("circle-stroke-width",this,r)+Xh(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,l,u,p,_,v,C){const D=dv(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return Qc(a,u,_,v,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,M)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Ji(this,a)}},heatmap:class extends Hs{createBucket(a){return new _f(a)}constructor(a){super(a,_v),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return ju("heatmap-radius",this,a)}queryIntersectsFeature(a,r,l,u,p,_,v,C){const D=this.paint.get("heatmap-radius").evaluate(r,l);return Qc(a,u,_,v,C,!0,!0,new q(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Ji(this,a)}},hillshade:class extends Hs{constructor(a){super(a,yv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new Ji(this,a)}},fill:class extends Hs{constructor(a){super(a,Sv)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Ji(this,a)}recalculate(a,r){super.recalculate(a,r);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Df(a)}queryRadius(){return Xh(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,l,u,p,_){return!a.queryGeometry.isAboveHorizon&&hv(og(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Hs{constructor(a){super(a,od)}createBucket(a){return new Tf(a)}queryRadius(){return Xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Ji(this,a)}queryIntersectsFeature(a,r,l,u,p,_,v,C,D){const M=dv(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(r,l),P=this.paint.get("fill-extrusion-base").evaluate(r,l),N=[0,0],B=C&&_.elevation,G=_.elevation?_.elevation.exaggeration():1;if(B){const ue=a.tile.getBucket(this).centroidVertexArray,ve=D+1;if(ve<ue.length){const Ee=ue.get(ve);N[0]=Ee.a_centroid_pos0,N[1]=Ee.a_centroid_pos1}}if(0===N[0]&&1===N[1])return!1;const Z=(ue=u,ve=P,Ee=I,Te=M,Se=v,(Ae=B?C:null)?function(st,Ze,Qe,at,Ke,Ft,bt,Mn,Lt){const _n=[],St=[],Ot=[0,0,0,1];for(const En of st){const Ki=[],vi=[];for(const Qi of En){const or=Qi.x+at.x,Pi=Qi.y+at.y,On=I_(or,Pi,Ze,Qe,Ft,bt,Mn,Lt);Ot[0]=or,Ot[1]=Pi,Ot[2]=On.base,Ot[3]=1,Yh(Ot,Ot,Ke),Ot[3]=Math.max(Ot[3],1e-5);const Kn=S_([Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]]);Ot[0]=or,Ot[1]=Pi,Ot[2]=On.top,Ot[3]=1,Yh(Ot,Ot,Ke),Ot[3]=Math.max(Ot[3],1e-5);const pr=S_([Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]]);Ki.push(Kn),vi.push(pr)}_n.push(Ki),St.push(vi)}return[_n,St]}(ue,ve,Ee,Te,Se,Ae,N,G,_.center.lat):function(st,Ze,Qe,at,Ke){const Ft=[],bt=[],Mn=Ke[8]*Ze,Lt=Ke[9]*Ze,_n=Ke[10]*Ze,St=Ke[11]*Ze,Ot=Ke[8]*Qe,En=Ke[9]*Qe,Ki=Ke[10]*Qe,vi=Ke[11]*Qe;for(const Qi of st){const or=[],Pi=[];for(const On of Qi){const Kn=On.x+at.x,pr=On.y+at.y,Si=Ke[0]*Kn+Ke[4]*pr+Ke[12],sr=Ke[1]*Kn+Ke[5]*pr+Ke[13],er=Ke[2]*Kn+Ke[6]*pr+Ke[14],Xn=Ke[3]*Kn+Ke[7]*pr+Ke[15],Vr=Si+Mn,Hn=sr+Lt,Qn=er+_n,Ni=Math.max(Xn+St,1e-5),Jr=Si+Ot,Er=sr+En,ii=er+Ki,Nn=Math.max(Xn+vi,1e-5),ar=new q(Vr/Ni,Hn/Ni);ar.z=Qn/Ni,or.push(ar);const Tr=new q(Jr/Nn,Er/Nn);Tr.z=ii/Nn,Pi.push(Tr)}Ft.push(or),bt.push(Pi)}return[Ft,bt]}(ue,ve,Ee,Te,Se)),re=a.queryGeometry;var ue,ve,Ee,Te,Se,Ae;return function(ue,ve,Ee){let Te=1/0;hv(Ee,ve)&&(Te=M_(Ee,ve[0]));for(let Se=0;Se<ve.length;Se++){const Ae=ve[Se],He=ue[Se];for(let We=0;We<Ae.length-1;We++){const et=Ae[We],st=[et,Ae[We+1],He[We+1],He[We],et];__(Ee,st)&&(Te=Math.min(Te,M_(Ee,st)))}}return Te!==1/0&&Te}(Z[0],Z[1],re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Hs{constructor(a){super(a,Mf),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof zl,this.gradientVersion=(this.gradientVersion+1)%K}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=xg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new bg(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Ji(this,a)}queryRadius(a){const r=a,l=N_(ju("line-width",this,r),ju("line-gap-width",this,r)),u=ju("line-offset",this,r);return l/2+Math.abs(u)+Xh(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,l,u,p,_){if(a.queryGeometry.isAboveHorizon)return!1;const v=og(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),C=a.pixelToTileUnitsFactor/2*N_(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),D=this.paint.get("line-offset").evaluate(r,l);return D&&(u=function(M,I){const P=[],N=new q(0,0);for(let B=0;B<M.length;B++){const G=M[B],Z=[];for(let re=0;re<G.length;re++){const ue=G[re-1],ve=G[re],Ee=G[re+1],Te=0===re?N:ve.sub(ue)._unit()._perp(),Se=re===G.length-1?N:Ee.sub(ve)._unit()._perp(),Ae=Te._add(Se)._unit();Ae._mult(1/(Ae.x*Se.x+Ae.y*Se.y)),Z.push(Ae._mult(I)._add(ve))}P.push(Z)}return P}(u,D*a.pixelToTileUnitsFactor)),function(M,I,P){for(let N=0;N<I.length;N++){const B=I[N];if(M.length>=3)for(let G=0;G<B.length;G++)if(Wh(M,B[G]))return!0;if(ng(M,B,P))return!0}return!1}(v,u,C)}isTileClipped(){return!0}},symbol:rh,background:class extends Hs{constructor(a){super(a,cl)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Hs{constructor(a){super(a,jg)}getProgramIds(){return["raster"]}},sky:class extends Hs{constructor(a){super(a,Hg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(a,r){const l=this.paint.get("sky-type");if("atmosphere"===l){const u=this.paint.get("sky-atmosphere-sun"),p=!u,_=a.style.light,v=_.properties.get("position");return p&&"viewport"===_.properties.get("anchor")&&pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?ey(v.azimuthal,90-v.polar,r):ey(u[0],90-u[1],r)}if("gradient"===l){const u=this.paint.get("sky-gradient-center");return ey(u[0],90-u[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}},{HTMLImageElement:Jv,HTMLCanvasElement:ba,HTMLVideoElement:md,ImageData:_d,ImageBitmap:oh}=ye;class Gg{constructor(r,l,u,p){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,u){const{width:p,height:_}=r,v=!(this.size&&this.size[0]===p&&this.size[1]===_||u),{context:C}=this,{gl:D}=C;if(this.useMipmap=Boolean(l&&l.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!l||!1!==l.premultiply)),v)this.size=[p,_],r instanceof Jv||r instanceof ba||r instanceof md||r instanceof _d||oh&&r instanceof oh?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,r):D.texImage2D(D.TEXTURE_2D,0,this.format,p,_,0,this.format,D.UNSIGNED_BYTE,r.data);else{const{x:M,y:I}=u||{x:0,y:0};r instanceof Jv||r instanceof ba||r instanceof md||r instanceof _d||oh&&r instanceof oh?D.texSubImage2D(D.TEXTURE_2D,0,M,I,D.RGBA,D.UNSIGNED_BYTE,r):D.texSubImage2D(D.TEXTURE_2D,0,M,I,p,_,D.RGBA,D.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(r,l,u){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),u!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=_.LINEAR),r!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,r),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,u||r),this.filter=r),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class au{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Ui?new Ui(r.lng,r.lat):Ui.convert(r),this}setSouthWest(r){return this._sw=r instanceof Ui?new Ui(r.lng,r.lat):Ui.convert(r),this}extend(r){const l=this._sw,u=this._ne;let p,_;if(r instanceof Ui)p=r,_=r;else{if(!(r instanceof au))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(au.convert(r)):this.extend(Ui.convert(r)):this;if(p=r._sw,_=r._ne,!p||!_)return this}return l||u?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new Ui(p.lng,p.lat),this._ne=new Ui(_.lng,_.lat)),this}getCenter(){return new Ui((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ui(this.getWest(),this.getNorth())}getSouthEast(){return new Ui(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:u}=Ui.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(r){return!r||r instanceof au?r:new au(r)}}const qg=6371008.8;class Ui{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ui(Ai(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,u=this.lat*l,p=r.lat*l,_=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return qg*Math.acos(Math.min(_,1))}toBounds(r=0){const l=360*r/40075017,u=l/Math.cos(Math.PI/180*this.lat);return new au(new Ui(this.lng-u,this.lat-l),new Ui(this.lng+u,this.lat+l))}static convert(r){if(r instanceof Ui)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Ui(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Ui(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ny=2*Math.PI*qg;function Kv(a){return ny*Math.cos(a*Math.PI/180)}function Wg(a){return(180+a)/360}function Zg(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Xg(a,r){return a/Kv(r)}function sh(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function iy(a,r){return a*Kv(sh(r))}class yd{constructor(r,l,u=0){this.x=+r,this.y=+l,this.z=+u}static fromLngLat(r,l=0){const u=Ui.convert(r);return new yd(Wg(u.lng),Zg(u.lat),Xg(l,u.lat))}toLngLat(){return new Ui(360*this.x-180,sh(this.y))}toAltitude(){return iy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ny*(r=sh(this.y),1/Math.cos(r*Math.PI/180));var r}}class ry{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new Po({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const u=this.getKey(r,l);return this.positions[u]}trim(){const r=this.width,l=this.height=ea(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,u){const p=[];let _=r.length%2==1?-r[r.length-1]*u:0,v=r[0]*u,C=!0;p.push({left:_,right:v,isDash:C,zeroLength:0===r[0]});let D=r[0];for(let M=1;M<r.length;M++){C=!C;const I=r[M];_=D*u,D+=I,v=D*u,p.push({left:_,right:v,isDash:C,zeroLength:0===I})}return p}addRoundDash(r,l,u){const p=l/2;for(let _=-u;_<=u;_++){const v=this.width*(this.nextRow+u+_);let C=0,D=r[C];for(let M=0;M<this.width;M++){M/D.right>1&&(D=r[++C]);const I=Math.abs(M-D.left),P=Math.abs(M-D.right),N=Math.min(I,P);let B;const G=_/u*(p+1);if(D.isDash){const Z=p-Math.abs(G);B=Math.sqrt(N*N+Z*Z)}else B=p-Math.sqrt(N*N+G*G);this.image.data[v+M]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(r,l){for(let D=r.length-1;D>=0;--D){const M=r[D],I=r[D+1];M.zeroLength?r.splice(D,1):I&&I.isDash===M.isDash&&(I.left=M.left,r.splice(D,1))}const u=r[0],p=r[r.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const _=this.width*this.nextRow;let v=0,C=r[v];for(let D=0;D<this.width;D++){D/C.right>1&&(C=r[++v]);const M=Math.abs(D-C.left),I=Math.abs(D-C.right),P=Math.min(M,I);this.image.data[_+D]=Math.max(0,Math.min(255,(C.isDash?P:-P)+l+128))}}addDash(r,l){const u=this.getKey(r,l);if(this.positions[u])return this.positions[u];const p="round"===l,_=p?7:0,v=2*_+1;if(this.nextRow+v>this.height)return pi("LineAtlas out of space"),null;0===r.length&&r.push(1);let C=0;for(let I=0;I<r.length;I++)r[I]<0&&(pi("Negative value is found in line dasharray, replacing values with 0"),r[I]=0),C+=r[I];if(0!==C){const I=this.width/C,P=this.getDashRanges(r,this.width,I);p?this.addRoundDash(P,I,_):this.addRegularDash(P,"square"===l?.5*I:0)}const D=this.nextRow+_;this.nextRow+=v;const M={tl:[D,_],br:[C,0]};return this.positions[u]=M,M}}yt("LineAtlas",ry);class Lw{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Bw=ye.performance;function Qv(a){const r=a?a.url.toString():void 0;return Bw.getEntriesByName(r)}class Vw{constructor(){this.tasks={},this.taskQueue=[],qn(["process"],this),this.invoker=new Lw(this.process),this.nextId=0}add(r,l){const u=this.nextId++,p=function({type:_,isSymbolTile:v,zoom:C}){return C=C||0,"message"===_?0:"maybePrepare"!==_||v?"parseTile"!==_||v?"parseTile"===_&&v?300-C:"maybePrepare"===_&&v?400-C:500:200-C:100-C}(l);if(0===p){Pr();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:l,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){Pr();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<l&&(l=_.priority,r=p)}if(null===r)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}function e1(a,r,l){var u=2*Math.PI*6378137/256/Math.pow(2,l);return[a*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class oy{constructor(r,l,u){this.z=r,this.x=l,this.y=u,this.key=Ds(0,r,r,l,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const u=(_=this.y,v=this.z,C=e1(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),D=e1(256*(p+1),256*(_+1),v),C[0]+","+C[1]+","+D[0]+","+D[1]);var p,_,v,C,D;const M=function(I,P,N){let B,G="";for(let Z=I;Z>0;Z--)B=1<<Z-1,G+=(P&B?1:0)+(N&B?2:0);return G}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",M).replace("{bbox-epsg-3857}",u)}getTilePoint(r){const l=Math.pow(2,this.z);return new q((r.x*l-this.x)*Pn,(r.y*l-this.y)*Pn)}getTileVec3(r){const l=Math.pow(2,this.z);return Gu((r.x*l-this.x)*Pn,(r.y*l-this.y)*Pn,iy(r.z,r.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class t1{constructor(r,l){this.wrap=r,this.canonical=l,this.key=Ds(r,l.z,l.z,l.x,l.y)}}class No{constructor(r,l,u,p,_){this.overscaledZ=r,this.wrap=l,this.canonical=new oy(u,+p,+_),this.key=0===l&&r===u?this.canonical.key:Ds(l,r,u,p,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new No(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return Ds(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return Ds(this.wrap*+l,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new No(l,this.wrap,l,u,p),new No(l,this.wrap,l,u+1,p),new No(l,this.wrap,l,u,p+1),new No(l,this.wrap,l,u+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new No(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new t1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new yd(r.x-this.wrap,r.y))}getTileVec3(r){return this.canonical.getTileVec3(new yd(r.x-this.wrap,r.y,r.z))}}function Ds(a,r,l,u,p){const _=1<<Math.min(l,22);let v=_*(p%_)+u%_;return a&&l<22&&(v+=_*_*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*v+l)+(r-l)}yt("CanonicalTileID",oy),yt("OverscaledTileID",No,{omit:["projMatrix"]});class jf{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const u=r[l];this._stringToNumber[u]=l,this._numberToString[l]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class sy{constructor(r,l,u,p,_){this.type="Feature",this._vectorTileFeature=r,r._z=l,r._x=u,r._y=p,this.properties=r.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(r[l]=this[l]);return r}}var ay=vt([{name:"a_pos",type:"Int16",components:2}]);class Hf{constructor(r,l,u){this.tileID=r,this.uid=Al(),this.uses=0,this.tileSize=l,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const l=r+this.timeAdded;l<no.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(r,l,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,_){const v={};if(!_)return v;for(const C of p){const D=C.layerIds.map(M=>_.getLayer(M)).filter(Boolean);if(0!==D.length){C.layers=D,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(M=>D.filter(I=>I.id===M)[0]));for(const M of D)v[M.id]=C}}return v}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof qs){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof qs&&_.hasRTLText){this.hasRTLText=!0,$.isLoading()||$.isLoaded()||"deferred"!==L()||z();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(_))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new nl}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gg(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gg(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Gg(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,u,p,_,v,C,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:C,transform:v,params:_},r,l,u):{}}querySourceFeatures(r,l){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=l?l.sourceLayer:"",v=p._geojsonTileLayer||p[_];if(!v)return;const C=fa(l&&l.filter),{z:D,x:M,y:I}=this.tileID.canonical,P={z:D,x:M,y:I};for(let N=0;N<v.length;N++){const B=v.feature(N);if(C.needGeometry){const re=xs(B,!0);if(!C.filter(new H(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!C.filter(new H(this.tileID.overscaledZ),B))continue;const G=u.getId(B,_),Z=new sy(B,D,M,I,G);Z.tile=P,r.push(Z)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const u=Na(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const _=this.expirationTime-l;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!l.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",C=u[v],D=r[v];if(!C||!D||0===Object.keys(D).length)continue;_.update(D,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=l&&l.style&&l.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<no.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=no.now()+r}setDependencies(r,l){const u={};for(const p of l)u[p]=!0;this.dependencies[r]=u}hasDependency(r,l){for(const u of r){const p=this.dependencies[u];if(p)for(const _ of l)if(p[_])return!0}return!1}clearQueryDebugViz(){}}class ly{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,u){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},Bt(this.stateChanges[r][p],u),null===this.deletedStates[r]){this.deletedStates[r]={};for(const _ in this.state[r])_!==p&&(this.deletedStates[r][_]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][p]){this.deletedStates[r][p]={};for(const _ in this.state[r][p])u[_]||(this.deletedStates[r][p][_]=null)}else for(const _ in u)this.deletedStates[r]&&this.deletedStates[r][p]&&null===this.deletedStates[r][p][_]&&delete this.deletedStates[r][p][_]}removeFeatureState(r,l,u){if(null===this.deletedStates[r])return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&void 0!==l)null!==this.deletedStates[r][p]&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][u]=null);else if(void 0!==l)if(this.stateChanges[r]&&this.stateChanges[r][p])for(u in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][u]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const u=String(l),p=Bt({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const _=this.deletedStates[r][l];if(null===_)return{};for(const v in _)delete p[v]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),Bt(this.state[p][v],this.stateChanges[p][v]),_[v]=this.state[p][v];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(null===this.deletedStates[p])for(const v in this.state[p])_[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(null===this.deletedStates[p][v])this.state[p][v]={};else for(const C of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][C];_[v]=this.state[p][v]}u[p]=u[p]||{},Bt(u[p],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const p in r)r[p].setFeatureState(u,l)}}class Gf{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const u=this.toIdx(r,l);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function cy(a,r,l,u){let p=0,_=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(l[v]<a[v]||l[v]>r[v])return null}else{const C=1/u[v];let D=(a[v]-l[v])*C,M=(r[v]-l[v])*C;if(D>M){const I=D;D=M,M=I}if(D>p&&(p=D),M<_&&(_=M),p>_)return null}return p}function ul(a,r,l,u,p,_,v,C,D,M,I){const P=u-a,N=p-r,B=_-l,G=v-a,Z=C-r,re=D-l,ue=I[1]*re-I[2]*Z,ve=I[2]*G-I[0]*re,Ee=I[0]*Z-I[1]*G,Te=P*ue+N*ve+B*Ee;if(Math.abs(Te)<1e-15)return null;const Se=1/Te,Ae=M[0]-a,He=M[1]-r,We=M[2]-l,et=(Ae*ue+He*ve+We*Ee)*Se;if(et<0||et>1)return null;const st=He*B-We*N,Ze=We*P-Ae*B,Qe=Ae*N-He*P,at=(I[0]*st+I[1]*Ze+I[2]*Qe)*Se;return at<0||et+at>1?null:(G*st+Z*Ze+re*Qe)*Se}function Yg(a,r,l){return(a-r)/(l-r)}function uy(a,r,l,u,p,_,v,C,D){const M=1<<l,I=_-u,P=v-p,N=(a+1)/M*I+u,B=(r+0)/M*P+p,G=(r+1)/M*P+p;C[0]=(a+0)/M*I+u,C[1]=B,D[0]=N,D[1]=G}class n1{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const v=Math.ceil(Math.log2(_.dim/8)),C=[];let D=Math.ceil(Math.pow(2,v));const M=1/D,I=(B,G,Z,re,ue)=>{const ve=re?1:0,Ee=(B+1)*Z-ve,Te=G*Z,Se=(G+1)*Z-ve;ue[0]=B*Z,ue[1]=Te,ue[2]=Ee,ue[3]=Se};let P=new Gf(D);const N=[];for(let B=0;B<D*D;B++){I(B%D,Math.floor(B/D),M,!1,N);const G=uc(N[0],N[1],_),Z=uc(N[2],N[1],_),re=uc(N[2],N[3],_),ue=uc(N[0],N[3],_);P.minimums.push(Math.min(G,Z,re,ue)),P.maximums.push(Math.max(G,Z,re,ue)),P.leaves.push(1)}for(C.push(P),D/=2;D>=1;D/=2){const B=C[C.length-1];P=new Gf(D);for(let G=0;G<D*D;G++){I(G%D,Math.floor(G/D),2,!0,N);const Z=B.getElevation(N[0],N[1]),re=B.getElevation(N[2],N[1]),ue=B.getElevation(N[2],N[3]),ve=B.getElevation(N[0],N[3]),Ee=B.isLeaf(N[0],N[1]),Te=B.isLeaf(N[2],N[1]),Se=B.isLeaf(N[2],N[3]),Ae=B.isLeaf(N[0],N[3]),He=Math.min(Z.min,re.min,ue.min,ve.min),We=Math.max(Z.max,re.max,ue.max,ve.max),et=Ee&&Te&&Se&&Ae;P.maximums.push(We),P.minimums.push(He),P.leaves.push(We-He<=5&&et?1:0)}C.push(P)}return C}(this.dem),u=l.length-1,p=l[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,u,0)}raycastRoot(r,l,u,p,_,v,C=1){return cy([r,l,-100],[u,p,this.maximums[0]*C],_,v)}raycast(r,l,u,p,_,v,C=1){if(!this.nodeCount)return null;const D=this.raycastRoot(r,l,u,p,_,v,C);if(null==D)return null;const M=[],I=[],P=[],N=[],B=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:G,t:Z,nodex:re,nodey:ue,depth:ve}=B.pop();if(this.leaves[G]){uy(re,ue,ve,r,l,u,p,P,N);const Te=1<<ve,Se=(re+0)/Te,Ae=(re+1)/Te,He=(ue+0)/Te,We=(ue+1)/Te,et=uc(Se,He,this.dem)*C,st=uc(Ae,He,this.dem)*C,Ze=uc(Ae,We,this.dem)*C,Qe=uc(Se,We,this.dem)*C,at=ul(P[0],P[1],et,N[0],P[1],st,N[0],N[1],Ze,_,v),Ke=ul(N[0],N[1],Ze,P[0],N[1],Qe,P[0],P[1],et,_,v),Ft=Math.min(null!==at?at:Number.MAX_VALUE,null!==Ke?Ke:Number.MAX_VALUE);if(Ft!==Number.MAX_VALUE)return Ft;{const bt=qu([],_,v,Z);if(qf(et,st,Qe,Ze,Yg(bt[0],P[0],N[0]),Yg(bt[1],P[1],N[1]))>=bt[2])return Z}continue}let Ee=0;for(let Te=0;Te<this._siblingOffset.length;Te++){uy((re<<1)+this._siblingOffset[Te][0],(ue<<1)+this._siblingOffset[Te][1],ve+1,r,l,u,p,P,N),P[2]=-100,N[2]=this.maximums[this.childOffsets[G]+Te]*C;const Se=cy(P,N,_,v);if(null!=Se){const Ae=Se;M[Te]=Ae;let He=!1;for(let We=0;We<Ee&&!He;We++)Ae>=M[I[We]]&&(I.splice(We,0,Te),He=!0);He||(I[Ee]=Te),Ee++}}for(let Te=0;Te<Ee;Te++){const Se=I[Te];B.push({idx:this.childOffsets[G]+Se,t:M[Se],nodex:(re<<1)+this._siblingOffset[Se][0],nodey:(ue<<1)+this._siblingOffset[Se][1],depth:ve+1})}}return null}_addNode(r,l,u){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,u,p,_){if(1===r[p].isLeaf(l,u))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const v=p-1,C=r[v];let D,M=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*l+this._siblingOffset[I][0],N=2*u+this._siblingOffset[I][1],B=C.getElevation(P,N),G=C.isLeaf(P,N),Z=this._addNode(B.min,B.max,G);G&&(M|=1<<I),D||(D=Z)}for(let I=0;I<this._siblingOffset.length;I++)M&1<<I||this._construct(r,2*l+this._siblingOffset[I][0],2*u+this._siblingOffset[I][1],v,D+I)}}function qf(a,r,l,u,p,_){return Qt(Qt(a,l,_),Qt(r,u,_),p)}function uc(a,r,l){const u=l.dim,p=wn(a*u-.5,0,u-1),_=wn(r*u-.5,0,u-1),v=Math.floor(p),C=Math.floor(_),D=Math.min(v+1,u-1),M=Math.min(C+1,u-1);return qf(l.get(v,C),l.get(D,C),l.get(v,M),l.get(D,M),p-v,_-C)}const Jg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,u,p=!1,_=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return pi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const v=this.dim=l.height-2;if(this.data=new Uint32Array(l.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let C=0;C<v;C++)this.data[this._idx(-1,C)]=this.data[this._idx(0,C)],this.data[this._idx(v,C)]=this.data[this._idx(v-1,C)],this.data[this._idx(C,-1)]=this.data[this._idx(C,0)],this.data[this._idx(C,v)]=this.data[this._idx(C,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new n1(this)}get(r,l,u=!1){const p=new Uint8Array(this.data.buffer);u&&(r=wn(r,-1,this.dim),l=wn(l,-1,this.dim));const _=4*this._idx(r,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(p[_],p[_+1],p[_+2])}static getUnpackVector(r){return Jg[r]}get unpackVector(){return Jg[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}_unpackMapbox(r,l,u){return(256*r*256+256*l+u)/10-1e4}_unpackTerrarium(r,l,u){return 256*r+l+u/256-32768}static pack(r,l){const u=[0,0,0,0],p=Wf.getUnpackVector(l);let _=Math.floor((r+p[3])/p[2]);return u[2]=_%256,_=Math.floor(_/256),u[1]=_%256,_=Math.floor(_/256),u[0]=_,u}getPixels(){return new Yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,l,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,_=l*this.dim+this.dim,v=u*this.dim,C=u*this.dim+this.dim;switch(l){case-1:p=_-1;break;case 1:_=p+1}switch(u){case-1:v=C-1;break;case 1:C=v+1}const D=-l*this.dim,M=-u*this.dim;for(let I=v;I<C;I++)for(let P=p;P<_;P++)this.data[this._idx(P,I)]=r.data[this._idx(P+D,I+M)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}yt("DEMData",Wf),yt("DemMinMaxQuadTree",n1,{omit:["dem"]});class i1{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,u){const p=r.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const _={value:l,timeout:void 0};if(void 0!==u&&(_.timeout=setTimeout(()=>{this.remove(r,_)},u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const u=r.wrapped().key,p=void 0===l?0:this.data[u].indexOf(l),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const u in this.data)for(const p of this.data[u])r(p.value)||l.push(p);for(const u of l)this.remove(u.value.tileID,u)}}class xa{constructor(r,l,u){this.func=r,this.mask=l,this.range=u}}xa.ReadOnly=!1,xa.ReadWrite=!0,xa.disabled=new xa(519,xa.ReadOnly,[0,1]);class vd{constructor(r,l,u,p,_,v){this.test=r,this.ref=l,this.mask=u,this.fail=p,this.depthFail=_,this.pass=v}}vd.disabled=new vd({func:519,mask:0},0,0,7680,7680,7680);class ho{constructor(r,l,u){this.blendFunction=r,this.blendColor=l,this.mask=u}}ho.Replace=[1,0],ho.disabled=new ho(ho.Replace,Wt.transparent,[!1,!1,!1,!1]),ho.unblended=new ho(ho.Replace,Wt.transparent,[!0,!0,!0,!0]),ho.alphaBlended=new ho([1,771],Wt.transparent,[!0,!0,!0,!0]);class Zs{constructor(r,l,u){this.enable=r,this.mode=l,this.frontFace=u}}Zs.disabled=new Zs(!1,1029,2305),Zs.backCCW=new Zs(!0,1029,2305),Zs.backCW=new Zs(!0,1029,2304),Zs.frontCW=new Zs(!0,1028,2304),Zs.frontCCW=new Zs(!0,1028,2305);class fc extends Ct{constructor(r,l,u){super(),this.id=r,this._onlySymbols=u,l.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new i1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ly}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const u=this._tiles[l];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return ji(this._tiles).map(r=>r.tileID).sort(Kg).map(r=>r.key)}getRenderableIds(r){const l=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&l.push(this._tiles[u]);return r?l.sort((u,p)=>{const _=u.tileID,v=p.tileID,C=new q(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),D=new q(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||D.y-C.y||D.x-C.x}).map(u=>u.tileID.key):l.map(u=>u.tileID).sort(Kg).map(u=>u.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const u=this._tiles[r];u&&("loading"!==u.state&&(u.state=l),this._loadTile(u,this._tileLoaded.bind(this,u,r,l)))}_tileLoaded(r,l,u,p){if(p)return r.state="errored",void(404!==p.status?this._source.fire(new Xe(p,{tile:r})):this.update(this.transform));r.timeAdded=no.now(),"expired"===u&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),"raster-dem"===this.getSource().type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new lt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const _=l[p];if(r.neighboringTiles&&r.neighboringTiles[_]){const v=this.getTileByID(_);u(r,v),u(v,r)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-p.tileID.canonical.x;const C=_.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),M=_.tileID.key;0===v&&0===C||Math.abs(C)>1||(Math.abs(v)>1&&(1===Math.abs(v+D)?v+=D:1===Math.abs(v-D)&&(v-=D)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,v,C),p.neighboringTiles&&p.neighboringTiles[M]&&(p.neighboringTiles[M].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,u,p){for(const _ in this._tiles){let v=this._tiles[_];if(p[_]||!v.hasData()||v.tileID.overscaledZ<=l||v.tileID.overscaledZ>u)continue;let C=v.tileID;for(;v&&v.tileID.overscaledZ>l+1;){const M=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[M.key],v&&v.hasData()&&(C=M)}let D=C;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){p[C.key]=C;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=l?u:null}for(let u=r.overscaledZ-1;u>=l;u--){const p=r.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const u=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,_=Math.floor(u*p*5),v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(r){const l=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,l){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(r,l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new No(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(C=>this._source.hasTile(C)))):p=[];const _=this._updateRetainedTiles(p);if(Zf(this._source.type)&&0!==p.length){const C={},D={},M=Object.keys(_);for(const P of M){const N=_[P],B=this._tiles[P];if(!B||B.fadeEndTime&&B.fadeEndTime<=no.now())continue;const G=this.findLoadedParent(N,Math.max(N.overscaledZ-fc.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),C[G.tileID.key]=G.tileID),D[P]=N}const I=p[p.length-1].overscaledZ;for(const P in this._tiles){const N=this._tiles[P];if(_[P]||!N.hasData())continue;let B=N.tileID;for(;B.overscaledZ>I;){B=B.scaledTo(B.overscaledZ-1);const G=this._tiles[B.key];if(G&&G.hasData()&&D[B.key]){_[P]=N.tileID;break}}}for(const P in C)_[P]||(this._coveredTiles[P]=!0,_[P]=C[P])}for(const C in _)this._tiles[C].clearFadeHold();const v=function(C,D){const M=[];for(const I in C)I in D||M.push(I);return M}(this._tiles,_);for(const C of v){const D=this._tiles[C];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(0===r.length)return l;const u={},p=r[r.length-1].overscaledZ,_=r[0].overscaledZ,v=Math.max(_-fc.maxOverzooming,this._source.minzoom),C=Math.max(_+fc.maxUnderzooming,this._source.minzoom),D={};for(const M of r){const I=this._addTile(M);l[M.key]=M,I.hasData()||p<this._source.maxzoom&&(D[M.key]=M)}this._retainLoadedChildren(D,p,C,l);for(const M of r){let I=this._tiles[M.key];if(I.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const N=M.children(this._source.maxzoom)[0],B=this.getTile(N);if(B&&B.hasData()){l[N.key]=N;continue}}else{const N=M.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let P=I.wasRequested();for(let N=M.overscaledZ-1;N>=v;--N){const B=M.scaledTo(N);if(u[B.key]||(u[B.key]=!0,I=this.getTile(B),!I&&P&&(I=this._addTile(B)),I&&(l[B.key]=B,P=I.wasRequested(),I.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let u,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}l.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of l)this._loadedParentTiles[_]=u}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const u=Boolean(l);return u||(l=new Hf(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))),l?(l.uses++,this._tiles[r.key]=l,u||this._source.fire(new lt("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=l.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._cache.reset()}tilesIn(r,l,u){const p=[],_=this.transform;if(!_)return p;for(const v in this._tiles){const C=this._tiles[v];if(u&&C.clearQueryDebugViz(),C.holdingForFade())continue;const D=r.containsTile(C,_,l);D&&p.push(D)}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of l)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Zf(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=no.now())return!0}return!1}setFeatureState(r,l,u){this._state.updateState(r=r||"_geojsonTileLayer",l,u)}removeFeatureState(r,l,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,u)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,u){const p=this._tiles[r];p&&p.setDependencies(l,u)}reloadTilesForDependencies(r,l){for(const u in this._tiles)this._tiles[u].hasDependency(r,l)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,l))}}function Kg(a,r){const l=Math.abs(2*a.wrap)-+(a.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return a.overscaledZ-r.overscaledZ||u-l||r.canonical.y-a.canonical.y||r.canonical.x-a.canonical.x}function Zf(a){return"raster"===a||"image"===a||"video"===a}fc.maxOverzooming=10,fc.maxUnderzooming=3;class ah{constructor(r,l,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=u}static create(r,l,u){const p=u||r.findDEMTileFor(l);if(!p||!p.dem)return;const _=p.dem,v=p.tileID,C=1<<l.canonical.z-v.canonical.z;return new ah(p,p.tileSize/Pn/C,[(l.canonical.x/C-v.canonical.x)*_.dim,(l.canonical.y/C-v.canonical.y)*_.dim])}tileCoordToPixel(r,l){const u=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),_=Math.floor(u);return new q(p,_)}getElevationAt(r,l,u,p){const _=r*this._scale+this._offset[0],v=l*this._scale+this._offset[1],C=Math.floor(_),D=Math.floor(v),M=this._dem;return p=!!p,u?Qt(Qt(M.get(C,D,p),M.get(C,D+1,p),v-D),Qt(M.get(C+1,D,p),M.get(C+1,D+1,p),v-D),_-C):M.get(C,D,p)}getElevationAtPixel(r,l,u){return this._dem.get(r,l,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Xg(1,r)*this._dem.stride}}class Qg{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Ti(Pn,16,0),this.featureIndexArray=new ov,this.promoteId=l}insert(r,l,u,p,_,v=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,_,v);const D=this.grid;for(let M=0;M<l.length;M++){const I=l[M],P=[1/0,1/0,-1/0,-1/0];for(let N=0;N<I.length;N++){const B=I[N];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<Pn&&P[1]<Pn&&P[2]>=0&&P[3]>=0&&D.insert(C,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Xu.VectorTile(new Ku(this.rawTileData)).layers,this.sourceLayerCoder=new jf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,l,u,p){this.loadVTLayers();const _=r.params||{},v=fa(_.filter),C=r.tileResult,D=r.transform,M=C.bufferedTilespaceBounds,I=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(G,Z,re,ue)=>rc(C.bufferedTilespaceGeometry,G,Z,re,ue));I.sort(r1);let P=null;D.elevation&&I.length>0&&(P=ah.create(D.elevation,this.tileID));const N={};let B;for(let G=0;G<I.length;G++){const Z=I[G];if(Z===B)continue;B=Z;const re=this.featureIndexArray.get(Z);let ue=null;this.loadMatchingFeature(N,re,v,_.layers,_.availableImages,l,u,p,(ve,Ee,Te,Se=0)=>(ue||(ue=sl(ve)),Ee.queryIntersectsFeature(C,ve,Te,ue,this.z,r.transform,r.pixelPosMatrix,P,Se)))}return N}loadMatchingFeature(r,l,u,p,_,v,C,D,M){const{featureIndex:I,bucketIndex:P,sourceLayerIndex:N,layoutVertexArrayOffset:B}=l,G=this.bucketLayerIDs[P];if(p&&!function(ve,Ee){for(let Te=0;Te<ve.length;Te++)if(Ee.indexOf(ve[Te])>=0)return!0;return!1}(p,G))return;const Z=this.sourceLayerCoder.decode(N),re=this.vtLayers[Z].feature(I);if(u.needGeometry){const ve=xs(re,!0);if(!u.filter(new H(this.tileID.overscaledZ),ve,this.tileID.canonical))return}else if(!u.filter(new H(this.tileID.overscaledZ),re))return;const ue=this.getId(re,Z);for(let ve=0;ve<G.length;ve++){const Ee=G[ve];if(p&&p.indexOf(Ee)<0)continue;const Te=v[Ee];if(!Te)continue;let Se={};void 0!==ue&&D&&(Se=D.getState(Te.sourceLayer||"_geojsonTileLayer",ue));const Ae=Bt({},C[Ee]);Ae.paint=bd(Ae.paint,Te.paint,re,Se,_),Ae.layout=bd(Ae.layout,Te.layout,re,Se,_);const He=!M||M(re,Te,Se,B);if(!He)continue;const We=new sy(re,this.z,this.x,this.y,ue);We.layer=Ae;let et=r[Ee];void 0===et&&(et=r[Ee]=[]),et.push({featureIndex:I,feature:We,intersectionZ:He})}}lookupSymbolFeatures(r,l,u,p,_,v,C,D){const M={};this.loadVTLayers();const I=fa(_);for(const P of r)this.loadMatchingFeature(M,{bucketIndex:u,sourceLayerIndex:p,featureIndex:P,layoutVertexArrayOffset:0},I,v,C,D,l);return M}hasLayer(r){for(const l of this.bucketLayerIDs)for(const u of l)if(r===u)return!0;return!1}getId(r,l){let u=r.id;return this.promoteId&&(u=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof u&&(u=Number(u))),u}}function bd(a,r,l,u,p){return Vo(a,(_,v)=>{const C=r instanceof _e?r.get(v):null;return C&&C.evaluate?C.evaluate(l,u,p):C})}function r1(a,r){return r-a}yt("FeatureIndex",Qg,{omit:["rawTileData","sourceLayerCoder"]});class em{constructor(r){const l={},u=[];for(const C in r){const D=r[C],M=l[C]={};for(const I in D.glyphs){const P=D.glyphs[+I];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const N=P.metrics.localGlyph?2:1,B={x:0,y:0,w:P.bitmap.width+2*N,h:P.bitmap.height+2*N};u.push(B),M[I]=B}}const{w:p,h:_}=cd(u),v=new Po({width:p||1,height:_||1});for(const C in r){const D=r[C];for(const M in D.glyphs){const I=D.glyphs[+M];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=l[C][M],N=I.metrics.localGlyph?2:1;Po.copy(I.bitmap,v,{x:0,y:0},{x:P.x+N,y:P.y+N},I.bitmap)}}this.image=v,this.positions=l}}yt("GlyphAtlas",em);class zw{constructor(r){this.tileID=new No(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile}parse(r,l,u,p,_){this.status="parsing",this.data=r,this.collisionBoxArray=new nl;const v=new jf(Object.keys(r.layers).sort()),C=new Qg(this.tileID,this.promoteId);C.bucketLayerIDs=[];const D={},M=new ry(256,256),I={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:u},P=l.familiesBySource[this.source];for(const Se in P){const Ae=r.layers[Se];if(!Ae)continue;let He=!1,We=!1;for(const Ze of P[Se])"symbol"===Ze[0].type?He=!0:We=!0;if(!0===this.isSymbolTile&&!He||!1===this.isSymbolTile&&!We)continue;1===Ae.version&&pi(`Vector tile source "${this.source}" layer "${Se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const et=v.encode(Se),st=[];for(let Ze=0;Ze<Ae.length;Ze++){const Qe=Ae.feature(Ze),at=C.getId(Qe,Se);st.push({feature:Qe,id:at,index:Ze,sourceLayerIndex:et})}for(const Ze of P[Se]){const Qe=Ze[0];void 0!==this.isSymbolTile&&"symbol"===Qe.type!==this.isSymbolTile||Qe.minzoom&&this.zoom<Math.floor(Qe.minzoom)||Qe.maxzoom&&this.zoom>=Qe.maxzoom||"none"!==Qe.visibility&&(Xf(Ze,this.zoom,u),(D[Qe.id]=Qe.createBucket({index:C.bucketLayerIDs.length,layers:Ze,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:et,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(st,I,this.tileID.canonical),C.bucketLayerIDs.push(Ze.map(at=>at.id)))}}let N,B,G,Z;M.trim();const re={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=Vo(I.glyphDependencies,Se=>Object.keys(Se).map(Number));Object.keys(ue).length?p.send("getGlyphs",{uid:this.uid,stacks:ue},(Se,Ae)=>{N||(N=Se,B=Ae,Te.call(this))},void 0,!1,re):B={};const ve=Object.keys(I.iconDependencies);ve.length?p.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Se,Ae)=>{N||(N=Se,G=Ae,Te.call(this))},void 0,!1,re):G={};const Ee=Object.keys(I.patternDependencies);function Te(){if(N)return _(N);if(B&&G&&Z){const Se=new em(B),Ae=new U_(G,Z);for(const He in D){const We=D[He];We instanceof qs?(Xf(We.layers,this.zoom,u),Zv(We,B,Se.positions,G,Ae.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):We.hasPattern&&(We instanceof bg||We instanceof Df||We instanceof Tf)&&(Xf(We.layers,this.zoom,u),We.addFeatures(I,this.tileID.canonical,Ae.patternPositions))}this.status="done",_(null,{buckets:ji(D).filter(He=>!He.isEmpty()),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Se.image,lineAtlas:M,imageAtlas:Ae,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?Se.positions:null})}}Ee.length?p.send("getImages",{icons:Ee,source:this.source,tileID:this.tileID,type:"patterns"},(Se,Ae)=>{N||(N=Se,Z=Ae,Te.call(this))},void 0,!1,re):Z={},Te.call(this)}}function Xf(a,r,l){const u=new H(r);for(const p of a)p.recalculate(u,l)}class tm{constructor(r){this.entries={},this.scheduler=r}request(r,l,u,p){const _=this.entries[r]=this.entries[r]||{callbacks:[]};if(_.result){const[v,C]=_.result;return this.scheduler?this.scheduler.add(()=>{p(v,C)},l):p(v,C),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=u((v,C)=>{_.result=[v,C];for(const D of _.callbacks)this.scheduler?this.scheduler.add(()=>{D(v,C)},l):D(v,C);setTimeout(()=>delete this.entries[r],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(v=>v!==p),_.callbacks.length||(_.cancel(),delete this.entries[r]))}}}function hy(a,r,l){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const _=F(a.request,(v,C,D,M)=>{v?p(v):C&&p(null,{vectorTile:l?void 0:new Xu.VectorTile(new Ku(C)),rawData:C,cacheControl:D,expires:M})});return()=>{_.cancel(),p()}},r)}d.ARRAY_TYPE=Br,d.AUTH_ERR_MSG=Nl,d.Actor=class{constructor(a,r,l){this.target=a,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},qn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pr()?a:ye,this.scheduler=new Vw}send(a,r,l,u,p=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[v]=l);const C=Fa(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!l,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:ga(r,C)},C),{cancel:()=>{l&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(a){const r=a.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const u=this.cancelCallbacks[l];delete this.cancelCallbacks[l],u&&u.cancel()}else if(r.mustQueue||Pr()){const u=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),u&&u.metadata||{type:"message"})}else this.processTask(l,r)}processTask(a,r){if("<response>"===r.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(r.error?l(ma(r.error)):l(null,ma(r.data)))}else{const l=Fa(this.globalScope)?void 0:[],u=r.hasCallback?(_,v)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:_?ga(_):null,data:ga(v,l)},l)}:_=>{},p=ma(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,u);else if(this.parent.getWorkerSource){const _=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,_[0],p.source)[_[1]](p,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=oy,d.Color=Wt,d.ColorMode=ho,d.CullFaceMode=Zs,d.DEMData=Wf,d.DataConstantProperty=oe,d.DedupedRequest=tm,d.DepthMode=xa,d.EXTENT=Pn,d.Elevation=class{getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,l=!0){null==r&&(r=null);const u=this._source();if(!u||a.y<0||a.y>1)return r;const p=u.getSource().maxzoom,_=1<<p,v=Math.floor(a.x),C=a.x-v,D=new No(p,v,p,Math.floor(C*_),Math.floor(a.y*_)),M=this.findDEMTileFor(D);if(!M||!M.dem)return r;const I=M.dem,P=1<<M.tileID.canonical.z,N=(C*P-M.tileID.canonical.x)*I.dim,B=(a.y*P-M.tileID.canonical.y)*I.dim,G=Math.floor(N),Z=Math.floor(B);return(l?this.exaggeration():1)*Qt(Qt(I.get(G,Z),I.get(G,Z+1),B-Z),Qt(I.get(G+1,Z),I.get(G+1,Z+1),B-Z),N-G)}getAtTileOffset(a,r,l){const u=1<<a.canonical.z;return this.getAtPointOrZero(new yd(a.wrap+(a.canonical.x+r/Pn)/u,(a.canonical.y+l/Pn)/u))}getForTilePoints(a,r,l,u){const p=ah.create(this,a,u);return!!p&&(r.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(a){const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const l=r.dem.tree,u=r.tileID,p=1<<a.canonical.z-u.canonical.z;let _=a.canonical.x/p-u.canonical.x,v=a.canonical.y/p-u.canonical.y,C=0;for(let D=0;D<a.canonical.z-u.canonical.z&&!l.leaves[C];D++){_*=2,v*=2;const M=2*Math.floor(v)+Math.floor(_);C=l.childOffsets[C]+M,_%=1,v%=1}return{min:this.exaggeration()*l.minimums[C],max:this.exaggeration()*l.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Xe,d.EvaluationParameters=H,d.Event=lt,d.Evented=Ct,d.GlyphManager=lc,d.ImagePosition=Pf,d.LineAtlas=ry,d.LngLat=Ui,d.LngLatBounds=au,d.LocalGlyphMode=Of,d.MAX_SAFE_INTEGER=K,d.MercatorCoordinate=yd,d.ONE_EM=24,d.OverscaledTileID=No,d.Properties=Fe,d.RGBAImage=Yo,d.RequestManager=class{constructor(a,r,l){this._transformRequestFn=a,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",cs,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,r){return this._transformRequestFn&&this._transformRequestFn(a,r)||{url:a}}normalizeStyleURL(a,r){if(!Nr(a))return a;const l=Co(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(a,r){if(!Nr(a))return a;const l=Co(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(a,r){if(!Nr(a))return a;const l=Co(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||r)}normalizeSpriteURL(a,r,l,u){const p=Co(a);return Nr(a)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${r}${l}`,La(p))}normalizeTileURL(a,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Nr(a))return a;const u=Co(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&"raster"!==u.authority&&512===l?"@2x":""}${ls.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${In.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${In.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(_){for(const v of _){const C=v.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(u.params)||In.ACCESS_TOKEN;return In.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(a,r){const l=Co(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let u="mapbox://";l.path.match(/^\/raster\/v1\//)?u+=`raster/${l.path.replace(`/${In.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${l.path.replace(`/${In.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter(_=>!_.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(a,r){const l=!!r&&Nr(r),u=[];for(const p of a.tiles||[])gi(p)?u.push(this.canonicalizeTileURL(p,l)):u.push(p);return u}_makeAPIURL(a,r){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=Co(In.API_URL);if(a.protocol=u.protocol,a.authority=u.authority,"http"===a.protocol){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if("/"!==u.path&&(a.path=`${u.path}${a.path}`),!In.REQUIRE_ACCESS_TOKEN)return La(a);if(r=r||In.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(p=>-1===p.indexOf("access_token")),a.params.push(`access_token=${r||""}`),La(a)}},d.ResourceType=qt,d.SegmentVector=fr,d.SourceCache=fc,d.StencilMode=vd,d.StructArrayLayout1ui2=wr,d.StructArrayLayout2f1f2i16=Xo,d.StructArrayLayout2i4=$t,d.StructArrayLayout2ui4=ki,d.StructArrayLayout3f12=Zt,d.StructArrayLayout3ui6=kn,d.StructArrayLayout4i8=bi,d.Texture=Gg,d.Tile=Hf,d.Transitionable=le,d.Uniform1f=lo,d.Uniform1i=class extends tc{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},d.Uniform2f=class extends tc{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},d.Uniform3f=class extends tc{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},d.Uniform4f=js,d.UniformColor=Hh,d.UniformMatrix3f=class extends tc{constructor(a,r){super(a,r),this.current=nc}set(a){for(let r=0;r<9;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},d.UniformMatrix4f=class extends tc{constructor(a,r){super(a,r),this.current=Xc}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},d.UnwrappedTileID=t1,d.ValidationError=Oe,d.VectorTileWorkerSource=class extends Ct{constructor(a,r,l,u,p){super(),this.actor=a,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||hy,this.loading={},this.loaded={},this.deduped=new tm(a.scheduler),this.isSpriteLoaded=u,this.scheduler=a.scheduler}loadTile(a,r){const l=a.uid,u=a&&a.request,p=u&&u.collectResourceTiming,_=this.loading[l]=new zw(a);_.abort=this.loadVectorData(a,(v,C)=>{const D=!this.loading[l];if(delete this.loading[l],D||v||!C)return _.status="done",D||(this.loaded[l]=_),r(v);const M=C.rawData,I={};C.expires&&(I.expires=C.expires),C.cacheControl&&(I.cacheControl=C.cacheControl),_.vectorTile=C.vectorTile||new Xu.VectorTile(new Ku(M));const P=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,B)=>{if(N||!B)return r(N);const G={};if(p){const Z=Qv(u);Z.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(Z)))}r(null,Bt({rawTileData:M.slice(0)},B,I,G))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=_})}reloadTile(a,r){const l=this.loaded,u=a.uid,p=this;if(l&&l[u]){const _=l[u];_.showCollisionBoxes=a.showCollisionBoxes,_.enableTerrain=!!a.enableTerrain;const v=(C,D)=>{const M=_.reloadCallback;M&&(delete _.reloadCallback,_.parse(_.vectorTile,p.layerIndex,this.availableImages,p.actor,M)),r(C,D)};"parsing"===_.status?_.reloadCallback=v:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(a,r){const l=a.uid,u=this.loading[l];u&&(u.abort&&u.abort(),delete this.loading[l]),r()}removeTile(a,r){const l=this.loaded,u=a.uid;l&&l[u]&&delete l[u],r()}},d.WritingMode=uo,d.ZoomHistory=br,d.add=function(a,r,l){return a[0]=r[0]+l[0],a[1]=r[1]+l[1],a[2]=r[2]+l[2],a},d.addDynamicAttributes=$g,d.altitudeFromMercatorZ=iy,d.asyncAll=Gr,d.bezier=jt,d.bindAll=qn,d.bufferConvexPolygon=function(a,r){const l=[];for(let u=0;u<a.length;u++){const p=Ai(u-1,-1,a.length-1),_=Ai(u+1,-1,a.length-1),v=a[u],C=a[_],D=a[p].sub(v).unit(),M=C.sub(v).unit(),I=M.angleWithSep(D.x,D.y),P=D.add(M).unit().mult(-1*r/Math.sin(I/2));l.push(v.add(P))}return l},d.cacheEntryPossiblyAdded=function(a){Ns++,Ns>Sc&&(a.getActor().send("enforceCacheSizeLimit",_u),Ns=0)},d.clamp=wn,d.clearTileCache=function(a){const r=ye.caches.delete(Mc);a&&r.catch(a).then(()=>a())},d.clipLine=Ff,d.clone=function(a){var r=new Br(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},d.clone$1=function(a){var r=new Br(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},d.clone$2=fi,d.collisionCircleLayout=ou,d.config=In,d.conjugate=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},d.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a},d.create=Jc,d.create$1=function(){var a=new Br(16);return Br!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},d.create$2=al,d.createExpression=dn,d.createFilter=fa,d.createLayout=vt,d.createStyleLayer=function(a){return"custom"===a.type?new Q_(a):new ty[a.type](a)},d.cross=function(a,r,l){var u=r[0],p=r[1],_=r[2],v=l[0],C=l[1],D=l[2];return a[0]=p*D-_*C,a[1]=_*v-u*D,a[2]=u*C-p*v,a},d.degToRad=nt,d.div=function(a,r,l){return a[0]=r[0]/l[0],a[1]=r[1]/l[1],a[2]=r[2]/l[2],a},d.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},d.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},d.ease=Gn,d.easeCubicInOut=xt,d.emitValidationErrors=mn,d.endsWith=As,d.enforceCacheSizeLimit=function(a){us(),Do&&Do.then(r=>{r.keys().then(l=>{for(let u=0;u<l.length-a;u++)r.delete(l[u])})})},d.evaluateSizeForFeature=If,d.evaluateSizeForZoom=Yu,d.evaluateVariableOffset=Bg,d.evented=R,d.exactEquals=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},d.exactEquals$1=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]},d.exported=no,d.exported$1=ls,d.extend=Bt,d.filterObject=Rt,d.fromMat4=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},d.fromQuat=function(a,r){var l=r[0],u=r[1],p=r[2],_=r[3],v=l+l,C=u+u,D=p+p,M=l*v,I=u*v,P=u*C,N=p*v,B=p*C,G=p*D,Z=_*v,re=_*C,ue=_*D;return a[0]=1-P-G,a[1]=I+ue,a[2]=N-re,a[3]=0,a[4]=I-ue,a[5]=1-M-G,a[6]=B+Z,a[7]=0,a[8]=N+re,a[9]=B-Z,a[10]=1-M-P,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},d.fromRotation=function(a,r){var l=Math.sin(r),u=Math.cos(r);return a[0]=u,a[1]=l,a[2]=0,a[3]=-l,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},d.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},d.furthestTileCorner=function(a){const r=Math.round((a+45+360)%360/90)%4;return ct[r]},d.getAABBPointSquareDist=function(a,r,l){let u=0;for(let p=0;p<2;++p){const _=l?l[p]:0;a[p]>_&&(u+=(a[p]-_)*(a[p]-_)),r[p]<_&&(u+=(_-r[p])*(_-r[p]))}return u},d.getAnchorAlignment=Pg,d.getAnchorJustification=Vg,d.getBounds=function(a){let r=1/0,l=1/0,u=-1/0,p=-1/0;for(const _ of a)r=Math.min(r,_.x),l=Math.min(l,_.y),u=Math.max(u,_.x),p=Math.max(p,_.y);return{min:new q(r,l),max:new q(u,p)}},d.getImage=pe,d.getJSON=function(a,r){return W(Bt(a,{type:"json"}),r)},d.getMapSessionAPI=wh,d.getPerformanceMeasurement=Qv,d.getRTLTextPluginStatus=L,d.getReferrer=hs,d.getVideo=function(a,r){const l=ye.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let u=0;u<a.length;u++){const p=ye.document.createElement("source");ie(a[u])||(l.crossOrigin="Anonymous"),p.src=a[u],l.appendChild(p)}return{cancel:()=>{}}},d.identity=sg,d.identity$1=Jh,d.invert=function(a,r){var l=r[0],u=r[1],p=r[2],_=r[3],v=r[4],C=r[5],D=r[6],M=r[7],I=r[8],P=r[9],N=r[10],B=r[11],G=r[12],Z=r[13],re=r[14],ue=r[15],ve=l*C-u*v,Ee=l*D-p*v,Te=l*M-_*v,Se=u*D-p*C,Ae=u*M-_*C,He=p*M-_*D,We=I*Z-P*G,et=I*re-N*G,st=I*ue-B*G,Ze=P*re-N*Z,Qe=P*ue-B*Z,at=N*ue-B*re,Ke=ve*at-Ee*Qe+Te*Ze+Se*st-Ae*et+He*We;return Ke?(a[0]=(C*at-D*Qe+M*Ze)*(Ke=1/Ke),a[1]=(p*Qe-u*at-_*Ze)*Ke,a[2]=(Z*He-re*Ae+ue*Se)*Ke,a[3]=(N*Ae-P*He-B*Se)*Ke,a[4]=(D*st-v*at-M*et)*Ke,a[5]=(l*at-p*st+_*et)*Ke,a[6]=(re*Te-G*He-ue*Ee)*Ke,a[7]=(I*He-N*Te+B*Ee)*Ke,a[8]=(v*Qe-C*st+M*We)*Ke,a[9]=(u*st-l*Qe-_*We)*Ke,a[10]=(G*Ae-Z*Te+ue*ve)*Ke,a[11]=(P*Te-I*Ae-B*ve)*Ke,a[12]=(C*et-v*Ze-D*We)*Ke,a[13]=(l*Ze-u*et+p*We)*Ke,a[14]=(Z*Ee-G*Se-re*ve)*Ke,a[15]=(I*Se-P*Ee+N*ve)*Ke,a):null},d.isMapAuthenticated=function(a){return Va.has(a)},d.isMapboxURL=Nr,d.latFromMercatorY=sh,d.len=gv,d.length=cg,d.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},d.loadVectorTile=hy,d.makeRequest=W,d.mercatorXfromLng=Wg,d.mercatorYfromLat=Zg,d.mercatorZfromAltitude=Xg,d.mul=function(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a[3]=r[3]*l[3],a},d.mul$1=lg,d.mul$2=Iw,d.multiply=ag,d.multiply$1=Kc,d.nextPowerOfTwo=ea,d.normalize=v_,d.normalize$1=function(a,r){var l=r[0],u=r[1],p=r[2],_=r[3],v=l*l+u*u+p*p+_*_;return v>0&&(v=1/Math.sqrt(v)),a[0]=l*v,a[1]=u*v,a[2]=p*v,a[3]=_*v,a},d.number=Qt,d.ortho=function(a,r,l,u,p,_,v){var C=1/(r-l),D=1/(u-p),M=1/(_-v);return a[0]=-2*C,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(r+l)*C,a[13]=(p+u)*D,a[14]=(v+_)*M,a[15]=1,a},d.pbf=Ku,d.perspective=function(a,r,l,u,p){var _,v=1/Math.tan(r/2);return a[0]=v/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=p&&p!==1/0?(a[10]=(p+u)*(_=1/(u-p)),a[14]=2*p*u*_):(a[10]=-1,a[14]=-2*u),a},d.pick=function(a,r){const l={};for(let u=0;u<r.length;u++){const p=r[u];p in a&&(l[p]=a[p])}return l},d.plugin=$,d.pointGeometry=q,d.polygonIntersectsBox=rc,d.polygonIntersectsPolygon=__,d.polygonizeBounds=function(a,r,l=0,u=!0){const p=new q(l,l),_=a.sub(p),v=r.add(p),C=[_,new q(v.x,_.y),v,new q(_.x,v.y)];return u&&C.push(_),C},d.posAttributes=ay,d.postMapLoadEvent=Ec,d.postTurnstileEvent=Rl,d.potpack=cd,d.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},d.radToDeg=function(a){return a*Ne},d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(a){return a({pluginStatus:x,pluginURL:E}),R.on("pluginStateChange",a),a},d.removeAuthState=function(a){Va.delete(a)},d.renderColorRamp=dg,d.rotateX=function(a,r,l){var u=Math.sin(l),p=Math.cos(l),_=r[4],v=r[5],C=r[6],D=r[7],M=r[8],I=r[9],P=r[10],N=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=_*p+M*u,a[5]=v*p+I*u,a[6]=C*p+P*u,a[7]=D*p+N*u,a[8]=M*p-_*u,a[9]=I*p-v*u,a[10]=P*p-C*u,a[11]=N*p-D*u,a},d.rotateX$1=gf,d.rotateY=function(a,r,l){var u=Math.sin(l),p=Math.cos(l),_=r[0],v=r[1],C=r[2],D=r[3],M=r[8],I=r[9],P=r[10],N=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=_*p-M*u,a[1]=v*p-I*u,a[2]=C*p-P*u,a[3]=D*p-N*u,a[8]=_*u+M*p,a[9]=v*u+I*p,a[10]=C*u+P*p,a[11]=D*u+N*p,a},d.rotateZ=function(a,r,l){var u=Math.sin(l),p=Math.cos(l),_=r[0],v=r[1],C=r[2],D=r[3],M=r[4],I=r[5],P=r[6],N=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=_*p+M*u,a[1]=v*p+I*u,a[2]=C*p+P*u,a[3]=D*p+N*u,a[4]=M*p-_*u,a[5]=I*p-v*u,a[6]=P*p-C*u,a[7]=N*p-D*u,a},d.rotateZ$1=function(a,r,l){l*=.5;var u=r[0],p=r[1],_=r[2],v=r[3],C=Math.sin(l),D=Math.cos(l);return a[0]=u*D+p*C,a[1]=p*D-u*C,a[2]=_*D+v*C,a[3]=v*D-_*C,a},d.scale=function(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a},d.scale$1=function(a,r,l){var u=l[0],p=l[1],_=l[2];return a[0]=r[0]*u,a[1]=r[1]*u,a[2]=r[2]*u,a[3]=r[3]*u,a[4]=r[4]*p,a[5]=r[5]*p,a[6]=r[6]*p,a[7]=r[7]*p,a[8]=r[8]*_,a[9]=r[9]*_,a[10]=r[10]*_,a[11]=r[11]*_,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},d.scale$2=function(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a[3]=r[3]*l,a},d.scaleAndAdd=qu,d.setCacheLimits=function(a,r){_u=a,Sc=r},d.setRTLTextPlugin=function(a,r,l=!1){if(x===s||x===h||x===m)throw new Error("setRTLTextPlugin cannot be called multiple times.");E=no.resolveURL(a),x=s,b=r,k(),l||z()},d.smoothstep=function(a,r,l){return(l=wn((l-a)/(r-a),0,1))*l*(3-2*l)},d.spec=ge,d.storeAuthState=function(a,r){r?Va.add(a):Va.delete(a)},d.sub=pv,d.subtract=y_,d.symbolSize=Af,d.transformMat3=function(a,r,l){var u=r[0],p=r[1],_=r[2];return a[0]=u*l[0]+p*l[3]+_*l[6],a[1]=u*l[1]+p*l[4]+_*l[7],a[2]=u*l[2]+p*l[5]+_*l[8],a},d.transformMat4=Yh,d.transformMat4$1=function(a,r,l){var u=r[0],p=r[1],_=r[2],v=l[3]*u+l[7]*p+l[11]*_+l[15];return a[0]=(l[0]*u+l[4]*p+l[8]*_+l[12])/(v=v||1),a[1]=(l[1]*u+l[5]*p+l[9]*_+l[13])/v,a[2]=(l[2]*u+l[6]*p+l[10]*_+l[14])/v,a},d.transformQuat=fv,d.translate=function(a,r,l){var u,p,_,v,C,D,M,I,P,N,B,G,Z=l[0],re=l[1],ue=l[2];return r===a?(a[12]=r[0]*Z+r[4]*re+r[8]*ue+r[12],a[13]=r[1]*Z+r[5]*re+r[9]*ue+r[13],a[14]=r[2]*Z+r[6]*re+r[10]*ue+r[14],a[15]=r[3]*Z+r[7]*re+r[11]*ue+r[15]):(p=r[1],_=r[2],v=r[3],C=r[4],D=r[5],M=r[6],I=r[7],P=r[8],N=r[9],B=r[10],G=r[11],a[0]=u=r[0],a[1]=p,a[2]=_,a[3]=v,a[4]=C,a[5]=D,a[6]=M,a[7]=I,a[8]=P,a[9]=N,a[10]=B,a[11]=G,a[12]=u*Z+C*re+P*ue+r[12],a[13]=p*Z+D*re+N*ue+r[13],a[14]=_*Z+M*re+B*ue+r[14],a[15]=v*Z+I*re+G*ue+r[15]),a},d.triggerPluginCompletionEvent=S,d.uniqueId=Al,d.validateCustomStyleLayer=function(a){const r=[],l=a.id;return void 0===l&&r.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&r.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},d.validateFog=Fu,d.validateLight=Fh,d.validateStyle=Xa,d.values=ji,d.vectorTile=Xu,d.version="2.5.1",d.warnOnce=pi,d.window=ye,d.wrap=Ai}),Je(0,function(d){function Pe(W){const F=typeof W;if("number"===F||"boolean"===F||"string"===F||null==W)return JSON.stringify(W);if(Array.isArray(W)){let ie="[";for(const de of W)ie+=`${Pe(de)},`;return`${ie}]`}const U=Object.keys(W).sort();let Y="{";for(let ie=0;ie<U.length;ie++)Y+=`${JSON.stringify(U[ie])}:${Pe(W[U[ie]])},`;return`${Y}}`}function Be(W){let F="";for(const U of d.refProperties)F+=`/${Pe(W[U])}`;return F}class Me{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,U){for(const ie of F){this._layerConfigs[ie.id]=ie;const de=this._layers[ie.id]=d.createStyleLayer(ie);de._featureFilter=d.createFilter(de.filter),this.keyCache[ie.id]&&delete this.keyCache[ie.id]}for(const ie of U)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const Y=function(ie,de){const Ce={};for(let pe=0;pe<ie.length;pe++){const De=de&&de[ie[pe].id]||Be(ie[pe]);de&&(de[ie[pe].id]=De);let Ge=Ce[De];Ge||(Ge=Ce[De]=[]),Ge.push(ie[pe])}const fe=[];for(const pe in Ce)fe.push(Ce[pe]);return fe}(d.values(this._layerConfigs),this.keyCache);for(const ie of Y){const de=ie.map(lt=>this._layers[lt.id]),Ce=de[0];if("none"===Ce.visibility)continue;const fe=Ce.source||"";let pe=this.familiesBySource[fe];pe||(pe=this.familiesBySource[fe]={});const De=Ce.sourceLayer||"_geojsonTileLayer";let Ge=pe[De];Ge||(Ge=pe[De]=[]),Ge.push(de)}}}const{ImageBitmap:q}=d.window;class ne{loadTile(F,U){const{uid:Y,encoding:ie,rawImageData:de,padding:Ce,buildQuadTree:fe}=F,pe=q&&de instanceof q?this.getImageData(de,Ce):de;U(null,new d.DEMData(Y,pe,ie,Ce<1,fe))}getImageData(F,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const Y=this.offscreenCanvasContext.getImageData(-U,-U,F.width+2*U,F.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:Y.width,height:Y.height},Y.data)}}var ye=function W(F,U){var Y,ie=F&&F.type;if("FeatureCollection"===ie)for(Y=0;Y<F.features.length;Y++)W(F.features[Y],U);else if("GeometryCollection"===ie)for(Y=0;Y<F.geometries.length;Y++)W(F.geometries[Y],U);else if("Feature"===ie)W(F.geometry,U);else if("Polygon"===ie)K(F.coordinates,U);else if("MultiPolygon"===ie)for(Y=0;Y<F.coordinates.length;Y++)K(F.coordinates[Y],U);return F};function K(W,F){if(0!==W.length){ae(W[0],F);for(var U=1;U<W.length;U++)ae(W[U],!F)}}function ae(W,F){for(var U=0,Y=0,ie=W.length,de=ie-1;Y<ie;de=Y++)U+=(W[Y][0]-W[de][0])*(W[de][1]+W[Y][1]);U>=0!=!!F&&W.reverse()}const Ne=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class nt{constructor(F){this._feature=F,this.extent=d.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(1===this._feature.type){const F=[];for(const U of this._feature.geometry)F.push([new d.pointGeometry(U[0],U[1])]);return F}{const F=[];for(const U of this._feature.geometry){const Y=[];for(const ie of U)Y.push(new d.pointGeometry(ie[0],ie[1]));F.push(Y)}return F}}toGeoJSON(F,U,Y){return Ne.call(this,F,U,Y)}}class ct{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=F.length,this._features=F}feature(F){return new nt(this._features[F])}}var xt=d.vectorTile.VectorTileFeature,jt=Gn;function Gn(W,F){this.options=F||{},this.features=W,this.length=W.length}function wn(W,F){this.id="number"==typeof W.id?W.id:void 0,this.type=W.type,this.rawGeometry=1===W.type?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=F||4096}Gn.prototype.feature=function(W){return new wn(this.features[W],this.options.extent)},wn.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var F=0;F<W.length;F++){for(var U=W[F],Y=[],ie=0;ie<U.length;ie++)Y.push(new d.pointGeometry(U[ie][0],U[ie][1]));this.geometry.push(Y)}return this.geometry},wn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,F=1/0,U=-1/0,Y=1/0,ie=-1/0,de=0;de<W.length;de++)for(var Ce=W[de],fe=0;fe<Ce.length;fe++){var pe=Ce[fe];F=Math.min(F,pe.x),U=Math.max(U,pe.x),Y=Math.min(Y,pe.y),ie=Math.max(ie,pe.y)}return[F,Y,U,ie]},wn.prototype.toGeoJSON=xt.prototype.toGeoJSON;var Ai=ji,Gr=jt;function ji(W){var F=new d.pbf;return function(U,Y){for(var ie in U.layers)Y.writeMessage(3,Bt,U.layers[ie])}(W,F),F.finish()}function Bt(W,F){var U;F.writeVarintField(15,W.version||1),F.writeStringField(1,W.name||""),F.writeVarintField(5,W.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<W.length;U++)Y.feature=W.feature(U),F.writeMessage(2,Qs,Y);var ie=Y.keys;for(U=0;U<ie.length;U++)F.writeStringField(3,ie[U]);var de=Y.values;for(U=0;U<de.length;U++)F.writeMessage(4,qn,de[U])}function Qs(W,F){var U=W.feature;void 0!==U.id&&F.writeVarintField(1,U.id),F.writeMessage(2,Al,W),F.writeVarintField(3,U.type),F.writeMessage(4,kl,U)}function Al(W,F){var U=W.feature,Y=W.keys,ie=W.values,de=W.keycache,Ce=W.valuecache;for(var fe in U.properties){var pe=de[fe];void 0===pe&&(Y.push(fe),de[fe]=pe=Y.length-1),F.writeVarint(pe);var De=U.properties[fe],Ge=typeof De;"string"!==Ge&&"boolean"!==Ge&&"number"!==Ge&&(De=JSON.stringify(De));var lt=Ge+":"+De,Xe=Ce[lt];void 0===Xe&&(ie.push(De),Ce[lt]=Xe=ie.length-1),F.writeVarint(Xe)}}function qr(W,F){return(F<<3)+(7&W)}function ea(W){return W<<1^W>>31}function kl(W,F){for(var U=W.loadGeometry(),Y=W.type,ie=0,de=0,Ce=U.length,fe=0;fe<Ce;fe++){var pe=U[fe],De=1;1===Y&&(De=pe.length),F.writeVarint(qr(1,De));for(var Ge=3===Y?pe.length-1:pe.length,lt=0;lt<Ge;lt++){1===lt&&1!==Y&&F.writeVarint(qr(2,Ge-1));var Xe=pe[lt].x-ie,Ct=pe[lt].y-de;F.writeVarint(ea(Xe)),F.writeVarint(ea(Ct)),ie+=Xe,de+=Ct}3===Y&&F.writeVarint(qr(7,1))}}function qn(W,F){var U=typeof W;"string"===U?F.writeStringField(1,W):"boolean"===U?F.writeBooleanField(7,W):"number"===U&&(W%1!=0?F.writeDoubleField(3,W):W<0?F.writeSVarintField(6,W):F.writeVarintField(5,W))}function As(W,F,U,Y,ie,de){if(ie-Y<=U)return;const Ce=Y+ie>>1;Vo(W,F,Ce,Y,ie,de%2),As(W,F,U,Y,Ce-1,de+1),As(W,F,U,Ce+1,ie,de+1)}function Vo(W,F,U,Y,ie,de){for(;ie>Y;){if(ie-Y>600){const De=ie-Y+1,Ge=U-Y+1,lt=Math.log(De),Xe=.5*Math.exp(2*lt/3),Ct=.5*Math.sqrt(lt*Xe*(De-Xe)/De)*(Ge-De/2<0?-1:1);Vo(W,F,U,Math.max(Y,Math.floor(U-Ge*Xe/De+Ct)),Math.min(ie,Math.floor(U+(De-Ge)*Xe/De+Ct)),de)}const Ce=F[2*U+de];let fe=Y,pe=ie;for(Rt(W,F,Y,U),F[2*ie+de]>Ce&&Rt(W,F,Y,ie);fe<pe;){for(Rt(W,F,fe,pe),fe++,pe--;F[2*fe+de]<Ce;)fe++;for(;F[2*pe+de]>Ce;)pe--}F[2*Y+de]===Ce?Rt(W,F,Y,pe):(pe++,Rt(W,F,pe,ie)),pe<=U&&(Y=pe+1),U<=pe&&(ie=pe-1)}}function Rt(W,F,U,Y){fi(W,U,Y),fi(F,2*U,2*Y),fi(F,2*U+1,2*Y+1)}function fi(W,F,U){const Y=W[F];W[F]=W[U],W[U]=Y}function Pa(W,F,U,Y){const ie=W-U,de=F-Y;return ie*ie+de*de}Ai.fromVectorTileJs=ji,Ai.fromGeojsonVt=function(W,F){F=F||{};var U={};for(var Y in W)U[Y]=new jt(W[Y].features,F),U[Y].name=Y,U[Y].version=F.version,U[Y].extent=F.extent;return ji({layers:U})},Ai.GeoJSONWrapper=Gr;const pi=W=>W[0],zo=W=>W[1];class wc{constructor(F,U=pi,Y=zo,ie=64,de=Float64Array){this.nodeSize=ie,this.points=F;const Ce=F.length<65536?Uint16Array:Uint32Array,fe=this.ids=new Ce(F.length),pe=this.coords=new de(2*F.length);for(let De=0;De<F.length;De++)fe[De]=De,pe[2*De]=U(F[De]),pe[2*De+1]=Y(F[De]);As(fe,pe,ie,0,fe.length-1,0)}range(F,U,Y,ie){return function(de,Ce,fe,pe,De,Ge,lt){const Xe=[0,de.length-1,0],Ct=[];let ge,Oe;for(;Xe.length;){const Vt=Xe.pop(),zt=Xe.pop(),Ht=Xe.pop();if(zt-Ht<=lt){for(let oi=Ht;oi<=zt;oi++)ge=Ce[2*oi],Oe=Ce[2*oi+1],ge>=fe&&ge<=De&&Oe>=pe&&Oe<=Ge&&Ct.push(de[oi]);continue}const Fn=Math.floor((Ht+zt)/2);ge=Ce[2*Fn],Oe=Ce[2*Fn+1],ge>=fe&&ge<=De&&Oe>=pe&&Oe<=Ge&&Ct.push(de[Fn]);const vn=(Vt+1)%2;(0===Vt?fe<=ge:pe<=Oe)&&(Xe.push(Ht),Xe.push(Fn-1),Xe.push(vn)),(0===Vt?De>=ge:Ge>=Oe)&&(Xe.push(Fn+1),Xe.push(zt),Xe.push(vn))}return Ct}(this.ids,this.coords,F,U,Y,ie,this.nodeSize)}within(F,U,Y){return function(ie,de,Ce,fe,pe,De){const Ge=[0,ie.length-1,0],lt=[],Xe=pe*pe;for(;Ge.length;){const Ct=Ge.pop(),ge=Ge.pop(),Oe=Ge.pop();if(ge-Oe<=De){for(let vn=Oe;vn<=ge;vn++)Pa(de[2*vn],de[2*vn+1],Ce,fe)<=Xe&&lt.push(ie[vn]);continue}const Vt=Math.floor((Oe+ge)/2),zt=de[2*Vt],Ht=de[2*Vt+1];Pa(zt,Ht,Ce,fe)<=Xe&&lt.push(ie[Vt]);const Fn=(Ct+1)%2;(0===Ct?Ce-pe<=zt:fe-pe<=Ht)&&(Ge.push(Oe),Ge.push(Vt-1),Ge.push(Fn)),(0===Ct?Ce+pe>=zt:fe+pe>=Ht)&&(Ge.push(Vt+1),Ge.push(ge),Ge.push(Fn))}return lt}(this.ids,this.coords,F,U,Y,this.nodeSize)}}const Pr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},Na=Math.fround||(ta=new Float32Array(1),W=>(ta[0]=+W,ta[0]));var ta;class Cn{constructor(F){this.options=ls(Object.create(Pr),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:U,minZoom:Y,maxZoom:ie,nodeSize:de}=this.options;U&&console.time("total time");const Ce=`prepare ${F.length} points`;U&&console.time(Ce),this.points=F;let fe=[];for(let pe=0;pe<F.length;pe++)F[pe].geometry&&fe.push(Pl(F[pe],pe));this.trees[ie+1]=new wc(fe,na,ks,de,Float32Array),U&&console.timeEnd(Ce);for(let pe=ie;pe>=Y;pe--){const De=+Date.now();fe=this._cluster(fe,pe),this.trees[pe]=new wc(fe,na,ks,de,Float32Array),U&&console.log("z%d: %d clusters in %dms",pe,fe.length,+Date.now()-De)}return U&&console.timeEnd("total time"),this}getClusters(F,U){let Y=((F[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,F[1]));let de=180===F[2]?180:((F[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)Y=-180,de=180;else if(Y>de){const Ge=this.getClusters([Y,ie,180,Ce],U),lt=this.getClusters([-180,ie,de,Ce],U);return Ge.concat(lt)}const fe=this.trees[this._limitZoom(U)],pe=fe.range(no(Y),Uo(Ce),no(de),Uo(ie)),De=[];for(const Ge of pe){const lt=fe.points[Ge];De.push(lt.numPoints?Fa(lt):this.points[lt.index])}return De}getChildren(F){const U=this._getOriginId(F),Y=this._getOriginZoom(F),ie="No cluster with the specified id.",de=this.trees[Y];if(!de)throw new Error(ie);const Ce=de.points[U];if(!Ce)throw new Error(ie);const fe=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),pe=de.within(Ce.x,Ce.y,fe),De=[];for(const Ge of pe){const lt=de.points[Ge];lt.parentId===F&&De.push(lt.numPoints?Fa(lt):this.points[lt.index])}if(0===De.length)throw new Error(ie);return De}getLeaves(F,U,Y){const ie=[];return this._appendLeaves(ie,F,U=U||10,Y=Y||0,0),ie}getTile(F,U,Y){const ie=this.trees[this._limitZoom(F)],de=Math.pow(2,F),{extent:Ce,radius:fe}=this.options,pe=fe/Ce,De=(Y-pe)/de,Ge=(Y+1+pe)/de,lt={features:[]};return this._addTileFeatures(ie.range((U-pe)/de,De,(U+1+pe)/de,Ge),ie.points,U,Y,de,lt),0===U&&this._addTileFeatures(ie.range(1-pe/de,De,1,Ge),ie.points,de,Y,de,lt),U===de-1&&this._addTileFeatures(ie.range(0,De,pe/de,Ge),ie.points,-1,Y,de,lt),lt.features.length?lt:null}getClusterExpansionZoom(F){let U=this._getOriginZoom(F)-1;for(;U<=this.options.maxZoom;){const Y=this.getChildren(F);if(U++,1!==Y.length)break;F=Y[0].properties.cluster_id}return U}_appendLeaves(F,U,Y,ie,de){const Ce=this.getChildren(U);for(const fe of Ce){const pe=fe.properties;if(pe&&pe.cluster?de+pe.point_count<=ie?de+=pe.point_count:de=this._appendLeaves(F,pe.cluster_id,Y,ie,de):de<ie?de++:F.push(fe),F.length===Y)break}return de}_addTileFeatures(F,U,Y,ie,de,Ce){for(const fe of F){const pe=U[fe],De=pe.numPoints;let Ge,lt,Xe;if(De)Ge=Cc(pe),lt=pe.x,Xe=pe.y;else{const Oe=this.points[pe.index];Ge=Oe.properties,lt=no(Oe.geometry.coordinates[0]),Xe=Uo(Oe.geometry.coordinates[1])}const Ct={type:1,geometry:[[Math.round(this.options.extent*(lt*de-Y)),Math.round(this.options.extent*(Xe*de-ie))]],tags:Ge};let ge;De?ge=pe.id:this.options.generateId?ge=pe.index:this.points[pe.index].id&&(ge=this.points[pe.index].id),void 0!==ge&&(Ct.id=ge),Ce.features.push(Ct)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,U){const Y=[],{radius:ie,extent:de,reduce:Ce,minPoints:fe}=this.options,pe=ie/(de*Math.pow(2,U));for(let De=0;De<F.length;De++){const Ge=F[De];if(Ge.zoom<=U)continue;Ge.zoom=U;const lt=this.trees[U+1],Xe=lt.within(Ge.x,Ge.y,pe),Ct=Ge.numPoints||1;let ge=Ct;for(const Oe of Xe){const Vt=lt.points[Oe];Vt.zoom>U&&(ge+=Vt.numPoints||1)}if(ge>=fe){let Oe=Ge.x*Ct,Vt=Ge.y*Ct,zt=Ce&&Ct>1?this._map(Ge,!0):null;const Ht=(De<<5)+(U+1)+this.points.length;for(const Fn of Xe){const vn=lt.points[Fn];if(vn.zoom<=U)continue;vn.zoom=U;const oi=vn.numPoints||1;Oe+=vn.x*oi,Vt+=vn.y*oi,vn.parentId=Ht,Ce&&(zt||(zt=this._map(Ge,!0)),Ce(zt,this._map(vn)))}Ge.parentId=Ht,Y.push(Ra(Oe/ge,Vt/ge,Ht,ge,zt))}else if(Y.push(Ge),ge>1)for(const Oe of Xe){const Vt=lt.points[Oe];Vt.zoom<=U||(Vt.zoom=U,Y.push(Vt))}}return Y}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,U){if(F.numPoints)return U?ls({},F.properties):F.properties;const Y=this.points[F.index].properties,ie=this.options.map(Y);return U&&ie===Y?ls({},ie):ie}}function Ra(W,F,U,Y,ie){return{x:Na(W),y:Na(F),zoom:1/0,id:U,parentId:-1,numPoints:Y,properties:ie}}function Pl(W,F){const[U,Y]=W.geometry.coordinates;return{x:Na(no(U)),y:Na(Uo(Y)),zoom:1/0,index:F,parentId:-1}}function Fa(W){return{type:"Feature",id:W.id,properties:Cc(W),geometry:{type:"Point",coordinates:[(F=W.x,360*(F-.5)),In(W.y)]}};var F}function Cc(W){const F=W.numPoints,U=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return ls(ls({},W.properties),{cluster:!0,cluster_id:W.id,point_count:F,point_count_abbreviated:U})}function no(W){return W/360+.5}function Uo(W){const F=Math.sin(W*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function In(W){const F=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function ls(W,F){for(const U in F)W[U]=F[U];return W}function na(W){return W.x}function ks(W){return W.y}function xi(W,F,U,Y){for(var ie,de=Y,Ce=U-F>>1,fe=U-F,pe=W[F],De=W[F+1],Ge=W[U],lt=W[U+1],Xe=F+3;Xe<U;Xe+=3){var Ct=ia(W[Xe],W[Xe+1],pe,De,Ge,lt);if(Ct>de)ie=Xe,de=Ct;else if(Ct===de){var ge=Math.abs(Xe-Ce);ge<fe&&(ie=Xe,fe=ge)}}de>Y&&(ie-F>3&&xi(W,F,ie,Y),W[ie+2]=de,U-ie>3&&xi(W,ie,U,Y))}function ia(W,F,U,Y,ie,de){var Ce=ie-U,fe=de-Y;if(0!==Ce||0!==fe){var pe=((W-U)*Ce+(F-Y)*fe)/(Ce*Ce+fe*fe);pe>1?(U=ie,Y=de):pe>0&&(U+=Ce*pe,Y+=fe*pe)}return(Ce=W-U)*Ce+(fe=F-Y)*fe}function Oa(W,F,U,Y){var ie={id:void 0===W?null:W,type:F,geometry:U,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Ce=de.geometry,fe=de.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)cs(de,Ce);else if("Polygon"===fe||"MultiLineString"===fe)for(var pe=0;pe<Ce.length;pe++)cs(de,Ce[pe]);else if("MultiPolygon"===fe)for(pe=0;pe<Ce.length;pe++)for(var De=0;De<Ce[pe].length;De++)cs(de,Ce[pe][De])}(ie),ie}function cs(W,F){for(var U=0;U<F.length;U+=3)W.minX=Math.min(W.minX,F[U]),W.minY=Math.min(W.minY,F[U+1]),W.maxX=Math.max(W.maxX,F[U]),W.maxY=Math.max(W.maxY,F[U+1])}function Nl(W,F,U,Y){if(F.geometry){var ie=F.geometry.coordinates,de=F.geometry.type,Ce=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),fe=[],pe=F.id;if(U.promoteId?pe=F.properties[U.promoteId]:U.generateId&&(pe=Y||0),"Point"===de)Nr(ie,fe);else if("MultiPoint"===de)for(var De=0;De<ie.length;De++)Nr(ie[De],fe);else if("LineString"===de)gi(ie,fe,Ce,!1);else if("MultiLineString"===de){if(U.lineMetrics){for(De=0;De<ie.length;De++)gi(ie[De],fe=[],Ce,!1),W.push(Oa(pe,"LineString",fe,F.properties));return}Dc(ie,fe,Ce,!1)}else if("Polygon"===de)Dc(ie,fe,Ce,!0);else{if("MultiPolygon"!==de){if("GeometryCollection"===de){for(De=0;De<F.geometry.geometries.length;De++)Nl(W,{id:pe,geometry:F.geometry.geometries[De],properties:F.properties},U,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(De=0;De<ie.length;De++){var Ge=[];Dc(ie[De],Ge,Ce,!0),fe.push(Ge)}}W.push(Oa(pe,de,fe,F.properties))}}function Nr(W,F){F.push(Co(W[0])),F.push(La(W[1])),F.push(0)}function gi(W,F,U,Y){for(var ie,de,Ce=0,fe=0;fe<W.length;fe++){var pe=Co(W[fe][0]),De=La(W[fe][1]);F.push(pe),F.push(De),F.push(0),fe>0&&(Ce+=Y?(ie*De-pe*de)/2:Math.sqrt(Math.pow(pe-ie,2)+Math.pow(De-de,2))),ie=pe,de=De}var Ge=F.length-3;F[2]=1,xi(F,0,Ge,U),F[Ge+2]=1,F.size=Math.abs(Ce),F.start=0,F.end=F.size}function Dc(W,F,U,Y){for(var ie=0;ie<W.length;ie++){var de=[];gi(W[ie],de,U,Y),F.push(de)}}function Co(W){return W/360+.5}function La(W){var F=Math.sin(W*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function mr(W,F,U,Y,ie,de,Ce,fe){if(Y/=F,de>=(U/=F)&&Ce<Y)return W;if(Ce<U||de>=Y)return null;for(var pe=[],De=0;De<W.length;De++){var Ge=W[De],lt=Ge.geometry,Xe=Ge.type,Ct=0===ie?Ge.minX:Ge.minY,ge=0===ie?Ge.maxX:Ge.maxY;if(Ct>=U&&ge<Y)pe.push(Ge);else if(!(ge<U||Ct>=Y)){var Oe=[];if("Point"===Xe||"MultiPoint"===Xe)Ps(lt,Oe,U,Y,ie);else if("LineString"===Xe)Ba(lt,Oe,U,Y,ie,!1,fe.lineMetrics);else if("MultiLineString"===Xe)Fl(lt,Oe,U,Y,ie,!1);else if("Polygon"===Xe)Fl(lt,Oe,U,Y,ie,!0);else if("MultiPolygon"===Xe)for(var Vt=0;Vt<lt.length;Vt++){var zt=[];Fl(lt[Vt],zt,U,Y,ie,!0),zt.length&&Oe.push(zt)}if(Oe.length){if(fe.lineMetrics&&"LineString"===Xe){for(Vt=0;Vt<Oe.length;Vt++)pe.push(Oa(Ge.id,Xe,Oe[Vt],Ge.tags));continue}"LineString"!==Xe&&"MultiLineString"!==Xe||(1===Oe.length?(Xe="LineString",Oe=Oe[0]):Xe="MultiLineString"),"Point"!==Xe&&"MultiPoint"!==Xe||(Xe=3===Oe.length?"Point":"MultiPoint"),pe.push(Oa(Ge.id,Xe,Oe,Ge.tags))}}}return pe.length?pe:null}function Ps(W,F,U,Y,ie){for(var de=0;de<W.length;de+=3){var Ce=W[de+ie];Ce>=U&&Ce<=Y&&(F.push(W[de]),F.push(W[de+1]),F.push(W[de+2]))}}function Ba(W,F,U,Y,ie,de,Ce){for(var fe,pe,De=Rl(W),Ge=0===ie?Tc:wh,lt=W.start,Xe=0;Xe<W.length-3;Xe+=3){var Ct=W[Xe],ge=W[Xe+1],Oe=W[Xe+2],Vt=W[Xe+3],zt=W[Xe+4],Ht=0===ie?Ct:ge,Fn=0===ie?Vt:zt,vn=!1;Ce&&(fe=Math.sqrt(Math.pow(Ct-Vt,2)+Math.pow(ge-zt,2))),Ht<U?Fn>U&&(pe=Ge(De,Ct,ge,Vt,zt,U),Ce&&(De.start=lt+fe*pe)):Ht>Y?Fn<Y&&(pe=Ge(De,Ct,ge,Vt,zt,Y),Ce&&(De.start=lt+fe*pe)):Ec(De,Ct,ge,Oe),Fn<U&&Ht>=U&&(pe=Ge(De,Ct,ge,Vt,zt,U),vn=!0),Fn>Y&&Ht<=Y&&(pe=Ge(De,Ct,ge,Vt,zt,Y),vn=!0),!de&&vn&&(Ce&&(De.end=lt+fe*pe),F.push(De),De=Rl(W)),Ce&&(lt+=fe)}var oi=W.length-3;Ct=W[oi],ge=W[oi+1],Oe=W[oi+2],(Ht=0===ie?Ct:ge)>=U&&Ht<=Y&&Ec(De,Ct,ge,Oe),oi=De.length-3,de&&oi>=3&&(De[oi]!==De[0]||De[oi+1]!==De[1])&&Ec(De,De[0],De[1],De[2]),De.length&&F.push(De)}function Rl(W){var F=[];return F.size=W.size,F.start=W.start,F.end=W.end,F}function Fl(W,F,U,Y,ie,de){for(var Ce=0;Ce<W.length;Ce++)Ba(W[Ce],F,U,Y,ie,de,!1)}function Ec(W,F,U,Y){W.push(F),W.push(U),W.push(Y)}function Tc(W,F,U,Y,ie,de){var Ce=(de-F)/(Y-F);return W.push(de),W.push(U+(ie-U)*Ce),W.push(1),Ce}function wh(W,F,U,Y,ie,de){var Ce=(de-U)/(ie-U);return W.push(F+(Y-F)*Ce),W.push(de),W.push(1),Ce}function Va(W,F){for(var U=[],Y=0;Y<W.length;Y++){var ie,de=W[Y],Ce=de.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)ie=Mc(de.geometry,F);else if("MultiLineString"===Ce||"Polygon"===Ce){ie=[];for(var fe=0;fe<de.geometry.length;fe++)ie.push(Mc(de.geometry[fe],F))}else if("MultiPolygon"===Ce)for(ie=[],fe=0;fe<de.geometry.length;fe++){for(var pe=[],De=0;De<de.geometry[fe].length;De++)pe.push(Mc(de.geometry[fe][De],F));ie.push(pe)}U.push(Oa(de.id,Ce,ie,de.tags))}return U}function Mc(W,F){var U=[];U.size=W.size,void 0!==W.start&&(U.start=W.start,U.end=W.end);for(var Y=0;Y<W.length;Y+=3)U.push(W[Y]+F,W[Y+1],W[Y+2]);return U}function Do(W,F){if(W.transformed)return W;var U,Y,ie,de=1<<W.z,Ce=W.x,fe=W.y;for(U=0;U<W.features.length;U++){var pe=W.features[U],De=pe.geometry,Ge=pe.type;if(pe.geometry=[],1===Ge)for(Y=0;Y<De.length;Y+=2)pe.geometry.push(ra(De[Y],De[Y+1],F,de,Ce,fe));else for(Y=0;Y<De.length;Y++){var lt=[];for(ie=0;ie<De[Y].length;ie+=2)lt.push(ra(De[Y][ie],De[Y][ie+1],F,de,Ce,fe));pe.geometry.push(lt)}}return W.transformed=!0,W}function ra(W,F,U,Y,ie,de){return[Math.round(U*(W*Y-ie)),Math.round(U*(F*Y-de))]}function _u(W,F,U,Y,ie){for(var de=F===ie.maxZoom?0:ie.tolerance/((1<<F)*ie.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:Y,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<W.length;fe++){Ce.numFeatures++,Sc(Ce,W[fe],de,ie);var pe=W[fe].minX,De=W[fe].minY,Ge=W[fe].maxX,lt=W[fe].maxY;pe<Ce.minX&&(Ce.minX=pe),De<Ce.minY&&(Ce.minY=De),Ge>Ce.maxX&&(Ce.maxX=Ge),lt>Ce.maxY&&(Ce.maxY=lt)}return Ce}function Sc(W,F,U,Y){var ie=F.geometry,de=F.type,Ce=[];if("Point"===de||"MultiPoint"===de)for(var fe=0;fe<ie.length;fe+=3)Ce.push(ie[fe]),Ce.push(ie[fe+1]),W.numPoints++,W.numSimplified++;else if("LineString"===de)us(Ce,ie,W,U,!1,!1);else if("MultiLineString"===de||"Polygon"===de)for(fe=0;fe<ie.length;fe++)us(Ce,ie[fe],W,U,"Polygon"===de,0===fe);else if("MultiPolygon"===de)for(var pe=0;pe<ie.length;pe++){var De=ie[pe];for(fe=0;fe<De.length;fe++)us(Ce,De[fe],W,U,!0,0===fe)}if(Ce.length){var Ge=F.tags||null;if("LineString"===de&&Y.lineMetrics){for(var lt in Ge={},F.tags)Ge[lt]=F.tags[lt];Ge.mapbox_clip_start=ie.start/ie.size,Ge.mapbox_clip_end=ie.end/ie.size}var Xe={geometry:Ce,type:"Polygon"===de||"MultiPolygon"===de?3:"LineString"===de||"MultiLineString"===de?2:1,tags:Ge};null!==F.id&&(Xe.id=F.id),W.features.push(Xe)}}function us(W,F,U,Y,ie,de){var Ce=Y*Y;if(Y>0&&F.size<(ie?Ce:Y))U.numPoints+=F.length/3;else{for(var fe=[],pe=0;pe<F.length;pe+=3)(0===Y||F[pe+2]>Ce)&&(U.numSimplified++,fe.push(F[pe]),fe.push(F[pe+1])),U.numPoints++;ie&&function(De,Ge){for(var lt=0,Xe=0,Ct=De.length,ge=Ct-2;Xe<Ct;ge=Xe,Xe+=2)lt+=(De[Xe]-De[ge])*(De[Xe+1]+De[ge+1]);if(lt>0===Ge)for(Xe=0,Ct=De.length;Xe<Ct/2;Xe+=2){var Oe=De[Xe],Vt=De[Xe+1];De[Xe]=De[Ct-2-Xe],De[Xe+1]=De[Ct-1-Xe],De[Ct-2-Xe]=Oe,De[Ct-1-Xe]=Vt}}(fe,de),W.push(fe)}}function yn(W,F){var U=(F=this.options=function(ie,de){for(var Ce in de)ie[Ce]=de[Ce];return ie}(Object.create(this.options),F)).debug;if(U&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie,de,Ce,fe,pe,De,Y=function(ie,de){var Ce=[];if("FeatureCollection"===ie.type)for(var fe=0;fe<ie.features.length;fe++)Nl(Ce,ie.features[fe],de,fe);else Nl(Ce,"Feature"===ie.type?ie:{geometry:ie},de);return Ce}(W,F);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ie=Y,de=F,Ce=de.buffer/de.extent,fe=ie,pe=mr(ie,1,-1-Ce,Ce,0,-1,2,de),De=mr(ie,1,1-Ce,2+Ce,0,-1,2,de),(pe||De)&&(fe=mr(ie,1,-Ce,1+Ce,0,-1,2,de)||[],pe&&(fe=Va(pe,1).concat(fe)),De&&(fe=fe.concat(Va(De,-1)))),Y=fe).length&&this.splitTile(Y,0,0,0),U&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ns(W,F,U){return 32*((1<<W)*U+F)+W}function qt(W,F){const U=W.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const Y=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!Y)return F(null,null);const ie=new ct(Y.features);let de=Ai(ie);0===de.byteOffset&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),F(null,{vectorTile:ie,rawData:de.buffer})}yn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yn.prototype.splitTile=function(W,F,U,Y,ie,de,Ce){for(var fe=[W,F,U,Y],pe=this.options,De=pe.debug;fe.length;){Y=fe.pop(),U=fe.pop(),F=fe.pop(),W=fe.pop();var Ge=1<<F,lt=Ns(F,U,Y),Xe=this.tiles[lt];if(!Xe&&(De>1&&console.time("creation"),Xe=this.tiles[lt]=_u(W,F,U,Y,pe),this.tileCoords.push({z:F,x:U,y:Y}),De)){De>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,U,Y,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var Ct="z"+F;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(Xe.source=W,ie){if(F===pe.maxZoom||F===ie)continue;var ge=1<<ie-F;if(U!==Math.floor(de/ge)||Y!==Math.floor(Ce/ge))continue}else if(F===pe.indexMaxZoom||Xe.numPoints<=pe.indexMaxPoints)continue;if(Xe.source=null,0!==W.length){De>1&&console.time("clipping");var Oe,Vt,zt,Ht,Fn,vn,oi=.5*pe.buffer/pe.extent,Rs=.5-oi,dt=.5+oi,tn=1+oi;Oe=Vt=zt=Ht=null,Fn=mr(W,Ge,U-oi,U+dt,0,Xe.minX,Xe.maxX,pe),vn=mr(W,Ge,U+Rs,U+tn,0,Xe.minX,Xe.maxX,pe),W=null,Fn&&(Oe=mr(Fn,Ge,Y-oi,Y+dt,1,Xe.minY,Xe.maxY,pe),Vt=mr(Fn,Ge,Y+Rs,Y+tn,1,Xe.minY,Xe.maxY,pe),Fn=null),vn&&(zt=mr(vn,Ge,Y-oi,Y+dt,1,Xe.minY,Xe.maxY,pe),Ht=mr(vn,Ge,Y+Rs,Y+tn,1,Xe.minY,Xe.maxY,pe),vn=null),De>1&&console.timeEnd("clipping"),fe.push(Oe||[],F+1,2*U,2*Y),fe.push(Vt||[],F+1,2*U,2*Y+1),fe.push(zt||[],F+1,2*U+1,2*Y),fe.push(Ht||[],F+1,2*U+1,2*Y+1)}}},yn.prototype.getTile=function(W,F,U){var Y=this.options,ie=Y.extent,de=Y.debug;if(W<0||W>24)return null;var Ce=1<<W,fe=Ns(W,F=(F%Ce+Ce)%Ce,U);if(this.tiles[fe])return Do(this.tiles[fe],ie);de>1&&console.log("drilling down to z%d-%d-%d",W,F,U);for(var pe,De=W,Ge=F,lt=U;!pe&&De>0;)De--,Ge=Math.floor(Ge/2),lt=Math.floor(lt/2),pe=this.tiles[Ns(De,Ge,lt)];return pe&&pe.source?(de>1&&console.log("found parent tile z%d-%d-%d",De,Ge,lt),de>1&&console.time("drilling down"),this.splitTile(pe.source,De,Ge,lt,W,F,U),de>1&&console.timeEnd("drilling down"),this.tiles[fe]?Do(this.tiles[fe],ie):null):null};class oa extends d.VectorTileWorkerSource{constructor(F,U,Y,ie,de){super(F,U,Y,ie,qt),de&&(this.loadGeoJSON=de)}loadData(F,U){const Y=F&&F.request,ie=Y&&Y.collectResourceTiming;this.loadGeoJSON(F,(de,Ce)=>{if(de||!Ce)return U(de);if("object"!=typeof Ce)return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{ye(Ce,!0);try{if(F.filter){const pe=d.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===pe.result)throw new Error(pe.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));const De=Ce.features.filter(Ge=>pe.value.evaluate({zoom:0},Ge));Ce={type:"FeatureCollection",features:De}}this._geoJSONIndex=F.cluster?new Cn(function({superclusterOptions:pe,clusterProperties:De}){if(!De||!pe)return pe;const Ge={},lt={},Xe={accumulated:null,zoom:0},Ct={properties:null},ge=Object.keys(De);for(const Oe of ge){const[Vt,zt]=De[Oe],Ht=d.createExpression(zt),Fn=d.createExpression("string"==typeof Vt?[Vt,["accumulated"],["get",Oe]]:Vt);Ge[Oe]=Ht.value,lt[Oe]=Fn.value}return pe.map=Oe=>{Ct.properties=Oe;const Vt={};for(const zt of ge)Vt[zt]=Ge[zt].evaluate(Xe,Ct);return Vt},pe.reduce=(Oe,Vt)=>{Ct.properties=Vt;for(const zt of ge)Xe.accumulated=Oe[zt],Oe[zt]=lt[zt].evaluate(Xe,Ct)},pe}(F)).load(Ce.features):new yn(pe=Ce,F.geojsonVtOptions)}catch(pe){return U(pe)}this.loaded={};const fe={};if(ie){const pe=d.getPerformanceMeasurement(Y);pe&&(fe.resourceTiming={},fe.resourceTiming[F.source]=JSON.parse(JSON.stringify(pe)))}U(null,fe)}var pe})}reloadTile(F,U){const Y=this.loaded;return Y&&Y[F.uid]?super.reloadTile(F,U):this.loadTile(F,U)}loadGeoJSON(F,U){if(F.request)d.getJSON(F.request,U);else{if("string"!=typeof F.data)return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(F.data))}catch(Y){return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(Y){U(Y)}}getClusterChildren(F,U){try{U(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(Y){U(Y)}}getClusterLeaves(F,U){try{U(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(Y){U(Y)}}}class hs{constructor(F){this.self=F,this.actor=new d.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:oa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,Y)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=Y},this.self.registerRTLTextPlugin=U=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=U.applyArabicShaping,d.plugin.processBidirectionalText=U.processBidirectionalText,d.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}checkIfReady(F,U,Y){Y()}setReferrer(F,U){this.referrer=U}spriteLoaded(F,U){this.isSpriteLoaded=U;for(const Y in this.workerSources[F]){const ie=this.workerSources[F][Y];for(const de in ie)ie[de]instanceof d.VectorTileWorkerSource&&(ie[de].isSpriteLoaded=U,ie[de].fire(new d.Event("isSpriteLoaded")))}}setImages(F,U,Y){this.availableImages[F]=U;for(const ie in this.workerSources[F]){const de=this.workerSources[F][ie];for(const Ce in de)de[Ce].availableImages=U}Y()}enableTerrain(F,U,Y){this.terrain=U,Y()}setLayers(F,U,Y){this.getLayerIndex(F).replace(U),Y()}updateLayers(F,U,Y){this.getLayerIndex(F).update(U.layers,U.removedIds),Y()}loadTile(F,U,Y){const ie=this.enableTerrain?d.extend({enableTerrain:this.terrain},U):U;this.getWorkerSource(F,U.type,U.source).loadTile(ie,Y)}loadDEMTile(F,U,Y){const ie=this.enableTerrain?d.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(F,U.source).loadTile(ie,Y)}reloadTile(F,U,Y){const ie=this.enableTerrain?d.extend({enableTerrain:this.terrain},U):U;this.getWorkerSource(F,U.type,U.source).reloadTile(ie,Y)}abortTile(F,U,Y){this.getWorkerSource(F,U.type,U.source).abortTile(U,Y)}removeTile(F,U,Y){this.getWorkerSource(F,U.type,U.source).removeTile(U,Y)}removeSource(F,U,Y){if(!this.workerSources[F]||!this.workerSources[F][U.type]||!this.workerSources[F][U.type][U.source])return;const ie=this.workerSources[F][U.type][U.source];delete this.workerSources[F][U.type][U.source],void 0!==ie.removeSource?ie.removeSource(U,Y):Y()}loadWorkerSource(F,U,Y){try{this.self.importScripts(U.url),Y()}catch(ie){Y(ie.toString())}}syncRTLPluginState(F,U,Y){try{d.plugin.setState(U);const ie=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=ie){this.self.importScripts(ie);const de=d.plugin.isParsed();Y(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ie}`),de)}}catch(ie){Y(ie.toString())}}getAvailableImages(F){let U=this.availableImages[F];return U||(U=[]),U}getLayerIndex(F){let U=this.layerIndexes[F];return U||(U=this.layerIndexes[F]=new Me),U}getWorkerSource(F,U,Y){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][U]||(this.workerSources[F][U]={}),this.workerSources[F][U][Y]||(this.workerSources[F][U][Y]=new this.workerSourceTypes[U]({send:(ie,de,Ce,fe,pe,De)=>{this.actor.send(ie,de,Ce,F,pe,De)},scheduler:this.actor.scheduler},this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded)),this.workerSources[F][U][Y]}getDEMWorkerSource(F,U){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][U]||(this.demWorkerSources[F][U]=new ne),this.demWorkerSources[F][U]}enforceCacheSizeLimit(F,U){d.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(F,U,Y){Y(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new hs(self)),hs}),Je(0,function(d){var Pe=Be;function Be(g){return s=g,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,b,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{b=new Worker(E),m=!0}catch(S){m=!1}return b&&b.terminate(),URL.revokeObjectURL(E),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var b=m.getContext("2d");if(!b)return!1;var x=b.getImageData(0,0,1,1);return x&&x.width===m.width}()||(void 0===Me[h=s&&s.failIfMajorPerformanceCaveat]&&(Me[h]=function(m){var b,E,S,k,x=(E=m,S=document.createElement("canvas"),(k=Object.create(Be.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,S.getContext("webgl",k)||S.getContext("experimental-webgl",k));if(!x)return!1;try{b=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!b||x.isContextLost())&&(x.shaderSource(b,"void main() {}"),x.compileShader(b),!0===x.getShaderParameter(b,x.COMPILE_STATUS))}(h)),!Me[h]||document.documentMode));var s,h}var Me={};function q(g,s){if(Array.isArray(g)){if(!Array.isArray(s)||g.length!==s.length)return!1;for(let h=0;h<g.length;h++)if(!q(g[h],s[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==s){if("object"!=typeof s||Object.keys(g).length!==Object.keys(s).length)return!1;for(const h in g)if(!q(g[h],s[h]))return!1;return!0}return g===s}Be.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ne={create:function(g,s,h){const m=d.window.document.createElement(g);return void 0!==s&&(m.className=s),h&&h.appendChild(m),m},createNS:function(g,s){return d.window.document.createElementNS(g,s)}},ye=d.window.document&&d.window.document.documentElement.style,K=ye&&void 0!==ye.userSelect?"userSelect":"WebkitUserSelect";let ae;ne.disableDrag=function(){ye&&K&&(ae=ye[K],ye[K]="none")},ne.enableDrag=function(){ye&&K&&(ye[K]=ae)},ne.setTransform=function(g,s){g.style.transform=s};let Ne=!1;try{const g=Object.defineProperty({},"passive",{get(){Ne=!0}});d.window.addEventListener("test",g,g),d.window.removeEventListener("test",g,g)}catch(g){Ne=!1}ne.addEventListener=function(g,s,h,m={}){g.addEventListener(s,h,"passive"in m&&Ne?m:m.capture)},ne.removeEventListener=function(g,s,h,m={}){g.removeEventListener(s,h,"passive"in m&&Ne?m:m.capture)};const nt=function(g){g.preventDefault(),g.stopPropagation(),d.window.removeEventListener("click",nt,!0)};function ct(g,s,h){const m=g.offsetWidth===s.width?1:g.offsetWidth/s.width;return new d.pointGeometry((h.clientX-s.left)*m,(h.clientY-s.top)*m)}ne.suppressClick=function(){d.window.addEventListener("click",nt,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",nt,!0)},0)},ne.mousePos=function(g,s){const h=g.getBoundingClientRect();return ct(g,h,s)},ne.touchPos=function(g,s){const h=g.getBoundingClientRect(),m=[];for(let b=0;b<s.length;b++)m.push(ct(g,h,s[b]));return m},ne.mouseButton=function(g){return void 0!==d.window.InstallTrigger&&2===g.button&&g.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button},ne.remove=function(g){g.parentNode&&g.parentNode.removeChild(g)};class xt{constructor(s,h){this.pos=s,this.dir=h}intersectsPlane(s,h,m){const b=d.dot(h,this.dir);if(Math.abs(b)<1e-6)return!1;const x=d.dot(d.sub(d.create(),s,this.pos),h)/b,E=d.scaleAndAdd(d.create(),this.pos,this.dir,x);return d.copy(m,E),!0}}class jt{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,m){const b=Math.pow(2,m),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=d.transformMat4([],S,s),R=1/k[3]/h*b;return d.mul(k,k,[R,R,1/k[3],R])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=d.sub([],x[S[0]],x[S[1]]),R=d.sub([],x[S[2]],x[S[1]]),L=d.normalize([],d.cross([],k,R)),z=-d.dot(L,x[S[1]]);return L.concat(z)});return new jt(x,E)}}class Gn{constructor(s,h){this.min=s,this.max=h,this.center=d.scale([],d.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],m=d.clone(this.min),b=d.clone(this.max);for(let x=0;x<h.length;x++)m[x]=h[x]?this.min[x]:this.center[x],b[x]=h[x]?this.center[x]:this.max[x];return b[2]=this.max[2],new Gn(m,b)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let b=0;b<s.planes.length;b++){const x=s.planes[b];let E=0;for(let S=0;S<h.length;S++)E+=d.dot$1(x,h[S])>=0;if(0===E)return 0;E!==h.length&&(m=!1)}if(m)return 2;for(let b=0;b<3;b++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<s.points.length;S++){const k=s.points[S][b]-this.min[b];x=Math.min(x,k),E=Math.max(E,k)}if(E<0||x>this.max[b]-this.min[b])return 0}return 1}}function wn(g){const{userImage:s}=g;return!!(s&&s.render&&s.render())&&(g.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ai extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,m);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let m=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,h){if(!s)return!0;let m=0;for(const b of s){if(b[0]<m||b[1]<b[0]||h<b[1])return!1;m=b[1]}return!0}_validateContent(s,h){return!(s&&(4!==s.length||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let m=!0;if(!this.isLoaded())for(const b of s)this.images[b]||(m=!1);this.isLoaded()||m?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const m={};for(const b of s){this.images[b]||this.fire(new d.Event("styleimagemissing",{id:b}));const x=this.images[b];x?m[b]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:d.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,m)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],m=this.getImage(s);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const b={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new d.ImagePosition(b,m);this.patterns[s]={bin:b,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:h,h:m}=d.potpack(s),b=this.atlasImage;b.resize({width:h||1,height:m||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],S=E.x+1,k=E.y+1,R=this.images[x].data,L=R.width,z=R.height;d.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:k},{width:L,height:z}),d.RGBAImage.copy(R,b,{x:0,y:z-1},{x:S,y:k-1},{width:L,height:1}),d.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:k+z},{width:L,height:1}),d.RGBAImage.copy(R,b,{x:L-1,y:0},{x:S-1,y:k},{width:1,height:z}),d.RGBAImage.copy(R,b,{x:0,y:0},{x:S+L,y:k},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.images[h];wn(m)&&this.updateImage(h,m)}}}const Gr=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(g,s){return function([h,m,b]){const x=d.degToRad(m+90),E=d.degToRad(b);return{x:h*Math.cos(x)*Math.sin(E),y:h*Math.sin(x)*Math.sin(E),z:h*Math.cos(E),azimuthal:m,polar:b}}(g.expression.evaluate(s))}interpolate(g,s,h){return{x:d.number(g.x,s.x,h),y:d.number(g.y,s.y,h),z:d.number(g.z,s.z,h),azimuthal:d.number(g.azimuthal,s.azimuthal,h),polar:d.number(g.polar,s.polar,h)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),ji="-transition";class Bt extends d.Evented{constructor(s){super(),this._transitionable=new d.Transitionable(Gr),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(d.validateLight,s,h))for(const m in s){const b=s[m];d.endsWith(m,ji)?this._transitionable.setTransition(m.slice(0,-ji.length),b):this._transitionable.setValue(m,b)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,s.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Qs=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),Al="-transition";class qr extends d.Evented{constructor(s){super(),this._transitionable=new d.Transitionable(Qs),this.set(s),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(s){for(const h in s){const m=s[h];d.endsWith(h,Al)?this._transitionable.setTransition(h.slice(0,-Al.length),m):this._transitionable.setValue(h,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}}function ea(g,s,h,m){const b=d.smoothstep(45,65,h),[x,E]=kl(g,m),S=d.length(s);let k=1-Math.min(1,Math.exp((S-x)/(E-x)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*b*g.alpha}function kl(g,s){const h=.5/Math.tan(.5*s);return[g.range[0]+h,g.range[1]+h]}const qn=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),As="-transition";class Vo extends d.Evented{constructor(s){super(),this._transitionable=new d.Transitionable(qn),this.set(s),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(d.validateFog,s,h))for(const m in s){const b=s[m];d.endsWith(m,As)?this._transitionable.setTransition(m.slice(0,-As.length),b):this._transitionable.setValue(m,b)}}getOpacity(s){const h=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,s)*h.a}getOpacityAtLatLng(s,h){return function(m,b,x){const E=d.MercatorCoordinate.fromLngLat(b),S=x.elevation?x.elevation.getAtPointOrZero(E):0,k=[E.x,E.y,S];return d.transformMat4$1(k,k,x.mercatorFogMatrix),ea(m,k,x.pitch,x._fov)}(this.state,s,h)}getFovAdjustedRange(s){return kl(this.state,s)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,s.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Rt{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let b=0;b<m.length;b++){const x=new Rt.Actor(m[b],h,this.id);x.name=`Worker ${b}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,m){d.asyncAll(this.actors,(b,x)=>{b.send(s,h,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fi(g,s,h){return s*(d.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Rt.Actor=d.Actor;class Pa{constructor(s,h,m,b){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>b.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(s,h){let m,b;if(s instanceof d.pointGeometry||"number"==typeof s[0]){const x=d.pointGeometry.convert(s);m=[d.pointGeometry.convert(s)],b=h.isPointAboveHorizon(x)}else{const x=d.pointGeometry.convert(s[0]),E=d.pointGeometry.convert(s[1]);m=[x,E],b=d.polygonizeBounds(x,E).every(S=>h.isPointAboveHorizon(S))}return new Pa(m,h.getCameraPoint(),b,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(s){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],b=d.polygonizeBounds(h,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<m.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?b[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(b[3]=this.cameraPoint)),d.bufferConvexPolygon(b,s)}containsTile(s,h,m){const b=s.queryPadding+1,x=m?this._bufferedCameraMercator(b,h).map(H=>s.tileID.getTilePoint(H)):this._bufferedScreenMercator(b,h).map(H=>s.tileID.getTilePoint(H)),E=this.screenGeometryMercator.map(H=>s.tileID.getTileVec3(H)),S=E.map(H=>new d.pointGeometry(H[0],H[1])),k=h.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),R=s.tileID.getTileVec3(k),L=E.map(H=>{const J=d.sub(H,H,R);return d.normalize(J,J),new xt(R,J)}),z=fi(s,1,h.zoom);if(d.polygonIntersectsBox(x,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:S,tilespaceRays:L,bufferedTilespaceGeometry:x,bufferedTilespaceBounds:($=d.getBounds(x),$.min.x=d.clamp($.min.x,0,d.EXTENT),$.min.y=d.clamp($.min.y,0,d.EXTENT),$.max.x=d.clamp($.max.x,0,d.EXTENT),$.max.y=d.clamp($.max.y,0,d.EXTENT),$),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:z};var $}_bufferedScreenMercator(s,h){const m=pi(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const b=this.bufferedScreenGeometry(s).map(x=>h.pointCoordinate3D(x));return this._screenRaycastCache[m]=b,b}}_bufferedCameraMercator(s,h){const m=pi(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const b=this.bufferedCameraGeometry(s).map(x=>h.pointCoordinate3D(x));return this._cameraRaycastCache[m]=b,b}}}function pi(g){return 100*g|0}function zo(g,s,h){const m=function(b,x){if(b)return h(b);if(x){const E=d.pick(d.extend(x,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),E.tiles=s.canonicalizeTileset(E,g.url),h(null,E)}};return g.url?d.getJSON(s.transformRequest(s.normalizeSourceURL(g.url),d.ResourceType.Source),m):d.exported.frame(()=>m(null,g))}class wc{constructor(s,h,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*h),b=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=m&&s.x<x&&s.y>=b&&s.y<E}}class Pr{constructor(s,h,m){this.context=s;const b=s.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Na={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ta{constructor(s,h,m,b){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let m=0;m<this.attributes.length;m++){const b=h.attributes[this.attributes[m].name];void 0!==b&&s.enableVertexAttribArray(b)}}setVertexAttribPointers(s,h,m){for(let b=0;b<this.attributes.length;b++){const x=this.attributes[b],E=h.attributes[x.name];void 0!==E&&s.vertexAttribPointer(E,x.components,s[Na[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ra extends Cn{getDefault(){return d.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Pl extends Cn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Fa extends Cn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Cc extends Cn{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class no extends Cn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Uo extends Cn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class In extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class ls extends Cn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class na extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class ks extends Cn{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class xi extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class ia extends Cn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Oa extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class cs extends Cn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Nl extends Cn{getDefault(){return d.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Nr extends Cn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class gi extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Dc extends Cn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Co extends Cn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class La extends Cn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class mr extends Cn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Ps extends Cn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ba extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Rl extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Fl extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ec extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Tc extends Cn{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class wh extends Cn{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Va extends Cn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Mc extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Do extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ra extends Cn{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class _u extends ra{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Sc extends ra{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class us extends Sc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class yn{constructor(s,h,m,b){this.context=s,this.width=h,this.height=m;const x=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new _u(s,x),b&&(this.depthAttachment=new Sc(s,x))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class Ns{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ra(this),this.clearDepth=new Pl(this),this.clearStencil=new Fa(this),this.colorMask=new Cc(this),this.depthMask=new no(this),this.stencilMask=new Uo(this),this.stencilFunc=new In(this),this.stencilOp=new ls(this),this.stencilTest=new na(this),this.depthRange=new ks(this),this.depthTest=new xi(this),this.depthFunc=new ia(this),this.blend=new Oa(this),this.blendFunc=new cs(this),this.blendColor=new Nl(this),this.blendEquation=new Nr(this),this.cullFace=new gi(this),this.cullFaceSide=new Dc(this),this.frontFace=new Co(this),this.program=new La(this),this.activeTexture=new mr(this),this.viewport=new Ps(this),this.bindFramebuffer=new Ba(this),this.bindRenderbuffer=new Rl(this),this.bindTexture=new Fl(this),this.bindVertexBuffer=new Ec(this),this.bindElementBuffer=new Tc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wh(this),this.pixelStoreUnpack=new Va(this),this.pixelStoreUnpackPremultiplyAlpha=new Mc(this),this.pixelStoreUnpackFlipY=new Do(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Pr(this,s,h)}createVertexBuffer(s,h,m){return new ta(this,s,h,m)}createRenderbuffer(s,h,m){const b=this.gl,x=b.createRenderbuffer();return this.bindRenderbuffer.set(x),b.renderbufferStorage(b.RENDERBUFFER,s,h,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,h,m){return new yn(this,s,h,m)}clear({color:s,depth:h,stencil:m}){const b=this.gl;let x=0;s&&(x|=b.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(x|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==m&&(x|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(x)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){q(s.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class qt extends d.Evented{constructor(s,h,m,b){super(),this.id=s,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zo(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new d.ErrorEvent(s)):h&&(d.extend(this,h),h.bounds&&(this.tileBounds=new wc(h.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(h.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const m=d.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=d.getImage(this.map._requestManager.transformRequest(b,d.ResourceType.Tile),(x,E,S,k)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(x)s.state="errored",h(x);else if(E){this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:k});const R=this.map.painter.context,L=R.gl;s.texture=this.map.painter.getTileTexture(E.width),s.texture?s.texture.update(E,{useMipmap:!0}):(s.texture=new d.Texture(R,E,L.RGBA,{useMipmap:!0}),s.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),R.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),s.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let oa;var hs=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class W extends d.Evented{constructor(s,h,m,b){super(),this.id=s,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}load(s,h){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,b)=>{this._loaded=!0,m?this.fire(new d.ErrorEvent(m)):b&&(this.image=d.exported.getImageData(b),s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(b){let x=1/0,E=1/0,S=-1/0,k=-1/0;for(const $ of b)x=Math.min(x,$.x),E=Math.min(E,$.y),S=Math.max(S,$.x),k=Math.max(k,$.y);const R=Math.max(S-x,k-E),L=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,L);return new d.CanonicalTileID(L,Math.floor((x+S)/2*z),Math.floor((E+k)/2*z))}(h),this.minzoom=this.maxzoom=this.tileID.z;const m=h.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(m[2].x,m[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const m in this.tiles){const b=this.tiles[m];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const F={vector:class extends d.Evented{constructor(g,s,h,m){if(super(),this.id=g,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(s,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zo(this._options,this.map._requestManager,(g,s)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new d.ErrorEvent(g)):s&&(d.extend(this,s),s.bounds&&(this.tileBounds=new wc(s.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(s.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}setSourceProperty(g){this._tileJSONRequest&&this._tileJSONRequest.cancel(),g();const s=this.map.style._getSourceCaches(this.id);for(const h of s)h.clearTiles();this.load()}setTiles(g){return this.setSourceProperty(()=>{this._options.tiles=g}),this}setUrl(g){return this.setSourceProperty(()=>{this.url=g,this._options.url=g}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(g,s){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(h,d.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=s:g.request=g.actor.send("reloadTile",m,b.bind(this));else if(g.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",m,b.bind(this),void 0,!0);else{const x=d.loadVectorTile.call({deduped:this._deduped},m,(E,S)=>{E||!S?b.call(this,E):(m.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},g.actor&&g.actor.send("loadTile",m,b.bind(this),void 0,!0))},!0);g.request={cancel:x}}function b(x,E){return delete g.request,g.aborted?s(null):x&&404!==x.status?s(x):(E&&E.resourceTiming&&(g.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&g.setExpiryData(E),g.loadVectorData(E,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:qt,"raster-dem":class extends qt{constructor(g,s,h,m){super(g,s,h,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(g,s){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(b,x){b&&(g.state="errored",s(b)),x&&(g.dem=x,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",s(null))}g.request=d.getImage(this.map._requestManager.transformRequest(h,d.ResourceType.Tile),function(b,x,E,S){if(delete g.request,g.aborted)g.state="unloaded",s(null);else if(b)g.state="errored",s(b);else if(x){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:E,expires:S});const k=d.window.ImageBitmap&&x instanceof d.window.ImageBitmap&&(null==oa&&(oa=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),oa),R=1-(x.width-d.prevPowerOfTwo(x.width))/2;R<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const L=k?x:d.exported.getImageData(x,R),z={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",z,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const s=g.canonical,h=Math.pow(2,s.z),m=(s.x-1+h)%h,b=0===s.x?g.wrap-1:g.wrap,x=(s.x+1+h)%h,E=s.x+1===h?g.wrap+1:g.wrap,S={};return S[new d.OverscaledTileID(g.overscaledZ,b,s.z,m,s.y).key]={backfilled:!1},S[new d.OverscaledTileID(g.overscaledZ,E,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(S[new d.OverscaledTileID(g.overscaledZ,b,s.z,m,s.y-1).key]={backfilled:!1},S[new d.OverscaledTileID(g.overscaledZ,g.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new d.OverscaledTileID(g.overscaledZ,E,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<h&&(S[new d.OverscaledTileID(g.overscaledZ,b,s.z,m,s.y+1).key]={backfilled:!1},S[new d.OverscaledTileID(g.overscaledZ,g.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new d.OverscaledTileID(g.overscaledZ,E,s.z,x,s.y+1).key]={backfilled:!1}),S}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends d.Evented{constructor(g,s,h,m){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(m),this._data=s.data,this._options=d.extend({},s),this._collectResourceTiming=s.collectResourceTiming,void 0!==s.maxzoom&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const b=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(void 0!==s.buffer?s.buffer:128)*b,tolerance:(void 0!==s.tolerance?s.tolerance:.375)*b,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:void 0!==s.clusterMaxZoom?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==s.clusterRadius?s.clusterRadius:50)*b,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},s),this}getClusterChildren(g,s){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},s),this}getClusterLeaves(g,s,h,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:s,offset:h},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=d.extend({},this.workerOptions),s=this._data;"string"==typeof s?(g.request=this.map._requestManager.transformRequest(d.exported.resolveURL(s),d.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new d.ErrorEvent(h));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(b.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,s){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,b)=>(delete g.request,g.unloadVectorData(),g.aborted?s(null):m?s(m):(g.loadVectorData(b,this.map.painter,"reloadTile"===h),s(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends W{constructor(g,s,h,m){super(g,s,h,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const s of g.urls)this.urls.push(this.map._requestManager.transformRequest(s,d.ResourceType.Source).url);d.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new d.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const s=this.video.seekable;g<s.start(0)||g>s.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,s=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(g,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const h in this.tiles){const m=this.tiles[h];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:W,canvas:class extends W{constructor(g,s,h,m){super(g,s,h,m),s.coordinates?Array.isArray(s.coordinates)&&4===s.coordinates.length&&!s.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(x=>"number"!=typeof x))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),s.animate&&"boolean"!=typeof s.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),s.canvas?"string"==typeof s.canvas||s.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=s,this.animate=void 0===s.animate||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,hs.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(s,this.canvas,h.RGBA,{premultiply:!0});for(const m in this.tiles){const b=this.tiles[m];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}}},U=function(g,s,h,m){const b=new F[s.type](g,s,h,m);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Y(g,s){const h=d.identity([]);return d.scale$1(h,h,[.5*g.width,.5*-g.height,1]),d.translate(h,h,[1,-1,0]),d.multiply(h,h,g.calculateProjMatrix(s.toUnwrapped()))}function ie(g,s,h,m,b,x,E,S=!1){const k=g.tilesIn(m,E,S);k.sort(Ce);const R=[];for(const z of k)R.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(s,h,g._state,z,b,x,Y(g.transform,z.tile.tileID),S)});const L=function(z){const $={},H={};for(const J of z){const Q=J.queryResults,le=J.wrappedTileID,X=H[le]=H[le]||{};for(const te in Q){const se=Q[te],he=X[te]=X[te]||{},_e=$[te]=$[te]||[];for(const oe of se)he[oe.featureIndex]||(he[oe.featureIndex]=!0,_e.push(oe))}}return $}(R);for(const z in L)L[z].forEach($=>{const H=$.feature,J=g.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=J});return L}function de(g,s){const h=g.getRenderableIds().map(x=>g.getTileByID(x)),m=[],b={};for(let x=0;x<h.length;x++){const E=h[x],S=E.tileID.canonical.key;b[S]||(b[S]=!0,E.querySourceFeatures(m,s))}return m}function Ce(g,s){const h=g.tileID,m=s.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function fe(){return null!=tl.workerClass?new tl.workerClass:new d.window.Worker(tl.workerUrl)}const pe="mapboxgl_preloaded_worker_pool";class De{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<De.workerCount;)this.workers.push(new fe);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pe]}numActive(){return Object.keys(this.active).length}}let Ge;function lt(){return Ge||(Ge=new De),Ge}function Xe(g,s){const h={};for(const m in g)"ref"!==m&&(h[m]=g[m]);return d.refProperties.forEach(m=>{m in s&&(h[m]=s[m])}),h}function Ct(g){g=g.slice();const s=Object.create(null);for(let h=0;h<g.length;h++)s[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Xe(g[h],s[g[h].ref]));return g}De.workerCount=2;const ge={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Oe(g,s,h){h.push({command:ge.addSource,args:[g,s[g]]})}function Vt(g,s,h){s.push({command:ge.removeSource,args:[g]}),h[g]=!0}function zt(g,s,h,m){Vt(g,h,m),Oe(g,s,h)}function Ht(g,s,h){let m;for(m in g[h])if(g[h].hasOwnProperty(m)&&"data"!==m&&!q(g[h][m],s[h][m]))return!1;for(m in s[h])if(s[h].hasOwnProperty(m)&&"data"!==m&&!q(g[h][m],s[h][m]))return!1;return!0}function Fn(g,s,h,m,b,x){let E;for(E in s=s||{},g=g||{})g.hasOwnProperty(E)&&(q(g[E],s[E])||h.push({command:x,args:[m,E,s[E],b]}));for(E in s)s.hasOwnProperty(E)&&!g.hasOwnProperty(E)&&(q(g[E],s[E])||h.push({command:x,args:[m,E,s[E],b]}))}function vn(g){return g.id}function oi(g,s){return g[s.id]=s,g}class Rs{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=d.clamp(s,0,1);let h=1,m=this._distances[h];const b=s*this.paddedLength+this.padding;for(;m<b&&h<this._distances.length;)m=this._distances[++h];const x=h-1,E=this._distances[x],S=m-E,k=S>0?(b-E)/S:0;return this.points[x].mult(1-k).add(this.points[h].mult(k))}}class dt{constructor(s,h,m){const b=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(h/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,m,b,x){this._forEachCell(h,m,b,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(x)}insertCircle(s,h,m,b){this._forEachCell(h-b,m-b,h+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(m),this.circles.push(b)}_insertBoxCell(s,h,m,b,x,E){this.boxCells[x].push(E)}_insertCircleCell(s,h,m,b,x,E){this.circleCells[x].push(E)}_query(s,h,m,b,x,E){if(m<0||s>this.width||b<0||h>this.height)return!x&&[];const S=[];if(s<=0&&h<=0&&this.width<=m&&this.height<=b){if(x)return!0;for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const R=this.circles[3*k],L=this.circles[3*k+1],z=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:R-z,y1:L-z,x2:R+z,y2:L+z})}return E?S.filter(E):S}return this._forEachCell(s,h,m,b,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?S.length>0:S}_queryCircle(s,h,m,b,x){const E=s-m,S=s+m,k=h-m,R=h+m;if(S<0||E>this.width||R<0||k>this.height)return!b&&[];const L=[];return this._forEachCell(E,k,S,R,this._queryCellCircle,L,{hitTest:b,circle:{x:s,y:h,radius:m},seenUids:{box:{},circle:{}}},x),b?L.length>0:L}query(s,h,m,b,x){return this._query(s,h,m,b,!1,x)}hitTest(s,h,m,b,x){return this._query(s,h,m,b,!0,x)}hitTestCircle(s,h,m,b){return this._queryCircle(s,h,m,!0,b)}_queryCell(s,h,m,b,x,E,S,k){const R=S.seenUids,L=this.boxCells[x];if(null!==L){const $=this.bboxes;for(const H of L)if(!R.box[H]){R.box[H]=!0;const J=4*H;if(s<=$[J+2]&&h<=$[J+3]&&m>=$[J+0]&&b>=$[J+1]&&(!k||k(this.boxKeys[H]))){if(S.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[H],x1:$[J],y1:$[J+1],x2:$[J+2],y2:$[J+3]})}}}const z=this.circleCells[x];if(null!==z){const $=this.circles;for(const H of z)if(!R.circle[H]){R.circle[H]=!0;const J=3*H;if(this._circleAndRectCollide($[J],$[J+1],$[J+2],s,h,m,b)&&(!k||k(this.circleKeys[H]))){if(S.hitTest)return E.push(!0),!0;{const Q=$[J],le=$[J+1],X=$[J+2];E.push({key:this.circleKeys[H],x1:Q-X,y1:le-X,x2:Q+X,y2:le+X})}}}}}_queryCellCircle(s,h,m,b,x,E,S,k){const R=S.circle,L=S.seenUids,z=this.boxCells[x];if(null!==z){const H=this.bboxes;for(const J of z)if(!L.box[J]){L.box[J]=!0;const Q=4*J;if(this._circleAndRectCollide(R.x,R.y,R.radius,H[Q+0],H[Q+1],H[Q+2],H[Q+3])&&(!k||k(this.boxKeys[J])))return E.push(!0),!0}}const $=this.circleCells[x];if(null!==$){const H=this.circles;for(const J of $)if(!L.circle[J]){L.circle[J]=!0;const Q=3*J;if(this._circlesCollide(H[Q],H[Q+1],H[Q+2],R.x,R.y,R.radius)&&(!k||k(this.circleKeys[J])))return E.push(!0),!0}}}_forEachCell(s,h,m,b,x,E,S,k){const R=this._convertToXCellCoord(s),L=this._convertToYCellCoord(h),z=this._convertToXCellCoord(m),$=this._convertToYCellCoord(b);for(let H=R;H<=z;H++)for(let J=L;J<=$;J++)if(x.call(this,s,h,m,b,this.xCellCount*J+H,E,S,k))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,m,b,x,E){const S=b-s,k=x-h,R=m+E;return R*R>S*S+k*k}_circleAndRectCollide(s,h,m,b,x,E,S){const k=(E-b)/2,R=Math.abs(s-(b+k));if(R>k+m)return!1;const L=(S-x)/2,z=Math.abs(h-(x+L));if(z>L+m)return!1;if(R<=k||z<=L)return!0;const $=R-k,H=z-L;return $*$+H*H<=m*m}}const tn=Math.tan(85*Math.PI/180);function nn(g,s,h,m,b){const x=d.create$1();return s?(d.scale$1(x,x,[1/b,1/b,1]),h||d.rotateZ(x,x,m.angle)):d.multiply(x,m.labelPlaneMatrix,g),x}function wi(g,s,h,m,b){if(s){const x=d.clone$1(g);return d.scale$1(x,x,[b,b,1]),h||d.rotateZ(x,x,-m.angle),x}return m.glCoordMatrix}function ln(g,s,h=0){const m=[g.x,g.y,h,1];h?d.transformMat4(m,m,s):Ll(m,m,s);const b=m[3];return{point:new d.pointGeometry(m[0]/b,m[1]/b),signedDistanceFromCamera:b}}function sn(g,s){return Math.min(.5+g/s*.5,1.5)}function Ch(g,s){const h=g[0]/g[3],m=g[1]/g[3];return h>=-s[0]&&h<=s[0]&&m>=-s[1]&&m<=s[1]}function yu(g,s,h,m,b,x,E,S,k){const R=m?g.textSizeData:g.iconSizeData,L=d.evaluateSizeForZoom(R,h.transform.zoom),z=[256/h.width*2+1,256/h.height*2+1],$=m?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;$.clear();const H=g.lineVertexArray,J=m?g.text.placedSymbolArray:g.icon.placedSymbolArray,Q=h.transform.width/h.transform.height;let le=!1;for(let X=0;X<J.length;X++){const te=J.get(X);if(te.writingMode!==d.WritingMode.vertical||le||0!==X&&J.get(X-1).writingMode===d.WritingMode.horizontal||(le=!0),te.hidden||te.writingMode===d.WritingMode.vertical&&!le){fs(te.numGlyphs,$);continue}le=!1;const se=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),he=k?k(se):0,_e=[se.x,se.y,he],oe=[..._e,1];if(d.transformMat4(oe,oe,s),!Ch(oe,z)){fs(te.numGlyphs,$);continue}const we=sn(h.transform.cameraToCenterDistance,oe[3]),ze=d.evaluateSizeForFeature(R,L,te),Ye=E?ze/we:ze*we,xe=ln(new d.pointGeometry(_e[0],_e[1]),b,_e[2]);if(xe.signedDistanceFromCamera<=0){fs(te.numGlyphs,$);continue}let Fe={};const gt=E?null:k,mt=Pt(te,Ye,!1,S,s,b,x,g.glyphOffsetArray,H,$,xe.point,se,Fe,Q,gt);le=mt.useVertical,gt&&mt.needsFlipping&&(Fe={}),(mt.notEnoughRoom||le||mt.needsFlipping&&Pt(te,Ye,!0,S,s,b,x,g.glyphOffsetArray,H,$,xe.point,se,Fe,Q,gt).notEnoughRoom)&&fs(te.numGlyphs,$)}m?g.text.dynamicLayoutVertexBuffer.updateData($):g.icon.dynamicLayoutVertexBuffer.updateData($)}function ht(g,s,h,m,b,x,E,S,k,R,L,z,$){const H=S.glyphStartIndex+S.numGlyphs,J=S.lineStartIndex,Q=S.lineStartIndex+S.lineLength,le=s.getoffsetX(S.glyphStartIndex),X=s.getoffsetX(H-1),te=Ol(g*le,h,m,b,x,E,S.segment,J,Q,k,R,L,z,$,!0);if(!te)return null;const se=Ol(g*X,h,m,b,x,E,S.segment,J,Q,k,R,L,z,$,!0);return se?{first:te,last:se}:null}function Eo(g,s,h,m){return g.writingMode===d.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*m?{useVertical:!0}:g.writingMode===d.WritingMode.vertical?s.y<h.y?{needsFlipping:!0}:null:0!==g.flipState&&function(b,x,E){const S=(x.x-b.x)*E;return 0===S||Math.abs((x.y-b.y)/S)>tn}(s,h,m)?1===g.flipState?{needsFlipping:!0}:null:s.x>h.x?{needsFlipping:!0}:null}function Pt(g,s,h,m,b,x,E,S,k,R,L,z,$,H,J){const Q=s/24,le=g.lineOffsetX*Q,X=g.lineOffsetY*Q;let te;if(g.numGlyphs>1){const se=g.glyphStartIndex+g.numGlyphs,he=g.lineStartIndex,_e=g.lineStartIndex+g.lineLength,oe=ht(Q,S,le,X,h,L,z,g,k,x,$,J,!1);if(!oe)return{notEnoughRoom:!0};const we=ln(oe.first.point,E).point,ze=ln(oe.last.point,E).point;if(m&&!h){const Ye=Eo(g,we,ze,H);if(g.flipState=Ye&&Ye.needsFlipping?1:2,Ye)return Ye}te=[oe.first];for(let Ye=g.glyphStartIndex+1;Ye<se-1;Ye++)te.push(Ol(Q*S.getoffsetX(Ye),le,X,h,L,z,g.segment,he,_e,k,x,$,J,!1,!1));te.push(oe.last)}else{if(m&&!h){const he=ln(z,b).point,_e=g.lineStartIndex+g.segment+1,oe=new d.pointGeometry(k.getx(_e),k.gety(_e)),we=ln(oe,b),ze=Eo(g,he,we.signedDistanceFromCamera>0?we.point:za(z,oe,he,1,b,void 0),H);if(g.flipState=ze&&ze.needsFlipping?1:2,ze)return ze}const se=Ol(Q*S.getoffsetX(g.glyphStartIndex),le,X,h,L,z,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,k,x,$,J,!1,!1);if(!se)return{notEnoughRoom:!0};te=[se]}for(const se of te)d.addDynamicAttributes(R,se.point,se.angle);return{}}function ds(g,s,h){const m={x:g.x,y:g.y,z:0};if(!h)return ln(m,s,m.z);const b=h(g);return ln(new d.pointGeometry(m.x,m.y),s,m.z+b)}function za(g,s,h,m,b,x){const E=ds(g.add(g.sub(s)._unit()),b,x).point,S=h.sub(E);return h.add(S._mult(m/S.mag()))}function Ol(g,s,h,m,b,x,E,S,k,R,L,z,$,H,J){const Q=m?g-s:g+s;let le=Q>0?1:-1,X=0;m&&(le*=-1,X=Math.PI),le<0&&(X+=Math.PI);let te=le>0?S+E:S+E+1,se=b,he=b,_e=0,oe=0;const we=Math.abs(Q),ze=[],Ye=[];let xe=x;const Fe=()=>{const Xt=te-le;return 0===_e?x:new d.pointGeometry(R.getx(Xt),R.gety(Xt))},gt=()=>za(Fe(),xe,he,we-_e+1,L,$);for(;_e+oe<=we;){if(te+=le,te<S||te>=k)return null;if(he=se,ze.push(se),H&&Ye.push(xe||Fe()),se=z[te],void 0===se){xe=new d.pointGeometry(R.getx(te),R.gety(te));const Xt=ds(xe,L,$);se=Xt.signedDistanceFromCamera>0?z[te]=Xt.point:gt()}else xe=null;_e+=oe,oe=he.dist(se)}J&&$&&(xe=xe||new d.pointGeometry(R.getx(te),R.gety(te)),z[te]=se=void 0===z[te]?se:gt(),oe=he.dist(se));const mt=(we-_e)/oe,_t=se.sub(he),it=_t.mult(mt)._add(he);h&&it._add(_t._unit()._perp()._mult(h*le));const vt=X+Math.atan2(se.y-he.y,se.x-he.x);return ze.push(it),H&&(xe=xe||new d.pointGeometry(R.getx(te),R.gety(te)),Ye.push(function(Xt,$t,bi){const li=1-bi;return new d.pointGeometry(Xt.x*li+$t.x*bi,Xt.y*li+$t.y*bi)}(Ye.length>0?Ye[Ye.length-1]:xe,xe,mt))),{point:it,angle:vt,path:ze,tilePath:Ye}}const Ic=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fs(g,s){for(let h=0;h<g;h++){const m=s.length;s.resize(m+4),s.float32.set(Ic,3*m)}}function Ll(g,s,h){const m=s[0],b=s[1];return g[0]=h[0]*m+h[4]*b+h[12],g[1]=h[1]*m+h[5]*b+h[13],g[3]=h[3]*m+h[7]*b+h[15],g}const Wt=100;class vu{constructor(s,h,m=new dt(s.width+200,s.height+200,25),b=new dt(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=b,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Wt,this.screenBottomBoundary=s.height+Wt,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,m,b,x,E,S){let k=h.projectedAnchorZ;h.elevation&&(k+=h.elevation);const R=this.projectAndGetPerspectiveRatio(E,h.projectedAnchorX,h.projectedAnchorY,k,h.tileID),L=x*R.perspectiveRatio,z=(h.x1*s+m.x-h.padding)*L+R.point.x,$=(h.y1*s+m.y-h.padding)*L+R.point.y,H=(h.x2*s+m.x+h.padding)*L+R.point.x,J=(h.y2*s+m.y+h.padding)*L+R.point.y,Q=R.perspectiveRatio<=.55||R.aboveHorizon;return!this.isInsideGrid(z,$,H,J)||!b&&this.grid.hitTest(z,$,H,J,S)||Q?{box:[],offscreen:!1}:{box:[z,$,H,J],offscreen:this.isOffscreen(z,$,H,J)}}placeCollisionCircles(s,h,m,b,x,E,S,k,R,L,z,$,H,J){const Q=[],le=this.transform.elevation,X=le?gt=>le.getAtTileOffset(J,gt.x,gt.y):gt=>0,te=new d.pointGeometry(h.tileAnchorX,h.tileAnchorY),se=X(te),he=this.projectAndGetPerspectiveRatio(E,te.x,te.y,se,J),{perspectiveRatio:_e}=he,oe=(L?x/_e:x*_e)/d.ONE_EM,we=ln(te,S,se).point,ze=he.signedDistanceFromCamera>0?ht(oe,b,h.lineOffsetX*oe,h.lineOffsetY*oe,!1,we,te,h,m,S,{},le&&!L?X:null,L&&!!le):null;let Ye=!1,xe=!1,Fe=!0;if(ze&&!he.aboveHorizon){const gt=.5*$*_e+H,mt=new d.pointGeometry(-100,-100),_t=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),it=new Rs,vt=ze.first,Xt=ze.last;let $t=[];for(let Zt=vt.path.length-1;Zt>=1;Zt--)$t.push(vt.path[Zt]);for(let Zt=1;Zt<Xt.path.length;Zt++)$t.push(Xt.path[Zt]);const bi=2.5*gt;if(k){const Zt=$t.map(le?(rn,mi)=>{const Io=X(mi<vt.path.length-1?vt.tilePath[vt.path.length-1-mi]:Xt.tilePath[mi-vt.path.length+2]);return ln(rn,k,Io)}:rn=>ln(rn,k));$t=Zt.some(rn=>rn.signedDistanceFromCamera<=0)?[]:Zt.map(rn=>rn.point)}let li=[];if($t.length>0){const Zt=$t[0].clone(),rn=$t[0].clone();for(let mi=1;mi<$t.length;mi++)Zt.x=Math.min(Zt.x,$t[mi].x),Zt.y=Math.min(Zt.y,$t[mi].y),rn.x=Math.max(rn.x,$t[mi].x),rn.y=Math.max(rn.y,$t[mi].y);li=Zt.x>=mt.x&&rn.x<=_t.x&&Zt.y>=mt.y&&rn.y<=_t.y?[$t]:rn.x<mt.x||Zt.x>_t.x||rn.y<mt.y||Zt.y>_t.y?[]:d.clipLine([$t],mt.x,mt.y,_t.x,_t.y)}for(const Zt of li){it.reset(Zt,.25*gt);let rn=0;rn=it.length<=.5*gt?1:Math.ceil(it.paddedLength/bi)+1;for(let mi=0;mi<rn;mi++){const Io=mi/Math.max(rn-1,1),ao=it.lerp(Io),Gi=ao.x+Wt,Xr=ao.y+Wt;Q.push(Gi,Xr,gt,0);const Xo=Gi-gt,vs=Xr-gt,kn=Gi+gt,fn=Xr+gt;if(Fe=Fe&&this.isOffscreen(Xo,vs,kn,fn),xe=xe||this.isInsideGrid(Xo,vs,kn,fn),!s&&this.grid.hitTestCircle(Gi,Xr,gt,z)&&(Ye=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ye}}}}return{circles:!R&&Ye||!xe?[]:Q,offscreen:Fe,collisionDetected:Ye}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let m=1/0,b=1/0,x=-1/0,E=-1/0;for(const L of s){const z=new d.pointGeometry(L.x+Wt,L.y+Wt);m=Math.min(m,z.x),b=Math.min(b,z.y),x=Math.max(x,z.x),E=Math.max(E,z.y),h.push(z)}const S=this.grid.query(m,b,x,E).concat(this.ignoredGrid.query(m,b,x,E)),k={},R={};for(const L of S){const z=L.key;if(void 0===k[z.bucketInstanceId]&&(k[z.bucketInstanceId]={}),k[z.bucketInstanceId][z.featureIndex])continue;const $=[new d.pointGeometry(L.x1,L.y1),new d.pointGeometry(L.x2,L.y1),new d.pointGeometry(L.x2,L.y2),new d.pointGeometry(L.x1,L.y2)];d.polygonIntersectsPolygon(h,$)&&(k[z.bucketInstanceId][z.featureIndex]=!0,void 0===R[z.bucketInstanceId]&&(R[z.bucketInstanceId]=[]),R[z.bucketInstanceId].push(z.featureIndex))}return R}insertCollisionBox(s,h,m,b,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,m,b,x){const E=h?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:b,collisionGroupID:x};for(let k=0;k<s.length;k+=4)E.insertCircle(S,s[k],s[k+1],s[k+2])}projectAndGetPerspectiveRatio(s,h,m,b,x){const E=[h,m,b||0,1];let S=!1;if(b||this.transform.pitch>0){d.transformMat4(E,E,s);let k=!1;this.fogState&&x&&(k=function(R,L,z,$,H,J){const Q=J.calculateFogTileMatrix(H),le=[L,z,$];return d.transformMat4$1(le,le,Q),ea(R,le,J.pitch,J._fov)}(this.fogState,h,m,b||0,x.toUnwrapped(),this.transform)>.9),S=E[2]>E[3]||k}else Ll(E,E,s);return{point:new d.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+Wt,(-E[1]/E[3]+1)/2*this.transform.height+Wt),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:S}}isOffscreen(s,h,m,b){return m<Wt||s>=this.screenRightBoundary||b<Wt||h>this.screenBottomBoundary}isInsideGrid(s,h,m,b){return m>=0&&s<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=d.identity([]);return d.translate(s,s,[-100,-100,0]),s}}class bu{constructor(s,h,m,b){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):b&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Tt{constructor(s,h,m,b,x){this.text=new bu(s?s.text:null,h,m,x),this.icon=new bu(s?s.icon:null,h,b,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rr{constructor(s,h,m){this.text=s,this.icon=h,this.skipFade=m}}class Zd{constructor(){this.invProjMatrix=d.create$1(),this.viewportMatrix=d.create$1(),this.circles=[]}}class $o{constructor(s,h,m,b,x){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=x}}class Li{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[s]}}function Ac(g,s,h,m,b){const{horizontalAlign:x,verticalAlign:E}=d.getAnchorAlignment(g),S=-(x-.5)*s,k=-(E-.5)*h,R=d.evaluateVariableOffset(g,m);return new d.pointGeometry(S+R[0]*b,k+R[1]*b)}function _r(g,s,h,m,b){const x=new d.pointGeometry(g,s);return h&&x._rotate(m?b:-b),x}class ti{constructor(s,h,m,b,x){this.transform=s.clone(),this.collisionIndex=new vu(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Li(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,m,b){const x=m.getBucket(h),E=m.latestFeatureIndex;if(!x||!E||h.id!==x.layerIds[0])return;const S=m.collisionBoxArray,k=x.layers[0].layout,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),L=m.tileSize/d.EXTENT,z=this.transform.calculateProjMatrix(m.tileID.toUnwrapped()),$="map"===k.get("text-pitch-alignment"),H="map"===k.get("text-rotation-alignment"),J=fi(m,1,this.transform.zoom),Q=nn(z,$,H,this.transform,J);let le=null;if($){const te=wi(z,$,H,this.transform,J);le=d.multiply([],this.transform.labelPlaneMatrix,te)}this.retainedQueryData[x.bucketInstanceId]=new $o(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,m.tileID);const X={bucket:x,layout:k,posMatrix:z,textLabelPlaneMatrix:Q,labelToScreenMatrix:le,scale:R,textPixelRatio:L,holdingForFade:m.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(b)for(const te of x.sortKeyRanges){const{sortKey:se,symbolInstanceStart:he,symbolInstanceEnd:_e}=te;s.push({sortKey:se,symbolInstanceStart:he,symbolInstanceEnd:_e,parameters:X})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:X})}attemptAnchorPlacement(s,h,m,b,x,E,S,k,R,L,z,$,H,J,Q,le,X,te){const se=[$.textOffset0,$.textOffset1],he=Ac(s,m,b,se,x),_e=this.collisionIndex.placeCollisionBox(x,h,_r(he.x,he.y,E,S,this.transform.angle),z,k,R,L.predicate);if((!le||0!==this.collisionIndex.placeCollisionBox(J.getSymbolInstanceIconSize(te,this.transform.zoom,H),le,_r(he.x,he.y,E,S,this.transform.angle),z,k,R,L.predicate).box.length)&&_e.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:se,width:m,height:b,anchor:s,textScale:x,prevAnchor:oe},this.markUsedJustification(J,s,$,Q),J.allowVerticalPlacement&&(this.markUsedOrientation(J,Q,$),this.placedOrientations[$.crossTileID]=Q),{shift:he,placedGlyphBoxes:_e}}}placeLayerBucketPart(s,h,m,b){const{bucket:x,layout:E,posMatrix:S,textLabelPlaneMatrix:k,labelToScreenMatrix:R,textPixelRatio:L,holdingForFade:z,collisionBoxArray:$,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:J,collisionGroup:Q}=s.parameters,le=E.get("text-optional"),X=E.get("icon-optional"),te=E.get("text-allow-overlap"),se=E.get("icon-allow-overlap"),he="map"===E.get("text-rotation-alignment"),_e="map"===E.get("text-pitch-alignment"),oe="none"!==E.get("icon-text-fit"),we="viewport-y"===E.get("symbol-z-order"),ze=te&&(se||!x.hasIconData()||X),Ye=se&&(te||!x.hasTextData()||le);!x.collisionArrays&&$&&x.deserializeCollisionBoxes($),m&&b&&x.updateCollisionDebugBuffers(this.transform.zoom,$);const xe=(Fe,gt,mt)=>{if(h[Fe.crossTileID])return;if(z)return void(this.placements[Fe.crossTileID]=new Rr(!1,!1,!1));let _t=!1,it=!1,vt=!0,Xt=null,$t={box:null,offscreen:null},bi={box:null,offscreen:null},li=null,Zt=null,rn=null,mi=0,Io=0,ao=0;mt.textFeatureIndex?mi=mt.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(mi=Fe.featureIndex),mt.verticalTextFeatureIndex&&(Io=mt.verticalTextFeatureIndex);const Gi=kn=>{kn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||kn.elevation)&&(kn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,kn.tileAnchorX,kn.tileAnchorY):0)},Xr=mt.textBox;if(Xr){Gi(Xr);const kn=Tn=>{let Zn=d.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Tn&&this.prevPlacement){const Yi=this.prevPlacement.placedOrientations[Fe.crossTileID];Yi&&(this.placedOrientations[Fe.crossTileID]=Yi,Zn=Yi,this.markUsedOrientation(x,Zn,Fe))}return Zn},fn=(Tn,Zn)=>{if(x.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(const Yi of x.writingModes)if(Yi===d.WritingMode.vertical?($t=Zn(),bi=$t):$t=Tn(),$t&&$t.box&&$t.box.length)break}else $t=Tn()};if(E.get("text-variable-anchor")){let Tn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Fe.crossTileID]){const zn=this.prevPlacement.variableOffsets[Fe.crossTileID];Tn.indexOf(zn.anchor)>0&&(Tn=Tn.filter(ki=>ki!==zn.anchor),Tn.unshift(zn.anchor))}const Zn=(zn,ki,wr)=>{const Ao=x.getSymbolInstanceTextSize(H,Fe,this.transform.zoom,gt),bs=(zn.x2-zn.x1)*Ao+2*zn.padding,hf=(zn.y2-zn.y1)*Ao+2*zn.padding,$h=oe&&!se?ki:null;$h&&Gi($h);let nl={box:[],offscreen:!1};const Jp=te?2*Tn.length:Tn.length;for(let Zc=0;Zc<Jp;++Zc){const Yt=this.attemptAnchorPlacement(Tn[Zc%Tn.length],zn,bs,hf,Ao,he,_e,L,S,Q,Zc>=Tn.length,Fe,gt,x,wr,$h,H,J);if(Yt&&(nl=Yt.placedGlyphBoxes,nl&&nl.box&&nl.box.length)){_t=!0,Xt=Yt.shift;break}}return nl};fn(()=>Zn(Xr,mt.iconBox,d.WritingMode.horizontal),()=>{const zn=mt.verticalTextBox;return zn&&Gi(zn),x.allowVerticalPlacement&&!($t&&$t.box&&$t.box.length)&&Fe.numVerticalGlyphVertices>0&&zn?Zn(zn,mt.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),$t&&(_t=$t.box,vt=$t.offscreen);const Yi=kn($t&&$t.box);if(!_t&&this.prevPlacement){const zn=this.prevPlacement.variableOffsets[Fe.crossTileID];zn&&(this.variableOffsets[Fe.crossTileID]=zn,this.markUsedJustification(x,zn.anchor,Fe,Yi))}}else{const Tn=(Zn,Yi)=>{const zn=x.getSymbolInstanceTextSize(H,Fe,this.transform.zoom,gt),ki=this.collisionIndex.placeCollisionBox(zn,Zn,new d.pointGeometry(0,0),te,L,S,Q.predicate);return ki&&ki.box&&ki.box.length&&(this.markUsedOrientation(x,Yi,Fe),this.placedOrientations[Fe.crossTileID]=Yi),ki};fn(()=>Tn(Xr,d.WritingMode.horizontal),()=>{const Zn=mt.verticalTextBox;return x.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&Zn?(Gi(Zn),Tn(Zn,d.WritingMode.vertical)):{box:null,offscreen:null}}),kn($t&&$t.box&&$t.box.length)}}if(li=$t,_t=li&&li.box&&li.box.length>0,vt=li&&li.offscreen,Fe.useRuntimeCollisionCircles){const kn=x.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex>=0?Fe.centerJustifiedTextSymbolIndex:Fe.verticalPlacedTextSymbolIndex),fn=d.evaluateSizeForFeature(x.textSizeData,H,kn),Tn=E.get("text-padding");Zt=this.collisionIndex.placeCollisionCircles(te,kn,x.lineVertexArray,x.glyphOffsetArray,fn,S,k,R,m,_e,Q.predicate,Fe.collisionCircleDiameter*fn/d.ONE_EM,Tn,this.retainedQueryData[x.bucketInstanceId].tileID),_t=te||Zt.circles.length>0&&!Zt.collisionDetected,vt=vt&&Zt.offscreen}if(mt.iconFeatureIndex&&(ao=mt.iconFeatureIndex),mt.iconBox){const kn=fn=>{Gi(fn);const Tn=oe&&Xt?_r(Xt.x,Xt.y,he,_e,this.transform.angle):new d.pointGeometry(0,0),Zn=x.getSymbolInstanceIconSize(J,this.transform.zoom,gt);return this.collisionIndex.placeCollisionBox(Zn,fn,Tn,se,L,S,Q.predicate)};bi&&bi.box&&bi.box.length&&mt.verticalIconBox?(rn=kn(mt.verticalIconBox),it=rn.box.length>0):(rn=kn(mt.iconBox),it=rn.box.length>0),vt=vt&&rn.offscreen}const Xo=le||0===Fe.numHorizontalGlyphVertices&&0===Fe.numVerticalGlyphVertices,vs=X||0===Fe.numIconVertices;if(Xo||vs?vs?Xo||(it=it&&_t):_t=it&&_t:it=_t=it&&_t,_t&&li&&li.box&&this.collisionIndex.insertCollisionBox(li.box,E.get("text-ignore-placement"),x.bucketInstanceId,bi&&bi.box&&Io?Io:mi,Q.ID),it&&rn&&this.collisionIndex.insertCollisionBox(rn.box,E.get("icon-ignore-placement"),x.bucketInstanceId,ao,Q.ID),Zt&&(_t&&this.collisionIndex.insertCollisionCircles(Zt.circles,E.get("text-ignore-placement"),x.bucketInstanceId,mi,Q.ID),m)){const kn=x.bucketInstanceId;let fn=this.collisionCircleArrays[kn];void 0===fn&&(fn=this.collisionCircleArrays[kn]=new Zd);for(let Tn=0;Tn<Zt.circles.length;Tn+=4)fn.circles.push(Zt.circles[Tn+0]),fn.circles.push(Zt.circles[Tn+1]),fn.circles.push(Zt.circles[Tn+2]),fn.circles.push(Zt.collisionDetected?1:0)}this.placements[Fe.crossTileID]=new Rr(_t||ze,it||Ye,vt||x.justReloaded),h[Fe.crossTileID]=!0};if(we){const Fe=x.getSortedSymbolIndexes(this.transform.angle);for(let gt=Fe.length-1;gt>=0;--gt){const mt=Fe[gt];xe(x.symbolInstances.get(mt),mt,x.collisionArrays[mt])}}else for(let Fe=s.symbolInstanceStart;Fe<s.symbolInstanceEnd;Fe++)xe(x.symbolInstances.get(Fe),Fe,x.collisionArrays[Fe]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[x.bucketInstanceId];d.invert(Fe.invProjMatrix,S),Fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,h,m,b){let x;x=b===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(h)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=x>=0&&S!==x?0:m.crossTileID)}markUsedOrientation(s,h,m){const b=h===d.WritingMode.horizontal||h===d.WritingMode.horizontalOnly?h:0,x=h===d.WritingMode.vertical?h:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const S of E)s.text.placedSymbolArray.get(S).placedOrientation=b;m.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(s):1,x=h?h.opacities:{},E=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const k in this.placements){const R=this.placements[k],L=x[k];L?(this.opacities[k]=new Tt(L,b,R.text,R.icon),m=m||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[k]=new Tt(null,b,R.text,R.icon,R.skipFade),m=m||R.text||R.icon)}for(const k in x){const R=x[k];if(!this.opacities[k]){const L=new Tt(R,b,!1,!1);L.isHidden()||(this.opacities[k]=L,m=m||R.text.placed||R.icon.placed)}}for(const k in E)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=E[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);m?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const m={};for(const b of h){const x=b.getBucket(s);x&&b.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,b.collisionBoxArray)}}updateBucketOpacities(s,h,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const b=s.layers[0].layout,x=new Tt(null,0,!1,!1,!0),E=b.get("text-allow-overlap"),S=b.get("icon-allow-overlap"),k=b.get("text-variable-anchor"),R="map"===b.get("text-rotation-alignment"),L="map"===b.get("text-pitch-alignment"),z="none"!==b.get("icon-text-fit"),$=new Tt(null,0,E&&(S||!s.hasIconData()||b.get("icon-optional")),S&&(E||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const H=(J,Q,le)=>{for(let X=0;X<Q/4;X++)J.opacityVertexArray.emplaceBack(le)};for(let J=0;J<s.symbolInstances.length;J++){const Q=s.symbolInstances.get(J),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:X,crossTileID:te}=Q;let se=this.opacities[te];h[te]?se=x:se||(se=$,this.opacities[te]=se),h[te]=!0;const he=Q.numIconVertices>0,_e=this.placedOrientations[Q.crossTileID],oe=_e===d.WritingMode.vertical,we=_e===d.WritingMode.horizontal||_e===d.WritingMode.horizontalOnly;if(le>0||X>0){const ze=To(se.text);H(s.text,le,oe?Bl:ze),H(s.text,X,we?Bl:ze);const Ye=se.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(gt=>{gt>=0&&(s.text.placedSymbolArray.get(gt).hidden=Ye||oe?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Ye||we?1:0);const xe=this.variableOffsets[Q.crossTileID];xe&&this.markUsedJustification(s,xe.anchor,Q,_e);const Fe=this.placedOrientations[Q.crossTileID];Fe&&(this.markUsedJustification(s,"left",Q,Fe),this.markUsedOrientation(s,Fe,Q))}if(he){const ze=To(se.icon);Q.placedIconSymbolIndex>=0&&(H(s.icon,Q.numIconVertices,oe?Bl:ze),s.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=se.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(H(s.icon,Q.numVerticalIconVertices,we?Bl:ze),s.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const ze=s.collisionArrays[J];if(ze){let Ye=new d.pointGeometry(0,0);if(ze.textBox||ze.verticalTextBox){let Fe=!0;if(k){const gt=this.variableOffsets[te];gt?(Ye=Ac(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textScale),R&&Ye._rotate(L?this.transform.angle:-this.transform.angle)):Fe=!1}ze.textBox&&kc(s.textCollisionBox.collisionVertexArray,se.text.placed,!Fe||oe,Ye.x,Ye.y),ze.verticalTextBox&&kc(s.textCollisionBox.collisionVertexArray,se.text.placed,!Fe||we,Ye.x,Ye.y)}const xe=Boolean(!we&&ze.verticalIconBox);ze.iconBox&&kc(s.iconCollisionBox.collisionVertexArray,se.icon.placed,xe,z?Ye.x:0,z?Ye.y:0),ze.verticalIconBox&&kc(s.iconCollisionBox.collisionVertexArray,se.icon.placed,!xe,z?Ye.x:0,z?Ye.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=J.invProjMatrix,s.placementViewportMatrix=J.viewportMatrix,s.collisionCircleArray=J.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function kc(g,s,h,m,b){g.emplaceBack(s?1:0,h?1:0,m||0,b||0),g.emplaceBack(s?1:0,h?1:0,m||0,b||0),g.emplaceBack(s?1:0,h?1:0,m||0,b||0),g.emplaceBack(s?1:0,h?1:0,m||0,b||0)}const ps=Math.pow(2,25),Ci=Math.pow(2,24),xu=Math.pow(2,17),jp=Math.pow(2,16),sa=Math.pow(2,9),Hp=Math.pow(2,8),jn=Math.pow(2,1);function To(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const s=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ps+s*Ci+h*xu+s*jp+h*sa+s*Hp+h*jn+s}const Bl=0;class io{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&void 0!==s.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,m,b,x){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,b,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<E.length;){const S=E[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,m,0===S.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class Wn{constructor(s,h,m,b,x,E,S,k){this.placement=new ti(s,x,E,S,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,h,m){const b=d.exported.now(),x=()=>{const E=d.exported.now()-b;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new io(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ua=512/d.EXTENT/2;class Dh{constructor(s,h,m){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let b=0;b<h.length;b++){const x=h.get(b),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,s)})}}getScaledCoordinates(s,h){const m=Ua/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*d.EXTENT+s.tileAnchorX)*m),y:Math.floor((h.canonical.y*d.EXTENT+s.tileAnchorY)*m)}}findMatches(s,h,m){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let x=0;x<s.length;x++){const E=s.get(x);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const k=this.getScaledCoordinates(E,h);for(const R of S)if(Math.abs(R.coord.x-k.x)<=b&&Math.abs(R.coord.y-k.y)<=b&&!m[R.crossTileID]){m[R.crossTileID]=!0,E.crossTileID=R.crossTileID;break}}}}class Eh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(0!==h)for(const m in this.indexes){const b=this.indexes[m],x={};for(const E in b){const S=b[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),x[S.tileID.key]=S}this.indexes[m]=x}this.lng=s}addBucket(s,h,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<h.symbolInstances.length;x++)h.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const b=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>s.overscaledZ)for(const S in E){const k=E[S];k.tileID.isChildOf(s)&&k.findMatches(h.symbolInstances,s,b)}else{const S=E[s.scaledTo(Number(x)).key];S&&S.findMatches(h.symbolInstances,s,b)}}for(let x=0;x<h.symbolInstances.length;x++){const E=h.symbolInstances.get(x);E.crossTileID||(E.crossTileID=m.generate(),b[E.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Dh(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const m in h.indexedSymbolInstances)for(const b of h.indexedSymbolInstances[m])delete this.usedCrossTileIDs[s][b.crossTileID]}removeStaleBuckets(s){let h=!1;for(const m in this.indexes){const b=this.indexes[m];for(const x in b)s[b[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[x]),delete b[x],h=!0)}return h}}class Xd{constructor(){this.layerIndexes={},this.crossTileIDs=new Eh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,m){let b=this.layerIndexes[s.id];void 0===b&&(b=this.layerIndexes[s.id]=new wu);let x=!1;const E={};b.handleWrapJump(m);for(const S of h){const k=S.getBucket(s);k&&s.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(S.tileID,k,this.crossTileIDs)&&(x=!0),E[k.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(s){const h={};s.forEach(m=>{h[m]=!0});for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}const ro=(g,s)=>d.emitValidationErrors(g,s&&s.filter(h=>"source.canvas"!==h.identifier)),Pc=d.pick(ge,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Yd=d.pick(ge,["setCenter","setZoom","setBearing","setPitch"]),si=function(){const g={},s=d.spec.$version;for(const h in d.spec.$root){const m=d.spec.$root[h];if(m.required){let b=null;b="version"===h?s:"array"===m.type?[]:{},null!=b&&(g[h]=b)}}return g}(),Th={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Mo extends d.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Rt(lt(),this),this.imageManager=new Ai,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(s._requestManager,h.localFontFamily?d.LocalGlyphMode.all:h.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new Xd,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=Mo.registerForPluginStateChange(b=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(x,E)=>{if(d.triggerPluginCompletionEvent(x),E&&E.every(S=>S))for(const S in m._sourceCaches){const k=m._sourceCaches[S],R=k.getSource().type;"vector"!==R&&"geojson"!==R||k.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const x=this.getSource(b.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const S=this._layers[E];S.source===x.id&&this._validateLayer(S)}})}loadURL(s,h={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof h.validate?h.validate:!d.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const b=this.map._requestManager.transformRequest(s,d.ResourceType.Style);this._request=d.getJSON(b,(x,E)=>{this._request=null,x?this.fire(new d.ErrorEvent(x)):E&&this._load(E,m)})}loadJSON(s,h={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(s,!1!==h.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(si,!1)}_updateLayerCount(s,h){const m=h?1:-1;s.is3D()&&(this._num3DLayers+=m),"circle"===s.type&&(this._numCircleLayers+=m),"symbol"===s.type&&(this._numSymbolLayers+=m)}_load(s,h){if(h&&ro(this,d.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const b in s.sources)this.addSource(b,s.sources[b],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const m=Ct(this.stylesheet.layers);this._order=m.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of m)b=d.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Bt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,m,b){let x,E,S;const k=d.exported.devicePixelRatio>1?"@2x":"";let R=d.getJSON(m.transformRequest(m.normalizeSpriteURL(h,k,".json"),d.ResourceType.SpriteJSON),($,H)=>{R=null,S||(S=$,x=H,z())}),L=d.getImage(m.transformRequest(m.normalizeSpriteURL(h,k,".png"),d.ResourceType.SpriteImage),($,H)=>{L=null,S||(S=$,E=H,z())});function z(){if(S)b(S);else if(x&&E){const $=d.exported.getImageData(E),H={};for(const J in x){const{width:Q,height:le,x:X,y:te,sdf:se,pixelRatio:he,stretchX:_e,stretchY:oe,content:we}=x[J],ze=new d.RGBAImage({width:Q,height:le});d.RGBAImage.copy($,ze,{x:X,y:te},{x:0,y:0},{width:Q,height:le}),H[J]={data:ze,pixelRatio:he,sdf:se,stretchX:_e,stretchY:oe,content:we}}b(null,H)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(s,this.map._requestManager,(h,m)=>{if(this._spriteRequest=null,h)this.fire(new d.ErrorEvent(h));else if(m)for(const b in m)this.imageManager.addImage(b,m[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const m=s.sourceLayer;m&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const m of s){const b=this._layers[m];"custom"!==b.type&&h.push(b.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&Th[s.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(b.length||x.length)&&this._updateWorkerLayers(b,x);for(const E in this._updatedSources){const S=this._updatedSources[E];"reload"===S?this._reloadSource(E):"clear"===S&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const m={};for(const b in this._sourceCaches){const x=this._sourceCaches[b];m[b]=x.used,x.used=!1}for(const b of this._order){const x=this._layers[b];if(x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)){const S=this._getLayerSourceCache(x);S&&(S.used=!0)}const E=this.map.painter;if(E){const S=x.getProgramIds();if(!S)continue;const k=x.getProgramConfiguration(s.zoom);for(const R of S)E.useProgram(R,k)}}for(const b in m){const x=this._sourceCaches[b];m[b]!==x.used&&x.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),ro(this,d.validateStyle(s)))return!1;(s=d.clone$2(s)).layers=Ct(s.layers);const h=function(b,x){if(!b)return[{command:ge.setStyle,args:[x]}];let E=[];try{if(!q(b.version,x.version))return[{command:ge.setStyle,args:[x]}];q(b.center,x.center)||E.push({command:ge.setCenter,args:[x.center]}),q(b.zoom,x.zoom)||E.push({command:ge.setZoom,args:[x.zoom]}),q(b.bearing,x.bearing)||E.push({command:ge.setBearing,args:[x.bearing]}),q(b.pitch,x.pitch)||E.push({command:ge.setPitch,args:[x.pitch]}),q(b.sprite,x.sprite)||E.push({command:ge.setSprite,args:[x.sprite]}),q(b.glyphs,x.glyphs)||E.push({command:ge.setGlyphs,args:[x.glyphs]}),q(b.transition,x.transition)||E.push({command:ge.setTransition,args:[x.transition]}),q(b.light,x.light)||E.push({command:ge.setLight,args:[x.light]}),q(b.fog,x.fog)||E.push({command:ge.setFog,args:[x.fog]});const S={},k=[];!function(z,$,H,J){let Q;for(Q in $=$||{},z=z||{})z.hasOwnProperty(Q)&&($.hasOwnProperty(Q)||Vt(Q,H,J));for(Q in $)$.hasOwnProperty(Q)&&(z.hasOwnProperty(Q)?q(z[Q],$[Q])||("geojson"===z[Q].type&&"geojson"===$[Q].type&&Ht(z,$,Q)?H.push({command:ge.setGeoJSONSourceData,args:[Q,$[Q].data]}):zt(Q,$,H,J)):Oe(Q,$,H))}(b.sources,x.sources,k,S);const R=[];b.layers&&b.layers.forEach(z=>{S[z.source]?E.push({command:ge.removeLayer,args:[z.id]}):R.push(z)});let L=b.terrain;L&&S[L.source]&&(E.push({command:ge.setTerrain,args:[void 0]}),L=void 0),E=E.concat(k),q(L,x.terrain)||E.push({command:ge.setTerrain,args:[x.terrain]}),function(z,$,H){$=$||[];const J=(z=z||[]).map(vn),Q=$.map(vn),le=z.reduce(oi,{}),X=$.reduce(oi,{}),te=J.slice(),se=Object.create(null);let he,_e,oe,we,ze,Ye,xe;for(he=0,_e=0;he<J.length;he++)oe=J[he],X.hasOwnProperty(oe)?_e++:(H.push({command:ge.removeLayer,args:[oe]}),te.splice(te.indexOf(oe,_e),1));for(he=0,_e=0;he<Q.length;he++)oe=Q[Q.length-1-he],te[te.length-1-he]!==oe&&(le.hasOwnProperty(oe)?(H.push({command:ge.removeLayer,args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-_e),1)):_e++,Ye=te[te.length-he],H.push({command:ge.addLayer,args:[X[oe],Ye]}),te.splice(te.length-he,0,oe),se[oe]=!0);for(he=0;he<Q.length;he++)if(oe=Q[he],we=le[oe],ze=X[oe],!se[oe]&&!q(we,ze))if(q(we.source,ze.source)&&q(we["source-layer"],ze["source-layer"])&&q(we.type,ze.type)){for(xe in Fn(we.layout,ze.layout,H,oe,null,ge.setLayoutProperty),Fn(we.paint,ze.paint,H,oe,null,ge.setPaintProperty),q(we.filter,ze.filter)||H.push({command:ge.setFilter,args:[oe,ze.filter]}),q(we.minzoom,ze.minzoom)&&q(we.maxzoom,ze.maxzoom)||H.push({command:ge.setLayerZoomRange,args:[oe,ze.minzoom,ze.maxzoom]}),we)we.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&(0===xe.indexOf("paint.")?Fn(we[xe],ze[xe],H,oe,xe.slice(6),ge.setPaintProperty):q(we[xe],ze[xe])||H.push({command:ge.setLayerProperty,args:[oe,xe,ze[xe]]}));for(xe in ze)ze.hasOwnProperty(xe)&&!we.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&(0===xe.indexOf("paint.")?Fn(we[xe],ze[xe],H,oe,xe.slice(6),ge.setPaintProperty):q(we[xe],ze[xe])||H.push({command:ge.setLayerProperty,args:[oe,xe,ze[xe]]}))}else H.push({command:ge.removeLayer,args:[oe]}),Ye=te[te.lastIndexOf(oe)+1],H.push({command:ge.addLayer,args:[ze,Ye]})}(R,x.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:ge.setStyle,args:[x]}]}return E}(this.serialize(),s).filter(b=>!(b.command in Yd));if(0===h.length)return!1;const m=h.filter(b=>!(b.command in Pc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(b=>b.command).join(", ")}.`);return h.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,m={}){if(this._checkLoaded(),void 0!==this.getSource(s))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,`sources.${s}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=U(s,h,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:b.serialize(),sourceId:s}));const x=E=>{const S=(E?"symbol:":"other:")+s,k=this._sourceCaches[S]=new d.SourceCache(S,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[s]=k,k.style=this,k.onAdd(this.map)};x(!1),"vector"!==h.type&&"geojson"!==h.type||x(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(void 0===h)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===s)return this.fire(new d.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new d.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(s);for(const b of m)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}addLayer(s,h,m={}){this._checkLoaded();const b=s.id;if(this.getLayer(b))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let x;if("custom"===s.type){if(ro(this,d.validateCustomStyleLayer(s)))return;x=d.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(b,s.source),s=d.clone$2(s),s=d.extend(s,{source:b})),this._validate(d.validateStyle.layer,`layers.${b}`,s,{arrayIndex:-1},m))return;x=d.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=h?this._order.indexOf(h):this._order.length;if(h&&-1===E)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=x;const S=this._getLayerSourceCache(x);if(this._removedLayers[b]&&x.source&&S&&"custom"!==x.type){const k=this._removedLayers[b];delete this._removedLayers[b],k.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const m=this._order.indexOf(s);this._order.splice(m,1);const b=h?this._order.indexOf(h):this._order.length;h&&-1===b?this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(b,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,m){this._checkLoaded();const b=this.getLayer(s);b?b.minzoom===h&&b.maxzoom===m||(null!=h&&(b.minzoom=h),null!=m&&(b.maxzoom=m),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,m={}){this._checkLoaded();const b=this.getLayer(s);if(b){if(!q(b.filter,h))return null==h?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(d.validateStyle.filter,`layers.${b.id}.filter`,h,null,m)||(b.filter=d.clone$2(h),this._updateLayer(b)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){return d.clone$2(this.getLayer(s).filter)}setLayoutProperty(s,h,m,b={}){this._checkLoaded();const x=this.getLayer(s);x?q(x.getLayoutProperty(h),m)||(x.setLayoutProperty(h,m,b),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const m=this.getLayer(s);if(m)return m.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,m,b={}){this._checkLoaded();const x=this.getLayer(s);x?q(x.getPaintProperty(h),m)||(x.setPaintProperty(h,m,b)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const m=s.source,b=s.sourceLayer,x=this.getSource(m);if(void 0===x)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const E=x.type;if("geojson"===E&&b)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!b)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===s.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const k of S)k.setFeatureState(b,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const m=s.source,b=this.getSource(m);if(void 0===b)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=b.type,E="vector"===x?s.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof s.id&&"number"!=typeof s.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const k of S)k.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,m=s.sourceLayer,b=this.getSource(h);if(void 0!==b){if("vector"!==b.type||m)return void 0===s.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(m,s.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const m=this._sourceCaches[h].getSource();s[m.id]||(s[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=E=>"fill-extrusion"===this._layers[E].type,m={},b=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S)){m[S]=E;for(const k of s){const R=k[S];if(R)for(const L of R)b.push(L)}}}b.sort((E,S)=>S.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S))for(let k=b.length-1;k>=0;k--){const R=b[k].feature;if(m[R.layer.id]<E)break;x.push(R),b.pop()}else for(const k of s){const R=k[S];if(R)for(const L of R)x.push(L.feature)}}return x}queryRenderedFeatures(s,h,m){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of h.layers){const R=this._layers[k];if(!R)return this.fire(new d.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b[R.source]=!0}}const x=[];h.availableImages=this._availableImages;const E=h&&h.layers?h.layers.some(k=>{const R=this.getLayer(k);return R&&R.is3D()}):this.has3DLayers(),S=Pa.createFromScreenPoints(s,m);for(const k in this._sourceCaches){const R=this._sourceCaches[k].getSource().id;h.layers&&!b[R]||x.push(ie(this._sourceCaches[k],this._layers,this._serializedLayers,S,h,m,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(k,R,L,z,$,H,J){const Q={},le=H.queryRenderedSymbols(z),X=[];for(const te of Object.keys(le).map(Number))X.push(J[te]);X.sort(Ce);for(const te of X){const se=te.featureIndex.lookupSymbolFeatures(le[te.bucketInstanceId],R,te.bucketIndex,te.sourceLayerIndex,$.filter,$.layers,$.availableImages,k);for(const he in se){const _e=Q[he]=Q[he]||[],oe=se[he];oe.sort((we,ze)=>{const Ye=te.featureSortOrder;if(Ye){const xe=Ye.indexOf(we.featureIndex);return Ye.indexOf(ze.featureIndex)-xe}return ze.featureIndex-we.featureIndex});for(const we of oe)_e.push(we)}}for(const te in Q)Q[te].forEach(se=>{const he=se.feature,_e=L(k[te]).getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=_e});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this._getSourceCaches(s);let b=[];for(const x of m)b=b.concat(de(x,h));return b}addSourceType(s,h,m){return Mo.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Mo.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const m=this.light.getLight();let b=!1;for(const E in s)if(!q(s[E],m[E])){b=!0;break}if(!b)return;const x={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(s){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof s.source){const h="terrain-dem-src";this.addSource(h,s.source),s=d.clone$2(s),s=d.extend(s,{source:h})}if(!this._validate(d.validateStyle.terrain,"terrain",s)){if(this.terrain){const h=this.terrain,m=h.get();for(const b in s)if(!q(s[b],m[b])){h.set(s),this.stylesheet.terrain=s;const x={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(x);break}}else this._createTerrain(s);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(s){const h=this.fog=new Vo(s);this.stylesheet.fog=s;const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,m=h.get();for(const b in s)if(!q(s[b],m[b])){h.set(s),this.stylesheet.fog=s;const x={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(x);break}}else this._createFog(s);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(m=>this.isLayerDraped(this._layers[m])),h=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s){const h=this.terrain=new qr(s);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(m)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];"fill-extrusion"===h.type&&this._updateLayer(h)}}_validate(s,h,m,b,x={}){return(!x||!1!==x.validate)&&ro(this,s.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:m,styleSpec:d.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const m of h)m.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const m of h)m.resume(),m.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,m,b,x=!1){let E=!1,S=!1;const k={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!k[L.source]){const $=this._getLayerSourceCache(L);if(!$)continue;k[L.source]=$.getRenderableIds(!0).map(H=>$.getTileByID(H)).sort((H,J)=>J.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(J.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(L,k[L.source],s.center.lng);E=E||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),s.zoom))&&(this.pauseablePlacement=new Wn(s,this._order,x,h,m,b,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,m){this.imageManager.getImages(h.icons,m),this._updateTilesForChangedImages();const b=x=>{x&&x.setDependencies(h.tileID.key,h.type,h.icons)};b(this._otherSourceCaches[h.source]),b(this._symbolSourceCaches[h.source])}getGlyphs(s,h,m){this.glyphManager.getGlyphs(h.stacks,m)}getResource(s,h,m){return d.makeRequest(h,m)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return"symbol"===s.type?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Mo.getSourceType=function(g){return F[g]},Mo.setSourceType=function(g,s){F[g]=s},Mo.registerForPluginStateChange=d.registerForPluginStateChange;var Cu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Du="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Dn={},jo={};Dn=Ut("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),jo=Ut("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Vl=Ut("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ut=Cu;var dr={background:Ut("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ut("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ut("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ut("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ut("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ut("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ut("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ut("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ut("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Ut("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ut("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ut("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ut("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ut("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ut("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ut("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ut("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ut("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ut("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ut("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ut("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:Ut("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Ut("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:Ut("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Ut("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ut("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Du),skyboxGradient:Ut("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Du),skyboxCapture:Ut("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ut("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:Ut("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Ut("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Ut(g,s,h){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=g.match(b),S=s.match(b),k=Cu.match(b);let R=S?S.concat(E):E;h||(Dn.staticUniforms&&(R=Dn.staticUniforms.concat(R)),jo.staticUniforms&&(R=jo.staticUniforms.concat(R))),R&&(R=R.concat(k));const L={};return{fragmentSource:g=g.replace(m,(z,$,H,J,Q)=>(L[Q]=!0,"define"===$?`\n#ifndef HAS_UNIFORM_u_${Q}\nvarying ${H} ${J} ${Q};\n#else\nuniform ${H} ${J} u_${Q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Q}\n    ${H} ${J} ${Q} = u_${Q};\n#endif\n`)),vertexSource:s=s.replace(m,(z,$,H,J,Q)=>{const le="float"===J?"vec2":"vec4",X=Q.match(/color/)?"color":le;return L[Q]?"define"===$?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${H} ${le} a_${Q};\nvarying ${H} ${J} ${Q};\n#else\nuniform ${H} ${J} u_${Q};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = a_${Q};\n#else\n    ${H} ${J} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${Q} = unpack_mix_${X}(a_${Q}, u_${Q}_t);\n#else\n    ${H} ${J} ${Q} = u_${Q};\n#endif\n`:"define"===$?`\n#ifndef HAS_UNIFORM_u_${Q}\nuniform lowp float u_${Q}_t;\nattribute ${H} ${le} a_${Q};\n#else\nuniform ${H} ${J} u_${Q};\n#endif\n`:"vec4"===X?`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${H} ${J} ${Q} = a_${Q};\n#else\n    ${H} ${J} ${Q} = u_${Q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Q}\n    ${H} ${J} ${Q} = unpack_mix_${X}(a_${Q}, u_${Q}_t);\n#else\n    ${H} ${J} ${Q} = u_${Q};\n#endif\n`}),staticAttributes:x,staticUniforms:R}}class Ho{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,m,b,x,E,S,k){this.context=s;let R=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!R&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(R=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===m&&!R&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===k?(s.bindVertexArrayOES.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),k&&k.bind()):this.freshBind(h,m,b,x,E,S,k)}freshBind(s,h,m,b,x,E,S){let k;const R=s.numAttributes,L=this.context,z=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{k=L.currentNumAttributes||0;for(let $=R;$<k;$++)z.disableVertexAttribArray($)}h.enableAttributes(z,s);for(const $ of m)$.enableAttributes(z,s);E&&E.enableAttributes(z,s),S&&S.enableAttributes(z,s),h.bind(),h.setVertexAttribPointers(z,s,x);for(const $ of m)$.bind(),$.setVertexAttribPointers(z,s,x);E&&(E.bind(),E.setVertexAttribPointers(z,s,x)),b&&b.bind(),S&&(S.bind(),S.setVertexAttribPointers(z,s,x)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fs(g,s){const h=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new d.MercatorCoordinate(0,m/h).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/h).toLngLat().lat]}function Fr(g,s,h,m,b,x,E){const S=g.context,k=S.gl,R=h.fbo;if(!R)return;g.prepareDrawTile(s);const L=g.useProgram("hillshade");S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.colorAttachment.get());const z=(($,H,J,Q)=>{const le=J.paint.get("hillshade-shadow-color"),X=J.paint.get("hillshade-highlight-color"),te=J.paint.get("hillshade-accent-color");let se=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===J.paint.get("hillshade-illumination-anchor")&&(se-=$.transform.angle);const he=!$.options.moving;return{u_matrix:Q||$.transform.calculateProjMatrix(H.tileID.toUnwrapped(),he),u_image:0,u_latrange:Fs(0,H.tileID),u_light:[J.paint.get("hillshade-exaggeration"),se],u_shadow:le,u_highlight:X,u_accent:te}})(g,h,m,g.terrain?s.projMatrix:null);g.prepareDrawProgram(S,L,s.toUnwrapped()),L.draw(S,k.TRIANGLES,b,x,E,d.CullFaceMode.disabled,z,m.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function zl(g,s,h){if(!s.needsDEMTextureUpload)return;const m=g.context,b=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||g.getTileTexture(h.stride);const x=h.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new d.Texture(m,x,b.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Qt(g,s,h,m,b,x){const E=g.context,S=E.gl;if(!s.dem)return;const k=s.dem;if(E.activeTexture.set(S.TEXTURE1),zl(g,s,k),!s.demTexture)return;s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const R=k.dim;E.activeTexture.set(S.TEXTURE0);let L=s.fbo;if(!L){const z=new d.Texture(E,{width:R,height:R,data:null},S.RGBA);z.bind(S.LINEAR,S.CLAMP_TO_EDGE),L=s.fbo=E.createFramebuffer(R,R,!0),L.colorAttachment.set(z.texture)}E.bindFramebuffer.set(L.framebuffer),E.viewport.set([0,0,R,R]),g.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,m,b,x,d.CullFaceMode.disabled,((z,$)=>{const H=$.stride,J=d.create$1();return d.ortho(J,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(J,J,[0,-d.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[H,H],u_zoom:z.overscaledZ,u_unpack:$.unpackVector}})(s.tileID,k),h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),s.needsHillshadePrepare=!1}const wt=(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_image0:new d.Uniform1i(g,s.u_image0),u_skirt_height:new d.Uniform1f(g,s.u_skirt_height)}),hn=(g,s)=>({u_matrix:g,u_image0:0,u_skirt_height:s}),ai=new class{constructor(){this.operations={}}newMorphing(g,s,h,m,b){if(g in this.operations){const x=this.operations[g];x.to.tileID.key!==h.tileID.key&&(x.queued=h)}else this.operations[g]={startTime:m,phase:0,duration:b,from:s,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const s=this.operations[g];return{from:s.from,to:s.to,phase:s.phase}}update(g){for(const s in this.operations){const h=this.operations[s];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[s];break}}}_nextOp(g,s){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=s,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Or={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Os(g,s){const h=1<<g.z;return!s&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const Bi=g=>({u_matrix:g});function aa(g,s,h,m,b){if(b>0){const x=d.exported.now(),E=(x-g.timeAdded)/b,S=s?(x-s.timeAdded)/b:-1,k=h.getSource(),R=m.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!s||Math.abs(s.tileID.overscaledZ-R)>Math.abs(g.tileID.overscaledZ-R),z=L&&g.refreshedUponExpiration?1:d.clamp(L?E:1-S,0,1);return g.refreshedUponExpiration&&E>=1&&(g.refreshedUponExpiration=!1),s?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class Vi extends d.SourceCache{constructor(s){const h=U("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Rt(lt(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,m){if(s.freezeTileCoverage)return;this.transform=s;const b=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const S=new d.Tile(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);S.state="loaded",this._tiles[E.key]=S}return x},{});for(const x in this._tiles)x in b||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const h=this.proxyCachedFBO[s];if(void 0!==h){const m=Object.values(h);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class la extends d.OverscaledTileID{constructor(s,h,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=m}}class ca extends d.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,b,x]=function(k){const R=new d.StructArrayLayout4i8,L=new d.StructArrayLayout3ui6,z=131;R.reserve(17161),L.reserve(33800);const $=d.EXTENT/128,H=d.EXTENT+$/2,J=H+$;for(let le=-$;le<J;le+=$)for(let X=-$;X<J;X+=$){const te=X<0||X>H||le<0||le>H?24575:0,se=d.clamp(Math.round(X),0,d.EXTENT),he=d.clamp(Math.round(le),0,d.EXTENT);R.emplaceBack(se+te,he,se,he)}const Q=(le,X)=>{const te=X*z+le;L.emplaceBack(te+1,te,te+z),L.emplaceBack(te+z,te+z+1,te+1)};for(let le=1;le<129;le++)for(let X=1;X<129;X++)Q(X,le);return[0,129].forEach(le=>{for(let X=0;X<130;X++)Q(X,le),Q(le,X)}),[R,L,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(m,hs.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,b.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vi(h.map),this.orthoMatrix=d.create$1(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const S=E.gl;this._overlapStencilMode=new d.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency()}update(s,h,m){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const b=s.terrain.properties;this.sourceCache=s._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const x=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.sourceCache.getSource().tileSize/128,S=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(h,E*S,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),h.updateElevation(!m),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==s.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&"source"===s.dataType?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):"style"===s.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=h.getIds().map(k=>{const R=h.getTileByID(k).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(k,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),z=new d.pointGeometry(L.x,L.y);k.sort(($,H)=>{if(H.overscaledZ-$.overscaledZ)return H.overscaledZ-$.overscaledZ;const J=new d.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),Q=new d.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),le=z.mult(1<<$.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(J)-le.distSqr(Q)})})(b,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const k in E){const R=E[k];if(!R.used||(R!==this.sourceCache&&(this._findCoveringTileCache[R.id]={}),this._setupProxiedCoordsForOrtho(R,s[k],x),R.usedForTerrain))continue;const L=s[k];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=b.map(k=>new la(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const S={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const R=this.terrainTileForTile[k.key];if(!R)continue;const L=R.tileID.key;L in S||(this._visibleDemTiles.push(R),S[L]=L)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const m=this._findTileCoveringTileID(h,this.sourceCache);m&&(this.terrainTileForTile[h.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const m in this.terrainTileForTile){const b=this.terrainTileForTile[m],x=b.dem;!x||b.demTexture&&!b.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),zl(this.painter,b,x))}}_prepareDemTileUniforms(s,h,m,b){if(!h||null==h.demTexture)return!1;const x=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-x.z),S=b||"";return m[`u_dem_tl${S}`]=[x.x*E%1,x.y*E%1],m[`u_dem_scale${S}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((m,b)=>{if(!b.dem)return m;const x=b.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const m=this._getLoadedAreaMinimum(),b={width:1,height:1,data:new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(b,{premultiply:!1}):x=this._emptyDEMTexture=new d.Texture(s,b,h.RGBA,{premultiply:!1}),x}setupElevationDraw(s,h,m){const b=this.painter.context,x=b.gl,E=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let k=null,R=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const z=m.morphing.srcDemTile,$=m.morphing.dstDemTile;L=m.morphing.phase,z&&$&&(this._prepareDemTileUniforms(s,z,E,"_prev")&&(R=z),this._prepareDemTileUniforms(s,$,E)&&(k=$))}if(R&&k?(b.activeTexture.set(x.TEXTURE2),k.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),b.activeTexture.set(x.TEXTURE4),R.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=L):(k=this.terrainTileForTile[s.tileID.key],b.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(s,k,E)?k.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST)),m&&m.useDepthForOcclusion&&(b.activeTexture.set(x.TEXTURE3),this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),m&&m.useMeterToDem&&k){const z=(1<<k.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=z}m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),h.setTerrainUniformValues(b,E)}renderToBackBuffer(s){const h=this.painter,m=this.painter.context;0!==s.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(b,x,E,S,k){const R=b.context,L=R.gl;let z,$;const H=b.options.showTerrainWireframe?2:0,J=(se,he)=>{if($===se)return;const _e=[Or[se]];he&&_e.push(Or[H]),z=b.useProgram("terrainRaster",null,_e),$=se},Q=b.colorModeForRenderPass(),le=new d.DepthMode(L.LEQUAL,d.DepthMode.ReadWrite,b.depthRangeFor3D);ai.update(k);const X=b.transform,te=6*Math.pow(1.5,22-X.zoom)*x.exaggeration();(H?[!1,!0]:[!1]).forEach(se=>{$=-1;const he=se?L.LINES:L.TRIANGLES,[_e,oe]=se?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const Ye of S){const xe=E.getTile(Ye),Fe=d.StencilMode.disabled,gt=x.prevTerrainTileForTile[Ye.key],mt=x.terrainTileForTile[Ye.key];ze=mt,null!=(we=gt)&&null!=ze&&we.hasData()&&ze.hasData()&&null!=we.demTexture&&null!=ze.demTexture&&we.tileID.key!==ze.tileID.key&&ai.newMorphing(Ye.key,gt,mt,k,250),R.activeTexture.set(L.TEXTURE0),xe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const _t=ai.getMorphValuesForProxy(Ye.key),it=_t?1:0;let vt;_t&&(vt={morphing:{srcDemTile:_t.from,dstDemTile:_t.to,phase:d.easeCubicInOut(_t.phase)}});const Xt=hn(Ye.projMatrix,Os(Ye.canonical,X.renderWorldCopies)?te/10:te);J(it,se),x.setupElevationDraw(xe,z,vt),b.prepareDrawProgram(R,z,Ye.toUnwrapped()),z.draw(R,he,le,Fe,Q,d.CullFaceMode.backCCW,Xt,"terrain_raster",x.gridBuffer,_e,oe)}var we,ze})}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,s.splice(0,s.length))}renderBatch(s){if(0===this._drapedRenderBatches.length)return s+1;this.renderingToTexture=!0;const h=this.painter,m=this.painter.context,b=this.proxySourceCache,x=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),S=[],k=h.style.order;let R=0;for(const L of x){const z=b.getTileByID(L.proxyTileKey),$=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][s]:void 0,H=void 0!==$?b.renderCache[$]:this.pool[R++],J=void 0!==$;if(z.texture=H.tex,J&&!H.dirty){S.push(z.tileID);continue}let Q;m.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(m.clear({color:d.Color.transparent}),H.dirty=!1);for(let le=E.start;le<=E.end;++le){const X=h.style._layers[k[le]];if(X.isHidden(h.transform.zoom))continue;const te=h.style._getLayerSourceCache(X),se=te?this.proxyToSource[L.key][te.id]:[L];if(!se)continue;const he=se;m.viewport.set([0,0,H.fb.width,H.fb.height]),Q!==(te?te.id:null)&&(this._setupStencil(H,se,X,te),Q=te?te.id:null),h.renderLayer(h,te,X,he)}this.renderedToTile?(H.dirty=!0,S.push(z.tileID)):J||--R,5===R&&(R=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(0===h)return{efficiency:100};let m,b=0,x=0,E=!1;for(let S=0;S<h;++S){const k=s._layers[s.order[S]];this._style.isLayerDraped(k)?(E&&++b,++x):E||(E=!0,m=k.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-b/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),0===s?s:(s-30)*this._exaggeration}raycast(s,h,m){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,S=Math.pow(2,E.overscaledZ),{x:k,y:R}=E.canonical,L=k/S,z=(k+1)/S,$=R/S,H=(R+1)/S;return{minx:L,miny:$,maxx:z,maxy:H,t:x.dem.tree.raycastRoot(L,$,z,H,s,h,m),tile:x}});b.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of b){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,h,m);if(null!=E)return E}return null}_createFBO(){const s=this.painter.context,h=s.gl,m=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const b=new d.Texture(s,{width:m[0],height:m[1],data:null},h.RGBA);b.bind(h.LINEAR,h.CLAMP_TO_EDGE);const x=s.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(b.texture),x.depthAttachment=new us(s,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],m=h.isHidden(this.painter.transform.zoom),b=h.getCrossfadeParameters(),x=!!b&&1!==b.t,E=h.hasTransition();return"custom"!==h.type&&!m&&(x||E)})}_clearRasterFadeFromRenderCache(){let s=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof qt){s=!0;break}if(s)for(let h=0;h<this._style.order.length;++h){const m=this._style._layers[this._style.order[h]],b=m.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(m);if("raster"!==m.type||b||!x)continue;const E=m.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][x.id];if(k)for(const R of k){const L=aa(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,E);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(0===h)return;const m=[];let b,x=0,E=this._style._layers[s[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<h;)E=this._style._layers[s[x]];for(;x<h;++x){const S=this._style._layers[s[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===b&&(b=x):void 0!==b&&(m.push({start:b,end:x-1}),b=void 0))}void 0!==b&&m.push({start:b,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<E.length;++S){const k=Object.values(E[S]);h.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,b=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const S=m[E];if(h.getTileByID(S.key),void 0!==h.proxyCachedFBO[S.key]){const k=s[S.key],R=this.proxyToSource[S.key];let L=0;for(const z in R){const $=R[z],H=k[z];if(!H||H.length!==$.length||$.some((J,Q)=>J!==H[Q]||b[z]&&b[z].hasOwnProperty(J.key))){L=-1;break}++L}for(const z in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][z]].dirty=L<0||L!==Object.values(k).length}}const x=[...this._drapedRenderBatches];x.sort((E,S)=>S.end-S.start-(E.end-E.start));for(const E of x)for(const S of m){if(h.proxyCachedFBO[S.key])continue;let k=h.renderCachePool.pop();void 0===k&&h.renderCache.length<50&&(k=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==k&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][E.start]=k,h.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,m,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(s,h){const m=this.painter,b=this.painter.context,x=b.gl;m._tileClippingMaskIDs={},b.setColorMode(d.ColorMode.disabled),b.setDepthMode(d.DepthMode.disabled);const E=m.useProgram("clippingMask");for(const S of s){const k=m._tileClippingMaskIDs[S.key]=--h;E.draw(b,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Bi(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const m=[s.x,s.y,1,1];d.transformMat4(m,m,h.pixelMatrixInverse),d.scale$2(m,m,1/m[3]),m[0]/=h.worldSize,m[1]/=h.worldSize;const b=h._camera.position,x=d.mercatorZfromAltitude(1,h.center.lat),E=[b[0],b[1],b[2]/x,0],S=d.subtract([],m.slice(0,3),E);d.normalize(S,S);const k=this.raycast(E,S,this._exaggeration);return null!==k&&k?(d.scaleAndAdd(E,E,S,k),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const s=this.painter,h=s.context,m=this.proxySourceCache,b=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=h.gl,S=h.createFramebuffer(b,x,!0);h.activeTexture.set(E.TEXTURE0);const k=new d.Texture(h,{width:b,height:x,data:null},E.RGBA);k.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.colorAttachment.set(k.texture);const R=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,b,x);S.depthAttachment.set(R),this._depthFBO=S,this._depthTexture=k}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,b,x]),function(E,S,k,R){const L=E.context,z=L.gl;L.clear({depth:1});const $=E.useProgram("terrainDepth"),H=new d.DepthMode(z.LESS,d.DepthMode.ReadWrite,E.depthRangeFor3D);for(const J of R){const Q=k.getTile(J),le=hn(J.projMatrix,0);S.setupElevationDraw(Q,$),$.draw(L,z.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,le,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,m){if(s.getSource()instanceof W)return this._setupProxiedCoordsForImageSource(s,h,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const b=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const k=x[S],R=this._findTileCoveringTileID(k,s);if(R){const L=this._createProxiedId(k,R,m[k.key]&&m[k.key][s.id]);b.push(L),this.proxyToSource[k.key][s.id]=[L]}}let E=!1;for(let S=0;S<h.length;S++){const k=s.getTile(h[S]);if(!k||!k.hasData())continue;const R=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][s.id],z=this._createProxiedId(R.tileID,k,m[R.tileID.key]&&m[R.tileID.key][s.id]);L?L.splice(L.length-1,0,z):this.proxyToSource[R.tileID.key][s.id]=[z],b.push(z),E=!0}}this._sourceTilesOverlap[s.id]=E}_setupProxiedCoordsForImageSource(s,h,m){if(!s.getSource().loaded())return;const b=this.proxiedCoords[s.id]=[],x=this.proxyCoords,E=s.getSource(),S=new d.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),k=E.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((L,z)=>(L.min.x=Math.min(L.min.x,z.x-S.x),L.min.y=Math.min(L.min.y,z.y-S.y),L.max.x=Math.max(L.max.x,z.x-S.x),L.max.y=Math.max(L.max.y,z.y-S.y),L),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,z)=>{const $=L.wrap+L.canonical.x/(1<<L.canonical.z),H=L.canonical.y/(1<<L.canonical.z),J=d.EXTENT/(1<<L.canonical.z),Q=z.wrap+z.canonical.x/(1<<z.canonical.z),le=z.canonical.y/(1<<z.canonical.z);return $+J<Q+k.min.x||$>Q+k.max.x||H+J<le+k.min.y||H>le+k.max.y};for(let L=0;L<x.length;L++){const z=x[L];for(let $=0;$<h.length;$++){const H=s.getTile(h[$]);if(!H||!H.hasData()||R(z,H.tileID))continue;const J=this._createProxiedId(z,H,m[z.key]&&m[z.key][s.id]),Q=this.proxyToSource[z.key][s.id];Q?Q.push(J):this.proxyToSource[z.key][s.id]=[J],b.push(J)}}}_createProxiedId(s,h,m){let b=this.orthoMatrix;if(m){const x=m.find(E=>E.key===h.tileID.key);if(x)return x}if(h.tileID.key!==s.key){const x=s.canonical.z-h.tileID.canonical.z;let E,S,k;b=d.create$1();const R=h.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(E=d.EXTENT>>x,S=E*((h.tileID.canonical.x<<x)-s.canonical.x+R),k=E*((h.tileID.canonical.y<<x)-s.canonical.y)):(E=d.EXTENT<<-x,S=d.EXTENT*(h.tileID.canonical.x-(s.canonical.x+R<<-x)),k=d.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-x))),d.ortho(b,0,E,0,E,0,1),d.translate(b,b,[S,k,0])}return new la(h.tileID,s.key,b)}_findTileCoveringTileID(s,h){let m=h.getTile(s);if(m&&m.hasData())return m;const b=this._findCoveringTileCache[h.id],x=b[s.key];if(m=x?h.getTileByID(x):null,m&&m.hasData()||null===x)return m;let E=m?m.tileID:s,S=E.overscaledZ;const k=h.getSource().minzoom,R=[];if(!x){const z=h.getSource().maxzoom;if(s.canonical.z>=z){const $=s.canonical.z-z;h.getSource().reparseOverscaled?(S=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new d.OverscaledTileID(S,s.wrap,z,s.canonical.x>>$,s.canonical.y>>$)):0!==$&&(S=z,E=new d.OverscaledTileID(S,s.wrap,z,s.canonical.x>>$,s.canonical.y>>$))}E.key!==s.key&&(R.push(E.key),m=h.getTile(E))}const L=z=>{R.forEach($=>{b[$]=z}),R.length=0};for(S-=1;S>=k&&(!m||!m.hasData());S--){m&&L(m.tileID.key);const z=E.calculateScaledKey(S);if(m=h.getTileByID(z),m&&m.hasData())break;const $=b[z];if(null===$)break;void 0===$?R.push(z):m=h.getTileByID($)}return L(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(s){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let m,b,x;const E=new d.StructArrayLayout2ui4,S=131;for(b=1;b<129;b++){for(m=1;m<129;m++)x=b*S+m,E.emplaceBack(x,x+1),E.emplaceBack(x,x+S),E.emplaceBack(x+1,x+S),128===b&&E.emplaceBack(x+S,x+S+1);E.emplaceBack(x+1,x+1+S)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function en(g){const s=[];for(let h=0;h<g.length;h++){if(null===g[h])continue;const m=g[h].split(" ");s.push(m.pop())}return s}class $a{static cacheKey(s,h,m){let b=`${s}${m?m.cacheKey:""}`;for(const x of h)b+=`/${x}`;return b}constructor(s,h,m,b,x,E){const S=s.gl;this.program=S.createProgram();const k=en(m.staticAttributes),R=b?b.getBinderAttributes():[],L=k.concat(R),z=m.staticUniforms?en(m.staticUniforms):[],$=b?b.getBinderUniforms():[],H=z.concat($),J=[];for(const _e of H)J.indexOf(_e)<0&&J.push(_e);let Q=b?b.defines():[];Q=Q.concat(E.map(_e=>`#define ${_e}`));const le=Q.concat(Vl.fragmentSource,ut,jo.fragmentSource,m.fragmentSource).join("\n"),X=Q.concat(Vl.vertexSource,ut,jo.vertexSource,Dn.vertexSource,m.vertexSource).join("\n"),te=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(te,le),S.compileShader(te),S.attachShader(this.program,te);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(se,X),S.compileShader(se),S.attachShader(this.program,se),this.attributes={};const he={};this.numAttributes=L.length;for(let _e=0;_e<this.numAttributes;_e++)L[_e]&&(S.bindAttribLocation(this.program,_e,L[_e]),this.attributes[L[_e]]=_e);S.linkProgram(this.program),S.deleteShader(se),S.deleteShader(te);for(let _e=0;_e<J.length;_e++){const oe=J[_e];if(oe&&!he[oe]){const we=S.getUniformLocation(this.program,oe);we&&(he[oe]=we)}}var _e,oe;this.fixedUniforms=x(s,he),this.binderUniforms=b?b.getUniforms(s,he):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(_e=s,(oe=he).u_dem),u_dem_prev:new d.Uniform1i(_e,oe.u_dem_prev),u_dem_unpack:new d.Uniform4f(_e,oe.u_dem_unpack),u_dem_tl:new d.Uniform2f(_e,oe.u_dem_tl),u_dem_scale:new d.Uniform1f(_e,oe.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(_e,oe.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(_e,oe.u_dem_scale_prev),u_dem_size:new d.Uniform1f(_e,oe.u_dem_size),u_dem_lerp:new d.Uniform1f(_e,oe.u_dem_lerp),u_exaggeration:new d.Uniform1f(_e,oe.u_exaggeration),u_depth:new d.Uniform1i(_e,oe.u_depth),u_depth_size_inv:new d.Uniform2f(_e,oe.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(_e,oe.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(_e,oe.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(_e,oe.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(_e,oe.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(_e,oe.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(_e,oe.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(_e,oe.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((_e,oe)=>({u_fog_matrix:new d.UniformMatrix4f(_e,oe.u_fog_matrix),u_fog_range:new d.Uniform2f(_e,oe.u_fog_range),u_fog_color:new d.Uniform4f(_e,oe.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(_e,oe.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(_e,oe.u_fog_temporal_offset)}))(s,he))}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in h)m[b].set(h[b])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const b in h)m[b].location&&m[b].set(h[b])}}draw(s,h,m,b,x,E,S,k,R,L,z,$,H,J,Q,le){const X=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(b),s.setColorMode(x),s.setCullFace(E);for(const se in this.fixedUniforms)this.fixedUniforms[se].set(S[se]);J&&J.setUniforms(s,this.binderUniforms,$,{zoom:H});const te={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[h];for(const se of z.get()){const he=se.vaos||(se.vaos={});(he[k]||(he[k]=new Ho)).bind(s,this,R,J?J.getPaintVertexBuffers():[],L,se.vertexOffset,Q,le),X.drawElements(h,se.primitiveLength*te,X.UNSIGNED_SHORT,se.primitiveOffset*te*2)}}}function ua(g,s,h){const m=1/fi(h,1,s.transform.tileZoom),b=Math.pow(2,h.tileID.overscaledZ),x=h.tileSize*Math.pow(2,s.transform.tileZoom)/b,E=x*(h.tileID.canonical.x+h.tileID.wrap*b),S=x*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const Nc=(g,s,h,m)=>{const b=s.style.light,x=b.properties.get("position"),E=[x.x,x.y,x.z],S=d.create$2();"viewport"===b.properties.get("anchor")&&(d.fromRotation(S,-s.transform.angle),d.transformMat3(E,E,S));const k=b.properties.get("color");return{u_matrix:g,u_lightpos:E,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+h,u_opacity:m}},Ul=(g,s,h,m,b,x,E)=>d.extend(Nc(g,s,h,m),ua(x,s,E),{u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8}),Xi=g=>({u_matrix:g}),gs=(g,s,h,m)=>d.extend(Xi(g),ua(h,s,m)),ja=(g,s)=>({u_matrix:g,u_world:s}),Di=(g,s,h,m,b)=>d.extend(gs(g,s,h,m),{u_world:b}),ni=(g,s,h,m)=>{const b=g.transform;let x;if("map"===m.paint.get("circle-pitch-alignment")){const E=fi(h,1,b.zoom);x=[E,E]}else x=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:g.translatePosMatrix(s.projMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:x}},Eu=g=>{const s=[];return"map"===g.paint.get("circle-pitch-alignment")&&s.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&s.push("SCALE_WITH_MAP"),s},Tu=(g,s,h)=>{const m=d.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:s.cameraToCenterDistance,u_extrude_scale:[s.pixelsToGLUnits[0]/m,s.pixelsToGLUnits[1]/m]}},Ha=(g,s,h=1)=>({u_matrix:g,u_color:s,u_overlay:0,u_overlay_scale:h}),Rc=(g,s,h,m)=>({u_matrix:g,u_extrude_scale:fi(s,1,h),u_intensity:m}),ha=(g,s,h,m,b,x)=>{const E=g.transform,S={u_matrix:Hi(g,s,h,b),u_ratio:1/fi(s,1,E.zoom),u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(So(h)){const k=ms(s,g.transform);S.u_texsize=s.lineAtlasTexture.size,S.u_scale=[k,m.fromScale,m.toScale],S.u_mix=m.t}return S},$l=(g,s,h,m,b)=>{const x=g.transform,E=ms(s,x);return{u_matrix:Hi(g,s,h,b),u_texsize:s.imageAtlasTexture.size,u_ratio:1/fi(s,1,x.zoom),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}};function ms(g,s){return 1/fi(g,1,s.tileZoom)}function Hi(g,s,h,m){return g.translatePosMatrix(m||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Jd=g=>{const s=[];return So(g)&&s.push("RENDER_LINE_DASH"),g.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT"),s};function So(g){const s=g.paint.get("line-dasharray").value;return s.value||"constant"!==s.kind}const yr=(g,s,h,m,b)=>{return{u_matrix:g,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(E=b.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=b.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Mh(b.paint.get("raster-hue-rotate"))};var x,E};function Mh(g){g*=Math.PI/180;const s=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Fc=(g,s,h,m,b,x,E,S,k,R)=>{const L=b.transform;return{u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:L.width/L.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+m,u_texsize:R,u_texture:0}},Oc=(g,s,h,m,b,x,E,S,k,R,L)=>{const{cameraToCenterDistance:z,_pitch:$}=b.transform;return d.extend(Fc(g,s,h,m,b,x,E,S,k,R),{u_gamma_scale:m?z*Math.cos(b.terrain?0:$):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+L})},Go=(g,s,h,m,b,x,E,S,k,R)=>d.extend(Oc(g,s,h,m,b,x,E,S,!0,k,!0),{u_texsize_icon:R,u_texture_icon:1}),Gp=(g,s,h)=>({u_matrix:g,u_opacity:s,u_color:h}),u_=(g,s,h,m,b,x)=>d.extend(function(E,S,k,R){const L=k.imageManager.getPattern(E.from.toString()),z=k.imageManager.getPattern(E.to.toString()),{width:$,height:H}=k.imageManager.getPixelSize(),J=Math.pow(2,R.tileID.overscaledZ),Q=R.tileSize*Math.pow(2,k.transform.tileZoom)/J,le=Q*(R.tileID.canonical.x+R.tileID.wrap*J),X=Q*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,H],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/fi(R,1,k.transform.tileZoom),u_pixel_coord_upper:[le>>16,X>>16],u_pixel_coord_lower:[65535&le,65535&X]}}(m,x,h,b),{u_matrix:g,u_opacity:s}),Sh={fillExtrusion:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_lightpos:new d.Uniform3f(g,s.u_lightpos),u_lightintensity:new d.Uniform1f(g,s.u_lightintensity),u_lightcolor:new d.Uniform3f(g,s.u_lightcolor),u_vertical_gradient:new d.Uniform1f(g,s.u_vertical_gradient),u_opacity:new d.Uniform1f(g,s.u_opacity)}),fillExtrusionPattern:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_lightpos:new d.Uniform3f(g,s.u_lightpos),u_lightintensity:new d.Uniform1f(g,s.u_lightintensity),u_lightcolor:new d.Uniform3f(g,s.u_lightcolor),u_vertical_gradient:new d.Uniform1f(g,s.u_vertical_gradient),u_height_factor:new d.Uniform1f(g,s.u_height_factor),u_image:new d.Uniform1i(g,s.u_image),u_texsize:new d.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new d.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new d.Uniform3f(g,s.u_scale),u_fade:new d.Uniform1f(g,s.u_fade),u_opacity:new d.Uniform1f(g,s.u_opacity)}),fill:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix)}),fillPattern:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_image:new d.Uniform1i(g,s.u_image),u_texsize:new d.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new d.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new d.Uniform3f(g,s.u_scale),u_fade:new d.Uniform1f(g,s.u_fade)}),fillOutline:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_world:new d.Uniform2f(g,s.u_world)}),fillOutlinePattern:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_world:new d.Uniform2f(g,s.u_world),u_image:new d.Uniform1i(g,s.u_image),u_texsize:new d.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new d.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new d.Uniform3f(g,s.u_scale),u_fade:new d.Uniform1f(g,s.u_fade)}),circle:(g,s)=>({u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(g,s.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(g,s.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(g,s.u_matrix)}),collisionBox:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(g,s.u_extrude_scale)}),collisionCircle:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_inv_matrix:new d.UniformMatrix4f(g,s.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(g,s.u_viewport_size)}),debug:(g,s)=>({u_color:new d.UniformColor(g,s.u_color),u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_overlay:new d.Uniform1i(g,s.u_overlay),u_overlay_scale:new d.Uniform1f(g,s.u_overlay_scale)}),clippingMask:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix)}),heatmap:(g,s)=>({u_extrude_scale:new d.Uniform1f(g,s.u_extrude_scale),u_intensity:new d.Uniform1f(g,s.u_intensity),u_matrix:new d.UniformMatrix4f(g,s.u_matrix)}),heatmapTexture:(g,s)=>({u_image:new d.Uniform1i(g,s.u_image),u_color_ramp:new d.Uniform1i(g,s.u_color_ramp),u_opacity:new d.Uniform1f(g,s.u_opacity)}),hillshade:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_image:new d.Uniform1i(g,s.u_image),u_latrange:new d.Uniform2f(g,s.u_latrange),u_light:new d.Uniform2f(g,s.u_light),u_shadow:new d.UniformColor(g,s.u_shadow),u_highlight:new d.UniformColor(g,s.u_highlight),u_accent:new d.UniformColor(g,s.u_accent)}),hillshadePrepare:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_image:new d.Uniform1i(g,s.u_image),u_dimension:new d.Uniform2f(g,s.u_dimension),u_zoom:new d.Uniform1f(g,s.u_zoom),u_unpack:new d.Uniform4f(g,s.u_unpack)}),line:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_ratio:new d.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new d.Uniform1f(g,s.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(g,s.u_units_to_pixels),u_dash_image:new d.Uniform1i(g,s.u_dash_image),u_gradient_image:new d.Uniform1i(g,s.u_gradient_image),u_image_height:new d.Uniform1f(g,s.u_image_height),u_texsize:new d.Uniform2f(g,s.u_texsize),u_scale:new d.Uniform3f(g,s.u_scale),u_mix:new d.Uniform1f(g,s.u_mix)}),linePattern:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_texsize:new d.Uniform2f(g,s.u_texsize),u_ratio:new d.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new d.Uniform1f(g,s.u_device_pixel_ratio),u_image:new d.Uniform1i(g,s.u_image),u_units_to_pixels:new d.Uniform2f(g,s.u_units_to_pixels),u_scale:new d.Uniform3f(g,s.u_scale),u_fade:new d.Uniform1f(g,s.u_fade)}),raster:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_tl_parent:new d.Uniform2f(g,s.u_tl_parent),u_scale_parent:new d.Uniform1f(g,s.u_scale_parent),u_buffer_scale:new d.Uniform1f(g,s.u_buffer_scale),u_fade_t:new d.Uniform1f(g,s.u_fade_t),u_opacity:new d.Uniform1f(g,s.u_opacity),u_image0:new d.Uniform1i(g,s.u_image0),u_image1:new d.Uniform1i(g,s.u_image1),u_brightness_low:new d.Uniform1f(g,s.u_brightness_low),u_brightness_high:new d.Uniform1f(g,s.u_brightness_high),u_saturation_factor:new d.Uniform1f(g,s.u_saturation_factor),u_contrast_factor:new d.Uniform1f(g,s.u_contrast_factor),u_spin_weights:new d.Uniform3f(g,s.u_spin_weights)}),symbolIcon:(g,s)=>({u_is_size_zoom_constant:new d.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new d.Uniform1f(g,s.u_size_t),u_size:new d.Uniform1f(g,s.u_size),u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new d.Uniform1f(g,s.u_pitch),u_rotate_symbol:new d.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new d.Uniform1f(g,s.u_fade_change),u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new d.Uniform1i(g,s.u_is_text),u_pitch_with_map:new d.Uniform1i(g,s.u_pitch_with_map),u_texsize:new d.Uniform2f(g,s.u_texsize),u_texture:new d.Uniform1i(g,s.u_texture)}),symbolSDF:(g,s)=>({u_is_size_zoom_constant:new d.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new d.Uniform1f(g,s.u_size_t),u_size:new d.Uniform1f(g,s.u_size),u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new d.Uniform1f(g,s.u_pitch),u_rotate_symbol:new d.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new d.Uniform1f(g,s.u_fade_change),u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new d.Uniform1i(g,s.u_is_text),u_pitch_with_map:new d.Uniform1i(g,s.u_pitch_with_map),u_texsize:new d.Uniform2f(g,s.u_texsize),u_texture:new d.Uniform1i(g,s.u_texture),u_gamma_scale:new d.Uniform1f(g,s.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(g,s.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(g,s.u_is_halo)}),symbolTextAndIcon:(g,s)=>({u_is_size_zoom_constant:new d.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new d.Uniform1f(g,s.u_size_t),u_size:new d.Uniform1f(g,s.u_size),u_camera_to_center_distance:new d.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new d.Uniform1f(g,s.u_pitch),u_rotate_symbol:new d.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new d.Uniform1f(g,s.u_fade_change),u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new d.Uniform1i(g,s.u_is_text),u_pitch_with_map:new d.Uniform1i(g,s.u_pitch_with_map),u_texsize:new d.Uniform2f(g,s.u_texsize),u_texsize_icon:new d.Uniform2f(g,s.u_texsize_icon),u_texture:new d.Uniform1i(g,s.u_texture),u_texture_icon:new d.Uniform1i(g,s.u_texture_icon),u_gamma_scale:new d.Uniform1f(g,s.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(g,s.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(g,s.u_is_halo)}),background:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_opacity:new d.Uniform1f(g,s.u_opacity),u_color:new d.UniformColor(g,s.u_color)}),backgroundPattern:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_opacity:new d.Uniform1f(g,s.u_opacity),u_image:new d.Uniform1i(g,s.u_image),u_pattern_tl_a:new d.Uniform2f(g,s.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(g,s.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(g,s.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(g,s.u_pattern_br_b),u_texsize:new d.Uniform2f(g,s.u_texsize),u_mix:new d.Uniform1f(g,s.u_mix),u_pattern_size_a:new d.Uniform2f(g,s.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(g,s.u_pattern_size_b),u_scale_a:new d.Uniform1f(g,s.u_scale_a),u_scale_b:new d.Uniform1f(g,s.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(g,s.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(g,s.u_tile_units_to_pixels)}),terrainRaster:wt,terrainDepth:wt,skybox:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_sun_direction:new d.Uniform3f(g,s.u_sun_direction),u_cubemap:new d.Uniform1i(g,s.u_cubemap),u_opacity:new d.Uniform1f(g,s.u_opacity),u_temporal_offset:new d.Uniform1f(g,s.u_temporal_offset)}),skyboxGradient:(g,s)=>({u_matrix:new d.UniformMatrix4f(g,s.u_matrix),u_color_ramp:new d.Uniform1i(g,s.u_color_ramp),u_center_direction:new d.Uniform3f(g,s.u_center_direction),u_radius:new d.Uniform1f(g,s.u_radius),u_opacity:new d.Uniform1f(g,s.u_opacity),u_temporal_offset:new d.Uniform1f(g,s.u_temporal_offset)}),skyboxCapture:(g,s)=>({u_matrix_3f:new d.UniformMatrix3f(g,s.u_matrix_3f),u_sun_direction:new d.Uniform3f(g,s.u_sun_direction),u_sun_intensity:new d.Uniform1f(g,s.u_sun_intensity),u_color_tint_r:new d.Uniform4f(g,s.u_color_tint_r),u_color_tint_m:new d.Uniform4f(g,s.u_color_tint_m),u_luminance:new d.Uniform1f(g,s.u_luminance)})};let jl;function Hl(g,s,h,m,b,x,E){const S=g.context,k=S.gl,R=g.useProgram("collisionBox"),L=[];let z=0,$=0;for(let se=0;se<m.length;se++){const he=m[se],_e=s.getTile(he),oe=_e.getBucket(h);if(!oe)continue;let we=he.projMatrix;0===b[0]&&0===b[1]||(we=g.translatePosMatrix(he.projMatrix,_e,b,x));const ze=E?oe.textCollisionBox:oe.iconCollisionBox,Ye=oe.collisionCircleArray;if(Ye.length>0){const xe=d.create$1(),Fe=we;d.mul$1(xe,oe.placementInvProjMatrix,g.transform.glCoordMatrix),d.mul$1(xe,xe,oe.placementViewportMatrix),L.push({circleArray:Ye,circleOffset:$,transform:Fe,invTransform:xe}),z+=Ye.length/4,$=z}ze&&(g.terrain&&g.terrain.setupElevationDraw(_e,R),R.draw(S,k.LINES,d.DepthMode.disabled,d.StencilMode.disabled,g.colorModeForRenderPass(),d.CullFaceMode.disabled,Tu(we,g.transform,_e),h.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,g.transform.zoom,null,ze.collisionVertexBuffer,ze.collisionVertexBufferExt))}if(!E||!L.length)return;const H=g.useProgram("collisionCircle"),J=new d.StructArrayLayout2f1f2i16;J.resize(4*z),J._trim();let Q=0;for(const se of L)for(let he=0;he<se.circleArray.length/4;he++){const _e=4*he,oe=se.circleArray[_e+0],we=se.circleArray[_e+1],ze=se.circleArray[_e+2],Ye=se.circleArray[_e+3];J.emplace(Q++,oe,we,ze,Ye,0),J.emplace(Q++,oe,we,ze,Ye,1),J.emplace(Q++,oe,we,ze,Ye,2),J.emplace(Q++,oe,we,ze,Ye,3)}(!jl||jl.length<2*z)&&(jl=function(se){const he=2*se,_e=new d.StructArrayLayout3ui6;_e.resize(he),_e._trim();for(let oe=0;oe<he;oe++){const we=6*oe;_e.uint16[we+0]=4*oe+0,_e.uint16[we+1]=4*oe+1,_e.uint16[we+2]=4*oe+2,_e.uint16[we+3]=4*oe+2,_e.uint16[we+4]=4*oe+3,_e.uint16[we+5]=4*oe+0}return _e}(z));const le=S.createIndexBuffer(jl,!0),X=S.createVertexBuffer(J,d.collisionCircleLayout.members,!0);for(const se of L){const he={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(te=g.transform).cameraToCenterDistance,u_viewport_size:[te.width,te.height]};H.draw(S,k.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,g.colorModeForRenderPass(),d.CullFaceMode.disabled,he,h.id,X,le,d.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,g.transform.zoom,null,null,null)}var te;X.destroy(),le.destroy()}const Kd=d.identity(new Float32Array(16));function qp(g,s,h,m,b,x){const{horizontalAlign:E,verticalAlign:S}=d.getAnchorAlignment(g),k=-(E-.5)*s,R=-(S-.5)*h,L=d.evaluateVariableOffset(g,m);return new d.pointGeometry((k/b+L[0])*x,(R/b+L[1])*x)}function Qd(g,s,h,m,b,x,E,S,k,R,L,z){const $=g.text.placedSymbolArray,H=g.text.dynamicLayoutVertexArray,J=g.icon.dynamicLayoutVertexArray,Q={};H.clear();for(let le=0;le<$.length;le++){const X=$.get(le),te=g.allowVerticalPlacement&&!X.placedOrientation,se=X.hidden||!X.crossTileID||te?null:m[X.crossTileID];if(se){const he=new d.pointGeometry(X.tileAnchorX,X.tileAnchorY),_e=z(he),oe=ln(he,h?S:E,_e),we=sn(x.cameraToCenterDistance,oe.signedDistanceFromCamera);let ze=b.evaluateSizeForFeature(g.textSizeData,R,X)*we/d.ONE_EM;h&&(ze*=g.tilePixelRatio/k);const{width:Ye,height:xe,anchor:Fe,textOffset:gt,textScale:mt}=se,_t=qp(Fe,Ye,xe,gt,mt,ze),it=h?ln(he.add(_t),E,_e).point:oe.point.add(s?_t.rotate(-x.angle):_t),vt=g.allowVerticalPlacement&&X.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Xt=0;Xt<X.numGlyphs;Xt++)d.addDynamicAttributes(H,it,vt);L&&X.associatedIconIndex>=0&&(Q[X.associatedIconIndex]={shiftedAnchor:it,angle:vt})}else fs(X.numGlyphs,H)}if(L){J.clear();const le=g.icon.placedSymbolArray;for(let X=0;X<le.length;X++){const te=le.get(X);if(te.hidden)fs(te.numGlyphs,J);else{const se=Q[X];if(se)for(let he=0;he<te.numGlyphs;he++)d.addDynamicAttributes(J,se.shiftedAnchor,se.angle);else fs(te.numGlyphs,J)}}g.icon.dynamicLayoutVertexBuffer.updateData(J)}g.text.dynamicLayoutVertexBuffer.updateData(H)}function Gl(g,s,h){return h.iconsInText&&s?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function ef(g,s,h,m,b,x,E,S,k,R,L,z){const $=g.context,H=$.gl,J=g.transform,Q="map"===S,le="map"===k,X=Q&&"point"!==h.layout.get("symbol-placement"),te=Q&&!le&&!X,se=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let he=!1;const _e=g.depthModeForSublayer(0,d.DepthMode.ReadOnly),oe=h.layout.get("text-variable-anchor"),we=[],ze=g.terrain&&le?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Ye of m){const xe=s.getTile(Ye),Fe=xe.getBucket(h);if(!Fe)continue;const gt=b?Fe.text:Fe.icon;if(!gt||!gt.segments.get().length)continue;const mt=gt.programConfigurations.get(h.id),_t=b||Fe.sdfIcons,it=b?Fe.textSizeData:Fe.iconSizeData,vt=le||0!==J.pitch,Xt=g.useProgram(Gl(_t,b,Fe),mt,ze),$t=d.evaluateSizeForZoom(it,J.zoom);let bi,li,Zt,rn,mi=[0,0],Io=null;if(b){if(li=xe.glyphAtlasTexture,Zt=H.LINEAR,bi=xe.glyphAtlasTexture.size,Fe.iconsInText){mi=xe.imageAtlasTexture.size,Io=xe.imageAtlasTexture;const wr="composite"===it.kind||"camera"===it.kind;rn=vt||g.options.rotating||g.options.zooming||wr?H.LINEAR:H.NEAREST}}else{const wr=1!==h.layout.get("icon-size").constantOr(0)||Fe.iconsNeedLinear;li=xe.imageAtlasTexture,Zt=_t||g.options.rotating||g.options.zooming||wr||vt?H.LINEAR:H.NEAREST,bi=xe.imageAtlasTexture.size}const ao=fi(xe,1,g.transform.zoom),Gi=nn(Ye.projMatrix,le,Q,g.transform,ao),Xr=g.terrain&&le&&X?d.invert(new Float32Array(16),Gi):Kd,Xo=wi(Ye.projMatrix,le,Q,g.transform,ao),vs=oe&&Fe.hasTextData(),kn="none"!==h.layout.get("icon-text-fit")&&vs&&Fe.hasIconData();if(X){const wr=J.elevation;yu(Fe,Ye.projMatrix,g,b,Gi,Xo,le,R,wr?Ao=>wr.getAtTileOffset(Ye,Ao.x,Ao.y):null)}const fn=g.translatePosMatrix(Ye.projMatrix,xe,x,E),Tn=X||b&&oe||kn?Kd:Gi,Zn=g.translatePosMatrix(Xo,xe,x,E,!0),Yi=_t&&0!==h.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let zn;zn=_t?Fe.iconsInText?Go(it.kind,$t,te,le,g,fn,Tn,Zn,bi,mi):Oc(it.kind,$t,te,le,g,fn,Tn,Zn,b,bi,!0):Fc(it.kind,$t,te,le,g,fn,Tn,Zn,b,bi);const ki={program:Xt,buffers:gt,uniformValues:zn,atlasTexture:li,atlasTextureIcon:Io,atlasInterpolation:Zt,atlasInterpolationIcon:rn,isSDF:_t,hasHalo:Yi,tile:xe,labelPlaneMatrixInv:Xr};if(se&&Fe.canOverlap){he=!0;const wr=gt.segments.get();for(const Ao of wr)we.push({segments:new d.SegmentVector([Ao]),sortKey:Ao.sortKey,state:ki})}else we.push({segments:gt.segments,sortKey:0,state:ki})}he&&we.sort((Ye,xe)=>Ye.sortKey-xe.sortKey);for(const Ye of we){const xe=Ye.state;if(g.terrain&&g.terrain.setupElevationDraw(xe.tile,xe.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:xe.labelPlaneMatrixInv}),$.activeTexture.set(H.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,H.CLAMP_TO_EDGE),xe.atlasTextureIcon&&($.activeTexture.set(H.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),xe.isSDF){const Fe=xe.uniformValues;xe.hasHalo&&(Fe.u_is_halo=1,ql(xe.buffers,Ye.segments,h,g,xe.program,_e,L,z,Fe)),Fe.u_is_halo=0}ql(xe.buffers,Ye.segments,h,g,xe.program,_e,L,z,xe.uniformValues)}}function ql(g,s,h,m,b,x,E,S,k){const R=m.context;b.draw(R,R.gl.TRIANGLES,x,E,S,d.CullFaceMode.disabled,k,h.id,g.layoutVertexBuffer,g.indexBuffer,s,h.paint,m.transform.zoom,g.programConfigurations.get(h.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Wl(g,s,h,m,b,x,E){const S=g.context.gl,k=h.paint.get("fill-pattern"),R=k&&k.constantOr(1),L=h.getCrossfadeParameters();let z,$,H,J,Q;E?($=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=S.LINES):($=R?"fillPattern":"fill",z=S.TRIANGLES);for(const le of m){const X=s.getTile(le);if(R&&!X.patternsLoaded())continue;const te=X.getBucket(h);if(!te)continue;g.prepareDrawTile(le);const se=te.programConfigurations.get(h.id),he=g.useProgram($,se);R&&(g.context.activeTexture.set(S.TEXTURE0),X.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),se.updatePaintBuffers(L));const _e=k.constantOr(null);if(_e&&X.imageAtlas){const we=X.imageAtlas,ze=we.patternPositions[_e.to.toString()],Ye=we.patternPositions[_e.from.toString()];ze&&Ye&&se.setConstantPatternPositions(ze,Ye)}const oe=g.translatePosMatrix(le.projMatrix,X,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){J=te.indexBuffer2,Q=te.segments2;const we=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];H="fillOutlinePattern"===$&&R?Di(oe,g,L,X,we):ja(oe,we)}else J=te.indexBuffer,Q=te.segments,H=R?gs(oe,g,L,X):Xi(oe);g.prepareDrawProgram(g.context,he,le.toUnwrapped()),he.draw(g.context,z,b,g.stencilModeForClipping(le),x,d.CullFaceMode.disabled,H,h.id,te.layoutVertexBuffer,J,Q,h.paint,g.transform.zoom,se)}}function Ih(g,s,h,m,b,x,E){const S=g.context,k=S.gl,R=h.paint.get("fill-extrusion-pattern"),L=R.constantOr(1),z=h.getCrossfadeParameters(),$=h.paint.get("fill-extrusion-opacity");for(const H of m){const J=s.getTile(H),Q=J.getBucket(h);if(!Q)continue;const le=Q.programConfigurations.get(h.id),X=g.useProgram(L?"fillExtrusionPattern":"fillExtrusion",le);if(g.terrain){const oe=g.terrain;if(!Q.enableTerrain)continue;if(oe.setupElevationDraw(J,X,{useMeterToDem:!0}),tf(S,s,H,Q,h,oe),!Q.centroidVertexBuffer){const we=X.attributes.a_centroid_pos;void 0!==we&&k.vertexAttrib2f(we,0,0)}}L&&(g.context.activeTexture.set(k.TEXTURE0),J.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),le.updatePaintBuffers(z));const te=R.constantOr(null);if(te&&J.imageAtlas){const oe=J.imageAtlas,we=oe.patternPositions[te.to.toString()],ze=oe.patternPositions[te.from.toString()];we&&ze&&le.setConstantPatternPositions(we,ze)}const se=g.translatePosMatrix(H.projMatrix,J,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),he=h.paint.get("fill-extrusion-vertical-gradient"),_e=L?Ul(se,g,he,$,H,z,J):Nc(se,g,he,$);g.prepareDrawProgram(S,X,H.toUnwrapped()),X.draw(S,S.gl.TRIANGLES,b,x,E,d.CullFaceMode.backCCW,_e,h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,g.transform.zoom,le,g.terrain?Q.centroidVertexBuffer:null)}}function tf(g,s,h,m,b,x){const E=[X=>{let te=X.canonical.x-1,se=X.wrap;return te<0&&(te=(1<<X.canonical.z)-1,se--),new d.OverscaledTileID(X.overscaledZ,se,X.canonical.z,te,X.canonical.y)},X=>{let te=X.canonical.x+1,se=X.wrap;return te===1<<X.canonical.z&&(te=0,se++),new d.OverscaledTileID(X.overscaledZ,se,X.canonical.z,te,X.canonical.y)},X=>new d.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(0===X.canonical.y?1<<X.canonical.z:X.canonical.y)-1),X=>new d.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],S=X=>{const te=s.getSource().maxzoom,se=we=>{const ze=s.getTileByID(we);if(ze&&ze.hasData())return ze.getBucket(b)};let he,_e,oe;return(X.overscaledZ===X.canonical.z||X.overscaledZ>=te)&&(he=se(X.key)),X.overscaledZ>=te&&(_e=se(X.calculateScaledKey(X.overscaledZ+1))),X.overscaledZ>te&&(oe=se(X.calculateScaledKey(X.overscaledZ-1))),he||_e||oe},k=[0,0,0],R=(X,te)=>(k[0]=Math.min(X.min.y,te.min.y),k[1]=Math.max(X.max.y,te.max.y),k[2]=d.EXTENT-te.min.x>X.max.x?te.min.x-d.EXTENT:X.max.x,k),L=(X,te)=>(k[0]=Math.min(X.min.x,te.min.x),k[1]=Math.max(X.max.x,te.max.x),k[2]=d.EXTENT-te.min.y>X.max.y?te.min.y-d.EXTENT:X.max.y,k),z=[(X,te)=>R(X,te),(X,te)=>R(te,X),(X,te)=>L(X,te),(X,te)=>L(te,X)],$=new d.pointGeometry(0,0);let H,J,Q;const le=(X,te,se,he,_e)=>{const oe=[[he?se:X,he?X:se,0],[he?se:te,he?te:se,0]],we=_e<0?d.EXTENT+_e:_e,ze=[he?we:(X+te)/2,he?(X+te)/2:we,0];return 0===se&&_e<0||0!==se&&_e>0?x.getForTilePoints(Q,[ze],!0,J):oe.push(ze),x.getForTilePoints(h,oe,!0,H),Math.max(oe[0][2],oe[1][2],ze[2])/x.exaggeration()};for(let X=0;X<4;X++){const te=m.borders[X];if(0===te.length&&(m.borderDone[X]=!0),m.borderDone[X])continue;const se=Q=E[X](h),he=S(se);if(!(he&&he.enableTerrain&&(J=x.findDEMTileFor(se),J&&J.dem)))continue;if(!H){const ze=x.findDEMTileFor(h);if(!ze||!ze.dem)return;H=ze}const _e=(X<2?1:5)-X,oe=he.borders[_e];let we=0;for(let ze=0;ze<te.length;ze++){const Ye=m.featuresOnBorder[te[ze]],xe=Ye.borders[X];let Fe;for(;we<oe.length&&(Fe=he.featuresOnBorder[oe[we]],!(Fe.borders[_e][1]>xe[0]+3));)he.borderDone[_e]||he.encodeCentroid(void 0,Fe,!1),we++;if(Fe&&we<oe.length){const gt=we;let mt=0;for(;!(Fe.borders[_e][0]>xe[1]-3)&&(mt++,++we!==oe.length);)Fe=he.featuresOnBorder[oe[we]];if(Fe=he.featuresOnBorder[oe[gt]],Ye.intersectsCount()>1||Fe.intersectsCount()>1||1!==mt){1!==mt&&(we=gt),m.encodeCentroid(void 0,Ye,!1),he.borderDone[_e]||he.encodeCentroid(void 0,Fe,!1);continue}const _t=z[X](Ye,Fe),it=X%2?d.EXTENT-1:0;$.x=le(_t[0],Math.min(d.EXTENT-1,_t[1]),it,X<2,_t[2]),$.y=0,m.encodeCentroid($,Ye,!1),he.borderDone[_e]||he.encodeCentroid($,Fe,!1)}else m.encodeCentroid(void 0,Ye,!1)}m.borderDone[X]=m.needsCentroidUpdate=!0,he.borderDone[_e]||(he.borderDone[_e]=he.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(g)}const Vn=new d.Color(1,0,0,1),Ah=new d.Color(0,1,0,1),h_=new d.Color(0,0,1,1),Wp=new d.Color(1,0,1,1),Zl=new d.Color(0,1,1,1);function Mu(g,s,h,m){Su(g,0,s+h/2,g.transform.width,h,m)}function Zp(g,s,h,m){Su(g,s-h/2,0,h,g.transform.height,m)}function Su(g,s,h,m,b,x){const E=g.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*d.exported.devicePixelRatio,h*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,b*d.exported.devicePixelRatio),E.clear({color:x}),S.disable(S.SCISSOR_TEST)}function d_(g,s,h){const m=g.context,b=m.gl,x=h.projMatrix,E=g.useProgram("debug"),S=s.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(S,E);const k=d.DepthMode.disabled,R=d.StencilMode.disabled,L=g.colorModeForRenderPass(),z="$debug";m.activeTexture.set(b.TEXTURE0),g.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),E.draw(m,b.LINE_STRIP,k,R,L,d.CullFaceMode.disabled,Ha(x,d.Color.red),z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments);const $=S.latestRawTileData,H=Math.floor(($&&$.byteLength||0)/1024),J=s.getTile(h).tileSize,Q=512/Math.min(J,512)*(h.overscaledZ/g.transform.zoom)*.5;let le=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(le+=` => ${h.overscaledZ}`),function(X,te){X.initDebugOverlayCanvas();const se=X.debugOverlayCanvas,he=X.context.gl,_e=X.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,se.width,se.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(te,5,5),_e.strokeText(te,5,5),X.debugOverlayTexture.update(se),X.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(g,`${le} ${H}kb`),E.draw(m,b.TRIANGLES,k,R,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Ha(x,d.Color.transparent,Q),z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments)}const Ls=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Lc}=Ls;function dn(g,s,h,m){g.emplaceBack(s,h,m)}class Bc{constructor(s){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,dn(this.vertexArray,-1,-1,1),dn(this.vertexArray,1,-1,1),dn(this.vertexArray,-1,1,1),dn(this.vertexArray,1,1,1),dn(this.vertexArray,-1,-1,-1),dn(this.vertexArray,1,-1,-1),dn(this.vertexArray,-1,1,-1),dn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Lc),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function da(g,s,h,m,b,x){const E=g.gl,S=s.paint.get("sky-atmosphere-color"),k=s.paint.get("sky-atmosphere-halo-color"),R=s.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:d.fromMat4([],m),u_sun_direction:b,u_sun_intensity:R,u_color_tint_r:[(J=S).r,J.g,J.b,J.a],u_color_tint_m:[(Q=k).r,Q.g,Q.b,Q.a],u_luminance:5e-5};var J,Q;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),h.draw(g,E.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,L,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const kh={symbol:function(g,s,h,m,b){if("translucent"!==g.renderPass)return;const x=d.StencilMode.disabled,E=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(S,k,R,L,z,$,H){const J=k.transform,Q="map"===z,le="map"===$;for(const X of S){const te=L.getTile(X),se=te.getBucket(R);if(!se||!se.text||!se.text.segments.get().length)continue;const he=d.evaluateSizeForZoom(se.textSizeData,J.zoom),_e=fi(te,1,k.transform.zoom),oe=nn(X.projMatrix,le,Q,k.transform,_e),we="none"!==R.layout.get("icon-text-fit")&&se.hasIconData();if(he){const ze=Math.pow(2,J.zoom-te.tileID.overscaledZ),Ye=J.elevation;Qd(se,Q,le,H,d.symbolSize,J,oe,X.projMatrix,ze,he,we,Ye?xe=>Ye.getAtTileOffset(X,xe.x,xe.y):xe=>0)}}}(m,g,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),b),0!==h.paint.get("icon-opacity").constantOr(1)&&ef(g,s,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),x,E),0!==h.paint.get("text-opacity").constantOr(1)&&ef(g,s,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),x,E),s.map.showCollisionBoxes&&(Hl(g,s,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Hl(g,s,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,s,h,m){if("translucent"!==g.renderPass)return;const b=h.paint.get("circle-opacity"),x=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),S=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const k=g.context,R=k.gl,L=g.depthModeForSublayer(0,d.DepthMode.ReadOnly),z=d.StencilMode.disabled,$=g.colorModeForRenderPass(),H=[];for(let J=0;J<m.length;J++){const Q=m[J],le=s.getTile(Q),X=le.getBucket(h);if(!X)continue;const te=X.programConfigurations.get(h.id),se=Eu(h),he={programConfiguration:te,program:g.useProgram("circle",te,se),layoutVertexBuffer:X.layoutVertexBuffer,indexBuffer:X.indexBuffer,uniformValues:ni(g,Q,le,h),tile:le};if(S){const _e=X.segments.get();for(const oe of _e)H.push({segments:new d.SegmentVector([oe]),sortKey:oe.sortKey,state:he})}else H.push({segments:X.segments,sortKey:0,state:he})}S&&H.sort((J,Q)=>J.sortKey-Q.sortKey);for(const J of H){const{programConfiguration:Q,program:le,layoutVertexBuffer:X,indexBuffer:te,uniformValues:se,tile:he}=J.state,_e=J.segments;g.terrain&&g.terrain.setupElevationDraw(he,le,{useDepthForOcclusion:!0}),g.prepareDrawProgram(k,le,he.tileID.toUnwrapped()),le.draw(k,R.TRIANGLES,L,z,$,d.CullFaceMode.disabled,se,h.id,X,te,_e,h.paint,g.transform.zoom,Q)}},heatmap:function(g,s,h,m){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const b=g.context,x=b.gl,E=d.StencilMode.disabled,S=new d.ColorMode([x.ONE,x.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(k,R,L){const z=k.gl;k.activeTexture.set(z.TEXTURE1),k.viewport.set([0,0,R.width/4,R.height/4]);let $=L.heatmapFbo;if($)z.bindTexture(z.TEXTURE_2D,$.colorAttachment.get()),k.bindFramebuffer.set($.framebuffer);else{const H=z.createTexture();z.bindTexture(z.TEXTURE_2D,H),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),$=L.heatmapFbo=k.createFramebuffer(R.width/4,R.height/4,!1),function(J,Q,le,X){const te=J.gl;te.texImage2D(te.TEXTURE_2D,0,te.RGBA,Q.width/4,Q.height/4,0,te.RGBA,J.extRenderToTextureHalfFloat?J.extTextureHalfFloat.HALF_FLOAT_OES:te.UNSIGNED_BYTE,null),X.colorAttachment.set(le)}(k,R,H,$)}})(b,g,h),b.clear({color:d.Color.transparent});for(let k=0;k<m.length;k++){const R=m[k];if(s.hasRenderableParent(R))continue;const L=s.getTile(R),z=L.getBucket(h);if(!z)continue;const $=z.programConfigurations.get(h.id),H=g.useProgram("heatmap",$),{zoom:J}=g.transform;g.terrain&&g.terrain.setupElevationDraw(L,H),g.prepareDrawProgram(b,H,R.toUnwrapped()),H.draw(b,x.TRIANGLES,d.DepthMode.disabled,E,S,d.CullFaceMode.disabled,Rc(R.projMatrix,L,J,h.paint.get("heatmap-intensity")),h.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,h.paint,g.transform.zoom,$)}b.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,x){const E=b.context,S=E.gl,k=x.heatmapFbo;if(!k)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new d.Texture(E,x.colorRamp,S.RGBA)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(E,S.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,b.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,x.paint,b.transform.zoom)}(g,h))},line:function(g,s,h,m){if("translucent"!==g.renderPass)return;const b=h.paint.get("line-opacity"),x=h.paint.get("line-width");if(0===b.constantOr(1)||0===x.constantOr(1))return;const E=g.depthModeForSublayer(0,d.DepthMode.ReadOnly),S=g.colorModeForRenderPass(),k=h.paint.get("line-dasharray"),R=k.constantOr(1),L=h.layout.get("line-cap"),z=h.paint.get("line-pattern"),$=z.constantOr(1),H=h.paint.get("line-gradient"),J=h.getCrossfadeParameters(),Q=$?"linePattern":"line",le=g.context,X=le.gl;for(const te of m){const se=s.getTile(te);if($&&!se.patternsLoaded())continue;const he=se.getBucket(h);if(!he)continue;g.prepareDrawTile(te);const _e=he.programConfigurations.get(h.id),oe=Jd(h),we=g.useProgram(Q,_e,oe),ze=z.constantOr(null);if(ze&&se.imageAtlas){const mt=se.imageAtlas,_t=mt.patternPositions[ze.to.toString()],it=mt.patternPositions[ze.from.toString()];_t&&it&&_e.setConstantPatternPositions(_t,it)}const Ye=k.constantOr(null),xe=L.constantOr(null);if(!$&&Ye&&xe&&se.lineAtlas){const mt=se.lineAtlas,_t=mt.getDash(Ye.to,xe),it=mt.getDash(Ye.from,xe);_t&&it&&_e.setConstantPatternPositions(_t,it)}const Fe=g.terrain?te.projMatrix:null,gt=$?$l(g,se,h,J,Fe):ha(g,se,h,J,Fe,he.lineClipsArray.length);if(H){const mt=he.gradients[h.id];let _t=mt.texture;if(h.gradientVersion!==mt.version){let it=256;if(h.stepInterpolant){const vt=s.getSource().maxzoom,Xt=te.canonical.z===vt?Math.ceil(1<<g.transform.maxZoom-te.canonical.z):1;it=d.clamp(d.nextPowerOfTwo(he.maxLineLength/d.EXTENT*1024*Xt),256,le.maxTextureSize)}mt.gradient=d.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:it,image:mt.gradient||void 0,clips:he.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new d.Texture(le,mt.gradient,X.RGBA),mt.version=h.gradientVersion,_t=mt.texture}le.activeTexture.set(X.TEXTURE1),_t.bind(h.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}R&&(le.activeTexture.set(X.TEXTURE0),se.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),_e.updatePaintBuffers(J)),$&&(le.activeTexture.set(X.TEXTURE0),se.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),_e.updatePaintBuffers(J)),g.prepareDrawProgram(le,we,te.toUnwrapped()),we.draw(le,X.TRIANGLES,E,g.stencilModeForClipping(te),S,d.CullFaceMode.disabled,gt,h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,h.paint,g.transform.zoom,_e,he.layoutVertexBuffer2)}},fill:function(g,s,h,m){const b=h.paint.get("fill-color"),x=h.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=g.colorModeForRenderPass(),S=h.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===b.constantOr(d.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(g.renderPass===k){const R=g.depthModeForSublayer(1,"opaque"===g.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);Wl(g,s,h,m,R,E,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const R=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);Wl(g,s,h,m,R,E,!0)}},"fill-extrusion":function(g,s,h,m){const b=h.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===g.renderPass){const x=new d.DepthMode(g.context.gl.LEQUAL,d.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==b||h.paint.get("fill-extrusion-pattern").constantOr(1))Ih(g,s,h,m,x,d.StencilMode.disabled,d.ColorMode.disabled),Ih(g,s,h,m,x,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const E=g.colorModeForRenderPass();Ih(g,s,h,m,x,d.StencilMode.disabled,E)}}},hillshade:function(g,s,h,m){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const b=g.context,x=g.depthModeForSublayer(0,d.DepthMode.ReadOnly),E=g.colorModeForRenderPass(),S=g.terrain&&g.terrain.renderingToTexture,[k,R]="translucent"!==g.renderPass||S?[{},m]:g.stencilConfigForOverlap(m);for(const L of R){const z=s.getTile(L);if(z.needsHillshadePrepare&&"offscreen"===g.renderPass)Qt(g,z,h,x,d.StencilMode.disabled,E);else if("translucent"===g.renderPass){const $=S&&g.terrain?g.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];Fr(g,L,z,h,x,$,E)}}b.viewport.set([0,0,g.width,g.height])},raster:function(g,s,h,m,b,x){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!m.length)return;const E=g.context,S=E.gl,k=s.getSource(),R=g.useProgram("raster"),L=g.colorModeForRenderPass(),z=g.terrain&&g.terrain.renderingToTexture,[$,H]=k instanceof W||z?[{},m]:g.stencilConfigForOverlap(m),J=H[H.length-1].overscaledZ,Q=!g.options.moving;for(const le of H){const X=z?d.DepthMode.disabled:g.depthModeForSublayer(le.overscaledZ-J,1===h.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,S.LESS),te=le.toUnwrapped(),se=s.getTile(le);if(z&&(!se||!se.hasData()))continue;const he=z?le.projMatrix:g.transform.calculateProjMatrix(te,Q),_e=g.terrain&&z?g.terrain.stencilModeForRTTOverlap(le):$[le.overscaledZ],oe=x?0:h.paint.get("raster-fade-duration");se.registerFadeDuration(oe);const we=s.findLoadedParent(le,0),ze=aa(se,we,s,g.transform,oe);let Ye,xe;g.terrain&&g.terrain.prepareDrawTile(le);const Fe="nearest"===h.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;E.activeTexture.set(S.TEXTURE0),se.texture.bind(Fe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(S.TEXTURE1),we?(we.texture.bind(Fe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Ye=Math.pow(2,we.tileID.overscaledZ-se.tileID.overscaledZ),xe=[se.tileID.canonical.x*Ye%1,se.tileID.canonical.y*Ye%1]):se.texture.bind(Fe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const gt=yr(he,xe||[0,0],Ye||1,ze,h);g.prepareDrawProgram(E,R,te),k instanceof W?R.draw(E,S.TRIANGLES,X,d.StencilMode.disabled,L,d.CullFaceMode.disabled,gt,h.id,k.boundsBuffer,g.quadTriangleIndexBuffer,k.boundsSegments):R.draw(E,S.TRIANGLES,X,_e,L,d.CullFaceMode.disabled,gt,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}},background:function(g,s,h,m){const b=h.paint.get("background-color"),x=h.paint.get("background-opacity");if(0===x)return;const E=g.context,S=E.gl,k=g.transform,R=k.tileSize,L=h.paint.get("background-pattern");if(g.isPatternMissing(L))return;const z=!L&&1===b.a&&1===x&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==z)return;const $=d.StencilMode.disabled,H=g.depthModeForSublayer(0,"opaque"===z?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),J=g.colorModeForRenderPass(),Q=g.useProgram(L?"backgroundPattern":"background"),le=m||k.coveringTiles({tileSize:R});L&&(E.activeTexture.set(S.TEXTURE0),g.imageManager.bind(g.context));const X=h.getCrossfadeParameters();for(const te of le){const se=te.toUnwrapped(),he=m?te.projMatrix:g.transform.calculateProjMatrix(se);g.prepareDrawTile(te);const _e=L?u_(he,x,g,L,{tileID:te,tileSize:R},X):Gp(he,x,b);g.prepareDrawProgram(E,Q,se),Q.draw(E,S.TRIANGLES,H,$,J,d.CullFaceMode.disabled,_e,h.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}},sky:function(g,s,h){const m=h.paint.get("sky-opacity");if(0===m)return;const b=g.context,x=h.paint.get("sky-type"),E=new d.DepthMode(b.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),S=g.frameCounter/1e3%1;"atmosphere"===x?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(k,R,L,z){const $=k.context,H=$.gl;let J=R.skyboxFbo;if(!J){J=R.skyboxFbo=$.createFramebuffer(32,32,!1),R.skyboxGeometry=new Bc($),R.skyboxTexture=$.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,R.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let te=0;te<6;++te)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(J.framebuffer),$.viewport.set([0,0,32,32]);const Q=R.getCenter(k,!0),le=k.useProgram("skyboxCapture"),X=new Float64Array(16);d.identity(X),d.rotateY(X,X,.5*-Math.PI),da($,R,le,X,Q,0),d.identity(X),d.rotateY(X,X,.5*Math.PI),da($,R,le,X,Q,1),d.identity(X),d.rotateX(X,X,.5*-Math.PI),da($,R,le,X,Q,2),d.identity(X),d.rotateX(X,X,.5*Math.PI),da($,R,le,X,Q,3),d.identity(X),da($,R,le,X,Q,4),d.identity(X),d.rotateY(X,X,Math.PI),da($,R,le,X,Q,5),$.viewport.set([0,0,k.width,k.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(k,R,L,z,$){const H=k.context,J=H.gl,Q=k.transform,le=k.useProgram("skybox");H.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,R.skyboxTexture);const X={u_matrix:Q.skyboxMatrix,u_sun_direction:R.getCenter(k,!1),u_cubemap:0,u_opacity:z,u_temporal_offset:$};k.prepareDrawProgram(H,le),le.draw(H,J.TRIANGLES,L,d.StencilMode.disabled,k.colorModeForRenderPass(),d.CullFaceMode.backCW,X,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(g,h,E,m,S):"gradient"===x&&"sky"===g.renderPass&&function(k,R,L,z,$){const H=k.context,J=H.gl,Q=k.transform,le=k.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Bc(H)),H.activeTexture.set(J.TEXTURE0);let X=R.colorRampTexture;X||(X=R.colorRampTexture=new d.Texture(H,R.colorRamp,J.RGBA)),X.bind(J.LINEAR,J.CLAMP_TO_EDGE);const te=(se=Q.skyboxMatrix,he=R.getCenter(k,!1),_e=R.paint.get("sky-gradient-radius"),oe=z,we=$,{u_matrix:se,u_color_ramp:0,u_center_direction:he,u_radius:d.degToRad(_e),u_opacity:oe,u_temporal_offset:we});var se,he,_e,oe,we;k.prepareDrawProgram(H,le),le.draw(H,J.TRIANGLES,L,d.StencilMode.disabled,k.colorModeForRenderPass(),d.CullFaceMode.backCW,te,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(g,h,E,m,S)},debug:function(g,s,h){for(let m=0;m<h.length;m++)d_(g,s,h[m])},custom:function(g,s,h){const m=g.context,b=h.implementation;if("offscreen"===g.renderPass){const x=b.prerender;x&&(g.setCustomLayerDefaults(),m.setColorMode(g.colorModeForRenderPass()),x.call(b,m.gl,g.transform.customLayerMatrix()),m.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),m.setColorMode(g.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const x="3d"===b.renderingMode?new d.DepthMode(g.context.gl.LEQUAL,d.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(x),b.render(m.gl,g.transform.customLayerMatrix()),m.setDirty(),g.setBaseState(),m.bindFramebuffer.set(null)}}};class Vc{constructor(s,h){this.context=new Ns(s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xd,this.gpuTimers={},this.frameCounter=0}updateTerrain(s,h){const m=!!s&&!!s.terrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ca(this,s));const b=this._terrain;this.transform.elevation=m?b:null,b.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,b]=h.getFovAdjustedRange(this.transform._fov);if(m>b)return void(this.transform.fogCullDistSq=null);const x=m+.78*(b-m);this.transform.fogCullDistSq=x*x}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*d.exported.devicePixelRatio,this.height=h*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const s=this.context,h=new d.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(d.EXTENT,0),h.emplaceBack(0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=s.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const b=new d.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(d.EXTENT,0,d.EXTENT,0),b.emplaceBack(0,d.EXTENT,0,d.EXTENT),b.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(b,hs.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const x=new d.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const E=new d.StructArrayLayout1ui2;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const S=new d.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new d.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA),this.identityMat=d.create$1();const k=this.context.gl;this.stencilClearMode=new d.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(d.window.performance.now())}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(s,h.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,Bi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h,m){if(!(h&&this.currentStencilSource!==h.id&&s.isTileClipped()&&m&&m.length))return;this.currentStencilSource=h.id;const b=this.context,x=b.gl;this.nextStencilID+m.length>256&&this.clearStencil(),b.setColorMode(d.ColorMode.disabled),b.setDepthMode(d.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++;E.draw(b,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Bi(S.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new d.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new d.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,m=s.sort((E,S)=>S.overscaledZ-E.overscaledZ),b=m[m.length-1].overscaledZ,x=m[0].overscaledZ-b+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let S=0;S<x;S++)E[S+b]=new d.StencilMode({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=x,[E,m]}return[{[b]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;if(this._showOverdrawInspector){const h=1/8;return new d.ColorMode([s.CONSTANT_COLOR,s.ONE],new d.Color(h,h,h,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(s,h,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,h,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,b=this.style._sourceCaches;for(const R in b){const L=b[R];L.used&&L.prepare(this.context)}const x={},E={},S={};for(const R in b){const L=b[R];x[R]=L.getVisibleCoordinates(),E[R]=x[R].slice().reverse(),S[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<m.length;R++)if(this.style._layers[m[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of m){const L=this.style._layers[R],z=s._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const $=z?E[z.id]:void 0;("custom"===L.type||L.isSky()||$&&$.length)&&this.renderLayer(this,z,L,$)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=d.Color.transparent;if(this.style.fog&&(k=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?d.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[m[this.currentLayer]],L=s._getLayerSourceCache(R);if(R.isSky())continue;const z=L?E[L.id]:void 0;this._renderTileClippingMasks(R,L,z),this.renderLayer(this,L,R,z)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const R=this.style._layers[m[this.currentLayer]],L=s._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?E[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const R=this.style._layers[m[this.currentLayer]],L=s._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=L?("symbol"===R.type?S:E)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?x[L.id]:void 0),this.renderLayer(this,L,R,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;d.values(this.style._layers).forEach(L=>{const z=s._getLayerSourceCache(L);z&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z)}),R&&this.options.showTileBoundaries&&kh.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;Mu(R,R.transform.height-(L.top||0),3,Vn),Mu(R,L.bottom||0,3,Ah),Zp(R,L.left||0,3,h_),Zp(R,R.transform.width-(L.right||0),3,Wp);const z=R.transform.centerPoint;var $,H,J,Q;Su($=R,(H=z.x)-1,(J=R.transform.height-z.y)-10,2,20,Q=Zl),Su($,H-10,J-1,20,2,Q)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%d.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,m,b){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||b&&b.length)&&(this.id=m.id,this.gpuTimingStart(m),kh[m.type](s,h,m,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let m=this.gpuTimers[s.id];m||(m=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),m.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const m in s){const b=s[m],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(b.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(b.query),h[m]=E}return h}translatePosMatrix(s,h,m,b,x){if(!m[0]&&!m[1])return s;const E=x?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(E){const R=Math.sin(E),L=Math.cos(E);m=[m[0]*L-m[1]*R,m[0]*R+m[1]*L]}const S=[x?m[0]:fi(h,m[0],this.transform.zoom),x?m[1]:fi(h,m[1],this.transform.zoom),0],k=new Float32Array(16);return d.translate(k,s,S),k}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),m=this.imageManager.getPattern(s.to.toString());return!h||!m}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),h&&!s&&0!==h.getOpacity(this.transform.pitch)&&m.push("FOG"),s&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(s,h,m){this.cache=this.cache||{};const b=m||[],x=this.currentGlobalDefines().concat(b),E=$a.cacheKey(s,x,h);return this.cache[E]||(this.cache[E]=new $a(this.context,s,dr[s],h,Sh[s],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(s){this.terrain&&this.terrain.prepareDrawTile(s)}prepareDrawProgram(s,h,m){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const x=b.getOpacity(this.transform.pitch);0!==x&&h.setFogUniformValues(s,((E,S,k,R)=>{const L=S.properties.get("color"),z=E.frameCounter/1e3%1,$=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:k?E.transform.calculateFogTileMatrix(k):E.identityMat,u_fog_range:S.getFovAdjustedRange(E.transform._fov),u_fog_color:$,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:z}})(this,b,m,x))}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&0!==s.getOpacity(this.transform.pitch)}}class Ga{constructor(s=0,h=0,m=0,b=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=m,this.right=b}interpolate(s,h,m){return null!=h.top&&null!=s.top&&(this.top=d.number(s.top,h.top,m)),null!=h.bottom&&null!=s.bottom&&(this.bottom=d.number(s.bottom,h.bottom,m)),null!=h.left&&null!=s.left&&(this.left=d.number(s.left,h.left,m)),null!=h.right&&null!=s.right&&(this.right=d.number(s.right,h.right,m)),this}getCenter(s,h){const m=d.clamp((this.left+s-this.right)/2,0,s),b=d.clamp((this.top+h-this.bottom)/2,0,h);return new d.pointGeometry(m,b)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Lr(g,s){return[g[4*s],g[4*s+1],g[4*s+2],g[4*s+3]]}function zc(g,s,h){g[4*s+0]=h[0],g[4*s+1]=h[1],g[4*s+2]=h[2],g[4*s+3]=h[3]}function Iu(g,s){const h=Lr(g,3);d.fromQuat(g,s),zc(g,3,h)}function Wr(g,s){zc(g,3,[s[0],s[1],s[2],1])}function Bs(g,s){const h=d.identity$1([]);return d.rotateZ$1(h,h,-s),d.rotateX$1(h,h,-g),h}function qa(g,s){const h=[g[0],g[1],0],m=[s[0],s[1],0];if(d.length(h)>=1e-15){const E=d.normalize([],h);d.scale(m,E,d.dot(m,E)),s[0]=m[0],s[1]=m[1]}const b=d.cross([],s,g);if(d.len(b)<1e-15)return null;const x=Math.atan2(-b[1],b[0]);return Bs(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),x)}class Xl{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){this._position=this._renderWorldCopies?function(h){if(!h)return;const m=Array.isArray(h)?new d.MercatorCoordinate(h[0],h[1],h[2]):h;return m.x=d.wrap(m.x,0,1),m}(s):s}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(s)):0,b=this.position,x=d.MercatorCoordinate.fromLngLat(s,m),E=[x.x-b.x,x.y-b.y,x.z-b.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=qa(E,h)}setPitchBearing(s,h){this.orientation=Bs(d.degToRad(s),d.degToRad(-h))}}class Ph{constructor(s,h){this._transform=d.identity([]),this._orientation=d.identity$1([]),h&&(this._orientation=h,Iu(this._transform,this._orientation)),s&&Wr(this._transform,s)}get mercatorPosition(){const s=this.position;return new d.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=Lr(this._transform,3);return[s[0],s[1],s[2]]}set position(s){Wr(this._transform,s)}get orientation(){return this._orientation}set orientation(s){this._orientation=s,Iu(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Bs(s,h),Iu(this._transform,this._orientation)}forward(){const s=Lr(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=Lr(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=Lr(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(s,h)),m}getWorldToCameraPosition(s,h,m){const b=this.position;d.scale(b,b,-s);const x=new Float64Array(16);return d.fromScaling(x,[m,m,m]),d.translate(x,x,b),x[10]*=h,x}getWorldToCamera(s,h){const m=new Float64Array(16),b=new Float64Array(4),x=this.position;return d.conjugate(b,this._orientation),d.scale(x,x,-s),d.fromQuat(m,b),d.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=h,m[9]*=h,m[10]*=h,m[11]*=h,m}getCameraToClipPerspective(s,h,m,b){const x=new Float64Array(16);return d.perspective(x,s,h,m,b),x}getDistanceToElevation(s){const h=0===s?0:d.mercatorZfromAltitude(s,this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new Ph([...this.position],[...this.orientation])}}class fa{constructor(s,h,m,b,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===x||x,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=null==m?0:m,this._maxPitch=null==b?60:b,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ga,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new Ph,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const s=new fa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._cameraZoom=this._cameraZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,s?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(s){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),s&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-d.wrap(s,-180,180)*Math.PI/180;var m,b,x,E,S,k,R,L,z,$;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),b=this.rotationMatrix,E=this.angle,S=(x=this.rotationMatrix)[0],k=x[1],R=x[2],L=x[3],z=Math.sin(E),$=Math.cos(E),b[0]=S*$+R*z,b[1]=k*$+L*z,b[2]=S*-z+R*$,b[3]=k*-z+L*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=d.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const s=this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(this.center),-1);return-1===s?(this._cameraZoom=null,!1):(this._centerAltitude=s,!0)}_updateCameraOnTerrain(){const s=this.cameraToCenterDistance/this.worldSize,h=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(h+s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let b=0,x=0;for(let E=0;E<h.length;E++){const S=new d.pointGeometry(h[E][0]*this.width,m+h[E][1]*(this.height-m)),k=s.pointCoordinate(S);if(!k)continue;const R=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*R,x+=R}return 0===x?NaN:b/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const s=this._cameraZoom,h=this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(this.center)),m=d.mercatorZfromAltitude(h,this.center.lat),b=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-m,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const b=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!d.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new Xl;return h.position=new d.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this._renderWorldCopies,h}_setCameraOrientation(s){if(!d.length$1(s))return!1;d.normalize$1(s,s);const h=d.transformQuat([],[0,0,-1],s),m=d.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;const b=qa(h,m);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;s[2]=d.clamp(s[2],b/m,b/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,m){this._unmodified=!1,this._edgeInsets.interpolate(s,h,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new d.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),b=this.pointCoordinate(new d.pointGeometry(this.width,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new d.pointGeometry(0,this.height)),S=Math.floor(Math.min(m.x,b.x,x.x,E.x)),k=Math.floor(Math.max(m.x,b.x,x.x,E.x)),R=1;for(let L=S-R;L<=k+R;L++)0!==L&&h.push(new d.UnwrappedTileID(L,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const m=h,b=this.elevation&&!s.isTerrainDEM;if(void 0!==s.minzoom&&h<s.minzoom)return[];void 0!==s.maxzoom&&h>s.maxzoom&&(h=s.maxzoom);const x=d.MercatorCoordinate.fromLngLat(this.center),E=1<<h,S=[E*x.x,E*x.y,0],k=jt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),R=this.pointCoordinate(this.getCameraPoint()),L=E*d.mercatorZfromAltitude(1,this.center.lat),z=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),$=[E*R.x,E*R.y,z],H=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?h:0,Q=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=s.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,X=xe=>({aabb:new Gn([xe*E,0,le],[(xe+1)*E,E,Q]),zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}),te=[];let se=[];const he=h,_e=s.reparseOverscaled?m:h,oe=xe=>{if(!this._elevation||!xe.tileID)return;const Fe=this._elevation.getMinMaxForTile(xe.tileID),gt=xe.aabb;Fe?(gt.min[2]=Fe.min,gt.max[2]=Fe.max,gt.center[2]=(gt.min[2]+gt.max[2])/2):(xe.shouldSplit=Ye(xe),xe.shouldSplit||(gt.min[2]=gt.max[2]=gt.center[2]=this._centerAltitude))},we=xe=>xe*xe,ze=we((z-this._centerAltitude)*L),Ye=xe=>{if(xe.zoom<J)return!0;if(xe.zoom===he)return!1;if(null!=xe.shouldSplit)return xe.shouldSplit;const Fe=xe.aabb.distanceX($),gt=xe.aabb.distanceY($);let mt=ze;b&&(mt=we(xe.aabb.distanceZ($)*L));const _t=Fe*Fe+gt*gt+mt;return _t<we((1<<he-xe.zoom)*H*((it,vt)=>{if(vt*we(.707)<it)return 1;const Xt=Math.sqrt(vt/it);return Xt/(1.4144271570014144+(Math.pow(1.1,Xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(mt,ze),_t))};if(this._renderWorldCopies)for(let xe=1;xe<=3;xe++)te.push(X(-xe)),te.push(X(xe));for(te.push(X(0));te.length>0;){const xe=te.pop(),Fe=xe.x,gt=xe.y;let mt=xe.fullyVisible;if(!mt){const _t=xe.aabb.intersects(k);if(0===_t)continue;mt=2===_t}if(xe.zoom!==he&&Ye(xe))for(let _t=0;_t<4;_t++){const it=(Fe<<1)+_t%2,vt=(gt<<1)+(_t>>1),Xt={aabb:xe.aabb.quadrant(_t),zoom:xe.zoom+1,x:it,y:vt,wrap:xe.wrap,fullyVisible:mt,tileID:void 0,shouldSplit:void 0};b&&(Xt.tileID=new d.OverscaledTileID(xe.zoom+1===he?_e:xe.zoom+1,xe.wrap,xe.zoom+1,it,vt),oe(Xt)),te.push(Xt)}else{const _t=xe.zoom===he?_e:xe.zoom;if(s.minzoom&&s.minzoom>_t)continue;const it=S[0]-(.5+Fe+(xe.wrap<<xe.zoom))*(1<<h-xe.zoom),vt=S[1]-.5-gt,Xt=xe.tileID?xe.tileID:new d.OverscaledTileID(_t,xe.wrap,xe.zoom,Fe,gt);se.push({tileID:Xt,distanceSq:it*it+vt*vt})}}if(this.fogCullDistSq){const xe=this.fogCullDistSq,Fe=this.horizonLineFromTop();se=se.filter(gt=>{const mt=[0,0,0,1],_t=[d.EXTENT,d.EXTENT,0,1],it=this.calculateFogTileMatrix(gt.tileID.toUnwrapped());d.transformMat4(mt,mt,it),d.transformMat4(_t,_t,it);const vt=d.getAABBPointSquareDist(mt,_t);if(0===vt)return!0;let Xt=!1;const $t=this._elevation;if($t&&vt>xe&&0!==Fe){const bi=this.calculateProjMatrix(gt.tileID.toUnwrapped());let li;s.isTerrainDEM||(li=$t.getMinMaxForTile(gt.tileID)),li||(li={min:le,max:Q});const Zt=d.furthestTileCorner(this.bearing),rn=[Zt[0]*d.EXTENT,Zt[1]*d.EXTENT,li.max];d.transformMat4$1(rn,rn,bi),Xt=(1-rn[1])*this.height*.5<Fe}return vt<xe||Xt})}return se.sort((xe,Fe)=>xe.distanceSq-Fe.distanceSq).map(xe=>xe.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=d.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.pointGeometry(d.mercatorXfromLng(s.lng)*this.worldSize,d.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new d.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(s,h){const m=this.pointCoordinate(h),b=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(s),E=new d.MercatorCoordinate(x.x-(m.x-b.x),x.y-(m.y-b.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(s){this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s){return this._coordinatePoint(this.locationCoordinate(s),!1)}locationPoint3D(s){return this._coordinatePoint(this.locationCoordinate(s),!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s){return d.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s.toLngLat()}pointRayIntersection(s,h){const m=null!=h?h:this._centerAltitude,b=[s.x,s.y,0,1],x=[s.x,s.y,1,1];d.transformMat4(b,b,this.pixelMatrixInverse),d.transformMat4(x,x,this.pixelMatrixInverse);const E=x[3];d.scale$2(b,b,1/b[3]),d.scale$2(x,x,1/E);const S=b[2],k=x[2];return{p0:b,p1:x,t:S===k?0:(m-S)/(k-S)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return d.transformMat4(h,h,this.pixelMatrixInverse),d.transformMat4(m,m,this.pixelMatrixInverse),d.scale$2(h,h,1/h[3]),d.scale$2(m,m,1/m[3]),h[2]=d.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$2(h,h,1/this.worldSize),d.scale$2(m,m,1/this.worldSize),new xt([h[0],h[1],h[2]],d.normalize([],d.sub([],m,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:m,t:b}=s,x=d.mercatorZfromAltitude(h[2],this._center.lat),E=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(h[0],m[0],b)/this.worldSize,d.number(h[1],m[1],b)/this.worldSize,d.number(x,E,b))}pointCoordinate(s,h=this._centerAltitude){const m=this.horizonLineFromTop(!1),b=new d.pointGeometry(s.x,Math.max(m,s.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(b,h))}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);const h=this.elevation;let m=this.elevation.pointCoordinate(s);if(m)return new d.MercatorCoordinate(m[0],m[1],m[2]);let b=0,x=this.horizonLineFromTop();if(s.y>x)return this.pointCoordinate(s);const E=.02*x,S=s.clone();for(let k=0;k<10&&x-b>E;k++){S.y=d.number(b,x,.66);const R=h.pointCoordinate(S);R?(x=S.y,m=R):b=S.y}return m?new d.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){if(this.elevation)return!this.elevation.pointCoordinate(s);{const h=this.horizonLineFromTop();return s.y<h}}_coordinatePoint(s,h){const m=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,b=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return d.transformMat4(b,b,this.pixelMatrix),b[3]>0?new d.pointGeometry(b[0]/b[3],b[1]/b[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(s,h){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(m,s),k=this.pointCoordinate(b,s);const R=this.pointCoordinate(x,h),L=this.pointCoordinate(E,h),z=($,H)=>(H.y-$.y)/(H.x-$.x);return S.y>1&&k.y>=0?S=new d.MercatorCoordinate((1-L.y)/z(L,S)+L.x,1):S.y<0&&k.y<=1&&(S=new d.MercatorCoordinate(-L.y/z(L,S)+L.x,0)),k.y>1&&S.y>=0?k=new d.MercatorCoordinate((1-R.y)/z(R,k)+R.x,1):k.y<0&&S.y<=1&&(k=new d.MercatorCoordinate(-R.y/z(R,k)+R.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const s=this.elevation,h=s.visibleDemTiles.reduce((m,b)=>{if(b.dem){const x=b.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(s){if(s){const h=s.getEast(),m=s.getWest();this.lngRange=[m,h>m?h:h+360],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(s,h){const m=s.canonical,b=h/this.zoomScale(m.z),x=m.x+Math.pow(2,m.z)*s.wrap,E=d.identity(new Float64Array(16));return d.translate(E,E,[x*b,m.y*b,0]),d.scale$1(E,E,[b/d.EXTENT,b/d.EXTENT,1]),E}calculateFogTileMatrix(s){const h=s.key,m=this._fogTileMatrixCache;if(m[h])return m[h];const b=this.calculatePosMatrix(s,this.cameraWorldSize);return d.multiply(b,this.worldToFogMatrix,b),m[h]=new Float32Array(b),m[h]}calculateProjMatrix(s,h=!1){const m=s.key,b=h?this._alignedProjMatrixCache:this._projMatrixCache;if(b[m])return b[m];const x=this.calculatePosMatrix(s,this.worldSize);return d.multiply(x,h?this.alignedProjMatrix:this.projMatrix,x),b[m]=new Float32Array(x),b[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=this._camera.position,m=this._camera.forward();if(h[2]<=0||m[2]>=0)return;const b=d.mercatorZfromAltitude(1,this._center.lat);h[2]/=b,m[2]/=b,d.normalize(m,m);const x=s.raycast(h,m,s.exaggeration());if(x){const E=d.scaleAndAdd([],h,m,x),S=new d.MercatorCoordinate(E[0],E[1],d.mercatorZfromAltitude(E[2],d.latFromMercatorY(E[1]))),k=this._camera.position,R=S.z+d.length([S.x-k[0],S.y-k[1],S.z-k[2]]);this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=S.toAltitude(),this._center=S.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=s.getAtPointOrZero(this._camera.mercatorPosition),m=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),b=d.mercatorZfromAltitude(h,this._center.lat),x=this._camera.position[2]-b;if(x<m){const E=d.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),S=this._camera.mercatorPosition,k=[E.x-S.x,E.y-S.y,E.z-S.z],R=d.length(k);k[2]-=m-x;const L=d.length(k);if(0===L)return;d.scale(k,k,R/L),this._camera.position=[E.x-k[0],E.y-k[1],E.z-k[2]],this._camera.orientation=qa(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,m,b,x,E=1/0,S=-1/0;const k=this.size,R=this._unmodified;if(this.latRange){const H=this.latRange;E=d.mercatorYfromLat(H[1])*this.worldSize,S=d.mercatorYfromLat(H[0])*this.worldSize,m=S-E<k.y?k.y/(S-E):0}if(this.lngRange){const H=this.lngRange;s=d.mercatorXfromLng(H[0])*this.worldSize,h=d.mercatorXfromLng(H[1])*this.worldSize,b=h-s<k.x?k.x/(h-s):0}const L=this.point,z=Math.max(b||0,m||0);if(z)return this.center=this.unproject(new d.pointGeometry(b?(h+s)/2:L.x,m?(S+E)/2:L.y)),this.zoom+=this.scaleZoom(z),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const H=L.y,J=k.y/2;H-J<E&&(x=E+J),H+J>S&&(x=S-J)}let $=L.x;if(this.lngRange){const H=this.worldSize/2-(s+h)/2;$=($+H+this.worldSize)%this.worldSize,s+=H,h+=H;const J=k.x/2;$-J<s&&($=s+J),$+J>h&&($=h-J),$-=H}$===L.x&&void 0===x||(this.center=this.unproject(new d.pointGeometry($,void 0!==x?x:L.y))),this._constrainCameraAltitude(),this._unmodified=R,this._constraining=!1}_minZoomForBounds(){const s=(b,x)=>Math.log2(b/(this.tileSize*Math.abs(x[1]-x[0])));let h=0;if(this.latRange){const b=this.latRange;h=s(this.height,[d.mercatorYfromLat(b[0]),d.mercatorYfromLat(b[1])])}let m=0;if(this.lngRange){const b=this.lngRange;m=s(this.width,[d.mercatorXfromLng(b[0]),d.mercatorXfromLng(b[1])])}return Math.max(h,m)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=this.pixelsPerMeter;this._updateCameraState();const m=Math.PI/2+this._pitch,b=this.fovAboveCenter,x=this.elevation?this.elevation.getMinElevationBelowMSL()*h:0,E=(this._camera.position[2]*this.worldSize-x)/Math.cos(this._pitch),S=Math.sin(b)*E/Math.sin(d.clamp(Math.PI-m-b,.01,Math.PI-.01)),k=this.point,R=k.x,L=k.y,z=Math.cos(Math.PI/2-this._pitch)*S+E,$=Math.min(1.01*z,E*(1/this._horizonShift)),H=this.height/50,J=this._camera.getWorldToCamera(this.worldSize,h),Q=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,H,$);Q[8]=2*-s.x/this.width,Q[9]=2*s.y/this.height;let le=d.mul$1([],Q,J);this.mercatorMatrix=d.scale$1([],le,[this.worldSize,this.worldSize,this.worldSize/h]),this.projMatrix=le,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const X=new Float32Array(16);d.identity(X),d.scale$1(X,X,[1,-1,1]),d.rotateX(X,X,this._pitch),d.rotateZ(X,X,this.angle);const te=d.perspective(new Float32Array(16),this._fov,this.width/this.height,H,$),se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;te[8]=2*-s.x/this.width,te[9]=2*(s.y+se)/this.height,this.skyboxMatrix=d.multiply(X,te,X);const he=this.width%2/2,_e=this.height%2/2,oe=Math.cos(this.angle),we=Math.sin(this.angle),ze=R-Math.round(R)+oe*he+we*_e,Ye=L-Math.round(L)+oe*_e+we*he,xe=new Float64Array(le);if(d.translate(xe,xe,[ze>.5?ze-1:ze,Ye>.5?Ye-1:Ye,0]),this.alignedProjMatrix=xe,le=d.create$1(),d.scale$1(le,le,[this.width/2,-this.height/2,1]),d.translate(le,le,[1,-1,0]),this.labelPlaneMatrix=le,le=d.create$1(),d.scale$1(le,le,[1,-1,1]),d.translate(le,le,[-1,-1,0]),d.scale$1(le,le,[2/this.width,2/this.height,1]),this.glCoordMatrix=le,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),le=d.invert(new Float64Array(16),this.pixelMatrix),!le)throw new Error("failed to invert matrix");this.pixelMatrixInverse=le,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSize,h=this.cameraPixelsPerMeter,m=this._camera.position,b=1/this.height,x=[s,s,h];d.scale(x,x,b),d.scale(m,m,-1),d.multiply$1(m,m,x);const E=d.create$1();d.translate(E,E,m),d.scale$1(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,b)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const s=this._camera.forward(),h=this.cameraToCenterDistance,m=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),x=this.cameraToCenterDistance/b;this._camera.position=[m.x/this.worldSize-s[0]*h/x,m.y/this.worldSize-s[1]*h/x,d.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-s[2]*h/x]}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=s[2];let b=1;m>0&&(b=Math.min((h-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,s,b),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:m,bearing:b}=this._camera.getPitchBearing(),x=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),S=Math.max((s[2]-x)/Math.cos(m),E),k=this._zoomFromMercatorZ(S);d.scaleAndAdd(s,s,h,S),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(b,-Math.PI,Math.PI),this._setZoom(d.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new d.MercatorCoordinate(s[0],s[1],s[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(s,h){const m=Math.min(s.x,h.x),b=Math.max(s.x,h.x),x=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(x<this.horizonLineFromTop(!1))return!0;const S=[new d.pointGeometry(m,x),new d.pointGeometry(b,E),new d.pointGeometry(m,E),new d.pointGeometry(b,x)],k=this._renderWorldCopies?-3:0,R=this._renderWorldCopies?4:1;for(const L of S){const z=this.pointRayIntersection(L);if(z.t<0)return!0;const $=this.rayIntersectionCoordinate(z);if($.x<k||$.y<0||$.x>R||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(s,h){const m=d.length(d.sub([],this._camera.position,s)),b=this._zoomFromMercatorZ(m)+h;return m-this._mercatorZfromZoom(b)}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,s))}}function Xp(g,s){let h=!1,m=null;const b=()=>{m=null,h&&(g(),m=setTimeout(b,s),h=!1)};return()=>(h=!0,m||b(),m)}class Ei{constructor(s){this._hashName=s&&encodeURIComponent(s),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xp(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,b),E=Math.round(h.lng*x)/x,S=Math.round(h.lat*x)/x,k=this._map.getBearing(),R=this._map.getPitch();let L="";if(L+=s?`/${E}/${S}/${m}`:`${m}/${S}/${E}`,(k||R)&&(L+="/"+Math.round(10*k)/10),R&&(L+=`/${Math.round(R)}`),this._hashName){const z=this._hashName;let $=!1;const H=d.window.location.hash.slice(1).split("&").map(J=>{const Q=J.split("=")[0];return Q===z?($=!0,`${Q}=${L}`):J}).filter(J=>J);return $||H.push(`${z}=${L}`),`#${H.join("&")}`}return`#${L}`}_getCurrentHash(){const s=d.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(h=m)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,s)}}const Yl={linearity:.3,easing:d.bezier(0,0,.3,1)},Au=d.extend({deceleration:2500,maxSpeed:1400},Yl),nf=d.extend({deceleration:20,maxSpeed:1400},Yl),zi=d.extend({deceleration:1e3,maxSpeed:360},Yl),ku=d.extend({deceleration:1e3,maxSpeed:90},Yl);class rf{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=d.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const x=vr(h.pan.mag(),m,d.extend({},Au,s||{}));b.offset=h.pan.mult(x.amount/h.pan.mag()),b.center=this._map.transform.center,pa(b,x)}if(h.zoom){const x=vr(h.zoom,m,nf);b.zoom=this._map.transform.zoom+x.amount,pa(b,x)}if(h.bearing){const x=vr(h.bearing,m,zi);b.bearing=this._map.transform.bearing+d.clamp(x.amount,-179,179),pa(b,x)}if(h.pitch){const x=vr(h.pitch,m,ku);b.pitch=this._map.transform.pitch+x.amount,pa(b,x)}if(b.zoom||b.bearing){const x=void 0===h.pinchAround?h.around:h.pinchAround;b.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),d.extend(b,{noMoveStart:!0})}}function pa(g,s){(!g.duration||g.duration<s.duration)&&(g.duration=s.duration,g.easing=s.easing)}function vr(g,s,h){const{maxSpeed:m,linearity:b,deceleration:x}=h,E=d.clamp(g*b/(s/1e3),-m,m),S=Math.abs(E)/(x*b);return{easing:h.easing,duration:1e3*S,amount:E*(S/2)}}class Zr extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m,b={}){const x=ne.mousePos(h.getCanvasContainer(),m),E=h.unproject(x);super(s,d.extend({point:x,lngLat:E,originalEvent:m},b)),this._defaultPrevented=!1,this.target=h}}class Wa extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){const b="touchend"===s?m.changedTouches:m.touches,x=ne.touchPos(h.getCanvasContainer(),b),E=x.map(k=>h.unproject(k)),S=x.reduce((k,R,L,z)=>k.add(R.div(z.length)),new d.pointGeometry(0,0));super(s,{points:x,point:S,lngLats:E,lngLat:h.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Za extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class rr{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Za(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Zr(s.type,this._map,s))}mouseup(s){this._map.fire(new Zr(s.type,this._map,s))}preclick(s){const h=d.extend({},s);h.type="preclick",this._map.fire(new Zr(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Zr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Zr(s.type,this._map,s))}mouseover(s){this._map.fire(new Zr(s.type,this._map,s))}mouseout(s){this._map.fire(new Zr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Wa(s.type,this._map,s))}touchmove(s){this._map.fire(new Wa(s.type,this._map,s))}touchend(s){this._map.fire(new Wa(s.type,this._map,s))}touchcancel(s){this._map.fire(new Wa(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nh{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Zr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Zr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&0===s.button&&(ne.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=m,this._box||(this._box=ne.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const x=Math.min(b.x,m.x),E=Math.max(b.x,m.x),S=Math.min(b.y,m.y),k=Math.max(b.y,m.y);this._map._requestDomTask(()=>{this._box&&(ne.setTransform(this._box,`translate(${x}px,${S}px)`),this._box.style.width=E-x+"px",this._box.style.height=k-S+"px")})}mouseupWindow(s,h){if(!this._active||0!==s.button)return;const m=this._startPos,b=h;if(this.reset(),ne.suppressClick(),m.x!==b.x||m.y!==b.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ne.remove(this._box),this._box=null),ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new d.Event(s,{originalEvent:h}))}}function Nu(g,s){const h={};for(let m=0;m<g.length;m++)h[g[m].identifier]=s[m];return h}class Vs{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(b){const x=new d.pointGeometry(0,0);for(const E of b)x._add(E);return x.div(b.length)}(h),this.touches=Nu(m,h)))}touchmove(s,h,m){if(this.aborted||!this.centroid)return;const b=Nu(m,h);for(const x in this.touches){const E=this.touches[x],S=b[x];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(s,h,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Uc{constructor(s){this.singleTap=new Vs(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,m){this.singleTap.touchstart(s,h,m)}touchmove(s,h,m){this.singleTap.touchmove(s,h,m)}touchend(s,h,m){const b=this.singleTap.touchend(s,h,m);if(b){const x=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(x&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Ru{constructor(){this._zoomIn=new Uc({numTouches:1,numTaps:2}),this._zoomOut=new Uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,m){this._zoomIn.touchstart(s,h,m),this._zoomOut.touchstart(s,h,m)}touchmove(s,h,m){this._zoomIn.touchmove(s,h,m),this._zoomOut.touchmove(s,h,m)}touchend(s,h,m){const b=this._zoomIn.touchend(s,h,m),x=this._zoomOut.touchend(s,h,m);return b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const It={0:1,2:2};class of{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const m=ne.mouseButton(s);this._correctButton(s,m)&&(this._lastPoint=h,this._eventButton=m)}mousemoveWindow(s,h){const m=this._lastPoint;if(m)if(s.preventDefault(),function(b,x){const E=It[x];return void 0===b.buttons||(b.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(m,h)}mouseupWindow(s){this._lastPoint&&ne.mouseButton(s)===this._eventButton&&(this._moved&&ne.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zs extends of{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return 0===h&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Rh extends of{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const m=.8*(h.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class Us extends of{_correctButton(s,h){return 0===h&&s.ctrlKey||2===h}_move(s,h){const m=-.5*(h.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class Xa{constructor(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(s,h,m){return this._calculateTransform(s,h,m)}touchmove(s,h,m){if(this._active&&!(m.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,m)}touchend(s,h,m){this._calculateTransform(s,h,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,m){m.length>0&&(this._active=!0);const b=Nu(m,h),x=new d.pointGeometry(0,0),E=new d.pointGeometry(0,0);let S=0;for(const R in b){const L=b[R],z=this._touches[R];z&&(x._add(L),E._add(L.sub(z)),S++,b[R]=L)}if(this._touches=b,S<this._minTouches||!E.mag())return;const k=E.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,m){return{}}touchstart(s,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,m){if(!this._firstTwoTouches)return;s.preventDefault();const[b,x]=this._firstTwoTouches,E=Fu(m,h,b),S=Fu(m,h,x);if(!E||!S)return;const k=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],k,s)}touchend(s,h,m){if(!this._firstTwoTouches)return;const[b,x]=this._firstTwoTouches,E=Fu(m,h,b),S=Fu(m,h,x);E&&S||(this._active&&ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fu(g,s,h){for(let m=0;m<g.length;m++)if(g[m].identifier===h)return s[m]}function tt(g,s){return Math.log(g/s)/Math.LN2}class An extends Fh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(tt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:tt(this._distance,m),pinchAround:h}}}function mn(g,s){return 180*g.angleWith(s)/Math.PI}class Ti extends Fh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mn(this._vector,m),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,m=mn(s,this._startVector);return Math.abs(m)<h}}function oo(g){return Math.abs(g.y)>Math.abs(g.x)}class Jl extends Fh{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(s){this._lastPoints=s,oo(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,m){const b=s[0].sub(this._lastPoints[0]),x=s[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,x,m.timeStamp),this._valid)return this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+x.y)/2*-.5}}gestureBeginsVertically(s,h,m){if(void 0!==this._valid)return this._valid;const b=s.mag()>=2,x=h.mag()>=2;if(!b&&!x)return;if(!b||!x)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return oo(s)&&oo(h)&&E}}const qo={panStep:100,bearingStep:15,pitchStep:10};class Ya{constructor(){const s=qo;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,m=0,b=0,x=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?b=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?b=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:S=>{const k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:yt,zoom:h?Math.round(k)+h*(s.shiftKey?2:1):k,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+b*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yt(g){return g*(2-g)}const sf=4.000244140625;class af{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;let h=s.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=d.exported.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==h&&h%sf==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ne.mousePos(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform,h=()=>s._terrainEnabled()?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>sf?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==R&&(R=1/R);const L=h(),z=Math.pow(2,L),$="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom($*R))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:h(),b=this._startZoom,x=this._easing;let E,S=!1;if("wheel"===this._type&&b&&x){const k=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),R=x(k);E=d.number(b,m,R),k<1?this._frameId||(this._frameId=!0):S=!0}else E=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:E-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=d.ease;if(this._prevEase){const m=this._prevEase,b=(d.exported.now()-m.start)/m.duration,x=m.easing(b+.01)-m.easing(b),E=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-E*E);h=d.bezier(E,S,.25,1)}return this._prevEase={start:d.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}}class ga{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ma{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class br{constructor(){this._tap=new Uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=h[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,h,m))}touchmove(s,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=h[0],x=b.y-this._swipePoint.y;return this._swipePoint=b,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,h,m)}touchend(s,h,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(s,h,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wo{constructor(s,h,m){this._el=s,this._mousePan=h,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oh{constructor(s,h,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ja{constructor(s,h,m,b){this._el=s,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const so=g=>g.zoom||g.drag||g.pitch||g.rotate;class lf extends d.Event{}class Lh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const m=d.sub([],h,s);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){d.div(s,s,this.constants),d.normalize(s,s),d.mul$2(s,s,this.constants);const h=d.scale([],s,this.radius);if(h[2]>0){const m=d.scale([],[0,0,1],d.dot(h,[0,0,1])),b=d.scale([],d.normalize([],[h[0],h[1],0]),this.radius),x=d.add([],h,d.scale([],d.sub([],d.add([],b,m),h),2));h[0]=x[0],h[1]=x[1]}return h}}function Ka(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Bh{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rf(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Lh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[b,x,E]of this._listeners)ne.addEventListener(b,x,b===d.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,m]of this._listeners)ne.removeEventListener(s,h,s===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new rr(h,s));const b=h.boxZoom=new Pu(h,s);this._add("boxZoom",b);const x=new Ru,E=new ma;h.doubleClickZoom=new ga(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const S=new br;this._add("tapDragZoom",S);const k=h.touchPitch=new Jl;this._add("touchPitch",k);const R=new Rh(s),L=new Us(s);h.dragRotate=new Oh(s,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const z=new zs(s),$=new Xa(s);h.dragPan=new Wo(m,z,$),this._add("mousePan",z),this._add("touchPan",$,["touchZoom","touchRotate"]);const H=new Ti,J=new An;h.touchZoomRotate=new Ja(m,J,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nh(h));const Q=h.scrollZoom=new af(h,this);this._add("scrollZoom",Q,["mousePan"]);const le=h.keyboard=new Ya;this._add("keyboard",le);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[X]&&h[X].enable(s[X])}_add(s,h,m){this._handlers.push({handlerName:s,handler:h,allowed:m}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(so(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,h,m){for(const b in s)if(b!==m&&(!h||h.indexOf(b)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const m of s)this._el.contains(m.target)&&h.push(m);return h}handleEvent(s,h){this._updatingCamera=!0;const m="renderFrame"===s.type,b=m?void 0:s,x={needsRenderFrame:!1},E={},S={},k=s.touches?this._getMapTouches(s.touches):void 0,R=k?ne.touchPos(this._el,k):m?void 0:ne.mousePos(this._el,s);for(const{handlerName:$,handler:H,allowed:J}of this._handlers){if(!H.isEnabled())continue;let Q;this._blockedByActive(S,J,$)?H.reset():H[h||s.type]&&(Q=H[h||s.type](s,R,k),this.mergeHandlerResult(x,E,Q,$,b),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||H.isActive())&&(S[$]=H)}const L={};for(const $ in this._previousActiveHandlers)S[$]||(L[$]=b);this._previousActiveHandlers=S,(Object.keys(L).length||Ka(x))&&(this._changes.push([x,E,L]),this._triggerRenderFrame()),(Object.keys(S).length||Ka(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(s,h,m,b,x){if(!m)return;d.extend(s,m);const E={handlerName:b,originalEvent:m.originalEvent||x};void 0!==m.zoomDelta&&(h.zoom=E),void 0!==m.panDelta&&(h.drag=E),void 0!==m.pitchDelta&&(h.pitch=E),void 0!==m.bearingDelta&&(h.rotate=E)}_applyChanges(){const s={},h={},m={};for(const[b,x,E]of this._changes)b.panDelta&&(s.panDelta=(s.panDelta||new d.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(s.around=b.around),void 0!==b.aroundCoord&&(s.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(s.pinchAround=b.pinchAround),b.noInertia&&(s.noInertia=b.noInertia),d.extend(h,x),d.extend(m,E);this._updateMapTransform(s,h,m),this._changes=[]}_updateMapTransform(s,h,m){const b=this._map,x=b.transform,E=te=>[te.x,te.y,te.z];if((te=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Ka(s)){const te=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",te!==x.zoom&&this._map._update(!0)}if(!Ka(s))return this._fireEvents(h,m,!0);let{panDelta:S,zoomDelta:k,bearingDelta:R,pitchDelta:L,around:z,aroundCoord:$,pinchAround:H}=s;void 0!==H&&(z=H),(te=>h.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=E(x.pointCoordinate3D(z)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",b._stop(!0),z=z||b.transform.centerPoint,R&&(x.bearing+=R),L&&(x.pitch+=L),x._updateCameraState();const J=[0,0,0];if(S){const te=x.screenPointToMercatorRay(z),se=x.screenPointToMercatorRay(z.sub(S)),he=this._trackingEllipsoid.projectRay(te.dir),_e=this._trackingEllipsoid.projectRay(se.dir);J[0]=_e[0]-he[0],J[1]=_e[1]-he[1]}const Q=x.zoom,le=[0,0,0];if(k){const te=E($||x.pointCoordinate3D(z)),se={dir:d.normalize([],d.sub([],te,x._camera.position))},he=x.screenPointToMercatorRay(x.centerPoint);if(se.dir[2]<0){const _e=d.altitudeFromMercatorZ(te[2],te[1]),oe=x.rayIntersectionCoordinate(x.pointRayIntersection(x.centerPoint,_e)),we=x.zoomDeltaToMovement(E(oe),k)*(he.dir[2]/se.dir[2]);d.scale(le,se.dir,we)}else if(x._terrainEnabled()){const _e=x.zoomDeltaToMovement(te,k);d.scale(le,se.dir,_e)}}const X=d.add(J,J,le);x._translateCameraConstrained(X),k&&Math.abs(x.zoom-Q)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,m,!0)}_fireEvents(s,h,m){const b=so(this._eventsInProgress),x=so(s),E={};for(const L in s){const{originalEvent:z}=s[L];this._eventsInProgress[L]||(E[`${L}start`]=z),this._eventsInProgress[L]=s[L]}!b&&x&&this._fireEvent("movestart",x.originalEvent);for(const L in E)this._fireEvent(L,E[L]);x&&this._fireEvent("move",x.originalEvent);for(const L in s){const{originalEvent:z}=s[L];this._fireEvent(L,z)}const S={};let k;for(const L in this._eventsInProgress){const{handlerName:z,originalEvent:$}=this._eventsInProgress[L];this._handlersById[z].isActive()||(delete this._eventsInProgress[L],k=h[z]||$,S[`${L}end`]=k)}for(const L in S)this._fireEvent(L,S[L]);const R=so(this._eventsInProgress);if(m&&(b||x)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;L?(z(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new d.Event("moveend",{originalEvent:k})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new d.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new lf("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Kl extends d.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,m){return s=d.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,d.extend({offset:s},h),m)}panTo(s,h,m){return this.easeTo(d.extend({center:s},h),m)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,m){return this.easeTo(d.extend({zoom:s},h),m)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,m){return this.easeTo(d.extend({bearing:s},h),m)}resetNorth(s,h){return this.rotateTo(0,d.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=d.LngLatBounds.convert(s);const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),m,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(s=d.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding){const m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=d.extend(h,s.padding),s}_cameraForBoxAndBearing(s,h,m,b){const x=this._extendCameraOptions(b),E=this.transform,S=E.padding,k=E.project(d.LngLat.convert(s)),R=E.project(d.LngLat.convert(h)),L=k.rotate(-d.degToRad(m)),z=R.rotate(-d.degToRad(m)),$=new d.pointGeometry(Math.max(L.x,z.x),Math.max(L.y,z.y)),H=new d.pointGeometry(Math.min(L.x,z.x),Math.min(L.y,z.y)),J=$.sub(H),Q=(E.width-(S.left+S.right+x.padding.left+x.padding.right))/J.x,le=(E.height-(S.top+S.bottom+x.padding.top+x.padding.bottom))/J.y;if(le<0||Q<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const X=Math.min(E.scaleZoom(E.scale*Math.min(Q,le)),x.maxZoom),te="number"==typeof x.offset.x?new d.pointGeometry(x.offset.x,x.offset.y):d.pointGeometry.convert(x.offset),se=new d.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(m*Math.PI/180),he=te.add(se).mult(E.scale/E.zoomScale(X));return{center:E.unproject(k.add(R).div(2).sub(he)),zoom:X,bearing:m}}_cameraForBox(s,h,m,b,x){const E=this._extendCameraOptions(x);m=m||0,b=b||0,s=d.LngLat.convert(s),h=d.LngLat.convert(h);const S=this.transform.clone();S.padding=E.padding;const k=this.getFreeCameraOptions(),R=new d.LngLat(.5*(s.lng+h.lng),.5*(s.lat+h.lat)),L=.5*(m+b);if(S._camera.position[2]<d.mercatorZfromAltitude(L,R.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(R),S.setFreeCameraOptions(k);const z=d.MercatorCoordinate.fromLngLat(s),$=d.MercatorCoordinate.fromLngLat(h),H=S.pointRayIntersection(S.centerPoint,L),J=[(Q=S.rayIntersectionCoordinate(H)).x,Q.y,Q.z];var Q;const le=S.screenPointToMercatorRay(S.centerPoint);let X,te=0;do{const se=Math.floor(S.zoom),he=1<<se,_e=Math.min(he*z.x,he*$.x),oe=Math.min(he*z.y,he*$.y),we=Math.max(he*z.x,he*$.x),ze=Math.max(he*z.y,he*$.y),Ye=new Gn([_e,oe,m],[we,ze,b]),xe=jt.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,se);if(2!==Ye.intersects(xe)){X&&(S._camera.position=d.scaleAndAdd([],S._camera.position,le.dir,-X),S._updateStateFromCamera());break}const Fe=d.sub([],S._camera.position,J);X=.5*d.length(Fe),S._camera.position=d.scaleAndAdd([],S._camera.position,le.dir,X);try{S._updateStateFromCamera()}catch(gt){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++te<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(s,h,m){return this._fitInternal(this.cameraForBounds(s,h),h,m)}_raycastElevationBox(s,h){const m=this.transform.elevation;if(!m)return;const b=new d.pointGeometry(s.x,h.y),x=new d.pointGeometry(h.x,s.y),E=m.pointCoordinate(s);if(!E)return;const S=m.pointCoordinate(h);if(!S)return;const k=m.pointCoordinate(b);if(!k)return;const R=m.pointCoordinate(x);if(!R)return;const L=new d.MercatorCoordinate(E[0],E[1]).toLngLat(),z=new d.MercatorCoordinate(S[0],S[1]).toLngLat(),$=new d.MercatorCoordinate(k[0],k[1]).toLngLat(),H=new d.MercatorCoordinate(R[0],R[1]).toLngLat(),J=Math.min(L.lng,Math.min(z.lng,Math.min($.lng,H.lng))),Q=Math.min(L.lat,Math.min(z.lat,Math.min($.lat,H.lat))),le=Math.max(L.lng,Math.max(z.lng,Math.max($.lng,H.lng))),X=Math.max(L.lat,Math.max(z.lat,Math.max($.lat,H.lat))),te=Math.min(E[3],Math.min(S[3],Math.min(k[3],R[3]))),se=Math.max(E[3],Math.max(S[3],Math.max(k[3],R[3])));return{minLngLat:new d.LngLat(J,Q),maxLngLat:new d.LngLat(le,X),minAltitude:te,maxAltitude:se}}fitScreenCoordinates(s,h,m,b,x){let E,S,k,R;const L=d.pointGeometry.convert(s),z=d.pointGeometry.convert(h),$=this._raycastElevationBox(L,z);if($)E=$.minLngLat,S=$.maxLngLat,k=$.minAltitude,R=$.maxAltitude;else{if(this.transform.isCornerOffEdge(L,z))return this;E=this.transform.pointLocation(L),S=this.transform.pointLocation(z)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(s)),this.transform.pointLocation(d.pointGeometry.convert(h)),m,b):this._cameraForBox(E,S,k,R,b),b,x)}_fitInternal(s,h,m){return s?(delete(h=d.extend(s,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(s,h){this.stop();const m=this.transform;let b=!1,x=!1,E=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(b=!0,m.zoom=+s.zoom),void 0!==s.center&&(m.center=d.LngLat.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(E=!0,m.pitch=+s.pitch),null==s.padding||m.isPaddingEqual(s.padding)||(m.padding=s.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),b&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),x&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),E&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){this.stop();const m=this.transform,b=m.zoom,x=m.pitch,E=m.bearing;m.setFreeCameraOptions(s);const S=b!==m.zoom,k=x!==m.pitch,R=E!==m.bearing;return this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),S&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),R&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),k&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),(!1===(s=d.extend({offset:[0,0],duration:500,easing:d.ease},s)).animate||!s.essential&&d.exported.prefersReducedMotion)&&(s.duration=0);const m=this.transform,b=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),k="zoom"in s?+s.zoom:b,R="bearing"in s?this._normalizeBearing(s.bearing,x):x,L="pitch"in s?+s.pitch:E,z="padding"in s?s.padding:m.padding,$=d.pointGeometry.convert(s.offset);let H=m.centerPoint.add($);const J=m.pointLocation(H),Q=d.LngLat.convert(s.center||J);this._normalizeCenter(Q);const le=m.project(J),X=m.project(Q).sub(le),te=m.zoomScale(k-b);let se,he;s.around&&(se=d.LngLat.convert(s.around),he=m.locationPoint(se));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==b,this._rotating=this._rotating||x!==R,this._pitching=this._pitching||L!==E,this._padding=!m.isPaddingEqual(z),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,_e),this._ease(oe=>{if(this._zooming&&(m.zoom=d.number(b,k,oe)),this._rotating&&(m.bearing=d.number(x,R,oe)),this._pitching&&(m.pitch=d.number(E,L,oe)),this._padding&&(m.interpolatePadding(S,z,oe),H=m.centerPoint.add($)),se)m.setLocationAtPoint(se,he);else{const we=m.zoomScale(m.zoom-b),ze=k>b?Math.min(2,te):Math.max(.5,te),Ye=Math.pow(ze,1-oe),xe=m.unproject(le.add(X.mult(oe*Ye)).mult(we));m.setLocationAtPoint(m.renderWorldCopies?xe.wrap():xe,H)}this._fireMoveEvents(h)},oe=>{m.recenterOnTerrain(),this._afterEase(h,oe)},s),this}_prepareEase(s,h,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||m.moving||this.fire(new d.Event("movestart",s)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new d.Event("move",s)),this._zooming&&this.fire(new d.Event("zoom",s)),this._rotating&&this.fire(new d.Event("rotate",s)),this._pitching&&this.fire(new d.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,b=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",s)),b&&this.fire(new d.Event("rotateend",s)),x&&this.fire(new d.Event("pitchend",s)),this.fire(new d.Event("moveend",s))}flyTo(s,h){if(!s.essential&&d.exported.prefersReducedMotion){const it=d.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(it,h)}this.stop(),s=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},s);const m=this.transform,b=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),k="zoom"in s?d.clamp(+s.zoom,m.minZoom,m.maxZoom):b,R="bearing"in s?this._normalizeBearing(s.bearing,x):x,L="pitch"in s?+s.pitch:E,z="padding"in s?s.padding:m.padding,$=m.zoomScale(k-b),H=d.pointGeometry.convert(s.offset);let J=m.centerPoint.add(H);const Q=m.pointLocation(J),le=d.LngLat.convert(s.center||Q);this._normalizeCenter(le);const X=m.project(Q),te=m.project(le).sub(X);let se=s.curve;const he=Math.max(m.width,m.height),_e=he/$,oe=te.mag();if("minZoom"in s){const it=d.clamp(Math.min(s.minZoom,b,k),m.minZoom,m.maxZoom),vt=he/m.zoomScale(it-b);se=Math.sqrt(vt/oe*2)}const we=se*se;function ze(it){const vt=(_e*_e-he*he+(it?-1:1)*we*we*oe*oe)/(2*(it?_e:he)*we*oe);return Math.log(Math.sqrt(vt*vt+1)-vt)}function Ye(it){return(Math.exp(it)-Math.exp(-it))/2}function xe(it){return(Math.exp(it)+Math.exp(-it))/2}const Fe=ze(0);let gt=function(it){return xe(Fe)/xe(Fe+se*it)},mt=function(it){return he*((xe(Fe)*(Ye(vt=Fe+se*it)/xe(vt))-Ye(Fe))/we)/oe;var vt},_t=(ze(1)-Fe)/se;if(Math.abs(oe)<1e-6||!isFinite(_t)){if(Math.abs(he-_e)<1e-6)return this.easeTo(s,h);const it=_e<he?-1:1;_t=Math.abs(Math.log(_e/he))/se,mt=function(){return 0},gt=function(vt){return Math.exp(it*se*vt)}}return s.duration="duration"in s?+s.duration:1e3*_t/("screenSpeed"in s?+s.screenSpeed/se:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=x!==R,this._pitching=L!==E,this._padding=!m.isPaddingEqual(z),this._prepareEase(h,!1),this._ease(it=>{const vt=it*_t,Xt=1/gt(vt);m.zoom=1===it?k:b+m.scaleZoom(Xt),this._rotating&&(m.bearing=d.number(x,R,it)),this._pitching&&(m.pitch=d.number(E,L,it)),this._padding&&(m.interpolatePadding(S,z,it),J=m.centerPoint.add(H));const $t=1===it?le:m.unproject(X.add(te.mult(mt(vt))).mult(Xt));m.setLocationAtPoint(m.renderWorldCopies?$t.wrap():$t,J),m._updateCenterElevation(),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,h,m){!1===m.animate||0===m.duration?(s(1),h()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=d.wrap(s,-180,180);const m=Math.abs(s-h);return Math.abs(s-360-h)<m&&(s-=360),Math.abs(s+360-h)<m&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const m=s.lng-h.center.lng;s.lng+=m>180?-360:m<-180?360:0}}class $c{constructor(s={}){this.options=s,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ne.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const m=this._map._getUIString(`AttributionControl.${h}`);s.title=m,s.setAttribute("aria-label",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(s){const m=h.reduce((b,x,E)=>(x.value&&(b+=`${x.key}=${x.value}${E<h.length-1?"&":""}`),b),"?");s.href=`${d.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(b=>"string"!=typeof b?"":b)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style._sourceCaches;for(const b in h){const x=h[b];if(x.used){const E=x.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((b,x)=>b.length-x.length),s=s.filter((b,x)=>{for(let E=x+1;E<s.length;E++)if(s[E].indexOf(b)>=0)return!1;return!0});const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ou{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(s){this._map=s,this._container=ne.create("div","mapboxgl-ctrl");const h=ne.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ne.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(0===Object.entries(s).length)return!0;for(const h in s){const m=s[h].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class jc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const b of m)if(b.id===s)return void(b.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vh(g,s,h){if(g=new d.LngLat(g.lng,g.lat),s){const m=new d.LngLat(g.lng-360,g.lat),b=new d.LngLat(g.lng+360,g.lat),x=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),E=h.locationPoint(g).distSqr(s),S=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(m).distSqr(s)<E&&(S||Math.abs(m.lng-h.center.lng)<x)?g=m:h.locationPoint(b).distSqr(s)<E&&(S||Math.abs(b.lng-h.center.lng)<x)&&(g=b)}for(;Math.abs(g.lng-h.center.lng)>180;){const m=h.locationPoint(g);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Hc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Qa extends d.Evented{constructor(s,h){if(super(),(s instanceof d.window.HTMLElement||h)&&(s=d.extend({element:s},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=d.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne.create("div"),this._element.setAttribute("aria-label","Map marker");const b=ne.createNS("http://www.w3.org/2000/svg","svg"),x=41,E=27;b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height",`${x}px`),b.setAttributeNS(null,"width",`${E}px`),b.setAttributeNS(null,"viewBox",`0 0 ${E} ${x}`);const S=ne.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const k=ne.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");const R=ne.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of L){const he=ne.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",se.rx),he.setAttributeNS(null,"ry",se.ry),R.appendChild(he)}const z=ne.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const $=ne.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild($);const H=ne.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const J=ne.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(J);const Q=ne.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");const le=ne.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=ne.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const te=ne.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#FFFFFF"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962"),le.appendChild(X),le.appendChild(te),k.appendChild(R),k.appendChild(z),k.appendChild(H),k.appendChild(Q),k.appendChild(le),b.appendChild(k),b.setAttributeNS(null,"height",x*this._scale+"px"),b.setAttributeNS(null,"width",E*this._scale+"px"),this._element.appendChild(b),this._offset=d.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const m=this._element.classList;for(const b in Hc)m.remove(`mapboxgl-marker-anchor-${b}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=d.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const h=38.1,m=13.5,b=Math.sqrt(Math.pow(m,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-h],"bottom-left":[b,-1*(h-m+b)],"bottom-right":[-b,-1*(h-m+b)],left:[m,-1*(h-m)],right:[-m,-1*(h-m)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,m=s.charCode||s.keyCode;"Space"!==h&&"Enter"!==h&&32!==m&&13!==m||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_evaluateOpacity(){const s=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(s))return void this._clearFadeTimer();const h=this._map.unproject(s);let m=!1;if(this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const E=x.position.toLngLat();m=E.distanceTo(h)<.9*E.distanceTo(this._lngLat)}}const b=(1-this._map._queryFogOpacity(h))*(m?.2:1);this._element.style.opacity=`${b}`,this._popup&&this._popup._setOpacity(`${b}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(s){const h=this._map.transform;return!!s&&s.x>=0&&s.x<h.width&&s.y>=0&&s.y<h.height}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Vh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?m="rotateX(0deg)":"map"===this._pitchAlignment&&(m=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ne.setTransform(this._element,`${Hc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const s=this._map.transform,h=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&h._rotate(s.angle),"map"===this._pitchAlignment&&(h.y*=Math.cos(s._pitch)),h}getOffset(){return this._offset}setOffset(s){return this._offset=d.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class zh{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=d.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,m){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+m}}const Lu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Ql,HTMLElement:Uh,ImageBitmap:_s}=d.window,cf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Gc(g){g.parentNode&&g.parentNode.removeChild(g)}const xr={showCompass:!0,showZoom:!0,visualizePitch:!1};class ys{constructor(s,h,m=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Rh({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new Us({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ne.addEventListener(h,"mousedown",this.mousedown),ne.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),ne.addEventListener(h,"touchmove",this.touchmove),ne.addEventListener(h,"touchend",this.touchend),ne.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),ne.disableDrag()}move(s,h){const m=this.map,b=this.mouseRotate.mousemoveWindow(s,h);if(b&&b.bearingDelta&&m.setBearing(m.getBearing()+b.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(s,h);x&&x.pitchDelta&&m.setPitch(m.getPitch()+x.pitchDelta)}}off(){const s=this.element;ne.removeEventListener(s,"mousedown",this.mousedown),ne.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),ne.removeEventListener(s,"touchmove",this.touchmove),ne.removeEventListener(s,"touchend",this.touchend),ne.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){ne.enableDrag(),ne.removeEventListener(d.window,"mousemove",this.mousemove),ne.removeEventListener(d.window,"mouseup",this.mouseup)}mousedown(s){this.down(d.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),ne.mousePos(this.element,s)),ne.addEventListener(d.window,"mousemove",this.mousemove),ne.addEventListener(d.window,"mouseup",this.mouseup)}mousemove(s){this.move(s,ne.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=ne.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=ne.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Mi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Zo,ec=0,$s=!1;const Yp={maxWidth:100,unit:"metric"};function uf(g,s,h){const m=h&&h.maxWidth||100,b=g._container.getBoundingClientRect().height/2,x=g.unproject([0,b]),E=g.unproject([m,b]),S=x.distanceTo(E);if(h&&"imperial"===h.unit){const k=3.2808*S;k>5280?el(s,m,k/5280,g._getUIString("ScaleControl.Miles"),g):el(s,m,k,g._getUIString("ScaleControl.Feet"),g)}else h&&"nautical"===h.unit?el(s,m,S/1852,g._getUIString("ScaleControl.NauticalMiles"),g):S>=1e3?el(s,m,S/1e3,g._getUIString("ScaleControl.Kilometers"),g):el(s,m,S,g._getUIString("ScaleControl.Meters"),g)}function el(g,s,h,m,b){const x=function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let R=S/k;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const z=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*z)/z}(R),k*R}(h),E=x/h;b._requestDomTask(()=>{g.style.width=s*E+"px",g.innerHTML=`${x}&nbsp;${m}`})}const qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),tl={version:d.version,supported:Pe,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Kl{constructor(g){if(null!=(g=d.extend({},cf,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fa(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._renderTaskQueue=new jc,this._domRenderTaskQueue=new jc,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Lu,g.locale),this._clickTolerance=g.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new zh(0),this._requestManager=new d.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=d.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof Uh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Bh(this,g),this._hash=g.hash&&new Ei("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,d.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.attributionControl&&this.addControl(new $c({customAttribution:g.customAttribution})),this._logoControl=new Ou,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update("style"===s.dataType),this.fire(new d.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(g,s){if(void 0===s&&(s=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const m=this._controlPositions[s];return-1!==s.indexOf("bottom")?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(g);return s>-1&&this._controls.splice(s,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){const[s,h]=this._containerDimensions();if(s===this.transform.width&&h===this.transform.height)return this;this._resizeCanvas(s,h),this.transform.resize(s,h),this.painter.resize(Math.ceil(s),Math.ceil(h));const m=!this._moving;return m&&this.fire(new d.Event("movestart",g)).fire(new d.Event("move",g)),this.fire(new d.Event("resize",g)),m&&this.fire(new d.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(d.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=null==g?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=null==g?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=null==g?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=null==g?85:g)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint3D(d.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(d.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(g,s,h){if("mouseenter"===g||"mouseover"===g){let m=!1;return{layer:s,listener:h,delegates:{mousemove:x=>{const E=this.getLayer(s)?this.queryRenderedFeatures(x.point,{layers:[s]}):[];E.length?m||(m=!0,h.call(this,new Zr(g,this,x.originalEvent,{features:E}))):m=!1},mouseout:()=>{m=!1}}}}if("mouseleave"===g||"mouseout"===g){let m=!1;return{layer:s,listener:h,delegates:{mousemove:E=>{(this.getLayer(s)?this.queryRenderedFeatures(E.point,{layers:[s]}):[]).length?m=!0:m&&(m=!1,h.call(this,new Zr(g,this,E.originalEvent)))},mouseout:E=>{m&&(m=!1,h.call(this,new Zr(g,this,E.originalEvent)))}}}}{const m=b=>{const x=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];x.length&&(b.features=x,h.call(this,b),delete b.features)};return{layer:s,listener:h,delegates:{[g]:m}}}}on(g,s,h){if(void 0===h)return super.on(g,s);const m=this._createDelegatedListener(g,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(m);for(const b in m.delegates)this.on(b,m.delegates[b]);return this}once(g,s,h){if(void 0===h)return super.once(g,s);const m=this._createDelegatedListener(g,s,h);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(g,s,h){return void 0===h?super.off(g,s):(this._delegatedListeners&&this._delegatedListeners[g]&&(m=>{const b=this._delegatedListeners[g];for(let x=0;x<b.length;x++){const E=b[x];if(E.layer===s&&E.listener===h){for(const S in E.delegates)this.off(S,E.delegates[S]);return b.splice(x,1),this}}})(),this)}queryRenderedFeatures(g,s){return this.style?(void 0!==s||void 0===g||g instanceof d.pointGeometry||Array.isArray(g)||(s=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(g,s){return this.style.querySourceFeatures(g,s)}queryTerrainElevation(g,s){const h=this.transform.elevation;return h?(s=d.extend({},{exaggerated:!0},s),h.getAtPoint(d.MercatorCoordinate.fromLngLat(g),null,s.exaggerated)):null}setStyle(g,s){return!1!==(s=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(g,s))}_getUIString(g){const s=this._locale[g];if(null==s)throw new Error(`Missing UI string '${g}'`);return s}_updateStyle(g,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),g&&(this.style=new Mo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,s){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),m=this._requestManager.transformRequest(h,d.ResourceType.Style);d.getJSON(m,(b,x)=>{b?this.fire(new d.ErrorEvent(b)):x&&this._updateDiff(x,s)})}else"object"==typeof g&&this._updateDiff(g,s)}_updateDiff(g,s){try{this.style.setState(g)&&this._update(!0)}catch(h){d.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(g,s){return this._lazyInitEmptyStyle(),this.style.addSource(g,s),this._update(!0)}isSourceLoaded(g){const s=this.style&&this.style._getSourceCaches(g);if(0!==s.length)return s.every(h=>h.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const s in g){const h=g[s]._tiles;for(const m in h){const b=h[m];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(g,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,s,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,s,{pixelRatio:h=1,sdf:m=!1,stretchX:b,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof Ql||_s&&s instanceof _s){const{width:S,height:k,data:R}=d.exported.getImageData(s);this.style.addImage(g,{data:new d.RGBAImage({width:S,height:k},R),pixelRatio:h,stretchX:b,stretchY:x,content:E,sdf:m,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:k,data:R}=s,L=s;this.style.addImage(g,{data:new d.RGBAImage({width:S,height:k},new Uint8Array(R)),pixelRatio:h,stretchX:b,stretchY:x,content:E,sdf:m,version:0,userImage:L}),L.onAdd&&L.onAdd(this,g)}}}updateImage(g,s){const h=this.style.getImage(g);if(!h)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof Ql||_s&&s instanceof _s?d.exported.getImageData(s):s,{width:b,height:x,data:E}=m;return void 0===b||void 0===x?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):b!==h.data.width||x!==h.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(h.data.replace(E,!(s instanceof Ql||_s&&s instanceof _s)),void this.style.updateImage(g,h))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,s){d.getImage(this._requestManager.transformRequest(g,d.ResourceType.Image),(h,m)=>{s(h,m instanceof Ql?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(g,s){return this._lazyInitEmptyStyle(),this.style.addLayer(g,s),this._update(!0)}moveLayer(g,s){return this.style.moveLayer(g,s),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,s,h){return this.style.setLayerZoomRange(g,s,h),this._update(!0)}setFilter(g,s,h={}){return this.style.setFilter(g,s,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,s,h,m={}){return this.style.setPaintProperty(g,s,h,m),this._update(!0)}getPaintProperty(g,s){return this.style.getPaintProperty(g,s)}setLayoutProperty(g,s,h,m={}){return this.style.setLayoutProperty(g,s,h,m),this._update(!0)}getLayoutProperty(g,s){return this.style.getLayoutProperty(g,s)}setLight(g,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(g),this.transform):0}setFeatureState(g,s){return this.style.setFeatureState(g,s),this._update()}removeFeatureState(g,s){return this.style.removeFeatureState(g,s),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_containerDimensions(){let g=0,s=0;return this._container&&(g=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300),[g,s]}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=ne.create("div","mapboxgl-canvas-container",g);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=ne.create("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1]);const m=this._controlContainer=ne.create("div","mapboxgl-control-container",g),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{b[x]=ne.create("div",`mapboxgl-ctrl-${x}`,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,s){const h=d.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${s}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const s=this._markers.indexOf(g);-1!==s&&this._markers.splice(s,1)}_setupPainter(){const g=d.extend({},Pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);s?(d.storeAuthState(s,!0),this.painter=new Vc(s,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(s)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.isMoving()&&this.loaded()?g():this._domRenderTaskQueue.add(g)}_render(g){let s;const h=this.painter.context.extTimerQuery,m=d.exported.now();this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s));let b=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;let x=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,R=d.exported.now();this.style.zoomHistory.update(k,R);const L=new d.EvaluationParameters(k,{now:R,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),z=L.crossFadingFactor();1===z&&z===this._crossFadingFactor||(x=!0,this._crossFadingFactor=z),this.style.update(L)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=d.exported.now()-m;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const R=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new d.Event("gpu-timing-frame",{cpuTime:k,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(k);this.fire(new d.Event("gpu-timing-layer",{layerTimes:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(b=this._updateAverageElevation(m,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const g of this._markers)g._update()}_updateAverageElevation(g,s=!1){const h=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((s||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const m=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const x=Math.abs(m-b);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(b),h(b);this._averageElevation.easeTo(b,g,300)}else if(x>1e-4)return this._averageElevation.jumpTo(b),h(b)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===d.AUTH_ERR_MSG||401===g.status)){const s=this.painter.context.gl;d.storeAuthState(s,!1),this._logoControl instanceof Ou&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,m=h.createFramebuffer();function b(x){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,x,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,m),this._canvasPixelComparison(b(g),s.canvasCopies.map(b),s.timeStamps)}_canvasPixelComparison(g,s,h){let m=h[1]-h[0];const b=g.length/4;for(let x=0;x<s.length;x++){const E=s[x];let S=0;for(let k=0;k<E.length;k+=4)E[k]===g[k]&&E[k+1]===g[k+1]&&E[k+2]===g[k+2]&&E[k+3]===g[k+3]&&(S+=1);m+=(h[x+2]-h[x+1])*(1-S/b)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),Gc(this._canvasContainer),Gc(this._controlContainer),Gc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=d.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}_setCacheLimits(g,s){d.setCacheLimits(g,s)}get version(){return d.version}},NavigationControl:class{constructor(g){this.options=d.extend({},xr,g),this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),ne.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),ne.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=ne.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const g=this._map.getZoom(),s=g===this._map.getMaxZoom(),h=g===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=g)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ys(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,s){const h=ne.create("button",g,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(g,s){const h=this._map._getUIString(`NavigationControl.${s}`);g.title=h,g.setAttribute("aria-label",h)}},GeolocateControl:class extends d.Evented{constructor(g){super(),this.options=d.extend({},Mi,g),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Xp(this._updateMarkerRotation,20)}onAdd(g){var s;return this._map=g,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,void 0!==Zo?s(Zo):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(h=>{Zo="denied"!==h.state,s(Zo)}):(Zo=!!d.window.navigator.geolocation,s(Zo)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ne.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ec=0,$s=!1}_isOutOfMapMaxBounds(g){const s=this._map.getMaxBounds(),h=g.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",g)),this._finish()}}_updateCamera(g){const s=new d.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,m=this._map.getBearing(),b=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),b,{geolocateSource:!0})}_updateMarker(g){if(g){const s=new d.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._container.getBoundingClientRect().height/2,s=this._map.unproject([0,g]),h=this._map.unproject([100,g]),m=s.distanceTo(h)/100,b=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&$s)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=ne.create("button","mapboxgl-ctrl-geolocate",this._container),ne.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===g){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ne.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ec--,$s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ec++,ec>1?(g={maximumAge:6e5,timeout:0},$s=!0):(g=this.options.positionOptions,$s=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(s=>{"granted"===s&&g()}).catch(console.error):g()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$c,ScaleControl:class{constructor(g){this.options=d.extend({},Yp,g),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){uf(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,uf(this._map,this._container,this.options)}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof d.window.HTMLElement?this._container=g.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ne.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=ne.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne.create("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden",!0),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(g){super(),this.options=d.extend(Object.create(qc),g),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ne.remove(this._content),this._container&&(ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=d.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(d.window.document.createTextNode(g))}setHTML(g){const s=d.window.document.createDocumentFragment(),h=d.window.document.createElement("body");let m;for(h.innerHTML=g;m=h.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ne.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._container&&this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._container&&this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let s;return this._classList.delete(g)?s=!1:(this._classList.add(g),s=!0),this._container&&this._updateClassList(),s}_createCloseButton(){this.options.closeButton&&(this._closeButton=ne.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const s=this._pos,h=this._container.offsetWidth,m=this._container.offsetHeight;let b;return b=s.y+g.bottom.y<m?["top"]:s.y>this._map.transform.height-m?["bottom"]:[],s.x<h/2?b.push("left"):s.x>this._map.transform.width-h/2&&b.push("right"),0===b.length?"bottom":b.join("-")}_updateClassList(){const g=[...this._classList];g.push("mapboxgl-popup"),this._anchor&&g.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&g.push("mapboxgl-popup-track-pointer"),this._container.className=g.join(" ")}_update(g){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ne.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ne.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vh(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||g){const s=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat),h=function(x){if(x||(x=new d.pointGeometry(0,0)),"number"==typeof x){const E=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,x),"top-left":new d.pointGeometry(E,E),"top-right":new d.pointGeometry(-E,E),bottom:new d.pointGeometry(0,-x),"bottom-left":new d.pointGeometry(E,-E),"bottom-right":new d.pointGeometry(-E,-E),left:new d.pointGeometry(x,0),right:new d.pointGeometry(-x,0)}}if(x instanceof d.pointGeometry||Array.isArray(x)){const E=d.pointGeometry.convert(x);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:d.pointGeometry.convert(x.center||[0,0]),top:d.pointGeometry.convert(x.top||[0,0]),"top-left":d.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(x["top-right"]||[0,0]),bottom:d.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(x["bottom-right"]||[0,0]),left:d.pointGeometry.convert(x.left||[0,0]),right:d.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(h),b=s.add(h[m]).round();this._map._requestDomTask(()=>{this._container&&m&&ne.setTransform(this._container,`${Hc[m]} translate(${b.x}px,${b.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Wc);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._content&&(this._content.style.opacity=g),this._tip&&(this._tip.style.opacity=g)}},Marker:Qa,Style:Mo,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Xl,Evented:d.Evented,config:d.config,prewarm:function(){lt().acquire(pe)},clearPrewarmedResources:function(){const g=Ge;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(pe),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(g){d.config.ACCESS_TOKEN=g},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(g){d.config.API_URL=g},get workerCount(){return De.workerCount},set workerCount(g){De.workerCount=g},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){d.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){d.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return tl}),Le}()},862:Et=>{var Re=1e3,Ie=6e4,Le=60*Ie,Je=24*Le;function q(ne,ye,K,ae){var Ne=ye>=1.5*K;return Math.round(ne/K)+" "+ae+(Ne?"s":"")}Et.exports=function(ne,ye){ye=ye||{};var K=typeof ne;if("string"===K&&ne.length>0)return function(ne){if(!((ne=String(ne)).length>100)){var ye=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(ne);if(ye){var K=parseFloat(ye[1]);switch((ye[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*K;case"weeks":case"week":case"w":return 6048e5*K;case"days":case"day":case"d":return K*Je;case"hours":case"hour":case"hrs":case"hr":case"h":return K*Le;case"minutes":case"minute":case"mins":case"min":case"m":return K*Ie;case"seconds":case"second":case"secs":case"sec":case"s":return K*Re;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return K;default:return}}}}(ne);if("number"===K&&isFinite(ne))return ye.long?function(ne){var ye=Math.abs(ne);return ye>=Je?q(ne,ye,Je,"day"):ye>=Le?q(ne,ye,Le,"hour"):ye>=Ie?q(ne,ye,Ie,"minute"):ye>=Re?q(ne,ye,Re,"second"):ne+" ms"}(ne):function(ne){var ye=Math.abs(ne);return ye>=Je?Math.round(ne/Je)+"d":ye>=Le?Math.round(ne/Le)+"h":ye>=Ie?Math.round(ne/Ie)+"m":ye>=Re?Math.round(ne/Re)+"s":ne+"ms"}(ne);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(ne))}},603:(Et,Re)=>{Re.encode=function(Ie){var Le="";for(var Je in Ie)Ie.hasOwnProperty(Je)&&(Le.length&&(Le+="&"),Le+=encodeURIComponent(Je)+"="+encodeURIComponent(Ie[Je]));return Le},Re.decode=function(Ie){for(var Le={},Je=Ie.split("&"),qe=0,d=Je.length;qe<d;qe++){var Pe=Je[qe].split("=");Le[decodeURIComponent(Pe[0])]=decodeURIComponent(Pe[1])}return Le}},171:Et=>{var Re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ie=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];Et.exports=function(d){var Pe=d,Be=d.indexOf("["),Me=d.indexOf("]");-1!=Be&&-1!=Me&&(d=d.substring(0,Be)+d.substring(Be,Me).replace(/:/g,";")+d.substring(Me,d.length));for(var q=Re.exec(d||""),ne={},ye=14;ye--;)ne[Ie[ye]]=q[ye]||"";return-1!=Be&&-1!=Me&&(ne.source=Pe,ne.host=ne.host.substring(1,ne.host.length-1).replace(/;/g,":"),ne.authority=ne.authority.replace("[","").replace("]","").replace(/;/g,":"),ne.ipv6uri=!0),ne.pathNames=function(qe,d){var Be=d.replace(/\/{2,9}/g,"/").split("/");return("/"==d.substr(0,1)||0===d.length)&&Be.splice(0,1),"/"==d.substr(d.length-1,1)&&Be.splice(Be.length-1,1),Be}(0,ne.path),ne.queryKey=function(qe,d){var Pe={};return d.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Be,Me,q){Me&&(Pe[Me]=q)}),Pe}(0,ne.query),ne}},733:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.reconstructPacket=Re.deconstructPacket=void 0;const Le=Ie(753);function qe(Be,Me){if(!Be)return Be;if(Le.isBinary(Be)){const q={_placeholder:!0,num:Me.length};return Me.push(Be),q}if(Array.isArray(Be)){const q=new Array(Be.length);for(let ne=0;ne<Be.length;ne++)q[ne]=qe(Be[ne],Me);return q}if("object"==typeof Be&&!(Be instanceof Date)){const q={};for(const ne in Be)Be.hasOwnProperty(ne)&&(q[ne]=qe(Be[ne],Me));return q}return Be}function Pe(Be,Me){if(!Be)return Be;if(Be&&Be._placeholder)return Me[Be.num];if(Array.isArray(Be))for(let q=0;q<Be.length;q++)Be[q]=Pe(Be[q],Me);else if("object"==typeof Be)for(const q in Be)Be.hasOwnProperty(q)&&(Be[q]=Pe(Be[q],Me));return Be}Re.deconstructPacket=function(Be){const Me=[],ne=Be;return ne.data=qe(Be.data,Me),ne.attachments=Me.length,{packet:ne,buffers:Me}},Re.reconstructPacket=function(Be,Me){return Be.data=Pe(Be.data,Me),Be.attachments=void 0,Be}},712:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.Decoder=Re.Encoder=Re.PacketType=Re.protocol=void 0;const Le=Ie(899),Je=Ie(733),qe=Ie(753),d=Ie(36)("socket.io-parser");var Pe,ye;Re.protocol=5,(ye=Pe=Re.PacketType||(Re.PacketType={}))[ye.CONNECT=0]="CONNECT",ye[ye.DISCONNECT=1]="DISCONNECT",ye[ye.EVENT=2]="EVENT",ye[ye.ACK=3]="ACK",ye[ye.CONNECT_ERROR=4]="CONNECT_ERROR",ye[ye.BINARY_EVENT=5]="BINARY_EVENT",ye[ye.BINARY_ACK=6]="BINARY_ACK",Re.Encoder=class{encode(K){return d("encoding packet %j",K),K.type!==Pe.EVENT&&K.type!==Pe.ACK||!qe.hasBinary(K)?[this.encodeAsString(K)]:(K.type=K.type===Pe.EVENT?Pe.BINARY_EVENT:Pe.BINARY_ACK,this.encodeAsBinary(K))}encodeAsString(K){let ae=""+K.type;return(K.type===Pe.BINARY_EVENT||K.type===Pe.BINARY_ACK)&&(ae+=K.attachments+"-"),K.nsp&&"/"!==K.nsp&&(ae+=K.nsp+","),null!=K.id&&(ae+=K.id),null!=K.data&&(ae+=JSON.stringify(K.data)),d("encoded %j as %s",K,ae),ae}encodeAsBinary(K){const ae=Je.deconstructPacket(K),Ne=this.encodeAsString(ae.packet),nt=ae.buffers;return nt.unshift(Ne),nt}};class Me extends Le{constructor(){super()}add(K){let ae;if("string"==typeof K)ae=this.decodeString(K),ae.type===Pe.BINARY_EVENT||ae.type===Pe.BINARY_ACK?(this.reconstructor=new ne(ae),0===ae.attachments&&super.emit("decoded",ae)):super.emit("decoded",ae);else{if(!qe.isBinary(K)&&!K.base64)throw new Error("Unknown type: "+K);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");ae=this.reconstructor.takeBinaryData(K),ae&&(this.reconstructor=null,super.emit("decoded",ae))}}decodeString(K){let ae=0;const Ne={type:Number(K.charAt(0))};if(void 0===Pe[Ne.type])throw new Error("unknown packet type "+Ne.type);if(Ne.type===Pe.BINARY_EVENT||Ne.type===Pe.BINARY_ACK){const ct=ae+1;for(;"-"!==K.charAt(++ae)&&ae!=K.length;);const xt=K.substring(ct,ae);if(xt!=Number(xt)||"-"!==K.charAt(ae))throw new Error("Illegal attachments");Ne.attachments=Number(xt)}if("/"===K.charAt(ae+1)){const ct=ae+1;for(;++ae&&","!==K.charAt(ae)&&ae!==K.length;);Ne.nsp=K.substring(ct,ae)}else Ne.nsp="/";const nt=K.charAt(ae+1);if(""!==nt&&Number(nt)==nt){const ct=ae+1;for(;++ae;){const xt=K.charAt(ae);if(null==xt||Number(xt)!=xt){--ae;break}if(ae===K.length)break}Ne.id=Number(K.substring(ct,ae+1))}if(K.charAt(++ae)){const ct=function(ye){try{return JSON.parse(ye)}catch(K){return!1}}(K.substr(ae));if(!Me.isPayloadValid(Ne.type,ct))throw new Error("invalid payload");Ne.data=ct}return d("decoded %s as %j",K,Ne),Ne}static isPayloadValid(K,ae){switch(K){case Pe.CONNECT:return"object"==typeof ae;case Pe.DISCONNECT:return void 0===ae;case Pe.CONNECT_ERROR:return"string"==typeof ae||"object"==typeof ae;case Pe.EVENT:case Pe.BINARY_EVENT:return Array.isArray(ae)&&ae.length>0;case Pe.ACK:case Pe.BINARY_ACK:return Array.isArray(ae)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}Re.Decoder=Me;class ne{constructor(K){this.packet=K,this.buffers=[],this.reconPack=K}takeBinaryData(K){if(this.buffers.push(K),this.buffers.length===this.reconPack.attachments){const ae=Je.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),ae}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},753:(Et,Re)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.hasBinary=Re.isBinary=void 0;const Ie="function"==typeof ArrayBuffer,Je=Object.prototype.toString,qe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Je.call(Blob),d="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Je.call(File);function Pe(Me){return Ie&&(Me instanceof ArrayBuffer||(Me=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(Me):Me.buffer instanceof ArrayBuffer)(Me))||qe&&Me instanceof Blob||d&&Me instanceof File}Re.isBinary=Pe,Re.hasBinary=function Be(Me,q){if(!Me||"object"!=typeof Me)return!1;if(Array.isArray(Me)){for(let ne=0,ye=Me.length;ne<ye;ne++)if(Be(Me[ne]))return!0;return!1}if(Pe(Me))return!0;if(Me.toJSON&&"function"==typeof Me.toJSON&&1===arguments.length)return Be(Me.toJSON(),!0);for(const ne in Me)if(Object.prototype.hasOwnProperty.call(Me,ne)&&Be(Me[ne]))return!0;return!1}},391:Et=>{"use strict";var d,Re="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Le={},Je=0,qe=0;function Pe(q){var ne="";do{ne=Re[q%64]+ne,q=Math.floor(q/64)}while(q>0);return ne}function Me(){var q=Pe(+new Date);return q!==d?(Je=0,d=q):q+"."+Pe(Je++)}for(;qe<64;qe++)Le[Re[qe]]=qe;Me.encode=Pe,Me.decode=function(q){var ne=0;for(qe=0;qe<q.length;qe++)ne=64*ne+Le[q.charAt(qe)];return ne},Et.exports=Me},949:(Et,Re,Ie)=>{"use strict";var Le={};function Je(t){return"function"==typeof t}Ie.r(Le),Ie.d(Le,{Manager:()=>I$,Socket:()=>A$,default:()=>_w,io:()=>nv});let qe=!1;const d={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const n=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+n.stack)}else qe&&console.log("RxJS: Back to a better error behavior. Thank you. <3");qe=t},get useDeprecatedSynchronousErrorHandling(){return qe}};function Pe(t){setTimeout(()=>{throw t},0)}const Be={closed:!0,next(t){},error(t){if(d.useDeprecatedSynchronousErrorHandling)throw t;Pe(t)},complete(){}},Me=Array.isArray||(t=>t&&"number"==typeof t.length);function q(t){return null!==t&&"object"==typeof t}const ye=(()=>{function t(n){return Error.call(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((e,i)=>`${i+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n,this}return t.prototype=Object.create(Error.prototype),t})();class K{constructor(n){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,n&&(this._ctorUnsubscribe=!0,this._unsubscribe=n)}unsubscribe(){let n;if(this.closed)return;let{_parentOrParents:e,_ctorUnsubscribe:i,_unsubscribe:o,_subscriptions:c}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,e instanceof K)e.remove(this);else if(null!==e)for(let f=0;f<e.length;++f)e[f].remove(this);if(Je(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(f){n=f instanceof ye?ae(f.errors):[f]}}if(Me(c)){let f=-1,y=c.length;for(;++f<y;){const w=c[f];if(q(w))try{w.unsubscribe()}catch(T){n=n||[],T instanceof ye?n=n.concat(ae(T.errors)):n.push(T)}}}if(n)throw new ye(n)}add(n){let e=n;if(!n)return K.EMPTY;switch(typeof n){case"function":e=new K(n);case"object":if(e===this||e.closed||"function"!=typeof e.unsubscribe)return e;if(this.closed)return e.unsubscribe(),e;if(!(e instanceof K)){const c=e;e=new K,e._subscriptions=[c]}break;default:throw new Error("unrecognized teardown "+n+" added to Subscription.")}let{_parentOrParents:i}=e;if(null===i)e._parentOrParents=this;else if(i instanceof K){if(i===this)return e;e._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return e;i.push(this)}const o=this._subscriptions;return null===o?this._subscriptions=[e]:o.push(e),e}remove(n){const e=this._subscriptions;if(e){const i=e.indexOf(n);-1!==i&&e.splice(i,1)}}}var t;function ae(t){return t.reduce((n,e)=>n.concat(e instanceof ye?e.errors:e),[])}K.EMPTY=((t=new K).closed=!0,t);const Ne="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class ct extends K{constructor(n,e,i){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Be;break;case 1:if(!n){this.destination=Be;break}if("object"==typeof n){n instanceof ct?(this.syncErrorThrowable=n.syncErrorThrowable,this.destination=n,n.add(this)):(this.syncErrorThrowable=!0,this.destination=new xt(this,n));break}default:this.syncErrorThrowable=!0,this.destination=new xt(this,n,e,i)}}[Ne](){return this}static create(n,e,i){const o=new ct(n,e,i);return o.syncErrorThrowable=!1,o}next(n){this.isStopped||this._next(n)}error(n){this.isStopped||(this.isStopped=!0,this._error(n))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(n){this.destination.next(n)}_error(n){this.destination.error(n),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:n}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=n,this}}class xt extends ct{constructor(n,e,i,o){super(),this._parentSubscriber=n;let c,f=this;Je(e)?c=e:e&&(c=e.next,i=e.error,o=e.complete,e!==Be&&(f=Object.create(e),Je(f.unsubscribe)&&this.add(f.unsubscribe.bind(f)),f.unsubscribe=this.unsubscribe.bind(this))),this._context=f,this._next=c,this._error=i,this._complete=o}next(n){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;d.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,n)&&this.unsubscribe():this.__tryOrUnsub(this._next,n)}}error(n){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:i}=d;if(this._error)i&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,n),this.unsubscribe()):(this.__tryOrUnsub(this._error,n),this.unsubscribe());else if(e.syncErrorThrowable)i?(e.syncErrorValue=n,e.syncErrorThrown=!0):Pe(n),this.unsubscribe();else{if(this.unsubscribe(),i)throw n;Pe(n)}}}complete(){if(!this.isStopped){const{_parentSubscriber:n}=this;if(this._complete){const e=()=>this._complete.call(this._context);d.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?(this.__tryOrSetError(n,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(n,e){try{n.call(this._context,e)}catch(i){if(this.unsubscribe(),d.useDeprecatedSynchronousErrorHandling)throw i;Pe(i)}}__tryOrSetError(n,e,i){if(!d.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,i)}catch(o){return d.useDeprecatedSynchronousErrorHandling?(n.syncErrorValue=o,n.syncErrorThrown=!0,!0):(Pe(o),!0)}return!1}_unsubscribe(){const{_parentSubscriber:n}=this;this._context=null,this._parentSubscriber=null,n.unsubscribe()}}const wn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ai(t){return t}let Bt=(()=>{class t{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(e){const i=new t;return i.source=this,i.operator=e,i}subscribe(e,i,o){const{operator:c}=this,f=function(t,n,e){if(t){if(t instanceof ct)return t;if(t[Ne])return t[Ne]()}return t||n||e?new ct(t,n,e):new ct(Be)}(e,i,o);if(f.add(c?c.call(f,this.source):this.source||d.useDeprecatedSynchronousErrorHandling&&!f.syncErrorThrowable?this._subscribe(f):this._trySubscribe(f)),d.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable&&(f.syncErrorThrowable=!1,f.syncErrorThrown))throw f.syncErrorValue;return f}_trySubscribe(e){try{return this._subscribe(e)}catch(i){d.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=i),function(t){for(;t;){const{closed:n,destination:e,isStopped:i}=t;if(n||i)return!1;t=e&&e instanceof ct?e:null}return!0}(e)?e.error(i):console.warn(i)}}forEach(e,i){return new(i=Qs(i))((o,c)=>{let f;f=this.subscribe(y=>{try{e(y)}catch(w){c(w),f&&f.unsubscribe()}},c,o)})}_subscribe(e){const{source:i}=this;return i&&i.subscribe(e)}[wn](){return this}pipe(...e){return 0===e.length?this:function(t){return 0===t.length?Ai:1===t.length?t[0]:function(e){return t.reduce((i,o)=>o(i),e)}}(e)(this)}toPromise(e){return new(e=Qs(e))((i,o)=>{let c;this.subscribe(f=>c=f,f=>o(f),()=>i(c))})}}return t.create=n=>new t(n),t})();function Qs(t){if(t||(t=d.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const qr=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class ea extends K{constructor(n,e){super(),this.subject=n,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const n=this.subject,e=n.observers;if(this.subject=null,!e||0===e.length||n.isStopped||n.closed)return;const i=e.indexOf(this.subscriber);-1!==i&&e.splice(i,1)}}class kl extends ct{constructor(n){super(n),this.destination=n}}let qn=(()=>{class t extends Bt{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Ne](){return new kl(this)}lift(e){const i=new As(this,this);return i.operator=e,i}next(e){if(this.closed)throw new qr;if(!this.isStopped){const{observers:i}=this,o=i.length,c=i.slice();for(let f=0;f<o;f++)c[f].next(e)}}error(e){if(this.closed)throw new qr;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:i}=this,o=i.length,c=i.slice();for(let f=0;f<o;f++)c[f].error(e);this.observers.length=0}complete(){if(this.closed)throw new qr;this.isStopped=!0;const{observers:e}=this,i=e.length,o=e.slice();for(let c=0;c<i;c++)o[c].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new qr;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new qr;return this.hasError?(e.error(this.thrownError),K.EMPTY):this.isStopped?(e.complete(),K.EMPTY):(this.observers.push(e),new ea(this,e))}asObservable(){const e=new Bt;return e.source=this,e}}return t.create=(n,e)=>new As(n,e),t})();class As extends qn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){const{destination:e}=this;e&&e.next&&e.next(n)}error(n){const{destination:e}=this;e&&e.error&&this.destination.error(n)}complete(){const{destination:n}=this;n&&n.complete&&this.destination.complete()}_subscribe(n){const{source:e}=this;return e?this.source.subscribe(n):K.EMPTY}}function Vo(t){return t&&"function"==typeof t.schedule}function Rt(t,n){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new fi(t,n))}}class fi{constructor(n,e){this.project=n,this.thisArg=e}call(n,e){return e.subscribe(new Pa(n,this.project,this.thisArg))}}class Pa extends ct{constructor(n,e,i){super(n),this.project=e,this.count=0,this.thisArg=i||this}_next(n){let e;try{e=this.project.call(this.thisArg,n,this.count++)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}const pi=t=>n=>{for(let e=0,i=t.length;e<i&&!n.closed;e++)n.next(t[e]);n.complete()},Pr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Ra=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Pl(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const Fa=t=>{if(t&&"function"==typeof t[wn])return(t=>n=>{const e=t[wn]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(n)})(t);if(Ra(t))return pi(t);if(Pl(t))return(t=>n=>(t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Pe),n))(t);if(t&&"function"==typeof t[Pr])return(t=>n=>{const e=t[Pr]();for(;;){let i;try{i=e.next()}catch(o){return n.error(o),n}if(i.done){n.complete();break}if(n.next(i.value),n.closed)break}return"function"==typeof e.return&&n.add(()=>{e.return&&e.return()}),n})(t);{const e=`You provided ${q(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(e)}};function Uo(t,n){return new Bt(e=>{const i=new K;let o=0;return i.add(n.schedule(function(){o!==t.length?(e.next(t[o++]),e.closed||i.add(this.schedule())):e.complete()})),i})}function xi(t,n){return n?function(t,n){if(null!=t){if(function(t){return t&&"function"==typeof t[wn]}(t))return function(t,n){return new Bt(e=>{const i=new K;return i.add(n.schedule(()=>{const o=t[wn]();i.add(o.subscribe({next(c){i.add(n.schedule(()=>e.next(c)))},error(c){i.add(n.schedule(()=>e.error(c)))},complete(){i.add(n.schedule(()=>e.complete()))}}))})),i})}(t,n);if(Pl(t))return function(t,n){return new Bt(e=>{const i=new K;return i.add(n.schedule(()=>t.then(o=>{i.add(n.schedule(()=>{e.next(o),i.add(n.schedule(()=>e.complete()))}))},o=>{i.add(n.schedule(()=>e.error(o)))}))),i})}(t,n);if(Ra(t))return Uo(t,n);if(function(t){return t&&"function"==typeof t[Pr]}(t)||"string"==typeof t)return function(t,n){if(!t)throw new Error("Iterable cannot be null");return new Bt(e=>{const i=new K;let o;return i.add(()=>{o&&"function"==typeof o.return&&o.return()}),i.add(n.schedule(()=>{o=t[Pr](),i.add(n.schedule(function(){if(e.closed)return;let c,f;try{const y=o.next();c=y.value,f=y.done}catch(y){return void e.error(y)}f?e.complete():(e.next(c),this.schedule())}))})),i})}(t,n)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,n):t instanceof Bt?t:new Bt(Fa(t))}class ia extends ct{constructor(n){super(),this.parent=n}_next(n){this.parent.notifyNext(n)}_error(n){this.parent.notifyError(n),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class cs extends ct{notifyNext(n){this.destination.next(n)}notifyError(n){this.destination.error(n)}notifyComplete(){this.destination.complete()}}function Nr(t,n){if(n.closed)return;if(t instanceof Bt)return t.subscribe(n);let e;try{e=Fa(t)(n)}catch(i){n.error(i)}return e}function gi(t,n,e=Number.POSITIVE_INFINITY){return"function"==typeof n?i=>i.pipe(gi((o,c)=>xi(t(o,c)).pipe(Rt((f,y)=>n(o,f,c,y))),e)):("number"==typeof n&&(e=n),i=>i.lift(new Dc(t,e)))}class Dc{constructor(n,e=Number.POSITIVE_INFINITY){this.project=n,this.concurrent=e}call(n,e){return e.subscribe(new Co(n,this.project,this.concurrent))}}class Co extends cs{constructor(n,e,i=Number.POSITIVE_INFINITY){super(n),this.project=e,this.concurrent=i,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(n){this.active<this.concurrent?this._tryNext(n):this.buffer.push(n)}_tryNext(n){let e;const i=this.index++;try{e=this.project(n,i)}catch(o){return void this.destination.error(o)}this.active++,this._innerSub(e)}_innerSub(n){const e=new ia(this),i=this.destination;i.add(e);const o=Nr(n,e);o!==e&&i.add(o)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(n){this.destination.next(n)}notifyComplete(){const n=this.buffer;this.active--,n.length>0?this._next(n.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function mr(t=Number.POSITIVE_INFINITY){return gi(Ai,t)}function Ps(t,n){return n?Uo(t,n):new Bt(pi(t))}function Rl(){return function(n){return n.lift(new Fl(n))}}class Fl{constructor(n){this.connectable=n}call(n,e){const{connectable:i}=this;i._refCount++;const o=new Ec(n,i),c=e.subscribe(o);return o.closed||(o.connection=i.connect()),c}}class Ec extends ct{constructor(n,e){super(n),this.connectable=e}_unsubscribe(){const{connectable:n}=this;if(!n)return void(this.connection=null);this.connectable=null;const e=n._refCount;if(e<=0)return void(this.connection=null);if(n._refCount=e-1,e>1)return void(this.connection=null);const{connection:i}=this,o=n._connection;this.connection=null,o&&(!i||o===i)&&o.unsubscribe()}}class Tc extends Bt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let n=this._connection;return n||(this._isComplete=!1,n=this._connection=new K,n.add(this.source.subscribe(new Va(this.getSubject(),this))),n.closed&&(this._connection=null,n=K.EMPTY)),n}refCount(){return Rl()(this)}}const wh=(()=>{const t=Tc.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class Va extends kl{constructor(n,e){super(n),this.connectable=e}_error(n){this._unsubscribe(),super._error(n)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const n=this.connectable;if(n){this.connectable=null;const e=n._connection;n._refCount=0,n._subject=null,n._connection=null,e&&e.unsubscribe()}}}function Sc(){return new qn}function us(){return t=>Rl()(function(t,n){return function(i){let o;o="function"==typeof t?t:function(){return t};const c=Object.create(i,wh);return c.source=i,c.subjectFactory=o,c}}(Sc)(t))}function yn(t){for(let n in t)if(t[n]===yn)return n;throw Error("Could not find renamed property on target object.")}function Ns(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function qt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(qt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function oa(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const hs=yn({__forward_ref__:yn});function W(t){return t.__forward_ref__=W,t.toString=function(){return qt(this())},t}function F(t){return U(t)?t():t}function U(t){return"function"==typeof t&&t.hasOwnProperty(hs)&&t.__forward_ref__===W}class ie extends Error{constructor(n,e){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,e)),this.code=n}}function fe(t){return"string"==typeof t?t:null==t?"":String(t)}function pe(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():fe(t)}function Xe(t,n){const e=n?` in ${n}`:"";throw new ie("201",`No provider for ${pe(t)} found${e}`)}function wi(t,n){null==t&&function(t,n,e,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${e} ${i} ${n} <=Actual]`))}(n,t,null,"!=")}function ht(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Pt(t){return{providers:t.providers||[],imports:t.imports||[]}}function ds(t){return za(t,Ll)||za(t,vu)}function za(t,n){return t.hasOwnProperty(n)?t[n]:null}function fs(t){return t&&(t.hasOwnProperty(Wt)||t.hasOwnProperty(bu))?t[Wt]:null}const Ll=yn({\u0275prov:yn}),Wt=yn({\u0275inj:yn}),vu=yn({ngInjectableDef:yn}),bu=yn({ngInjectorDef:yn});var Tt=(()=>((Tt=Tt||{})[Tt.Default=0]="Default",Tt[Tt.Host=1]="Host",Tt[Tt.Self=2]="Self",Tt[Tt.SkipSelf=4]="SkipSelf",Tt[Tt.Optional=8]="Optional",Tt))();let Rr;function $o(t){const n=Rr;return Rr=t,n}function Li(t,n,e){const i=ds(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:e&Tt.Optional?null:void 0!==n?n:void Xe(qt(t),"Injector")}function _r(t){return{toString:t}.toString()}var ti=(()=>((ti=ti||{})[ti.OnPush=0]="OnPush",ti[ti.Default=1]="Default",ti))(),Ci=(()=>((Ci=Ci||{})[Ci.Emulated=0]="Emulated",Ci[Ci.None=2]="None",Ci[Ci.ShadowDom=3]="ShadowDom",Ci))();const xu="undefined"!=typeof globalThis&&globalThis,jp="undefined"!=typeof window&&window,sa="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Hp="undefined"!=typeof global&&global,jn=xu||Hp||jp||sa,io={},Wn=[],Ua=yn({\u0275cmp:yn}),Dh=yn({\u0275dir:yn}),Eh=yn({\u0275pipe:yn}),wu=yn({\u0275mod:yn}),Xd=yn({\u0275loc:yn}),ro=yn({\u0275fac:yn}),Pc=yn({__NG_ELEMENT_ID__:yn});let Yd=0;function si(t){return _r(()=>{const e={},i={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===ti.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Wn,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||Ci.Emulated,id:"c",styles:t.styles||Wn,_:null,setInput:null,schemas:t.schemas||null,tView:null},o=t.directives,c=t.features,f=t.pipes;return i.id+=Yd++,i.inputs=Vl(t.inputs,e),i.outputs=Vl(t.outputs),c&&c.forEach(y=>y(i)),i.directiveDefs=o?()=>("function"==typeof o?o():o).map(Mo):null,i.pipeDefs=f?()=>("function"==typeof f?f():f).map(Cu):null,i})}function Mo(t){return Ut(t)||function(t){return t[Dh]||null}(t)}function Cu(t){return function(t){return t[Eh]||null}(t)}const Du={};function Dn(t){return _r(()=>{const n={type:t.type,bootstrap:t.bootstrap||Wn,declarations:t.declarations||Wn,imports:t.imports||Wn,exports:t.exports||Wn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Du[t.id]=t.type),n})}function Vl(t,n){if(null==t)return io;const e={};for(const i in t)if(t.hasOwnProperty(i)){let o=t[i],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),e[o]=i,n&&(n[o]=c)}return e}const ut=si;function Ut(t){return t[Ua]||null}function Fr(t,n){const e=t[wu]||null;if(!e&&!0===n)throw new Error(`Type ${qt(t)} does not have '\u0275mod' property.`);return e}function So(t){return Array.isArray(t)&&"object"==typeof t[1]}function yr(t){return Array.isArray(t)&&!0===t[1]}function Mh(t){return 0!=(8&t.flags)}function Fc(t){return 2==(2&t.flags)}function Oc(t){return 1==(1&t.flags)}function Go(t){return null!==t.template}function Gp(t){return 0!=(512&t[2])}function Ls(t,n){return t.hasOwnProperty(ro)?t[ro]:null}class Lc{constructor(n,e,i){this.previousValue=n,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}}function dn(){return Bc}function Bc(t){return t.type.prototype.ngOnChanges&&(t.setInput=kh),da}function da(){const t=Ga(this),n=null==t?void 0:t.current;if(n){const e=t.previous;if(e===io)t.previous=n;else for(let i in n)e[i]=n[i];t.current=null,this.ngOnChanges(n)}}function kh(t,n,e,i){const o=Ga(t)||function(t,n){return t[Vc]=n}(t,{previous:io,current:null}),c=o.current||(o.current={}),f=o.previous,y=this.declaredInputs[e],w=f[y];c[y]=new Lc(w&&w.currentValue,n,f===io),t[i]=n}dn.ngInherit=!0;const Vc="__ngSimpleChanges__";function Ga(t){return t[Vc]||null}const Bs="http://www.w3.org/2000/svg";let Xl;function Ei(t){return!!t.listen}const Au={createRenderer:(t,n)=>void 0!==Xl?Xl:"undefined"!=typeof document?document:void 0};function zi(t){for(;Array.isArray(t);)t=t[0];return t}function pa(t,n){return zi(n[t])}function vr(t,n){return zi(n[t.index])}function Wa(t,n){return t.data[n]}function rr(t,n){const e=n[t];return So(e)?e:e[0]}function Nh(t){return 4==(4&t[2])}function Pu(t){return 128==(128&t[2])}function Vs(t,n){return null==n?null:t[n]}function Uc(t){t[18]=0}function Ru(t,n){t[5]+=n;let e=t,i=t[3];for(;null!==i&&(1===n&&1===e[5]||-1===n&&0===e[5]);)i[5]+=n,e=i,i=i[3]}const It={lFrame:Lu(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Xa(){return It.bindingsEnabled}function tt(){return It.lFrame.lView}function An(){return It.lFrame.tView}function mn(t){return It.lFrame.contextLView=t,t[8]}function Ti(){let t=oo();for(;null!==t&&64===t.type;)t=t.parent;return t}function oo(){return It.lFrame.currentTNode}function qo(t,n){const e=It.lFrame;e.currentTNode=t,e.isParent=n}function Ya(){return It.lFrame.isParent}function yt(){It.lFrame.isParent=!1}function ga(){return It.isInCheckNoChangesMode}function ma(t){It.isInCheckNoChangesMode=t}function Ja(){return It.lFrame.bindingIndex++}function so(t){const n=It.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function Ka(t,n){const e=It.lFrame;e.bindingIndex=e.bindingRootIndex=t,Kl(n)}function Kl(t){It.lFrame.currentDirectiveIndex=t}function Ou(){return It.lFrame.currentQueryIndex}function jc(t){It.lFrame.currentQueryIndex=t}function Vh(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function Hc(t,n,e){if(e&Tt.SkipSelf){let o=n,c=t;for(;!(o=o.parent,null!==o||e&Tt.Host||(o=Vh(c),null===o||(c=c[15],10&o.type))););if(null===o)return!1;n=o,t=c}const i=It.lFrame=zh();return i.currentTNode=n,i.lView=t,!0}function Qa(t){const n=zh(),e=t[1];It.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function zh(){const t=It.lFrame,n=null===t?null:t.child;return null===n?Lu(t):n}function Lu(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Ql(){const t=It.lFrame;return It.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Uh=Ql;function _s(){const t=Ql();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function xr(){return It.lFrame.selectedIndex}function ys(t){It.lFrame.selectedIndex=t}function Mi(){const t=It.lFrame;return Wa(t.tView,t.selectedIndex)}function Zo(){It.lFrame.currentNamespace=Bs}function $s(){It.lFrame.currentNamespace=null}function qc(t,n){for(let e=n.directiveStart,i=n.directiveEnd;e<i;e++){const c=t.data[e].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:y,ngAfterViewInit:w,ngAfterViewChecked:T,ngOnDestroy:A}=c;f&&(t.contentHooks||(t.contentHooks=[])).push(-e,f),y&&((t.contentHooks||(t.contentHooks=[])).push(e,y),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(e,y)),w&&(t.viewHooks||(t.viewHooks=[])).push(-e,w),T&&((t.viewHooks||(t.viewHooks=[])).push(e,T),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(e,T)),null!=A&&(t.destroyHooks||(t.destroyHooks=[])).push(e,A)}}function Wc(t,n,e){s(t,n,3,e)}function tl(t,n,e,i){(3&t[2])===e&&s(t,n,e,i)}function g(t,n){let e=t[2];(3&e)===n&&(e&=2047,e+=1,t[2]=e)}function s(t,n,e,i){const c=null!=i?i:-1,f=n.length-1;let y=0;for(let w=void 0!==i?65535&t[18]:0;w<f;w++)if("number"==typeof n[w+1]){if(y=n[w],null!=i&&y>=i)break}else n[w]<0&&(t[18]+=65536),(y<c||-1==c)&&(h(t,e,n,w),t[18]=(4294901760&t[18])+w+2),w++}function h(t,n,e,i){const o=e[i]<0,c=e[i+1],y=t[o?-e[i]:e[i]];if(o){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{c.call(y)}finally{}}}else try{c.call(y)}finally{}}const m=-1;class b{constructor(n,e,i){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=i}}function H(t,n,e){const i=Ei(t);let o=0;for(;o<e.length;){const c=e[o];if("number"==typeof c){if(0!==c)break;o++;const f=e[o++],y=e[o++],w=e[o++];i?t.setAttribute(n,y,w,f):n.setAttributeNS(f,y,w)}else{const f=c,y=e[++o];Q(f)?i&&t.setProperty(n,f,y):i?t.setAttribute(n,f,y):n.setAttribute(f,y),o++}}return o}function J(t){return 3===t||4===t||6===t}function Q(t){return 64===t.charCodeAt(0)}function le(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let i=0;i<n.length;i++){const o=n[i];"number"==typeof o?e=o:0===e||X(t,e,o,null,-1===e||2===e?n[++i]:null)}}return t}function X(t,n,e,i,o){let c=0,f=t.length;if(-1===n)f=-1;else for(;c<t.length;){const y=t[c++];if("number"==typeof y){if(y===n){f=-1;break}if(y>n){f=c-1;break}}}for(;c<t.length;){const y=t[c];if("number"==typeof y)break;if(y===e){if(null===i)return void(null!==o&&(t[c+1]=o));if(i===t[c+1])return void(t[c+2]=o)}c++,null!==i&&c++,null!==o&&c++}-1!==f&&(t.splice(f,0,n),c=f+1),t.splice(c++,0,e),null!==i&&t.splice(c++,0,i),null!==o&&t.splice(c++,0,o)}function te(t){return t!==m}function se(t){return 32767&t}function _e(t,n){let e=function(t){return t>>16}(t),i=n;for(;e>0;)i=i[15],e--;return i}let oe=!0;function we(t){const n=oe;return oe=t,n}let Fe=0;function mt(t,n){const e=it(t,n);if(-1!==e)return e;const i=n[1];i.firstCreatePass&&(t.injectorIndex=n.length,_t(i.data,t),_t(n,null),_t(i.blueprint,null));const o=vt(t,n),c=t.injectorIndex;if(te(o)){const f=se(o),y=_e(o,n),w=y[1].data;for(let T=0;T<8;T++)n[c+T]=y[f+T]|w[f+T]}return n[c+8]=o,c}function _t(t,n){t.push(0,0,0,0,0,0,0,0,n)}function it(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function vt(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,i=null,o=n;for(;null!==o;){const c=o[1],f=c.type;if(i=2===f?c.declTNode:1===f?o[6]:null,null===i)return m;if(e++,o=o[15],-1!==i.injectorIndex)return i.injectorIndex|e<<16}return m}function Xt(t,n,e){!function(t,n,e){let i;"string"==typeof e?i=e.charCodeAt(0)||0:e.hasOwnProperty(Pc)&&(i=e[Pc]),null==i&&(i=e[Pc]=Fe++);const o=255&i;n.data[t+(o>>5)]|=1<<o}(t,n,e)}function bi(t,n,e){if(e&Tt.Optional)return t;Xe(n,"NodeInjector")}function li(t,n,e,i){if(e&Tt.Optional&&void 0===i&&(i=null),0==(e&(Tt.Self|Tt.Host))){const o=t[9],c=$o(void 0);try{return o?o.get(n,i,e&Tt.Optional):Li(n,i,e&Tt.Optional)}finally{$o(c)}}return bi(i,n,e)}function Zt(t,n,e,i=Tt.Default,o){if(null!==t){const c=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Pc)?t[Pc]:void 0;return"number"==typeof n?n>=0?255&n:mi:n}(e);if("function"==typeof c){if(!Hc(n,t,i))return i&Tt.Host?bi(o,e,i):li(n,e,i,o);try{const f=c(i);if(null!=f||i&Tt.Optional)return f;Xe(e)}finally{Uh()}}else if("number"==typeof c){let f=null,y=it(t,n),w=m,T=i&Tt.Host?n[16][6]:null;for((-1===y||i&Tt.SkipSelf)&&(w=-1===y?vt(t,n):n[y+8],w!==m&&vs(i,!1)?(f=n[1],y=se(w),n=_e(w,n)):y=-1);-1!==y;){const A=n[1];if(Xo(c,y,A.data)){const O=Io(y,n,e,f,i,T);if(O!==rn)return O}w=n[y+8],w!==m&&vs(i,n[1].data[y+8]===T)&&Xo(c,y,n)?(f=A,y=se(w),n=_e(w,n)):y=-1}}}return li(n,e,i,o)}const rn={};function mi(){return new kn(Ti(),tt())}function Io(t,n,e,i,o,c){const f=n[1],y=f.data[t+8],A=ao(y,f,e,null==i?Fc(y)&&oe:i!=f&&0!=(3&y.type),o&Tt.Host&&c===y);return null!==A?Gi(n,f,A,y):rn}function ao(t,n,e,i,o){const c=t.providerIndexes,f=n.data,y=1048575&c,w=t.directiveStart,A=c>>20,V=o?y+A:t.directiveEnd;for(let j=i?y:y+A;j<V;j++){const ee=f[j];if(j<w&&e===ee||j>=w&&ee.type===e)return j}if(o){const j=f[w];if(j&&Go(j)&&j.type===e)return w}return null}function Gi(t,n,e,i){let o=t[e];const c=n.data;if(function(t){return t instanceof b}(o)){const f=o;f.resolving&&function(t,n){throw new ie("200",`Circular dependency in DI detected for ${t}`)}(pe(c[e]));const y=we(f.canSeeViewProviders);f.resolving=!0;const w=f.injectImpl?$o(f.injectImpl):null;Hc(t,i,Tt.Default);try{o=t[e]=f.factory(void 0,c,t,i),n.firstCreatePass&&e>=i.directiveStart&&function(t,n,e){const{ngOnChanges:i,ngOnInit:o,ngDoCheck:c}=n.type.prototype;if(i){const f=Bc(n);(e.preOrderHooks||(e.preOrderHooks=[])).push(t,f),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,f)}o&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-t,o),c&&((e.preOrderHooks||(e.preOrderHooks=[])).push(t,c),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(t,c))}(e,c[e],n)}finally{null!==w&&$o(w),we(y),f.resolving=!1,Uh()}}return o}function Xo(t,n,e){return!!(e[n+(t>>5)]&1<<t)}function vs(t,n){return!(t&Tt.Self||t&Tt.Host&&n)}class kn{constructor(n,e){this._tNode=n,this._lView=e}get(n,e){return Zt(this._tNode,this._lView,n,void 0,e)}}function fn(t){return _r(()=>{const n=t.prototype.constructor,e=n[ro]||Tn(n),i=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==i;){const c=o[ro]||Tn(o);if(c&&c!==e)return c;o=Object.getPrototypeOf(o)}return c=>new c})}function Tn(t){return U(t)?()=>{const n=Tn(F(t));return n&&n()}:Ls(t)}const zn="__parameters__";function bs(t,n,e){return _r(()=>{const i=function(t){return function(...e){if(t){const i=t(...e);for(const o in i)this[o]=i[o]}}}(n);function o(...c){if(this instanceof o)return i.apply(this,c),this;const f=new o(...c);return y.annotation=f,y;function y(w,T,A){const O=w.hasOwnProperty(zn)?w[zn]:Object.defineProperty(w,zn,{value:[]})[zn];for(;O.length<=A;)O.push(null);return(O[A]=O[A]||[]).push(f),w}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}class Yt{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=ht({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const f_=new Yt("AnalyzeForEntryComponents"),jh=Function;function lo(t,n){void 0===n&&(n=t);for(let e=0;e<t.length;e++){let i=t[e];Array.isArray(i)?(n===t&&(n=t.slice(0,e)),lo(i,n)):n!==t&&n.push(i)}return n}function js(t,n){t.forEach(e=>Array.isArray(e)?js(e,n):n(e))}function Hh(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function Xc(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function nc(t,n){const e=[];for(let i=0;i<t;i++)e.push(n);return e}function Ji(t,n,e){let i=zu(t,n);return i>=0?t[1|i]=e:(i=~i,function(t,n,e,i){let o=t.length;if(o==n)t.push(e,i);else if(1===o)t.push(i,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;)t[o]=t[o-2],o--;t[n]=e,t[n+1]=i}}(t,i,n,e)),i}function ol(t,n){const e=zu(t,n);if(e>=0)return t[1|e]}function zu(t,n){return function(t,n,e){let i=0,o=t.length>>e;for(;o!==i;){const c=i+(o-i>>1),f=t[c<<e];if(n===f)return c<<e;f>n?o=c:i=c+1}return~(o<<e)}(t,n,1)}const Uu={},sl="__NG_DI_FLAG__",xs="ngTempTokenPath",eg=/\n/gm,tg="__source",ng=yn({provide:String,useValue:yn});let Yc;function $u(t){const n=Yc;return Yc=t,n}function ig(t,n=Tt.Default){if(void 0===Yc)throw new Error("inject() must be called from an injection context");return null===Yc?Li(t,void 0,n):Yc.get(t,n&Tt.Optional?null:void 0,n)}function je(t,n=Tt.Default){return(Rr||ig)(F(t),n)}function rc(t){const n=[];for(let e=0;e<t.length;e++){const i=F(t[e]);if(Array.isArray(i)){if(0===i.length)throw new Error("Arguments array must have arguments.");let o,c=Tt.Default;for(let f=0;f<i.length;f++){const y=i[f],w=ju(y);"number"==typeof w?-1===w?o=y.token:c|=w:o=y}n.push(je(o,c))}else n.push(je(i))}return n}function Zh(t,n){return t[sl]=n,t.prototype[sl]=n,t}function ju(t){return t[sl]}function Xh(t,n,e,i){const o=t[xs];throw n[tg]&&o.unshift(n[tg]),t.message=function(t,n,e,i=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let o=qt(n);if(Array.isArray(n))o=n.map(qt).join(" -> ");else if("object"==typeof n){let c=[];for(let f in n)if(n.hasOwnProperty(f)){let y=n[f];c.push(f+":"+("string"==typeof y?JSON.stringify(y):qt(y)))}o=`{${c.join(", ")}}`}return`${e}${i?"("+i+")":""}[${o}]: ${t.replace(eg,"\n  ")}`}("\n"+t.message,o,e,i),t.ngTokenPath=o,t[xs]=null,t}const Hu=Zh(bs("Inject",t=>({token:t})),-1),ko=Zh(bs("Optional"),8),al=Zh(bs("SkipSelf"),4);function Jo(t){return t instanceof class{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?t.changingThisBreaksApplicationSecurity:t}const Tf="__ngContext__";function Yr(t,n){t[Tf]=n}function ru(t){const n=function(t){return t[Tf]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function Sf(t){return t.ngOriginalError}function F_(t,...n){t.error(...n)}class ou{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n),i=this._findContext(n),o=function(t){return t&&t.ngErrorLogger||F_}(n);o(this._console,"ERROR",n),e&&o(this._console,"ORIGINAL ERROR",e),i&&o(this._console,"ERROR CONTEXT",i)}_findContext(n){return n?function(t){return t.ngDebugContext}(n)||this._findContext(Sf(n)):null}_findOriginalError(n){let e=n&&Sf(n);for(;e&&Sf(e);)e=Sf(e);return e||null}}const Ku=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(jn))();function Dr(t){return t instanceof Function?t():t}var Ko=(()=>((Ko=Ko||{})[Ko.Important=1]="Important",Ko[Ko.DashCase=2]="DashCase",Ko))();function Tg(t,n){return undefined(t,n)}function ad(t){const n=t[3];return yr(n)?n[3]:n}function sc(t){return z_(t[13])}function kf(t){return z_(t[4])}function z_(t){for(;null!==t&&!yr(t);)t=t[4];return t}function Qu(t,n,e,i,o){if(null!=i){let c,f=!1;yr(i)?c=i:So(i)&&(f=!0,i=i[0]);const y=zi(i);0===t&&null!==e?null==o?ll(n,e,y):ac(n,e,y,o||null,!0):1===t&&null!==e?ac(n,e,y,o||null,!0):2===t?function(t,n,e){const i=hd(t,n);i&&function(t,n,e,i){Ei(t)?t.removeChild(n,e,i):n.removeChild(e)}(t,i,n,e)}(n,y,f):3===t&&n.destroyNode(y),null!=c&&function(t,n,e,i,o){const c=e[7];c!==zi(e)&&Qu(n,t,i,c,o);for(let y=10;y<e.length;y++){const w=e[y];ih(w[1],w,t,n,i,c)}}(n,t,c,e,o)}}function uo(t,n,e){return Ei(t)?t.createElement(n,e):null===e?t.createElement(n):t.createElementNS(e,n)}function Sg(t,n){const e=t[9],i=e.indexOf(n),o=n[3];1024&n[2]&&(n[2]&=-1025,Ru(o,-1)),e.splice(i,1)}function Ig(t,n){if(t.length<=10)return;const e=10+n,i=t[e];if(i){const o=i[17];null!==o&&o!==t&&Sg(o,i),n>0&&(t[e-1][4]=i[4]);const c=Xc(t,10+n);!function(t,n){ih(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(i[1],i);const f=c[19];null!==f&&f.detachView(c[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function Ag(t,n){if(!(256&n[2])){const e=n[11];Ei(e)&&e.destroyNode&&ih(t,n,e,3,null,null),function(t){let n=t[13];if(!n)return Rf(t[1],t);for(;n;){let e=null;if(So(n))e=n[13];else{const i=n[10];i&&(e=i)}if(!e){for(;n&&!n[4]&&n!==t;)So(n)&&Rf(n[1],n),n=n[3];null===n&&(n=t),So(n)&&Rf(n[1],n),e=n&&n[4]}n=e}}(n)}}function Rf(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let i=0;i<e.length;i+=2){const o=n[e[i]];if(!(o instanceof b)){const c=e[i+1];if(Array.isArray(c))for(let f=0;f<c.length;f+=2){const y=o[c[f]],w=c[f+1];try{w.call(y)}finally{}}else try{c.call(o)}finally{}}}}(t,n),function(t,n){const e=t.cleanup,i=n[7];let o=-1;if(null!==e)for(let c=0;c<e.length-1;c+=2)if("string"==typeof e[c]){const f=e[c+1],y="function"==typeof f?f(n):zi(n[f]),w=i[o=e[c+2]],T=e[c+3];"boolean"==typeof T?y.removeEventListener(e[c],w,T):T>=0?i[o=T]():i[o=-T].unsubscribe(),c+=2}else{const f=i[o=e[c+1]];e[c].call(f)}if(null!==i){for(let c=o+1;c<i.length;c++)i[c]();n[7]=null}}(t,n),1===n[1].type&&Ei(n[11])&&n[11].destroy();const e=n[17];if(null!==e&&yr(n[3])){e!==n[3]&&Sg(e,n);const i=n[19];null!==i&&i.detachView(t)}}}function Ng(t,n,e){return function(t,n,e){let i=n;for(;null!==i&&40&i.type;)i=(n=i).parent;if(null===i)return e[0];if(2&i.flags){const o=t.data[i.directiveStart].encapsulation;if(o===Ci.None||o===Ci.Emulated)return null}return vr(i,e)}(t,n.parent,e)}function ac(t,n,e,i,o){Ei(t)?t.insertBefore(n,e,i,o):n.insertBefore(e,i,o)}function ll(t,n,e){Ei(t)?t.appendChild(n,e):n.appendChild(e)}function Rg(t,n,e,i,o){null!==i?ac(t,n,e,i,o):ll(t,n,e)}function hd(t,n){return Ei(t)?t.parentNode(n):n.parentNode}function q_(t,n,e){return Fg(t,n,e)}let Fg=function(t,n,e){return 40&t.type?vr(t,e):null};function dd(t,n,e,i){const o=Ng(t,i,n),c=n[11],y=q_(i.parent||n[6],i,n);if(null!=o)if(Array.isArray(e))for(let w=0;w<e.length;w++)Rg(c,o,e[w],y,!1);else Rg(c,o,e,y,!1)}function fd(t,n){if(null!==n){const e=n.type;if(3&e)return vr(n,t);if(4&e)return lc(-1,t[n.index]);if(8&e){const i=n.child;if(null!==i)return fd(t,i);{const o=t[n.index];return yr(o)?lc(-1,o):zi(o)}}if(32&e)return Tg(n,t)()||zi(t[n.index]);{const i=Of(t,n);return null!==i?Array.isArray(i)?i[0]:fd(ad(t[16]),i):fd(t,n.next)}}return null}function Of(t,n){return null!==n?t[16][6].projection[n.projection]:null}function lc(t,n){const e=10+t+1;if(e<n.length){const i=n[e],o=i[1].firstChild;if(null!==o)return fd(i,o)}return n[7]}function nh(t,n,e,i,o,c,f){for(;null!=e;){const y=i[e.index],w=e.type;if(f&&0===n&&(y&&Yr(zi(y),i),e.flags|=4),64!=(64&e.flags))if(8&w)nh(t,n,e.child,i,o,c,!1),Qu(n,t,o,y,c);else if(32&w){const T=Tg(e,i);let A;for(;A=T();)Qu(n,t,o,A,c);Qu(n,t,o,y,c)}else 16&w?pd(t,n,i,e,o,c):Qu(n,t,o,y,c);e=f?e.projectionNext:e.next}}function ih(t,n,e,i,o,c){nh(e,i,t.firstChild,n,o,c,!1)}function pd(t,n,e,i,o,c){const f=e[16],w=f[6].projection[i.projection];if(Array.isArray(w))for(let T=0;T<w.length;T++)Qu(n,t,o,w[T],c);else nh(t,n,w,f[3],o,c,!0)}function Z_(t,n,e){Ei(t)?t.setAttribute(n,"style",e):n.style.cssText=e}function Lg(t,n,e){Ei(t)?""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e):n.className=e}function X_(t,n,e){let i=t.length;for(;;){const o=t.indexOf(n,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const c=n.length;if(o+c===i||t.charCodeAt(o+c)<=32)return o}e=o+1}}const Bf="ng-template";function Wv(t,n,e){let i=0;for(;i<t.length;){let o=t[i++];if(e&&"class"===o){if(o=t[i],-1!==X_(o.toLowerCase(),n,0))return!0}else if(1===o){for(;i<t.length&&"string"==typeof(o=t[i++]);)if(o.toLowerCase()===n)return!0;return!1}}return!1}function Bg(t){return 4===t.type&&t.value!==Bf}function Zv(t,n,e){return n===(4!==t.type||e?t.value:Bf)}function Vg(t,n,e){let i=4;const o=t.attrs||[],c=function(t){for(let n=0;n<t.length;n++)if(J(t[n]))return n;return t.length}(o);let f=!1;for(let y=0;y<n.length;y++){const w=n[y];if("number"!=typeof w){if(!f)if(4&i){if(i=2|1&i,""!==w&&!Zv(t,w,e)||""===w&&1===n.length){if(Gs(i))return!1;f=!0}}else{const T=8&i?w:n[++y];if(8&i&&null!==t.attrs){if(!Wv(t.attrs,T,e)){if(Gs(i))return!1;f=!0}continue}const O=cc(8&i?"class":w,o,Bg(t),e);if(-1===O){if(Gs(i))return!1;f=!0;continue}if(""!==T){let V;V=O>c?"":o[O+1].toLowerCase();const j=8&i?V:null;if(j&&-1!==X_(j,T,0)||2&i&&T!==V){if(Gs(i))return!1;f=!0}}}}else{if(!f&&!Gs(i)&&!Gs(w))return!1;if(f&&Gs(w))continue;f=!1,i=w|1&i}}return Gs(i)||f}function Gs(t){return 0==(1&t)}function cc(t,n,e,i){if(null===n)return-1;let o=0;if(i||!e){let c=!1;for(;o<n.length;){const f=n[o];if(f===t)return o;if(3===f||6===f)c=!0;else{if(1===f||2===f){let y=n[++o];for(;"string"==typeof y;)y=n[++o];continue}if(4===f)break;if(0===f){o+=4;continue}}o+=c?1:2}return-1}return function(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const i=t[e];if("number"==typeof i)return-1;if(i===n)return e;e++}return-1}(n,t)}function zg(t,n,e=!1){for(let i=0;i<n.length;i++)if(Vg(t,n[i],e))return!0;return!1}function Xv(t,n){e:for(let e=0;e<n.length;e++){const i=n[e];if(t.length===i.length){for(let o=0;o<t.length;o++)if(t[o]!==i[o])continue e;return!0}}return!1}function J_(t,n){return t?":not("+n.trim()+")":n}function Yv(t){let n=t[0],e=1,i=2,o="",c=!1;for(;e<t.length;){let f=t[e];if("string"==typeof f)if(2&i){const y=t[++e];o+="["+f+(y.length>0?'="'+y+'"':"")+"]"}else 8&i?o+="."+f:4&i&&(o+=" "+f);else""!==o&&!Gs(f)&&(n+=J_(c,o),o=""),i=f,c=c||!Gs(i);e++}return""!==o&&(n+=J_(c,o)),n}const on={};function ot(t){Uf(An(),tt(),xr()+t,ga())}function Uf(t,n,e,i){if(!i)if(3==(3&n[2])){const c=t.preOrderCheckHooks;null!==c&&Wc(n,c,e)}else{const c=t.preOrderHooks;null!==c&&tl(n,c,0,e)}ys(e)}function qs(t,n){return t<<17|n<<2}function Ws(t){return t>>17&32767}function rh(t){return 2|t}function cl(t){return(131068&t)>>2}function jg(t,n){return-131069&t|n<<2}function Hg(t){return 1|t}function Jg(t,n){const e=t.contentQueries;if(null!==e)for(let i=0;i<e.length;i+=2){const o=e[i],c=e[i+1];if(-1!==c){const f=t.data[c];jc(o),f.contentQueries(2,n[c],c)}}}function xa(t,n,e,i,o,c,f,y,w,T){const A=n.blueprint.slice();return A[0]=o,A[2]=140|i,Uc(A),A[3]=A[15]=t,A[8]=e,A[10]=f||t&&t[10],A[11]=y||t&&t[11],A[12]=w||t&&t[12]||null,A[9]=T||t&&t[9]||null,A[6]=c,A[16]=2==n.type?t[16]:A,A}function hc(t,n,e,i,o){let c=t.data[n];if(null===c)c=function(t,n,e,i,o){const c=oo(),f=Ya(),w=t.data[n]=function(t,n,e,i,o,c){return{type:e,index:i,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?c:c&&c.parent,e,n,i,o);return null===t.firstChild&&(t.firstChild=w),null!==c&&(f?null==c.child&&null!==w.parent&&(c.child=w):null===c.next&&(c.next=w)),w}(t,n,e,i,o),It.lFrame.inI18n&&(c.flags|=64);else if(64&c.type){c.type=e,c.value=i,c.attrs=o;const f=function(){const t=It.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();c.injectorIndex=null===f?-1:f.injectorIndex}return qo(c,!0),c}function ho(t,n,e,i){if(0===e)return-1;const o=n.length;for(let c=0;c<e;c++)n.push(i),t.blueprint.push(i),t.data.push(null);return o}function lu(t,n,e){Qa(n);try{const i=t.viewQuery;null!==i&&On(1,i,e);const o=t.template;null!==o&&fc(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Jg(t,n),t.staticViewQueries&&On(2,t.viewQuery,e);const c=t.components;null!==c&&function(t,n){for(let e=0;e<n.length;e++)Lt(t,n[e])}(n,c)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{n[2]&=-5,_s()}}function dc(t,n,e,i){const o=n[2];if(256==(256&o))return;Qa(n);const c=ga();try{Uc(n),function(t){It.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&fc(t,n,e,2,i);const f=3==(3&o);if(!c)if(f){const T=t.preOrderCheckHooks;null!==T&&Wc(n,T,null)}else{const T=t.preOrderHooks;null!==T&&tl(n,T,0,null),g(n,0)}if(function(t){for(let n=sc(t);null!==n;n=kf(n)){if(!n[2])continue;const e=n[9];for(let i=0;i<e.length;i++){const o=e[i],c=o[3];0==(1024&o[2])&&Ru(c,1),o[2]|=1024}}}(n),function(t){for(let n=sc(t);null!==n;n=kf(n))for(let e=10;e<n.length;e++){const i=n[e],o=i[1];Pu(i)&&dc(o,i,o.template,i[8])}}(n),null!==t.contentQueries&&Jg(t,n),!c)if(f){const T=t.contentCheckHooks;null!==T&&Wc(n,T)}else{const T=t.contentHooks;null!==T&&tl(n,T,1),g(n,1)}!function(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let i=0;i<e.length;i++){const o=e[i];if(o<0)ys(~o);else{const c=o,f=e[++i],y=e[++i];Ka(f,c),y(2,n[c])}}}finally{ys(-1)}}(t,n);const y=t.components;null!==y&&function(t,n){for(let e=0;e<n.length;e++)bt(t,n[e])}(n,y);const w=t.viewQuery;if(null!==w&&On(2,w,i),!c)if(f){const T=t.viewCheckHooks;null!==T&&Wc(n,T)}else{const T=t.viewHooks;null!==T&&tl(n,T,2),g(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),c||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,Ru(n[3],-1))}finally{_s()}}function Zs(t,n,e,i){const o=n[10],c=!ga(),f=Nh(n);try{c&&!f&&o.begin&&o.begin(),f&&lu(t,n,i),dc(t,n,e,i)}finally{c&&!f&&o.end&&o.end()}}function fc(t,n,e,i,o){const c=xr(),f=2&i;try{ys(-1),f&&n.length>20&&Uf(t,n,20,ga()),e(i,o)}finally{ys(c)}}function Zf(t,n,e){!Xa()||(function(t,n,e,i){const o=e.directiveStart,c=e.directiveEnd;t.firstCreatePass||mt(e,n),Yr(i,n);const f=e.initialInputs;for(let y=o;y<c;y++){const w=t.data[y],T=Go(w);T&&He(n,e,w);const A=Gi(n,t,y,e);Yr(A,n),null!==f&&st(0,y-o,A,w,0,f),T&&(rr(e.index,n)[8]=A)}}(t,n,e,vr(e,n)),128==(128&e.flags)&&function(t,n,e){const i=e.directiveStart,o=e.directiveEnd,f=e.index,y=It.lFrame.currentDirectiveIndex;try{ys(f);for(let w=i;w<o;w++){const T=t.data[w],A=n[w];Kl(w),(null!==T.hostBindings||0!==T.hostVars||null!==T.hostAttrs)&&re(T,A)}}finally{ys(-1),Kl(y)}}(t,n,e))}function ah(t,n,e=vr){const i=n.localNames;if(null!==i){let o=n.index+1;for(let c=0;c<i.length;c+=2){const f=i[c+1],y=-1===f?e(n,t):t[f];t[o++]=y}}}function Qg(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=bd(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function bd(t,n,e,i,o,c,f,y,w,T){const A=20+i,O=A+o,V=function(t,n){const e=[];for(let i=0;i<n;i++)e.push(i<t?null:on);return e}(A,O),j="function"==typeof T?T():T;return V[1]={type:t,blueprint:V,template:e,queries:null,viewQuery:y,declTNode:n,data:V.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:O,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:w,consts:j,incompleteFirstPass:!1}}function tm(t,n,e,i){const o=Si(n);null===e?o.push(i):(o.push(e),t.firstCreatePass&&sr(t).push(i,o.length-1))}function a(t,n,e){for(let i in t)if(t.hasOwnProperty(i)){const o=t[i];(e=null===e?{}:e).hasOwnProperty(i)?e[i].push(n,o):e[i]=[n,o]}return e}function P(t,n,e,i){let o=!1;if(Xa()){const c=function(t,n,e){const i=t.directiveRegistry;let o=null;if(i)for(let c=0;c<i.length;c++){const f=i[c];zg(e,f.selectors,!1)&&(o||(o=[]),Xt(mt(e,n),t,f.type),Go(f)?(ve(t,e),o.unshift(f)):o.push(f))}return o}(t,n,e),f=null===i?null:{"":-1};if(null!==c){o=!0,Se(e,t.data.length,c.length);for(let A=0;A<c.length;A++){const O=c[A];O.providersResolver&&O.providersResolver(O)}let y=!1,w=!1,T=ho(t,n,c.length,null);for(let A=0;A<c.length;A++){const O=c[A];e.mergedAttrs=le(e.mergedAttrs,O.hostAttrs),Ae(t,e,n,T,O),Te(T,O,f),null!==O.contentQueries&&(e.flags|=8),(null!==O.hostBindings||null!==O.hostAttrs||0!==O.hostVars)&&(e.flags|=128);const V=O.type.prototype;!y&&(V.ngOnChanges||V.ngOnInit||V.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(e.index),y=!0),!w&&(V.ngOnChanges||V.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(e.index),w=!0),T++}!function(t,n){const i=n.directiveEnd,o=t.data,c=n.attrs,f=[];let y=null,w=null;for(let T=n.directiveStart;T<i;T++){const A=o[T],O=A.inputs,V=null===c||Bg(n)?null:Ze(O,c);f.push(V),y=a(O,T,y),w=a(A.outputs,T,w)}null!==y&&(y.hasOwnProperty("class")&&(n.flags|=16),y.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=f,n.inputs=y,n.outputs=w}(t,e)}f&&function(t,n,e){if(n){const i=t.localNames=[];for(let o=0;o<n.length;o+=2){const c=e[n[o+1]];if(null==c)throw new ie("301",`Export of name '${n[o+1]}' not found!`);i.push(n[o],c)}}}(e,i,f)}return e.mergedAttrs=le(e.mergedAttrs,e.attrs),o}function N(t,n,e,i,o,c){const f=c.hostBindings;if(f){let y=t.hostBindingOpCodes;null===y&&(y=t.hostBindingOpCodes=[]);const w=~n.index;(function(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(y)!=w&&y.push(w),y.push(i,o,f)}}function re(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function ve(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function Te(t,n,e){if(e){if(n.exportAs)for(let i=0;i<n.exportAs.length;i++)e[n.exportAs[i]]=t;Go(n)&&(e[""]=t)}}function Se(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function Ae(t,n,e,i,o){t.data[i]=o;const c=o.factory||(o.factory=Ls(o.type)),f=new b(c,Go(o),null);t.blueprint[i]=f,e[i]=f,N(t,n,0,i,ho(t,e,o.hostVars,on),o)}function He(t,n,e){const i=vr(n,t),o=Qg(e),c=t[10],f=St(t,xa(t,o,null,e.onPush?64:16,i,n,c,c.createRenderer(i,e),null,null));t[n.index]=f}function We(t,n,e,i,o,c){const f=vr(t,n);!function(t,n,e,i,o,c,f){if(null==c)Ei(t)?t.removeAttribute(n,o,e):n.removeAttribute(o);else{const y=null==f?fe(c):f(c,i||"",o);Ei(t)?t.setAttribute(n,o,y,e):e?n.setAttributeNS(e,o,y):n.setAttribute(o,y)}}(n[11],f,c,t.value,e,i,o)}function st(t,n,e,i,o,c){const f=c[n];if(null!==f){const y=i.setInput;for(let w=0;w<f.length;){const T=f[w++],A=f[w++],O=f[w++];null!==y?i.setInput(e,O,T,A):e[A]=O}}}function Ze(t,n){let e=null,i=0;for(;i<n.length;){const o=n[i];if(0!==o)if(5!==o){if("number"==typeof o)break;t.hasOwnProperty(o)&&(null===e&&(e=[]),e.push(o,t[o],n[i+1])),i+=2}else i+=2;else i+=4}return e}function at(t,n,e,i){return new Array(t,!0,!1,n,null,0,i,e,null,null)}function bt(t,n){const e=rr(n,t);if(Pu(e)){const i=e[1];80&e[2]?dc(i,e,i.template,e[8]):e[5]>0&&Mn(e)}}function Mn(t){for(let i=sc(t);null!==i;i=kf(i))for(let o=10;o<i.length;o++){const c=i[o];if(1024&c[2]){const f=c[1];dc(f,c,f.template,c[8])}else c[5]>0&&Mn(c)}const e=t[1].components;if(null!==e)for(let i=0;i<e.length;i++){const o=rr(e[i],t);Pu(o)&&o[5]>0&&Mn(o)}}function Lt(t,n){const e=rr(n,t),i=e[1];(function(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])})(i,e),lu(i,e,e[8])}function St(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function Ot(t){for(;t;){t[2]|=64;const n=ad(t);if(Gp(t)&&!n)return t;t=n}return null}function vi(t,n,e){const i=n[10];i.begin&&i.begin();try{dc(t,n,t.template,e)}catch(o){throw Xn(n,o),o}finally{i.end&&i.end()}}function Qi(t){!function(t){for(let n=0;n<t.components.length;n++){const e=t.components[n],i=ru(e),o=i[1];Zs(o,i,o.template,e)}}(t[8])}function On(t,n,e){jc(0),n(t,e)}const pr=(()=>Promise.resolve(null))();function Si(t){return t[7]||(t[7]=[])}function sr(t){return t.cleanup||(t.cleanup=[])}function Xn(t,n){const e=t[9],i=e?e.get(ou,null):null;i&&i.handleError(n)}function Vr(t,n,e,i,o){for(let c=0;c<e.length;){const f=e[c++],y=e[c++],w=n[f],T=t.data[f];null!==T.setInput?T.setInput(w,o,i,y):w[y]=o}}function Hn(t,n,e){const i=pa(n,t);!function(t,n,e){Ei(t)?t.setValue(n,e):n.textContent=e}(t[11],i,e)}function Qn(t,n,e){let i=e?t.styles:null,o=e?t.classes:null,c=0;if(null!==n)for(let f=0;f<n.length;f++){const y=n[f];"number"==typeof y?c=y:1==c?o=oa(o,y):2==c&&(i=oa(i,y+": "+n[++f]+";"))}e?t.styles=i:t.stylesWithoutHost=i,e?t.classes=o:t.classesWithoutHost=o}const ii=new Yt("INJECTOR",-1);class Nn{get(n,e=Uu){if(e===Uu){const i=new Error(`NullInjectorError: No provider for ${qt(n)}!`);throw i.name="NullInjectorError",i}return e}}const ar=new Yt("Set Injector scope."),Tr={},Xs={};let Ro;function Es(){return void 0===Ro&&(Ro=new Nn),Ro}function Mr(t,n=null,e=null,i){return new Ca(t,e,n||Es(),i)}class Ca{constructor(n,e,i,o=null){this.parent=i,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const c=[];e&&js(e,y=>this.processProvider(y,n,e)),js([n],y=>this.processInjectorType(y,[],c)),this.records.set(ii,pc(void 0,this));const f=this.records.get(ar);this.scope=null!=f?f.value:null,this.source=o||("object"==typeof n?null:qt(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,e=Uu,i=Tt.Default){this.assertNotDestroyed();const o=$u(this),c=$o(void 0);try{if(!(i&Tt.SkipSelf)){let y=this.records.get(n);if(void 0===y){const w=function(t){return"function"==typeof t||"object"==typeof t&&t instanceof Yt}(n)&&ds(n);y=w&&this.injectableDefInScope(w)?pc(hl(n),Tr):null,this.records.set(n,y)}if(null!=y)return this.hydrate(n,y)}return(i&Tt.Self?Es():this.parent).get(n,e=i&Tt.Optional&&e===Uu?null:e)}catch(f){if("NullInjectorError"===f.name){if((f[xs]=f[xs]||[]).unshift(qt(n)),o)throw f;return Xh(f,n,"R3InjectorError",this.source)}throw f}finally{$o(c),$u(o)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((i,o)=>n.push(qt(o))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,e,i){if(!(n=F(n)))return!1;let o=fs(n);const c=null==o&&n.ngModule||void 0,f=void 0===c?n:c,y=-1!==i.indexOf(f);if(void 0!==c&&(o=fs(c)),null==o)return!1;if(null!=o.imports&&!y){let A;i.push(f);try{js(o.imports,O=>{this.processInjectorType(O,e,i)&&(void 0===A&&(A=[]),A.push(O))})}finally{}if(void 0!==A)for(let O=0;O<A.length;O++){const{ngModule:V,providers:j}=A[O];js(j,ee=>this.processProvider(ee,V,j||Wn))}}this.injectorDefTypes.add(f);const w=Ls(f)||(()=>new f);this.records.set(f,pc(w,Tr));const T=o.providers;if(null!=T&&!y){const A=n;js(T,O=>this.processProvider(O,A,T))}return void 0!==c&&void 0!==n.providers}processProvider(n,e,i){let o=gr(n=F(n))?n:F(n&&n.provide);const c=function(t,n,e){return dl(t)?pc(void 0,t.useValue):pc(Yf(t),Tr)}(n);if(gr(n)||!0!==n.multi)this.records.get(o);else{let f=this.records.get(o);f||(f=pc(void 0,Tr,!0),f.factory=()=>rc(f.multi),this.records.set(o,f)),o=n,f.multi.push(n)}this.records.set(o,c)}hydrate(n,e){return e.value===Tr&&(e.value=Xs,e.value=e.factory()),"object"==typeof e.value&&e.value&&function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this.onDestroy.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=F(n.providedIn);return"string"==typeof e?"any"===e||e===this.scope:this.injectorDefTypes.has(e)}}function hl(t){const n=ds(t),e=null!==n?n.factory:Ls(t);if(null!==e)return e;if(t instanceof Yt)throw new Error(`Token ${qt(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const i=nc(n,"?");throw new Error(`Can't resolve all parameters for ${qt(t)}: (${i.join(", ")}).`)}const e=function(t){const n=t&&(t[Ll]||t[vu]);if(n){const e=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),n}return null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new Error("unreachable")}function Yf(t,n,e){let i;if(gr(t)){const o=F(t);return Ls(o)||hl(o)}if(dl(t))i=()=>F(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...rc(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))i=()=>je(F(t.useExisting));else{const o=F(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Ls(o)||hl(o);i=()=>new o(...rc(t.deps))}return i}function pc(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function dl(t){return null!==t&&"object"==typeof t&&ng in t}function gr(t){return"function"==typeof t}const Uw=function(t,n,e){return function(t,n=null,e=null,i){const o=Mr(t,n,e,i);return o._resolveInjectorDefTypes(),o}({name:e},n,t,e)};let Un=(()=>{class t{static create(e,i){return Array.isArray(e)?Uw(e,i,""):Uw(e.providers,e.parent,e.name||"")}}return t.THROW_IF_NOT_FOUND=Uu,t.NULL=new Nn,t.\u0275prov=ht({token:t,providedIn:"any",factory:()=>je(ii)}),t.__NG_ELEMENT_ID__=-1,t})();function k2(t,n){qc(ru(t)[1],Ti())}function Ri(t){let n=function(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const i=[t];for(;n;){let o;if(Go(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Error("Directives cannot inherit Components");o=n.\u0275dir}if(o){if(e){i.push(o);const f=t;f.inputs=h1(t.inputs),f.declaredInputs=h1(t.declaredInputs),f.outputs=h1(t.outputs);const y=o.hostBindings;y&&F2(t,y);const w=o.viewQuery,T=o.contentQueries;if(w&&N2(t,w),T&&R2(t,T),Ns(t.inputs,o.inputs),Ns(t.declaredInputs,o.declaredInputs),Ns(t.outputs,o.outputs),Go(o)&&o.data.animation){const A=t.data;A.animation=(A.animation||[]).concat(o.data.animation)}}const c=o.features;if(c)for(let f=0;f<c.length;f++){const y=c[f];y&&y.ngInherit&&y(t),y===Ri&&(e=!1)}}n=Object.getPrototypeOf(n)}!function(t){let n=0,e=null;for(let i=t.length-1;i>=0;i--){const o=t[i];o.hostVars=n+=o.hostVars,o.hostAttrs=le(o.hostAttrs,e=le(e,o.hostAttrs))}}(i)}function h1(t){return t===io?{}:t===Wn?[]:t}function N2(t,n){const e=t.viewQuery;t.viewQuery=e?(i,o)=>{n(i,o),e(i,o)}:n}function R2(t,n){const e=t.contentQueries;t.contentQueries=e?(i,o,c)=>{n(i,o,c),e(i,o,c)}:n}function F2(t,n){const e=t.hostBindings;t.hostBindings=e?(i,o)=>{n(i,o),e(i,o)}:n}let fy=null;function Jf(){if(!fy){const t=jn.Symbol;if(t&&t.iterator)fy=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<n.length;++e){const i=n[e];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(fy=i)}}}return fy}function om(t){return!!d1(t)&&(Array.isArray(t)||!(t instanceof Map)&&Jf()in t)}function d1(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Oo(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function Yn(t,n,e,i){const o=tt();return Oo(o,Ja(),n)&&(An(),We(Mi(),o,t,n,e,i)),Yn}function ep(t,n,e,i,o,c){const y=function(t,n,e,i){const o=Oo(t,n,e);return Oo(t,n+1,i)||o}(t,It.lFrame.bindingIndex,e,o);return so(2),y?n+fe(e)+i+fe(o)+c:on}function ce(t,n=Tt.Default){const e=tt();return null===e?je(t,n):Zt(Ti(),e,F(t),n)}function rt(t,n,e){const i=tt();return Oo(i,Ja(),n)&&function(t,n,e,i,o,c,f,y){const w=vr(n,e);let A,T=n.inputs;!y&&null!=T&&(A=T[i])?(Vr(t,e,A,i,o),Fc(n)&&function(t,n){const e=rr(n,t);16&e[2]||(e[2]|=64)}(e,n.index)):3&n.type&&(i=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),o=null!=f?f(o,n.value||"",i):o,Ei(c)?c.setProperty(w,i,o):Q(i)||(w.setProperty?w.setProperty(i,o):w[i]=o))}(An(),Mi(),i,t,n,i[11],e,!1),rt}function _1(t,n,e,i,o){const f=o?"class":"style";Vr(t,e,n.inputs[f],f,i)}function Ue(t,n,e,i){const o=tt(),c=An(),f=20+t,y=o[11],w=o[f]=uo(y,n,It.lFrame.currentNamespace),T=c.firstCreatePass?function(t,n,e,i,o,c,f){const y=n.consts,T=hc(n,t,2,o,Vs(y,c));return P(n,e,T,Vs(y,f)),null!==T.attrs&&Qn(T,T.attrs,!1),null!==T.mergedAttrs&&Qn(T,T.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,T),T}(f,c,o,0,n,e,i):c.data[f];qo(T,!0);const A=T.mergedAttrs;null!==A&&H(y,w,A);const O=T.classes;null!==O&&Lg(y,w,O);const V=T.styles;null!==V&&Z_(y,w,V),64!=(64&T.flags)&&dd(c,o,w,T),0===It.lFrame.elementDepthCount&&Yr(w,o),It.lFrame.elementDepthCount++,Oc(T)&&(Zf(c,o,T),function(t,n,e){if(Mh(n)){const o=n.directiveEnd;for(let c=n.directiveStart;c<o;c++){const f=t.data[c];f.contentQueries&&f.contentQueries(1,e[c],c)}}}(c,T,o)),null!==i&&ah(o,T)}function $e(){let t=Ti();Ya()?yt():(t=t.parent,qo(t,!1));const n=t;It.lFrame.elementDepthCount--;const e=An();e.firstCreatePass&&(qc(e,t),Mh(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&_1(e,n,tt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&_1(e,n,tt(),n.stylesWithoutHost,!1)}function ei(t,n,e,i){Ue(t,n,e,i),$e()}function Fi(){return tt()}function am(t){return!!t&&"function"==typeof t.then}const my=function(t){return!!t&&"function"==typeof t.subscribe};function At(t,n,e,i){const o=tt(),c=An(),f=Ti();return function(t,n,e,i,o,c,f,y){const w=Oc(i),A=t.firstCreatePass&&sr(t),O=n[8],V=Si(n);let j=!0;if(3&i.type||y){const me=vr(i,n),Ve=y?y(me):me,ke=V.length,Dt=y?Nt=>y(zi(Nt[i.index])):i.index;if(Ei(e)){let Nt=null;if(!y&&w&&(Nt=function(t,n,e,i){const o=t.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const f=o[c];if(f===e&&o[c+1]===i){const y=n[7],w=o[c+2];return y.length>w?y[w]:null}"string"==typeof f&&(c+=2)}return null}(t,n,o,i.index)),null!==Nt)(Nt.__ngLastListenerFn__||Nt).__ngNextListenerFn__=c,Nt.__ngLastListenerFn__=c,j=!1;else{c=b1(i,n,O,c,!1);const un=e.listen(Ve,o,c);V.push(c,un),A&&A.push(o,Dt,ke,ke+1)}}else c=b1(i,n,O,c,!0),Ve.addEventListener(o,c,f),V.push(c),A&&A.push(o,Dt,ke,f)}else c=b1(i,n,O,c,!1);const ee=i.outputs;let be;if(j&&null!==ee&&(be=ee[o])){const me=be.length;if(me)for(let Ve=0;Ve<me;Ve+=2){const hr=n[be[Ve]][be[Ve+1]].subscribe(c),as=V.length;V.push(c,hr),A&&A.push(o,i.index,as,-(as+1))}}}(c,o,o[11],f,t,n,!!e,i),At}function SC(t,n,e,i){try{return!1!==e(i)}catch(o){return Xn(t,o),!1}}function b1(t,n,e,i,o){return function c(f){if(f===Function)return i;const y=2&t.flags?rr(t.index,n):n;0==(32&n[2])&&Ot(y);let w=SC(n,0,i,f),T=c.__ngNextListenerFn__;for(;T;)w=SC(n,0,T,f)&&w,T=T.__ngNextListenerFn__;return o&&!1===w&&(f.preventDefault(),f.returnValue=!1),w}}function pt(t=1){return function(t){return(It.lFrame.contextLView=function(t,n){for(;t>0;)n=n[15],t--;return n}(t,It.lFrame.contextLView))[8]}(t)}function mk(t,n){let e=null;const i=function(t){const n=t.attrs;if(null!=n){const e=n.indexOf(5);if(0==(1&e))return n[e+1]}return null}(t);for(let o=0;o<n.length;o++){const c=n[o];if("*"!==c){if(null===i?zg(t,c,!0):Xv(i,c))return o}else e=o}return e}function LC(t,n,e,i,o){const c=t[e+1],f=null===n;let y=i?Ws(c):cl(c),w=!1;for(;0!==y&&(!1===w||f);){const A=t[y+1];vk(t[y],n)&&(w=!0,t[y+1]=i?Hg(A):rh(A)),y=i?Ws(A):cl(A)}w&&(t[e+1]=i?rh(c):Hg(c))}function vk(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&zu(t,n)>=0}const zr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function BC(t){return t.substring(zr.key,zr.keyEnd)}function VC(t,n){const e=zr.textEnd;return e===n?-1:(n=zr.keyEnd=function(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}(t,zr.key=n,e),lp(t,n,e))}function lp(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function gn(t,n){return function(t,n,e,i){const o=tt(),c=An(),f=so(2);c.firstUpdatePass&&GC(c,t,f,i),n!==on&&Oo(o,f,n)&&WC(c,c.data[xr()],o,o[11],t,o[f+1]=function(t,n){return null==t||("string"==typeof n?t+=n:"object"==typeof t&&(t=qt(Jo(t)))),t}(n,e),i,f)}(t,n,null,!0),gn}function gl(t){!function(t,n,e,i){const o=An(),c=so(2);o.firstUpdatePass&&GC(o,null,c,i);const f=tt();if(e!==on&&Oo(f,c,e)){const y=o.data[xr()];if(XC(y,i)&&!HC(o,c)){let w=i?y.classesWithoutHost:y.stylesWithoutHost;null!==w&&(e=oa(w,e||"")),_1(o,y,f,e,i)}else!function(t,n,e,i,o,c,f,y){o===on&&(o=Wn);let w=0,T=0,A=0<o.length?o[0]:null,O=0<c.length?c[0]:null;for(;null!==A||null!==O;){const V=w<o.length?o[w+1]:void 0,j=T<c.length?c[T+1]:void 0;let be,ee=null;A===O?(w+=2,T+=2,V!==j&&(ee=O,be=j)):null===O||null!==A&&A<O?(w+=2,ee=A):(T+=2,ee=O,be=j),null!==ee&&WC(t,n,e,i,ee,be,f,y),A=w<o.length?o[w]:null,O=T<c.length?c[T]:null}}(o,y,f,f[11],f[c+1],f[c+1]=function(t,n,e){if(null==e||""===e)return Wn;const i=[],o=Jo(e);if(Array.isArray(o))for(let c=0;c<o.length;c++)t(i,o[c],!0);else if("object"==typeof o)for(const c in o)o.hasOwnProperty(c)&&t(i,c,o[c]);else"string"==typeof o&&n(i,o);return i}(t,n,e),i,c)}}(Ji,_c,t,!0)}function _c(t,n){for(let e=function(t){return function(t){zr.key=0,zr.keyEnd=0,zr.value=0,zr.valueEnd=0,zr.textEnd=t.length}(t),VC(t,lp(t,0,zr.textEnd))}(n);e>=0;e=VC(n,e))Ji(t,BC(n),!0)}function HC(t,n){return n>=t.expandoStartIndex}function GC(t,n,e,i){const o=t.data;if(null===o[e+1]){const c=o[xr()],f=HC(t,e);XC(c,i)&&null===n&&!f&&(n=!1),n=function(t,n,e,i){const o=function(t){const n=It.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let c=i?n.residualClasses:n.residualStyles;if(null===o)0===(i?n.classBindings:n.styleBindings)&&(e=lm(e=w1(null,t,n,e,i),n.attrs,i),c=null);else{const f=n.directiveStylingLast;if(-1===f||t[f]!==o)if(e=w1(o,t,n,e,i),null===c){let w=function(t,n,e){const i=e?n.classBindings:n.styleBindings;if(0!==cl(i))return t[Ws(i)]}(t,n,i);void 0!==w&&Array.isArray(w)&&(w=w1(null,t,n,w[1],i),w=lm(w,n.attrs,i),function(t,n,e,i){t[Ws(e?n.classBindings:n.styleBindings)]=i}(t,n,i,w))}else c=function(t,n,e){let i;const o=n.directiveEnd;for(let c=1+n.directiveStylingLast;c<o;c++)i=lm(i,t[c].hostAttrs,e);return lm(i,n.attrs,e)}(t,n,i)}return void 0!==c&&(i?n.residualClasses=c:n.residualStyles=c),e}(o,c,n,i),function(t,n,e,i,o,c){let f=c?n.classBindings:n.styleBindings,y=Ws(f),w=cl(f);t[i]=e;let A,T=!1;if(Array.isArray(e)){const O=e;A=O[1],(null===A||zu(O,A)>0)&&(T=!0)}else A=e;if(o)if(0!==w){const V=Ws(t[y+1]);t[i+1]=qs(V,y),0!==V&&(t[V+1]=jg(t[V+1],i)),t[y+1]=function(t,n){return 131071&t|n<<17}(t[y+1],i)}else t[i+1]=qs(y,0),0!==y&&(t[y+1]=jg(t[y+1],i)),y=i;else t[i+1]=qs(w,0),0===y?y=i:t[w+1]=jg(t[w+1],i),w=i;T&&(t[i+1]=rh(t[i+1])),LC(t,A,i,!0),LC(t,A,i,!1),function(t,n,e,i,o){const c=o?t.residualClasses:t.residualStyles;null!=c&&"string"==typeof n&&zu(c,n)>=0&&(e[i+1]=Hg(e[i+1]))}(n,A,t,i,c),f=qs(y,w),c?n.classBindings=f:n.styleBindings=f}(o,c,n,e,f,i)}}function w1(t,n,e,i,o){let c=null;const f=e.directiveEnd;let y=e.directiveStylingLast;for(-1===y?y=e.directiveStart:y++;y<f&&(c=n[y],i=lm(i,c.hostAttrs,o),c!==t);)y++;return null!==t&&(e.directiveStylingLast=y),i}function lm(t,n,e){const i=e?1:2;let o=-1;if(null!==n)for(let c=0;c<n.length;c++){const f=n[c];"number"==typeof f?o=f:o===i&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Ji(t,f,!!e||n[++c]))}return void 0===t?null:t}function WC(t,n,e,i,o,c,f,y){if(!(3&n.type))return;const w=t.data,T=w[y+1];yy(function(t){return 1==(1&t)}(T)?ZC(w,n,e,o,cl(T),f):void 0)||(yy(c)||function(t){return 2==(2&t)}(T)&&(c=ZC(w,null,e,o,y,f)),function(t,n,e,i,o){const c=Ei(t);if(n)o?c?t.addClass(e,i):e.classList.add(i):c?t.removeClass(e,i):e.classList.remove(i);else{let f=-1===i.indexOf("-")?void 0:Ko.DashCase;if(null==o)c?t.removeStyle(e,i,f):e.style.removeProperty(i);else{const y="string"==typeof o&&o.endsWith("!important");y&&(o=o.slice(0,-10),f|=Ko.Important),c?t.setStyle(e,i,o,f):e.style.setProperty(i,o,y?"important":"")}}}(i,f,pa(xr(),e),o,c))}function ZC(t,n,e,i,o,c){const f=null===n;let y;for(;o>0;){const w=t[o],T=Array.isArray(w),A=T?w[1]:w,O=null===A;let V=e[o+1];V===on&&(V=O?Wn:void 0);let j=O?ol(V,i):A===i?V:void 0;if(T&&!yy(j)&&(j=ol(w,i)),yy(j)&&(y=j,f))return y;const ee=t[o+1];o=f?Ws(ee):cl(ee)}if(null!==n){let w=c?n.residualClasses:n.residualStyles;null!=w&&(y=ol(w,i))}return y}function yy(t){return void 0!==t}function XC(t,n){return 0!=(t.flags&(n?16:32))}function Ln(t,n=""){const e=tt(),i=An(),o=t+20,c=i.firstCreatePass?hc(i,o,1,n,null):i.data[o],f=e[o]=function(t,n){return Ei(t)?t.createText(n):t.createTextNode(n)}(e[11],n);dd(i,e,f,c),qo(c,!1)}function C1(t,n,e,i,o){const c=tt(),f=ep(c,t,n,e,i,o);return f!==on&&Hn(c,xr(),f),C1}const Td=void 0;var Kk=["en",[["a","p"],["AM","PM"],Td],[["AM","PM"],Td,Td],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Td,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Td,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Td,"{1} 'at' {0}",Td],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),e=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===e?1:5}];let up={};function gD(t){return t in up||(up[t]=jn.ng&&jn.ng.common&&jn.ng.common.locales&&jn.ng.common.locales[t]),up[t]}var Mt=(()=>((Mt=Mt||{})[Mt.LocaleId=0]="LocaleId",Mt[Mt.DayPeriodsFormat=1]="DayPeriodsFormat",Mt[Mt.DayPeriodsStandalone=2]="DayPeriodsStandalone",Mt[Mt.DaysFormat=3]="DaysFormat",Mt[Mt.DaysStandalone=4]="DaysStandalone",Mt[Mt.MonthsFormat=5]="MonthsFormat",Mt[Mt.MonthsStandalone=6]="MonthsStandalone",Mt[Mt.Eras=7]="Eras",Mt[Mt.FirstDayOfWeek=8]="FirstDayOfWeek",Mt[Mt.WeekendRange=9]="WeekendRange",Mt[Mt.DateFormat=10]="DateFormat",Mt[Mt.TimeFormat=11]="TimeFormat",Mt[Mt.DateTimeFormat=12]="DateTimeFormat",Mt[Mt.NumberSymbols=13]="NumberSymbols",Mt[Mt.NumberFormats=14]="NumberFormats",Mt[Mt.CurrencyCode=15]="CurrencyCode",Mt[Mt.CurrencySymbol=16]="CurrencySymbol",Mt[Mt.CurrencyName=17]="CurrencyName",Mt[Mt.Currencies=18]="Currencies",Mt[Mt.Directionality=19]="Directionality",Mt[Mt.PluralCase=20]="PluralCase",Mt[Mt.ExtraData=21]="ExtraData",Mt))();const vy="en-US";let mD=vy;function D1(t){wi(t,"Expected localeId to be defined"),"string"==typeof t&&(mD=t.toLowerCase().replace(/_/g,"-"))}function M1(t,n,e,i,o){if(t=F(t),Array.isArray(t))for(let c=0;c<t.length;c++)M1(t[c],n,e,i,o);else{const c=An(),f=tt();let y=gr(t)?t:F(t.provide),w=Yf(t);const T=Ti(),A=1048575&T.providerIndexes,O=T.directiveStart,V=T.providerIndexes>>20;if(gr(t)||!t.multi){const j=new b(w,o,ce),ee=I1(y,n,o?A:A+V,O);-1===ee?(Xt(mt(T,f),c,y),S1(c,t,n.length),n.push(y),T.directiveStart++,T.directiveEnd++,o&&(T.providerIndexes+=1048576),e.push(j),f.push(j)):(e[ee]=j,f[ee]=j)}else{const j=I1(y,n,A+V,O),ee=I1(y,n,A,A+V),be=j>=0&&e[j],me=ee>=0&&e[ee];if(o&&!me||!o&&!be){Xt(mt(T,f),c,y);const Ve=function(t,n,e,i,o){const c=new b(t,e,ce);return c.multi=[],c.index=n,c.componentProviders=0,VD(c,o,i&&!e),c}(o?WP:qP,e.length,o,i,w);!o&&me&&(e[ee].providerFactory=Ve),S1(c,t,n.length,0),n.push(y),T.directiveStart++,T.directiveEnd++,o&&(T.providerIndexes+=1048576),e.push(Ve),f.push(Ve)}else S1(c,t,j>-1?j:ee,VD(e[o?ee:j],w,!o&&i));!o&&i&&me&&e[ee].componentProviders++}}}function S1(t,n,e,i){const o=gr(n);if(o||function(t){return!!t.useClass}(n)){const f=(n.useClass||n).prototype.ngOnDestroy;if(f){const y=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){const w=y.indexOf(e);-1===w?y.push(e,[i,f]):y[w+1].push(i,f)}else y.push(e,f)}}}function VD(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function I1(t,n,e,i){for(let o=e;o<i;o++)if(n[o]===t)return o;return-1}function qP(t,n,e,i){return A1(this.multi,[])}function WP(t,n,e,i){const o=this.multi;let c;if(this.providerFactory){const f=this.providerFactory.componentProviders,y=Gi(e,e[1],this.providerFactory.index,i);c=y.slice(0,f),A1(o,c);for(let w=f;w<y.length;w++)c.push(y[w])}else c=[],A1(o,c);return c}function A1(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function ri(t,n=[]){return e=>{e.providersResolver=(i,o)=>function(t,n,e){const i=An();if(i.firstCreatePass){const o=Go(t);M1(e,i.data,i.blueprint,o,!0),M1(n,i.data,i.blueprint,o,!1)}}(i,o?o(t):t,n)}}class zD{}const $D="ngComponent";class YP{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${qt(t)}. Did you add it to @NgModule.entryComponents?`);return n[$D]=t,n}(n)}}let Js=(()=>{class t{}return t.NULL=new YP,t})();function Dy(...t){}function fp(t,n){return new bn(vr(t,n))}const QP=function(){return fp(Ti(),tt())};let bn=(()=>{class t{constructor(e){this.nativeElement=e}}return t.__NG_ELEMENT_ID__=QP,t})();function jD(t){return t instanceof bn?t.nativeElement:t}class pp{}let go=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>tN(),t})();const tN=function(){const t=tt(),e=rr(Ti().index,t);return function(t){return t[11]}(So(e)?e:t)};let P1=(()=>{class t{}return t.\u0275prov=ht({token:t,providedIn:"root",factory:()=>null}),t})();class pm{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const HD=new pm("12.2.7");class GD{constructor(){}supports(n){return om(n)}create(n){return new oN(n)}}const rN=(t,n)=>n;class oN{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||rN}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,i=this._removalsHead,o=0,c=null;for(;e||i;){const f=!i||e&&e.currentIndex<WD(i,o,c)?e:i,y=WD(f,o,c),w=f.currentIndex;if(f===i)o--,i=i._nextRemoved;else if(e=e._next,null==f.previousIndex)o++;else{c||(c=[]);const T=y-o,A=w-o;if(T!=A){for(let V=0;V<T;V++){const j=V<c.length?c[V]:c[V]=0,ee=j+V;A<=ee&&ee<T&&(c[V]=j+1)}c[f.previousIndex]=A-T}}y!==w&&n(f,y,w)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!om(n))throw new Error(`Error trying to diff '${qt(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o,c,f,e=this._itHead,i=!1;if(Array.isArray(n)){this.length=n.length;for(let y=0;y<this.length;y++)c=n[y],f=this._trackByFn(y,c),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,c,f,y)),Object.is(e.item,c)||this._addIdentityChange(e,c)):(e=this._mismatch(e,c,f,y),i=!0),e=e._next}else o=0,function(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Jf()]();let i;for(;!(i=e.next()).done;)n(i.value)}}(n,y=>{f=this._trackByFn(o,y),null!==e&&Object.is(e.trackById,f)?(i&&(e=this._verifyReinsertion(e,y,f,o)),Object.is(e.item,y)||this._addIdentityChange(e,y)):(e=this._mismatch(e,y,f,o),i=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,i,o){let c;return null===n?c=this._itTail:(c=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,c,o)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(i,o))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,c,o)):n=this._addAfter(new sN(e,i),c,o),n}_verifyReinsertion(n,e,i,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==c?n=this._reinsertAfter(c,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const o=n._prevRemoved,c=n._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(n,e,i),this._addToMoves(n,i),n}_moveAfter(n,e,i){return this._unlink(n),this._insertAfter(n,e,i),this._addToMoves(n,i),n}_addAfter(n,e,i){return this._insertAfter(n,e,i),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,i){const o=null===e?this._itHead:e._next;return n._next=o,n._prev=e,null===o?this._itTail=n:o._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new qD),this._linkedRecords.put(n),n.currentIndex=i,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,i=n._next;return null===e?this._itHead=i:e._next=i,null===i?this._itTail=e:i._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new qD),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class sN{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class aN{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===e||e<=i.currentIndex)&&Object.is(i.trackById,n))return i;return null}remove(n){const e=n._prevDup,i=n._nextDup;return null===e?this._head=i:e._nextDup=i,null===i?this._tail=e:i._prevDup=e,null===this._head}}class qD{constructor(){this.map=new Map}put(n){const e=n.trackById;let i=this.map.get(e);i||(i=new aN,this.map.set(e,i)),i.add(n)}get(n,e){const o=this.map.get(n);return o?o.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function WD(t,n,e){const i=t.previousIndex;if(null===i)return i;let o=0;return e&&i<e.length&&(o=e[i]),i+n+o}class ZD{constructor(){}supports(n){return n instanceof Map||d1(n)}create(){return new lN}}class lN{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||d1(n)))throw new Error(`Error trying to diff '${qt(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(i,o)=>{if(e&&e.key===o)this._maybeAddToChanges(e,i),this._appendAfter=e,e=e._next;else{const c=this._getOrCreateRecordForKey(o,i);e=this._insertBeforeOrAppend(e,c)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let i=e;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const i=n._prev;return e._next=n,e._prev=i,n._prev=e,i&&(i._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const o=this._records.get(n);this._maybeAddToChanges(o,e);const c=o._prev,f=o._next;return c&&(c._next=f),f&&(f._prev=c),o._next=null,o._prev=null,o}const i=new cN(n);return this._records.set(n,i),i.currentValue=e,this._addToAdditions(i),i}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(i=>e(n[i],i))}}class cN{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function XD(){return new gm([new GD])}let gm=(()=>{class t{constructor(e){this.factories=e}static create(e,i){if(null!=i){const o=i.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||XD()),deps:[[t,new al,new ko]]}}find(e){const i=this.factories.find(o=>o.supports(e));if(null!=i)return i;throw new Error(`Cannot find a differ supporting object '${e}' of type '${function(t){return t.name||typeof t}(e)}'`)}}return t.\u0275prov=ht({token:t,providedIn:"root",factory:XD}),t})();function YD(){return new gp([new ZD])}let gp=(()=>{class t{constructor(e){this.factories=e}static create(e,i){if(i){const o=i.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:i=>t.create(e,i||YD()),deps:[[t,new al,new ko]]}}find(e){const i=this.factories.find(o=>o.supports(e));if(i)return i;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return t.\u0275prov=ht({token:t,providedIn:"root",factory:YD}),t})();function Ey(t,n,e,i,o=!1){for(;null!==e;){const c=n[e.index];if(null!==c&&i.push(zi(c)),yr(c))for(let y=10;y<c.length;y++){const w=c[y],T=w[1].firstChild;null!==T&&Ey(w[1],w,T,i)}const f=e.type;if(8&f)Ey(t,n,e.child,i);else if(32&f){const y=Tg(e,n);let w;for(;w=y();)i.push(w)}else if(16&f){const y=Of(n,e);if(Array.isArray(y))i.push(...y);else{const w=ad(n[16]);Ey(w[1],w,y,i,!0)}}e=o?e.projectionNext:e.next}return i}class mm{constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,e=n[1];return Ey(e,n,e.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(yr(n)){const e=n[8],i=e?e.indexOf(this):-1;i>-1&&(Ig(n,i),Xc(e,i))}this._attachedToViewContainer=!1}Ag(this._lView[1],this._lView)}onDestroy(n){tm(this._lView[1],this._lView,null,n)}markForCheck(){Ot(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){vi(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,e){ma(!0);try{vi(t,n,e)}finally{ma(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(t,n){ih(t,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class hN extends mm{constructor(n){super(n),this._view=n}detectChanges(){Qi(this._view)}checkNoChanges(){!function(t){ma(!0);try{Qi(t)}finally{ma(!1)}}(this._view)}get context(){return null}}const fN=function(t){return function(t,n,e){if(Fc(t)&&!e){const i=rr(t.index,n);return new mm(i,i)}return 47&t.type?new mm(n[16],n):null}(Ti(),tt(),16==(16&t))};let mo=(()=>{class t{}return t.__NG_ELEMENT_ID__=fN,t})();const mN=[new ZD],yN=new gm([new GD]),vN=new gp(mN),xN=function(){return Ty(Ti(),tt())};let Ii=(()=>{class t{}return t.__NG_ELEMENT_ID__=xN,t})();const wN=Ii,CN=class extends wN{constructor(n,e,i){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=i}createEmbeddedView(n){const e=this._declarationTContainer.tViews,i=xa(this._declarationLView,e,n,16,null,e.declTNode,null,null,null,null);i[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(i[19]=c.createEmbeddedView(e)),lu(e,i,n),new mm(i)}};function Ty(t,n){return 4&t.type?new CN(n,t,fp(t,n)):null}class yc{}class JD{}const TN=function(){return eE(Ti(),tt())};let ts=(()=>{class t{}return t.__NG_ELEMENT_ID__=TN,t})();const SN=ts,KD=class extends SN{constructor(n,e,i){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=i}get element(){return fp(this._hostTNode,this._hostLView)}get injector(){return new kn(this._hostTNode,this._hostLView)}get parentInjector(){const n=vt(this._hostTNode,this._hostLView);if(te(n)){const e=_e(n,this._hostLView),i=se(n);return new kn(e[1].data[i+8],e)}return new kn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=QD(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,e,i){const o=n.createEmbeddedView(e||{});return this.insert(o,i),o}createComponent(n,e,i,o,c){const f=i||this.parentInjector;if(!c&&null==n.ngModule&&f){const w=f.get(yc,null);w&&(c=w)}const y=n.create(f,o,void 0,c);return this.insert(y.hostView,e),y}insert(n,e){const i=n._lView,o=i[1];if(function(t){return yr(t[3])}(i)){const A=this.indexOf(n);if(-1!==A)this.detach(A);else{const O=i[3],V=new KD(O,O[6],O[3]);V.detach(V.indexOf(n))}}const c=this._adjustIndex(e),f=this._lContainer;!function(t,n,e,i){const o=10+i,c=e.length;i>0&&(e[o-1][4]=n),i<c-10?(n[4]=e[o],Hh(e,10+i,n)):(e.push(n),n[4]=null),n[3]=e;const f=n[17];null!==f&&e!==f&&function(t,n){const e=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===e?t[9]=[n]:e.push(n)}(f,n);const y=n[19];null!==y&&y.insertView(t),n[2]|=128}(o,i,f,c);const y=lc(c,f),w=i[11],T=hd(w,f[7]);return null!==T&&function(t,n,e,i,o,c){i[0]=o,i[6]=n,ih(t,i,e,1,o,c)}(o,f[6],w,i,T,y),n.attachToViewContainerRef(),Hh(N1(f),c,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=QD(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),i=Ig(this._lContainer,e);i&&(Xc(N1(this._lContainer),e),Ag(i[1],i))}detach(n){const e=this._adjustIndex(n,-1),i=Ig(this._lContainer,e);return i&&null!=Xc(N1(this._lContainer),e)?new mm(i):null}_adjustIndex(n,e=0){return null==n?this.length+e:n}};function QD(t){return t[8]}function N1(t){return t[8]||(t[8]=[])}function eE(t,n){let e;const i=n[t.index];if(yr(i))e=i;else{let o;if(8&t.type)o=zi(i);else{const c=n[11];o=c.createComment("");const f=vr(t,n);ac(c,hd(c,f),o,function(t,n){return Ei(t)?t.nextSibling(n):n.nextSibling}(c,f),!1)}n[t.index]=e=at(i,n,o,t),St(n,e)}return new KD(e,t,n)}const vp={};class bE extends Js{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=Ut(n);return new wE(e,this.ngModule)}}function xE(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}const DR=new Yt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Ku});class wE extends zD{constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function(t){return t.map(Yv).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return xE(this.componentDef.inputs)}get outputs(){return xE(this.componentDef.outputs)}create(n,e,i,o){const c=(o=o||this.ngModule)?function(t,n){return{get:(e,i,o)=>{const c=t.get(e,vp,o);return c!==vp||i===vp?c:n.get(e,i,o)}}}(n,o.injector):n,f=c.get(pp,Au),y=c.get(P1,null),w=f.createRenderer(null,this.componentDef),T=this.componentDef.selectors[0][0]||"div",A=i?function(t,n,e){if(Ei(t))return t.selectRootElement(n,e===Ci.ShadowDom);let i="string"==typeof n?t.querySelector(n):n;return i.textContent="",i}(w,i,this.componentDef.encapsulation):uo(f.createRenderer(null,this.componentDef),T,function(t){const n=t.toLowerCase();return"svg"===n?Bs:"math"===n?"http://www.w3.org/1998/MathML/":null}(T)),O=this.componentDef.onPush?576:528,V=function(t,n){return{components:[],scheduler:t||Ku,clean:pr,playerHandler:n||null,flags:0}}(),j=bd(0,null,null,1,0,null,null,null,null,null),ee=xa(null,j,V,O,null,null,f,w,y,c);let be,me;Qa(ee);try{const Ve=function(t,n,e,i,o,c){const f=e[1];e[20]=t;const w=hc(f,20,2,"#host",null),T=w.mergedAttrs=n.hostAttrs;null!==T&&(Qn(w,T,!0),null!==t&&(H(o,t,T),null!==w.classes&&Lg(o,t,w.classes),null!==w.styles&&Z_(o,t,w.styles)));const A=i.createRenderer(t,n),O=xa(e,Qg(n),null,n.onPush?64:16,e[20],w,i,A,c||null,null);return f.firstCreatePass&&(Xt(mt(w,e),f,n.type),ve(f,w),Se(w,e.length,1)),St(e,O),e[20]=O}(A,this.componentDef,ee,f,w);if(A)if(i)H(w,A,["ng-version",HD.full]);else{const{attrs:ke,classes:Dt}=function(t){const n=[],e=[];let i=1,o=2;for(;i<t.length;){let c=t[i];if("string"==typeof c)2===o?""!==c&&n.push(c,t[++i]):8===o&&e.push(c);else{if(!Gs(o))break;o=c}i++}return{attrs:n,classes:e}}(this.componentDef.selectors[0]);ke&&H(w,A,ke),Dt&&Dt.length>0&&Lg(w,A,Dt.join(" "))}if(me=Wa(j,20),void 0!==e){const ke=me.projection=[];for(let Dt=0;Dt<this.ngContentSelectors.length;Dt++){const Nt=e[Dt];ke.push(null!=Nt?Array.from(Nt):null)}}be=function(t,n,e,i,o){const c=e[1],f=function(t,n,e){const i=Ti();t.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),Ae(t,i,n,ho(t,n,1,null),e));const o=Gi(n,t,i.directiveStart,i);Yr(o,n);const c=vr(i,n);return c&&Yr(c,n),o}(c,e,n);if(i.components.push(f),t[8]=f,o&&o.forEach(w=>w(f,n)),n.contentQueries){const w=Ti();n.contentQueries(1,f,w.directiveStart)}const y=Ti();return!c.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(ys(y.index),N(e[1],y,0,y.directiveStart,y.directiveEnd,n),re(n,f)),f}(Ve,this.componentDef,ee,V,[k2]),lu(j,ee,null)}finally{_s()}return new MR(this.componentType,be,fp(me,ee),ee,me)}}class MR extends class{}{constructor(n,e,i,o,c){super(),this.location=i,this._rootLView=o,this._tNode=c,this.instance=e,this.hostView=this.changeDetectorRef=new hN(o),this.componentType=n}get injector(){return new kn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const bp=new Map;class AR extends yc{constructor(n,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new bE(this);const i=Fr(n),o=function(t){return t[Xd]||null}(n);o&&D1(o),this._bootstrapComponents=Dr(i.bootstrap),this._r3Injector=Mr(n,e,[{provide:yc,useValue:this},{provide:Js,useValue:this.componentFactoryResolver}],qt(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,e=Un.THROW_IF_NOT_FOUND,i=Tt.Default){return n===Un||n===yc||n===ii?this:this._r3Injector.get(n,e,i)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class q1 extends JD{constructor(n){super(),this.moduleType=n,null!==Fr(n)&&function(t){const n=new Set;!function e(i){const o=Fr(i,!0),c=o.id;null!==c&&(function(t,n,e){if(n&&n!==e)throw new Error(`Duplicate module registered for ${t} - ${qt(n)} vs ${qt(n.name)}`)}(c,bp.get(c),i),bp.set(c,i));const f=Dr(o.imports);for(const y of f)n.has(y)||(n.add(y),e(y))}(t)}(n)}create(n){return new AR(this.moduleType,n)}}function W1(t){return n=>{setTimeout(t,void 0,n)}}const kt=class extends qn{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,i){var o,c,f;let y=n,w=e||(()=>null),T=i;if(n&&"object"==typeof n){const O=n;y=null===(o=O.next)||void 0===o?void 0:o.bind(O),w=null===(c=O.error)||void 0===c?void 0:c.bind(O),T=null===(f=O.complete)||void 0===f?void 0:f.bind(O)}this.__isAsync&&(w=W1(w),y&&(y=W1(y)),T&&(T=W1(T)));const A=super.subscribe({next:y,error:w,complete:T});return n instanceof K&&n.add(A),A}};function HR(){return this._results[Jf()]()}class Ny{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Jf(),i=Ny.prototype;i[e]||(i[e]=HR)}get changes(){return this._changes||(this._changes=new kt)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const i=this;i.dirty=!1;const o=lo(n);(this._changesDetected=!function(t,n,e){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++){let o=t[i],c=n[i];if(e&&(o=e(o),c=e(c)),c!==o)return!1}return!0}(i._results,o,e))&&(i._results=o,i.length=o.length,i.last=o[this.length-1],i.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class Z1{constructor(n){this.queryList=n,this.matches=null}clone(){return new Z1(this.queryList)}setDirty(){this.queryList.setDirty()}}class X1{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const i=null!==n.contentQueries?n.contentQueries[0]:e.length,o=[];for(let c=0;c<i;c++){const f=e.getByIndex(c);o.push(this.queries[f.indexInDeclarationView].clone())}return new X1(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==OE(n,e).matches&&this.queries[e].setDirty()}}class PE{constructor(n,e,i=null){this.predicate=n,this.flags=e,this.read=i}}class Y1{constructor(n=[]){this.queries=n}elementStart(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let i=0;i<this.length;i++){const o=null!==e?e.length:0,c=this.getByIndex(i).embeddedTView(n,o);c&&(c.indexInDeclarationView=i,null!==e?e.push(c):e=[c])}return null!==e?new Y1(e):null}template(n,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class J1{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new J1(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let i=n.parent;for(;null!==i&&8&i.type&&i.index!==e;)i=i.parent;return e===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const i=this.metadata.predicate;if(Array.isArray(i))for(let o=0;o<i.length;o++){const c=i[o];this.matchTNodeWithReadOption(n,e,WR(e,c)),this.matchTNodeWithReadOption(n,e,ao(e,n,c,!1,!1))}else i===Ii?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,ao(e,n,i,!1,!1))}matchTNodeWithReadOption(n,e,i){if(null!==i){const o=this.metadata.read;if(null!==o)if(o===bn||o===ts||o===Ii&&4&e.type)this.addMatch(e.index,-2);else{const c=ao(e,n,o,!1,!1);null!==c&&this.addMatch(e.index,c)}else this.addMatch(e.index,i)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function WR(t,n){const e=t.localNames;if(null!==e)for(let i=0;i<e.length;i+=2)if(e[i]===n)return e[i+1];return null}function XR(t,n,e,i){return-1===e?function(t,n){return 11&t.type?fp(t,n):4&t.type?Ty(t,n):null}(n,t):-2===e?function(t,n,e){return e===bn?fp(n,t):e===Ii?Ty(n,t):e===ts?eE(n,t):void 0}(t,n,i):Gi(t,t[1],e,n)}function NE(t,n,e,i){const o=n[19].queries[i];if(null===o.matches){const c=t.data,f=e.matches,y=[];for(let w=0;w<f.length;w+=2){const T=f[w];y.push(T<0?null:XR(n,c[T],f[w+1],e.metadata.read))}o.matches=y}return o.matches}function K1(t,n,e,i){const o=t.queries.getByIndex(e),c=o.matches;if(null!==c){const f=NE(t,n,o,e);for(let y=0;y<c.length;y+=2){const w=c[y];if(w>0)i.push(f[y/2]);else{const T=c[y+1],A=n[-w];for(let O=10;O<A.length;O++){const V=A[O];V[17]===V[3]&&K1(V[1],V,T,i)}if(null!==A[9]){const O=A[9];for(let V=0;V<O.length;V++){const j=O[V];K1(j[1],j,T,i)}}}}}return i}function hi(t){const n=tt(),e=An(),i=Ou();jc(i+1);const o=OE(e,i);if(t.dirty&&Nh(n)===(2==(2&o.metadata.flags))){if(null===o.matches)t.reset([]);else{const c=o.crossesNgTemplate?K1(e,n,i,[]):NE(e,n,o,i);t.reset(c,jD),t.notifyOnChanges()}return!0}return!1}function Id(t,n,e){const i=An();i.firstCreatePass&&(function(t,n,e){null===t.queries&&(t.queries=new Y1),t.queries.track(new J1(n,e))}(i,new PE(t,n,e),-1),2==(2&n)&&(i.staticViewQueries=!0)),function(t,n,e){const i=new Ny(4==(4&e));tm(t,n,i,i.destroy),null===n[19]&&(n[19]=new X1),n[19].queries.push(new Z1(i))}(i,tt(),n)}function OE(t,n){return t.queries.getByIndex(n)}function Kr(t,n){return Ty(t,n)}const Im=new Yt("Application Initializer");let wp=(()=>{class t{constructor(e){this.appInits=e,this.resolve=Dy,this.reject=Dy,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o})}runInitializers(){if(this.initialized)return;const e=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const c=this.appInits[o]();if(am(c))e.push(c);else if(my(c)){const f=new Promise((y,w)=>{c.subscribe({complete:y,error:w})});e.push(f)}}Promise.all(e).then(()=>{i()}).catch(o=>{this.reject(o)}),0===e.length&&i(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(je(Im,8))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const Am=new Yt("AppId"),EF={provide:Am,useFactory:function(){return`${rb()}${rb()}${rb()}`},deps:[]};function rb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const eT=new Yt("Platform Initializer"),km=new Yt("Platform ID"),tT=new Yt("appBootstrapListener");let Oy=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const Ma=new Yt("LocaleId"),nT=new Yt("DefaultCurrencyCode");class MF{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}const ob=function(t){return new q1(t)},SF=ob,IF=function(t){return Promise.resolve(ob(t))},iT=function(t){const n=ob(t),i=Dr(Fr(t).declarations).reduce((o,c)=>{const f=Ut(c);return f&&o.push(new wE(f)),o},[]);return new MF(n,i)},AF=iT,kF=function(t){return Promise.resolve(iT(t))};let Ad=(()=>{class t{constructor(){this.compileModuleSync=SF,this.compileModuleAsync=IF,this.compileModuleAndAllComponentsSync=AF,this.compileModuleAndAllComponentsAsync=kF}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const RF=(()=>Promise.resolve(0))();function sb(t){"undefined"==typeof Zone?RF.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Bn{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new kt(!1),this.onMicrotaskEmpty=new kt(!1),this.onStable=new kt(!1),this.onError=new kt(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&e,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function(){let t=jn.requestAnimationFrame,n=jn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const e=t[Zone.__symbol__("OriginalDelegate")];e&&(t=e);const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(jn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,lb(t),t.isCheckStableRunning=!0,ab(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),lb(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,i,o,c,f,y)=>{try{return rT(t),e.invokeTask(o,c,f,y)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||t.shouldCoalesceRunChangeDetection)&&n(),oT(t)}},onInvoke:(e,i,o,c,f,y,w)=>{try{return rT(t),e.invoke(o,c,f,y,w)}finally{t.shouldCoalesceRunChangeDetection&&n(),oT(t)}},onHasTask:(e,i,o,c)=>{e.hasTask(o,c),i===o&&("microTask"==c.change?(t._hasPendingMicrotasks=c.microTask,lb(t),ab(t)):"macroTask"==c.change&&(t.hasPendingMacrotasks=c.macroTask))},onHandleError:(e,i,o,c)=>(e.handleError(o,c),t.runOutsideAngular(()=>t.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Bn.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Bn.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,e,i){return this._inner.run(n,e,i)}runTask(n,e,i,o){const c=this._inner,f=c.scheduleEventTask("NgZoneEvent: "+o,n,OF,Dy,Dy);try{return c.runTask(f,e,i)}finally{c.cancelTask(f)}}runGuarded(n,e,i){return this._inner.runGuarded(n,e,i)}runOutsideAngular(n){return this._outer.run(n)}}const OF={};function ab(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function lb(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function rT(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function oT(t){t._nesting--,ab(t)}class VF{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new kt,this.onMicrotaskEmpty=new kt,this.onStable=new kt,this.onError=new kt}run(n,e,i){return n.apply(e,i)}runGuarded(n,e,i){return n.apply(e,i)}runOutsideAngular(n){return n()}runTask(n,e,i,o){return n.apply(e,i)}}let cb=(()=>{class t{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Bn.assertNotInAngularZone(),sb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())sb(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(e)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,i,o){let c=-1;i&&i>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==c),e(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:e,timeoutId:c,updateCb:o})}whenStable(e,i,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,i,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,i,o){return[]}}return t.\u0275fac=function(e){return new(e||t)(je(Bn))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),sT=(()=>{class t{constructor(){this._applications=new Map,ub.addToWindow(this)}registerApplication(e,i){this._applications.set(e,i)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,i=!0){return ub.findTestabilityInTree(this,e,i)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();class zF{addToWindow(n){}findTestabilityInTree(n,e,i){return null}}let ub=new zF,aT=!0,lT=!1;let bl;const uT=new Yt("AllowMultipleToken");class hb{constructor(n,e){this.name=n,this.token=e}}function hT(t,n,e=[]){const i=`Platform: ${n}`,o=new Yt(i);return(c=[])=>{let f=dT();if(!f||f.injector.get(uT,!1))if(t)t(e.concat(c).concat({provide:o,useValue:!0}));else{const y=e.concat(c).concat({provide:o,useValue:!0},{provide:ar,useValue:"platform"});!function(t){if(bl&&!bl.destroyed&&!bl.injector.get(uT,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");bl=t.get(fT);const n=t.get(eT,null);n&&n.forEach(e=>e())}(Un.create({providers:y,name:i}))}return function(t){const n=dT();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(o)}}function dT(){return bl&&!bl.destroyed?bl:null}let fT=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,i){const y=function(t,n){let e;return e="noop"===t?new VF:("zone.js"===t?void 0:t)||new Bn({enableLongStackTrace:(lT=!0,aT),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),e}(i?i.ngZone:void 0,{ngZoneEventCoalescing:i&&i.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:i&&i.ngZoneRunCoalescing||!1}),w=[{provide:Bn,useValue:y}];return y.run(()=>{const T=Un.create({providers:w,parent:this.injector,name:e.moduleType.name}),A=e.create(T),O=A.injector.get(ou,null);if(!O)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return y.runOutsideAngular(()=>{const V=y.onError.subscribe({next:j=>{O.handleError(j)}});A.onDestroy(()=>{db(this._modules,A),V.unsubscribe()})}),function(t,n,e){try{const i=e();return am(i)?i.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):i}catch(i){throw n.runOutsideAngular(()=>t.handleError(i)),i}}(O,y,()=>{const V=A.injector.get(wp);return V.runInitializers(),V.donePromise.then(()=>(D1(A.injector.get(Ma,vy)||vy),this._moduleDoBootstrap(A),A))})})}bootstrapModule(e,i=[]){const o=pT({},i);return function(t,n,e){const i=new q1(e);return Promise.resolve(i)}(0,0,e).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(e){const i=e.injector.get(xl);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>i.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${qt(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(i)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(je(Un))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function pT(t,n){return Array.isArray(n)?n.reduce(pT,t):Object.assign(Object.assign({},t),n)}let xl=(()=>{class t{constructor(e,i,o,c,f){this._zone=e,this._injector=i,this._exceptionHandler=o,this._componentFactoryResolver=c,this._initStatus=f,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new Bt(T=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{T.next(this._stable),T.complete()})}),w=new Bt(T=>{let A;this._zone.runOutsideAngular(()=>{A=this._zone.onStable.subscribe(()=>{Bn.assertNotInAngularZone(),sb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,T.next(!0))})})});const O=this._zone.onUnstable.subscribe(()=>{Bn.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{T.next(!1)}))});return()=>{A.unsubscribe(),O.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,e=null,i=t[t.length-1];return Vo(i)?(e=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof i&&(n=t.pop()),null===e&&1===t.length&&t[0]instanceof Bt?t[0]:mr(n)(Ps(t,e))}(y,w.pipe(us()))}bootstrap(e,i){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let o;o=e instanceof zD?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(o.componentType);const c=function(t){return t.isBoundToModule}(o)?void 0:this._injector.get(yc),y=o.create(Un.NULL,[],i||o.selector,c),w=y.location.nativeElement,T=y.injector.get(cb,null),A=T&&y.injector.get(sT);return T&&A&&A.registerApplication(w,T),y.onDestroy(()=>{this.detachView(y.hostView),db(this.components,y),A&&A.unregisterApplication(w)}),this._loadComponent(y),y}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){const i=e;db(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(tT,[]).concat(this._bootstrapListeners).forEach(o=>o(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(e){return new(e||t)(je(Bn),je(Un),je(ou),je(Js),je(wp))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function db(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}class By{}class tO{}const nO={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let iO=(()=>{class t{constructor(e,i){this._compiler=e,this._config=i||nO}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[i,o]=e.split("#");return void 0===o&&(o="default"),Ie(255)(i).then(c=>c[o]).then(c=>yT(c,i,o)).then(c=>this._compiler.compileModuleAsync(c))}loadFactory(e){let[i,o]=e.split("#"),c="NgFactory";return void 0===o&&(o="default",c=""),Ie(255)(this._config.factoryPathPrefix+i+this._config.factoryPathSuffix).then(f=>f[o+c]).then(f=>yT(f,i,o))}}return t.\u0275fac=function(e){return new(e||t)(je(Ad),je(tO,8))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function yT(t,n,e){if(!t)throw new Error(`Cannot find '${e}' in '${n}'`);return t}const fO=hT(null,"core",[{provide:km,useValue:"unknown"},{provide:fT,deps:[Un]},{provide:sT,deps:[]},{provide:Oy,deps:[]}]),yO=[{provide:xl,useClass:xl,deps:[Bn,Un,ou,Js,wp]},{provide:DR,deps:[Bn],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(e){n.push(e)}}},{provide:wp,useClass:wp,deps:[[new ko,Im]]},{provide:Ad,useClass:Ad,deps:[]},EF,{provide:gm,useFactory:function(){return yN},deps:[]},{provide:gp,useFactory:function(){return vN},deps:[]},{provide:Ma,useFactory:function(t){return D1(t=t||"undefined"!=typeof $localize&&$localize.locale||vy),t},deps:[[new Hu(Ma),new ko,new al]]},{provide:nT,useValue:"USD"}];let bO=(()=>{class t{constructor(e){}}return t.\u0275fac=function(e){return new(e||t)(je(xl))},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:yO}),t})(),Zy=null;function vc(){return Zy}const ci=new Yt("DocumentToken");let Nd=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({factory:vL,token:t,providedIn:"platform"}),t})();function vL(){return je($T)}const bL=new Yt("Location Initialized");let $T=(()=>{class t extends Nd{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return vc().getBaseHref(this._doc)}onPopState(e){const i=vc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){const i=vc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,i,o){jT()?this._history.pushState(e,i,o):this.location.hash=o}replaceState(e,i,o){jT()?this._history.replaceState(e,i,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(je(ci))},t.\u0275prov=ht({factory:xL,token:t,providedIn:"platform"}),t})();function jT(){return!!window.history.pushState}function xL(){return new $T(je(ci))}function Mb(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function HT(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function hu(t){return t&&"?"!==t[0]?"?"+t:t}let Ep=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({factory:wL,token:t,providedIn:"root"}),t})();function wL(t){const n=je(ci).location;return new GT(je(Nd),n&&n.origin||"")}const Sb=new Yt("appBaseHref");let GT=(()=>{class t extends Ep{constructor(e,i){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==i&&(i=this._platformLocation.getBaseHrefFromDOM()),null==i)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=i}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Mb(this._baseHref,e)}path(e=!1){const i=this._platformLocation.pathname+hu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${i}${o}`:i}pushState(e,i,o,c){const f=this.prepareExternalUrl(o+hu(c));this._platformLocation.pushState(e,i,f)}replaceState(e,i,o,c){const f=this.prepareExternalUrl(o+hu(c));this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,e)}}return t.\u0275fac=function(e){return new(e||t)(je(Nd),je(Sb,8))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),CL=(()=>{class t extends Ep{constructor(e,i){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(e){const i=Mb(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,o,c){let f=this.prepareExternalUrl(o+hu(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(e,i,f)}replaceState(e,i,o,c){let f=this.prepareExternalUrl(o+hu(c));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(e,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformLocation).historyGo)||void 0===o||o.call(i,e)}}return t.\u0275fac=function(e){return new(e||t)(je(Nd),je(Sb,8))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),Xy=(()=>{class t{constructor(e,i){this._subject=new kt,this._urlChangeListeners=[],this._platformStrategy=e;const o=this._platformStrategy.getBaseHref();this._platformLocation=i,this._baseHref=HT(qT(o)),this._platformStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+hu(i))}normalize(e){return t.stripTrailingSlash(function(t,n){return t&&n.startsWith(t)?n.substring(t.length):n}(this._baseHref,qT(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,i="",o=null){this._platformStrategy.pushState(o,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+hu(i)),o)}replaceState(e,i="",o=null){this._platformStrategy.replaceState(o,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+hu(i)),o)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var i,o;null===(o=(i=this._platformStrategy).historyGo)||void 0===o||o.call(i,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}))}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(o=>o(e,i))}subscribe(e,i,o){return this._subject.subscribe({next:e,error:i,complete:o})}}return t.\u0275fac=function(e){return new(e||t)(je(Ep),je(Nd))},t.normalizeQueryParams=hu,t.joinWithSlash=Mb,t.stripTrailingSlash=HT,t.\u0275prov=ht({factory:DL,token:t,providedIn:"root"}),t})();function DL(){return new Xy(je(Ep),je(Nd))}function qT(t){return t.replace(/\/index.html$/,"")}var Sr=(()=>((Sr=Sr||{})[Sr.Zero=0]="Zero",Sr[Sr.One=1]="One",Sr[Sr.Two=2]="Two",Sr[Sr.Few=3]="Few",Sr[Sr.Many=4]="Many",Sr[Sr.Other=5]="Other",Sr))();const IL=function(t){return function(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=gD(n);if(e)return e;const i=n.split("-")[0];if(e=gD(i),e)return e;if("en"===i)return Kk;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[Mt.PluralCase]};class o0{}let i3=(()=>{class t extends o0{constructor(e){super(),this.locale=e}getPluralCategory(e,i){switch(IL(i||this.locale)(e)){case Sr.Zero:return"zero";case Sr.One:return"one";case Sr.Two:return"two";case Sr.Few:return"few";case Sr.Many:return"many";default:return"other"}}}return t.\u0275fac=function(e){return new(e||t)(je(Ma))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function rM(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const i=e.indexOf("="),[o,c]=-1==i?[e,""]:[e.slice(0,i),e.slice(i+1)];if(o.trim()===n)return decodeURIComponent(c)}return null}let Ks=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:[{provide:o0,useClass:i3}]}),t})();let hM=(()=>{class t{}return t.\u0275prov=ht({token:t,providedIn:"root",factory:()=>new O3(je(ci),window)}),t})();class O3{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const i=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(;o;){const c=o.shadowRoot;if(c){const f=c.getElementById(n)||c.querySelector(`[name="${n}"]`);if(f)return f}o=i.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),this.attemptFocus(e))}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=n)}}scrollToElement(n){const e=n.getBoundingClientRect(),i=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(i-c[0],o-c[1])}attemptFocus(n){return n.focus(),this.document.activeElement===n}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=dM(this.window.history)||dM(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch(n){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(n){return!1}}}function dM(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class fM{}class $b extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(t){Zy||(Zy=t)}(new $b)}onAndCancel(n,e,i){return n.addEventListener(e,i,!1),()=>{n.removeEventListener(e,i,!1)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=(Bm=Bm||document.querySelector("base"),Bm?Bm.getAttribute("href"):null);return null==e?null:function(t){s0=s0||document.createElement("a"),s0.setAttribute("href",t);const n=s0.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){Bm=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return rM(document.cookie,n)}}let s0,Bm=null;const pM=new Yt("TRANSITION_ID"),$3=[{provide:Im,useFactory:function(t,n,e){return()=>{e.get(wp).donePromise.then(()=>{const i=vc(),o=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let c=0;c<o.length;c++)i.remove(o[c])})}},deps:[pM,ci,Un],multi:!0}];class jb{static init(){!function(t){ub=t}(new jb)}addToWindow(n){jn.getAngularTestability=(i,o=!0)=>{const c=n.findTestabilityInTree(i,o);if(null==c)throw new Error("Could not find testability for element.");return c},jn.getAllAngularTestabilities=()=>n.getAllTestabilities(),jn.getAllAngularRootElements=()=>n.getAllRootElements(),jn.frameworkStabilizers||(jn.frameworkStabilizers=[]),jn.frameworkStabilizers.push(i=>{const o=jn.getAllAngularTestabilities();let c=o.length,f=!1;const y=function(w){f=f||w,c--,0==c&&i(f)};o.forEach(function(w){w.whenStable(y)})})}findTestabilityInTree(n,e,i){if(null==e)return null;const o=n.getTestability(e);return null!=o?o:i?vc().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null}}let j3=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const Vm=new Yt("EventManagerPlugins");let l0=(()=>{class t{constructor(e,i){this._zone=i,this._eventNameToPlugin=new Map,e.forEach(o=>o.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,i,o){return this._findPluginFor(i).addEventListener(e,i,o)}addGlobalEventListener(e,i,o){return this._findPluginFor(i).addGlobalEventListener(e,i,o)}getZone(){return this._zone}_findPluginFor(e){const i=this._eventNameToPlugin.get(e);if(i)return i;const o=this._plugins;for(let c=0;c<o.length;c++){const f=o[c];if(f.supports(e))return this._eventNameToPlugin.set(e,f),f}throw new Error(`No event manager plugin found for event ${e}`)}}return t.\u0275fac=function(e){return new(e||t)(je(Vm),je(Bn))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();class Hb{constructor(n){this._doc=n}addGlobalEventListener(n,e,i){const o=vc().getGlobalEventTarget(this._doc,n);if(!o)throw new Error(`Unsupported event target ${o} for event ${e}`);return this.addEventListener(o,e,i)}}let mM=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(e){const i=new Set;e.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),i.add(o))}),this.onStylesAdded(i)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),zm=(()=>{class t extends mM{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,i,o){e.forEach(c=>{const f=this._doc.createElement("style");f.textContent=c,o.push(i.appendChild(f))})}addHost(e){const i=[];this._addStylesToHost(this._stylesSet,e,i),this._hostNodes.set(e,i)}removeHost(e){const i=this._hostNodes.get(e);i&&i.forEach(_M),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((i,o)=>{this._addStylesToHost(e,o,i)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(_M))}}return t.\u0275fac=function(e){return new(e||t)(je(ci))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function _M(t){vc().remove(t)}const Gb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},qb=/%COMP%/g;function c0(t,n,e){for(let i=0;i<n.length;i++){let o=n[i];Array.isArray(o)?c0(t,o,e):(o=o.replace(qb,t),e.push(o))}return e}function bM(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let Wb=(()=>{class t{constructor(e,i,o){this.eventManager=e,this.sharedStylesHost=i,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new Zb(e)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;switch(i.encapsulation){case Ci.Emulated:{let o=this.rendererByCompId.get(i.id);return o||(o=new rB(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,o)),o.applyToHost(e),o}case 1:case Ci.ShadowDom:return new oB(this.eventManager,this.sharedStylesHost,e,i);default:if(!this.rendererByCompId.has(i.id)){const o=c0(i.id,i.styles,[]);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(je(l0),je(zm),je(Am))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();class Zb{constructor(n){this.eventManager=n,this.data=Object.create(null)}destroy(){}createElement(n,e){return e?document.createElementNS(Gb[e]||e,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,e){n.appendChild(e)}insertBefore(n,e,i){n&&n.insertBefore(e,i)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let i="string"==typeof n?document.querySelector(n):n;if(!i)throw new Error(`The selector "${n}" did not match any elements`);return e||(i.textContent=""),i}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,i,o){if(o){e=o+":"+e;const c=Gb[o];c?n.setAttributeNS(c,e,i):n.setAttribute(e,i)}else n.setAttribute(e,i)}removeAttribute(n,e,i){if(i){const o=Gb[i];o?n.removeAttributeNS(o,e):n.removeAttribute(`${i}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,i,o){o&(Ko.DashCase|Ko.Important)?n.style.setProperty(e,i,o&Ko.Important?"important":""):n.style[e]=i}removeStyle(n,e,i){i&Ko.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,i){n[e]=i}setValue(n,e){n.nodeValue=e}listen(n,e,i){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,e,bM(i)):this.eventManager.addEventListener(n,e,bM(i))}}class rB extends Zb{constructor(n,e,i,o){super(n),this.component=i;const c=c0(o+"-"+i.id,i.styles,[]);e.addStyles(c),this.contentAttr=function(t){return"_ngcontent-%COMP%".replace(qb,t)}(o+"-"+i.id),this.hostAttr=function(t){return"_nghost-%COMP%".replace(qb,t)}(o+"-"+i.id)}applyToHost(n){super.setAttribute(n,this.hostAttr,"")}createElement(n,e){const i=super.createElement(n,e);return super.setAttribute(i,this.contentAttr,""),i}}class oB extends Zb{constructor(n,e,i,o){super(n),this.sharedStylesHost=e,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=c0(o.id,o.styles,[]);for(let f=0;f<c.length;f++){const y=document.createElement("style");y.textContent=c[f],this.shadowRoot.appendChild(y)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,i){return super.insertBefore(this.nodeOrShadowRoot(n),e,i)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}}let sB=(()=>{class t extends Hb{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,o){return e.addEventListener(i,o,!1),()=>this.removeEventListener(e,i,o)}removeEventListener(e,i,o){return e.removeEventListener(i,o)}}return t.\u0275fac=function(e){return new(e||t)(je(ci))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const CM=["alt","control","meta","shift"],fB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},DM={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},pB={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let gB=(()=>{class t extends Hb{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,i,o){const c=t.parseEventName(i),f=t.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>vc().onAndCancel(e,c.domEventName,f))}static parseEventName(e){const i=e.toLowerCase().split("."),o=i.shift();if(0===i.length||"keydown"!==o&&"keyup"!==o)return null;const c=t._normalizeKey(i.pop());let f="";if(CM.forEach(w=>{const T=i.indexOf(w);T>-1&&(i.splice(T,1),f+=w+".")}),f+=c,0!=i.length||0===c.length)return null;const y={};return y.domEventName=o,y.fullKey=f,y}static getEventFullKey(e){let i="",o=function(t){let n=t.key;if(null==n){if(n=t.keyIdentifier,null==n)return"Unidentified";n.startsWith("U+")&&(n=String.fromCharCode(parseInt(n.substring(2),16)),3===t.location&&DM.hasOwnProperty(n)&&(n=DM[n]))}return fB[n]||n}(e);return o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),CM.forEach(c=>{c!=o&&pB[c](e)&&(i+=c+".")}),i+=o,i}static eventCallback(e,i,o){return c=>{t.getEventFullKey(c)===e&&o.runGuarded(()=>i(c))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return t.\u0275fac=function(e){return new(e||t)(je(ci))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const CB=hT(fO,"browser",[{provide:km,useValue:"browser"},{provide:eT,useValue:function(){$b.makeCurrent(),jb.init()},multi:!0},{provide:ci,useFactory:function(){return function(t){Xl=t}(document),document},deps:[]}]),DB=[[],{provide:ar,useValue:"root"},{provide:ou,useFactory:function(){return new ou},deps:[]},{provide:Vm,useClass:sB,multi:!0,deps:[ci,Bn,km]},{provide:Vm,useClass:gB,multi:!0,deps:[ci]},[],{provide:Wb,useClass:Wb,deps:[l0,zm,Am]},{provide:pp,useExisting:Wb},{provide:mM,useExisting:zm},{provide:zm,useClass:zm,deps:[ci]},{provide:cb,useClass:cb,deps:[Bn]},{provide:l0,useClass:l0,deps:[Vm,Bn]},{provide:fM,useClass:j3,deps:[]},[]];let EB=(()=>{class t{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:Am,useValue:e.appId},{provide:pM,useExisting:Am},$3]}}}return t.\u0275fac=function(e){return new(e||t)(je(t,12))},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:DB,imports:[Ks,bO]}),t})();function u0(t,n){return new Bt(e=>{const i=t.length;if(0===i)return void e.complete();const o=new Array(i);let c=0,f=0;for(let y=0;y<i;y++){const w=xi(t[y]);let T=!1;e.add(w.subscribe({next:A=>{T||(T=!0,f++),o[y]=A},error:A=>e.error(A),complete:()=>{c++,(c===i||!T)&&(f===i&&e.next(n?n.reduce((A,O,V)=>(A[O]=o[V],A),{}):o),e.complete())}}))}})}"undefined"!=typeof window&&window;let TM=(()=>{class t{constructor(e,i){this._renderer=e,this._elementRef=i,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return t.\u0275fac=function(e){return new(e||t)(ce(go),ce(bn))},t.\u0275dir=ut({type:t}),t})(),Rd=(()=>{class t extends TM{}return t.\u0275fac=function(){let n;return function(i){return(n||(n=fn(t)))(i||t)}}(),t.\u0275dir=ut({type:t,features:[Ri]}),t})();const _o=new Yt("NgValueAccessor"),RB={provide:_o,useExisting:W(()=>Qb),multi:!0};let Qb=(()=>{class t extends Rd{writeValue(e){this.setProperty("checked",e)}}return t.\u0275fac=function(){let n;return function(i){return(n||(n=fn(t)))(i||t)}}(),t.\u0275dir=ut({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(e,i){1&e&&At("change",function(c){return i.onChange(c.target.checked)})("blur",function(){return i.onTouched()})},features:[ri([RB]),Ri]}),t})();const FB={provide:_o,useExisting:W(()=>h0),multi:!0},LB=new Yt("CompositionEventMode");let h0=(()=>{class t extends TM{constructor(e,i,o){super(e,i),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=vc()?vc().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(go),ce(bn),ce(LB,8))},t.\u0275dir=ut({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,i){1&e&&At("input",function(c){return i._handleInput(c.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(c){return i._compositionEnd(c.target.value)})},features:[ri([FB]),Ri]}),t})();function fh(t){return null==t||0===t.length}function MM(t){return null!=t&&"number"==typeof t.length}const yo=new Yt("NgValidators"),ph=new Yt("NgAsyncValidators"),BB=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Tp{static min(n){return function(t){return n=>{if(fh(n.value)||fh(t))return null;const e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}(n)}static max(n){return function(t){return n=>{if(fh(n.value)||fh(t))return null;const e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}(n)}static required(n){return function(t){return fh(t.value)?{required:!0}:null}(n)}static requiredTrue(n){return function(t){return!0===t.value?null:{required:!0}}(n)}static email(n){return function(t){return fh(t.value)||BB.test(t.value)?null:{email:!0}}(n)}static minLength(n){return function(t){return n=>fh(n.value)||!MM(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function(t){return n=>MM(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}(n)}static pattern(n){return function(t){if(!t)return gh;let n,e;return"string"==typeof t?(e="","^"!==t.charAt(0)&&(e+="^"),e+=t,"$"!==t.charAt(t.length-1)&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),i=>{if(fh(i.value))return null;const o=i.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}(n)}static nullValidator(n){return null}static compose(n){return UM(n)}static composeAsync(n){return $M(n)}}function gh(t){return null}function OM(t){return null!=t}function LM(t){const n=am(t)?xi(t):t;return my(n),n}function BM(t){let n={};return t.forEach(e=>{n=null!=e?Object.assign(Object.assign({},n),e):n}),0===Object.keys(n).length?null:n}function VM(t,n){return n.map(e=>e(t))}function zM(t){return t.map(n=>function(t){return!t.validate}(n)?n:e=>n.validate(e))}function UM(t){if(!t)return null;const n=t.filter(OM);return 0==n.length?null:function(e){return BM(VM(e,n))}}function ex(t){return null!=t?UM(zM(t)):null}function $M(t){if(!t)return null;const n=t.filter(OM);return 0==n.length?null:function(e){return function(...t){if(1===t.length){const n=t[0];if(Me(n))return u0(n,null);if(q(n)&&Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);return u0(e.map(i=>n[i]),e)}}if("function"==typeof t[t.length-1]){const n=t.pop();return u0(t=1===t.length&&Me(t[0])?t[0]:t,null).pipe(Rt(e=>n(...e)))}return u0(t,null)}(VM(e,n).map(LM)).pipe(Rt(BM))}}function tx(t){return null!=t?$M(zM(t)):null}function jM(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function HM(t){return t._rawValidators}function GM(t){return t._rawAsyncValidators}function nx(t){return t?Array.isArray(t)?t:[t]:[]}function d0(t,n){return Array.isArray(t)?t.includes(n):t===n}function qM(t,n){const e=nx(n);return nx(t).forEach(o=>{d0(e,o)||e.push(o)}),e}function WM(t,n){return nx(n).filter(e=>!d0(t,e))}let ZM=(()=>{class t{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=ex(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=tx(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,i){return!!this.control&&this.control.hasError(e,i)}getError(e,i){return this.control?this.control.getError(e,i):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=ut({type:t}),t})(),rs=(()=>{class t extends ZM{get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(){let n;return function(i){return(n||(n=fn(t)))(i||t)}}(),t.\u0275dir=ut({type:t,features:[Ri]}),t})();class mh extends ZM{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class XM{constructor(n){this._cd=n}is(n){var e,i,o;return"submitted"===n?!!(null===(e=this._cd)||void 0===e?void 0:e.submitted):!!(null===(o=null===(i=this._cd)||void 0===i?void 0:i.control)||void 0===o?void 0:o[n])}}let YM=(()=>{class t extends XM{constructor(e){super(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(mh,2))},t.\u0275dir=ut({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,i){2&e&&gn("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))},features:[Ri]}),t})(),JM=(()=>{class t extends XM{constructor(e){super(e)}}return t.\u0275fac=function(e){return new(e||t)(ce(rs,10))},t.\u0275dir=ut({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,i){2&e&&gn("ng-untouched",i.is("untouched"))("ng-touched",i.is("touched"))("ng-pristine",i.is("pristine"))("ng-dirty",i.is("dirty"))("ng-valid",i.is("valid"))("ng-invalid",i.is("invalid"))("ng-pending",i.is("pending"))("ng-submitted",i.is("submitted"))},features:[Ri]}),t})();function Um(t,n){ox(t,n),n.valueAccessor.writeValue(t.value),function(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&KM(t,n)})}(t,n),function(t,n){const e=(i,o)=>{n.valueAccessor.writeValue(i),o&&n.viewToModelUpdate(i)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&KM(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function(t,n){if(n.valueAccessor.setDisabledState){const e=i=>{n.valueAccessor.setDisabledState(i)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function g0(t,n,e=!0){const i=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(i),n.valueAccessor.registerOnTouched(i)),_0(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function m0(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function ox(t,n){const e=HM(t);null!==n.validator?t.setValidators(jM(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const i=GM(t);null!==n.asyncValidator?t.setAsyncValidators(jM(i,n.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]);const o=()=>t.updateValueAndValidity();m0(n._rawValidators,o),m0(n._rawAsyncValidators,o)}function _0(t,n){let e=!1;if(null!==t){if(null!==n.validator){const o=HM(t);if(Array.isArray(o)&&o.length>0){const c=o.filter(f=>f!==n.validator);c.length!==o.length&&(e=!0,t.setValidators(c))}}if(null!==n.asyncValidator){const o=GM(t);if(Array.isArray(o)&&o.length>0){const c=o.filter(f=>f!==n.asyncValidator);c.length!==o.length&&(e=!0,t.setAsyncValidators(c))}}}const i=()=>{};return m0(n._rawValidators,i),m0(n._rawAsyncValidators,i),e}function KM(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function y0(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}const $m="VALID",v0="INVALID",Mp="PENDING",jm="DISABLED";function lx(t){return(ux(t)?t.validators:t)||null}function tS(t){return Array.isArray(t)?ex(t):t||null}function cx(t,n){return(ux(n)?n.asyncValidators:t)||null}function nS(t){return Array.isArray(t)?tx(t):t||null}function ux(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class hx{constructor(n,e){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=n,this._rawAsyncValidators=e,this._composedValidatorFn=tS(this._rawValidators),this._composedAsyncValidatorFn=nS(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===$m}get invalid(){return this.status===v0}get pending(){return this.status==Mp}get disabled(){return this.status===jm}get enabled(){return this.status!==jm}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._rawValidators=n,this._composedValidatorFn=tS(n)}setAsyncValidators(n){this._rawAsyncValidators=n,this._composedAsyncValidatorFn=nS(n)}addValidators(n){this.setValidators(qM(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(qM(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(WM(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(WM(n,this._rawAsyncValidators))}hasValidator(n){return d0(this._rawValidators,n)}hasAsyncValidator(n){return d0(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Mp,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=jm,this.errors=null,this._forEachChild(i=>{i.disable(Object.assign(Object.assign({},n),{onlySelf:!0}))}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},n),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=$m,this._forEachChild(i=>{i.enable(Object.assign(Object.assign({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},n),{skipPristineCheck:e})),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===$m||this.status===Mp)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?jm:$m}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Mp,this._hasOwnPendingAsyncValidator=!0;const e=LM(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent)}get(n){return function(t,n,e){if(null==n||(Array.isArray(n)||(n=n.split(".")),Array.isArray(n)&&0===n.length))return null;let i=t;return n.forEach(o=>{i=i instanceof b0?i.controls.hasOwnProperty(o)?i.controls[o]:null:i instanceof JB&&i.at(o)||null}),i}(this,n)}getError(n,e){const i=e?this.get(e):this;return i&&i.errors?i.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new kt,this.statusChanges=new kt}_calculateStatus(){return this._allControlsDisabled()?jm:this.errors?v0:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Mp)?Mp:this._anyControlsHaveStatus(v0)?v0:$m}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_isBoxedValue(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){ux(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class Fd extends hx{constructor(n=null,e,i){super(lx(e),cx(i,e)),this._onChange=[],this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=null,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){y0(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){y0(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){this._isBoxedValue(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}}class b0 extends hx{constructor(n,e,i){super(lx(e),cx(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,i={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){this._checkAllValuesPresent(n),Object.keys(n).forEach(i=>{this._throwIfControlMissing(i),this.controls[i].setValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(i=>{this.controls[i]&&this.controls[i].patchValue(n[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((i,o)=>{i.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,i)=>(n[i]=e instanceof Fd?e.value:e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,i)=>!!i._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_throwIfControlMissing(n){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[n])throw new Error(`Cannot find form control with name: ${n}.`)}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const i=this.controls[e];i&&n(i,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const e of Object.keys(this.controls)){const i=this.controls[e];if(this.contains(e)&&n(i))return!0}return!1}_reduceValue(){return this._reduceChildren({},(n,e,i)=>((e.enabled||this.disabled)&&(n[i]=e.value),n))}_reduceChildren(n,e){let i=n;return this._forEachChild((o,c)=>{i=e(i,o,c)}),i}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(n){this._forEachChild((e,i)=>{if(void 0===n[i])throw new Error(`Must supply a value for form control with name: '${i}'.`)})}}class JB extends hx{constructor(n,e,i){super(lx(e),cx(i,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[n]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,i={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,i={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),e&&(this.controls.splice(n,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){this._checkAllValuesPresent(n),n.forEach((i,o)=>{this._throwIfControlMissing(o),this.at(o).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(n.forEach((i,o)=>{this.at(o)&&this.at(o).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((i,o)=>{i.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n instanceof Fd?n.value:n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_syncPendingControls(){let n=this.controls.reduce((e,i)=>!!i._syncPendingControls()||e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_throwIfControlMissing(n){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(n))throw new Error(`Cannot find form control at index ${n}`)}_forEachChild(n){this.controls.forEach((e,i)=>{n(e,i)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_checkAllValuesPresent(n){this._forEachChild((e,i)=>{if(void 0===n[i])throw new Error(`Must supply a value for form control at index: ${i}.`)})}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}}let aS=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=ut({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),cS=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})();const fx=new Yt("NgModelWithFormControlWarning"),sV={provide:rs,useExisting:W(()=>x0)};let x0=(()=>{class t extends rs{constructor(e,i){super(),this.validators=e,this.asyncValidators=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new kt,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(_0(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const i=this.form.get(e.path);return Um(i,e),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){g0(e.control||null,e,!1),y0(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this.submitted=!0,function(t,n){t._syncPendingControls(),n.forEach(e=>{const i=e.control;"submit"===i.updateOn&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const i=e.control,o=this.form.get(e.path);i!==o&&(g0(i||null,e),o instanceof Fd&&(Um(o,e),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const i=this.form.get(e.path);(function(t,n){ox(t,n)})(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const i=this.form.get(e.path);i&&function(t,n){return _0(t,n)}(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){ox(this.form,this),this._oldForm&&_0(this._oldForm,this)}_checkFormPresent(){}}return t.\u0275fac=function(e){return new(e||t)(ce(yo,10),ce(ph,10))},t.\u0275dir=ut({type:t,selectors:[["","formGroup",""]],hostBindings:function(e,i){1&e&&At("submit",function(c){return i.onSubmit(c)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ri([sV]),Ri,dn]}),t})();const cV={provide:mh,useExisting:W(()=>mx)};let mx=(()=>{class t extends mh{constructor(e,i,o,c,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.update=new kt,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(i),this._setAsyncValidators(o),this.valueAccessor=function(t,n){if(!n)return null;let e,i,o;return Array.isArray(n),n.forEach(c=>{c.constructor===h0?e=c:function(t){return Object.getPrototypeOf(t.constructor)===Rd}(c)?i=c:o=c}),o||i||e||null}(0,c)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),function(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return function(t,n){return[...n.path,t]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return t.\u0275fac=function(e){return new(e||t)(ce(rs,13),ce(yo,10),ce(ph,10),ce(_o,10),ce(fx,8))},t.\u0275dir=ut({type:t,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[ri([cV]),Ri,dn]}),t._ngModelWarningSentOnce=!1,t})(),MS=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[cS]]}),t})(),wV=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[MS]}),t})(),CV=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:fx,useValue:e.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[MS]}),t})();function Kt(...t){let n=t[t.length-1];return Vo(n)?(t.pop(),Uo(t,n)):Ps(t)}class $r extends qn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return e&&!e.closed&&n.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qr;return this._value}next(n){super.next(this._value=n)}}class bx extends ct{notifyNext(n,e,i,o,c){this.destination.next(e)}notifyError(n,e){this.destination.error(n)}notifyComplete(n){this.destination.complete()}}class DV extends ct{constructor(n,e,i){super(),this.parent=n,this.outerValue=e,this.outerIndex=i,this.index=0}_next(n){this.parent.notifyNext(this.outerValue,n,this.outerIndex,this.index++,this)}_error(n){this.parent.notifyError(n,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function xx(t,n,e,i,o=new DV(t,e,i)){if(!o.closed)return n instanceof Bt?n.subscribe(o):Fa(n)(o)}const SS={};class EV{constructor(n){this.resultSelector=n}call(n,e){return e.subscribe(new TV(n,this.resultSelector))}}class TV extends bx{constructor(n,e){super(n),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(n){this.values.push(SS),this.observables.push(n)}_complete(){const n=this.observables,e=n.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let i=0;i<e;i++)this.add(xx(this,n[i],void 0,i))}}notifyComplete(n){0==(this.active-=1)&&this.destination.complete()}notifyNext(n,e,i){const o=this.values,f=this.toRespond?o[i]===SS?--this.toRespond:this.toRespond:0;o[i]=e,0===f&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}_tryResultSelector(n){let e;try{e=this.resultSelector.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}const w0=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function C0(...t){return mr(1)(Kt(...t))}const Od=new Bt(t=>t.complete());function D0(t){return t?function(t){return new Bt(n=>t.schedule(()=>n.complete()))}(t):Od}function IS(t){return new Bt(n=>{let e;try{e=t()}catch(o){return void n.error(o)}return(e?xi(e):D0()).subscribe(n)})}function Ml(t,n){return"function"==typeof n?e=>e.pipe(Ml((i,o)=>xi(t(i,o)).pipe(Rt((c,f)=>n(i,c,o,f))))):e=>e.lift(new IV(t))}class IV{constructor(n){this.project=n}call(n,e){return e.subscribe(new AV(n,this.project))}}class AV extends cs{constructor(n,e){super(n),this.project=e,this.index=0}_next(n){let e;const i=this.index++;try{e=this.project(n,i)}catch(o){return void this.destination.error(o)}this._innerSub(e)}_innerSub(n){const e=this.innerSubscription;e&&e.unsubscribe();const i=new ia(this),o=this.destination;o.add(i),this.innerSubscription=Nr(n,i),this.innerSubscription!==i&&o.add(this.innerSubscription)}_complete(){const{innerSubscription:n}=this;(!n||n.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(n){this.destination.next(n)}}const AS=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function os(t){return n=>0===t?D0():n.lift(new kV(t))}class kV{constructor(n){if(this.total=n,this.total<0)throw new AS}call(n,e){return e.subscribe(new PV(n,this.total))}}class PV extends ct{constructor(n,e){super(n),this.total=e,this.count=0}_next(n){const e=this.total,i=++this.count;i<=e&&(this.destination.next(n),i===e&&(this.destination.complete(),this.unsubscribe()))}}function kS(t,n){let e=!1;return arguments.length>=2&&(e=!0),function(o){return o.lift(new NV(t,n,e))}}class NV{constructor(n,e,i=!1){this.accumulator=n,this.seed=e,this.hasSeed=i}call(n,e){return e.subscribe(new RV(n,this.accumulator,this.seed,this.hasSeed))}}class RV extends ct{constructor(n,e,i,o){super(n),this.accumulator=e,this._seed=i,this.hasSeed=o,this.index=0}get seed(){return this._seed}set seed(n){this.hasSeed=!0,this._seed=n}_next(n){if(this.hasSeed)return this._tryNext(n);this.seed=n,this.destination.next(n)}_tryNext(n){const e=this.index++;let i;try{i=this.accumulator(this.seed,n,e)}catch(o){this.destination.error(o)}this.seed=i,this.destination.next(i)}}function Ar(t,n){return function(i){return i.lift(new FV(t,n))}}class FV{constructor(n,e){this.predicate=n,this.thisArg=e}call(n,e){return e.subscribe(new OV(n,this.predicate,this.thisArg))}}class OV extends ct{constructor(n,e,i){super(n),this.predicate=e,this.thisArg=i,this.count=0}_next(n){let e;try{e=this.predicate.call(this.thisArg,n,this.count++)}catch(i){return void this.destination.error(i)}e&&this.destination.next(n)}}function Ld(t){return function(e){const i=new LV(t),o=e.lift(i);return i.caught=o}}class LV{constructor(n){this.selector=n}call(n,e){return e.subscribe(new BV(n,this.selector,this.caught))}}class BV extends cs{constructor(n,e,i){super(n),this.selector=e,this.caught=i}error(n){if(!this.isStopped){let e;try{e=this.selector(n,this.caught)}catch(c){return void super.error(c)}this._unsubscribeAndRecycle();const i=new ia(this);this.add(i);const o=Nr(e,i);o!==i&&this.add(o)}}}function Sp(t,n){return gi(t,n,1)}function Cx(t){return function(e){return 0===t?D0():e.lift(new VV(t))}}class VV{constructor(n){if(this.total=n,this.total<0)throw new AS}call(n,e){return e.subscribe(new zV(n,this.total))}}class zV extends ct{constructor(n,e){super(n),this.total=e,this.ring=new Array,this.count=0}_next(n){const e=this.ring,i=this.total,o=this.count++;e.length<i?e.push(n):e[o%i]=n}_complete(){const n=this.destination;let e=this.count;if(e>0){const i=this.count>=this.total?this.total:this.count,o=this.ring;for(let c=0;c<i;c++){const f=e++%i;n.next(o[f])}}n.complete()}}function PS(t=jV){return n=>n.lift(new UV(t))}class UV{constructor(n){this.errorFactory=n}call(n,e){return e.subscribe(new $V(n,this.errorFactory))}}class $V extends ct{constructor(n,e){super(n),this.errorFactory=e,this.hasValue=!1}_next(n){this.hasValue=!0,this.destination.next(n)}_complete(){if(this.hasValue)return this.destination.complete();{let n;try{n=this.errorFactory()}catch(e){n=e}this.destination.error(n)}}}function jV(){return new w0}function NS(t=null){return n=>n.lift(new HV(t))}class HV{constructor(n){this.defaultValue=n}call(n,e){return e.subscribe(new GV(n,this.defaultValue))}}class GV extends ct{constructor(n,e){super(n),this.defaultValue=e,this.isEmpty=!0}_next(n){this.isEmpty=!1,this.destination.next(n)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Ip(t,n){const e=arguments.length>=2;return i=>i.pipe(t?Ar((o,c)=>t(o,c,i)):Ai,os(1),e?NS(n):PS(()=>new w0))}function fu(){}function vo(t,n,e){return function(o){return o.lift(new WV(t,n,e))}}class WV{constructor(n,e,i){this.nextOrObserver=n,this.error=e,this.complete=i}call(n,e){return e.subscribe(new ZV(n,this.nextOrObserver,this.error,this.complete))}}class ZV extends ct{constructor(n,e,i,o){super(n),this._tapNext=fu,this._tapError=fu,this._tapComplete=fu,this._tapError=i||fu,this._tapComplete=o||fu,Je(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||fu,this._tapError=e.error||fu,this._tapComplete=e.complete||fu)}_next(n){try{this._tapNext.call(this._context,n)}catch(e){return void this.destination.error(e)}this.destination.next(n)}_error(n){try{this._tapError.call(this._context,n)}catch(e){return void this.destination.error(e)}this.destination.error(n)}_complete(){try{this._tapComplete.call(this._context)}catch(n){return void this.destination.error(n)}return this.destination.complete()}}class YV{constructor(n){this.callback=n}call(n,e){return e.subscribe(new JV(n,this.callback))}}class JV extends ct{constructor(n,e){super(n),this.add(new K(e))}}class pu{constructor(n,e){this.id=n,this.url=e}}class Dx extends pu{constructor(n,e,i="imperative",o=null){super(n,e),this.navigationTrigger=i,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Gm extends pu{constructor(n,e,i){super(n,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class RS extends pu{constructor(n,e,i){super(n,e),this.reason=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class KV extends pu{constructor(n,e,i){super(n,e),this.error=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class QV extends pu{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ez extends pu{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class tz extends pu{constructor(n,e,i,o,c){super(n,e),this.urlAfterRedirects=i,this.state=o,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class nz extends pu{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iz extends pu{constructor(n,e,i,o){super(n,e),this.urlAfterRedirects=i,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class FS{constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class OS{constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class rz{constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class oz{constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sz{constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class az{constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class LS{constructor(n,e,i){this.routerEvent=n,this.position=e,this.anchor=i}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Rn="primary";class lz{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ap(t){return new lz(t)}const BS="ngNavigationCancelingError";function Ex(t){const n=Error("NavigationCancelingError: "+t);return n[BS]=!0,n}function uz(t,n,e){const i=e.path.split("/");if(i.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||i.length<t.length))return null;const o={};for(let c=0;c<i.length;c++){const f=i[c],y=t[c];if(f.startsWith(":"))o[f.substring(1)]=y;else if(f!==y.path)return null}return{consumed:t.slice(0,i.length),posParams:o}}function bc(t,n){const e=t?Object.keys(t):void 0,i=n?Object.keys(n):void 0;if(!e||!i||e.length!=i.length)return!1;let o;for(let c=0;c<e.length;c++)if(o=e[c],!VS(t[o],n[o]))return!1;return!0}function VS(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),i=[...n].sort();return e.every((o,c)=>i[c]===o)}return t===n}function zS(t){return Array.prototype.concat.apply([],t)}function US(t){return t.length>0?t[t.length-1]:null}function bo(t,n){for(const e in t)t.hasOwnProperty(e)&&n(t[e],e)}function xc(t){return my(t)?t:am(t)?xi(Promise.resolve(t)):Kt(t)}const fz={exact:function HS(t,n,e){if(!Vd(t.segments,n.segments)||!T0(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children)if(!t.children[i]||!HS(t.children[i],n.children[i],e))return!1;return!0},subset:GS},$S={exact:function(t,n){return bc(t,n)},subset:function(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>VS(t[e],n[e]))},ignored:()=>!0};function jS(t,n,e){return fz[e.paths](t.root,n.root,e.matrixParams)&&$S[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function GS(t,n,e){return qS(t,n,n.segments,e)}function qS(t,n,e,i){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!Vd(o,e)||n.hasChildren()||!T0(o,e,i))}if(t.segments.length===e.length){if(!Vd(t.segments,e)||!T0(t.segments,e,i))return!1;for(const o in n.children)if(!t.children[o]||!GS(t.children[o],n.children[o],i))return!1;return!0}{const o=e.slice(0,t.segments.length),c=e.slice(t.segments.length);return!!(Vd(t.segments,o)&&T0(t.segments,o,i)&&t.children[Rn])&&qS(t.children[Rn],n,c,i)}}function T0(t,n,e){return n.every((i,o)=>$S[e](t[o].parameters,i.parameters))}class Bd{constructor(n,e,i){this.root=n,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ap(this.queryParams)),this._queryParamMap}toString(){return yz.serialize(this)}}class $n{constructor(n,e){this.segments=n,this.children=e,this.parent=null,bo(e,(i,o)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return M0(this)}}class qm{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Ap(this.parameters)),this._parameterMap}toString(){return YS(this)}}function Vd(t,n){return t.length===n.length&&t.every((e,i)=>e.path===n[i].path)}class Tx{}class WS{parse(n){const e=new Mz(n);return new Bd(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){return`${`/${Wm(n.root,!0)}`}${function(t){const n=Object.keys(t).map(e=>{const i=t[e];return Array.isArray(i)?i.map(o=>`${S0(e)}=${S0(o)}`).join("&"):`${S0(e)}=${S0(i)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams)}${"string"==typeof n.fragment?`#${function(t){return encodeURI(t)}(n.fragment)}`:""}`}}const yz=new WS;function M0(t){return t.segments.map(n=>YS(n)).join("/")}function Wm(t,n){if(!t.hasChildren())return M0(t);if(n){const e=t.children[Rn]?Wm(t.children[Rn],!1):"",i=[];return bo(t.children,(o,c)=>{c!==Rn&&i.push(`${c}:${Wm(o,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}{const e=function(t,n){let e=[];return bo(t.children,(i,o)=>{o===Rn&&(e=e.concat(n(i,o)))}),bo(t.children,(i,o)=>{o!==Rn&&(e=e.concat(n(i,o)))}),e}(t,(i,o)=>o===Rn?[Wm(t.children[Rn],!1)]:[`${o}:${Wm(i,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Rn]?`${M0(t)}/${e[0]}`:`${M0(t)}/(${e.join("//")})`}}function ZS(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function S0(t){return ZS(t).replace(/%3B/gi,";")}function Mx(t){return ZS(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function I0(t){return decodeURIComponent(t)}function XS(t){return I0(t.replace(/\+/g,"%20"))}function YS(t){return`${Mx(t.path)}${function(t){return Object.keys(t).map(n=>`;${Mx(n)}=${Mx(t[n])}`).join("")}(t.parameters)}`}const wz=/^[^\/()?;=#]+/;function A0(t){const n=t.match(wz);return n?n[0]:""}const Cz=/^[^=?&#]+/,Ez=/^[^?&#]+/;class Mz{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new $n([],{}):new $n([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(i[Rn]=new $n(n,e)),i}parseSegment(){const n=A0(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(n),new qm(I0(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=A0(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const o=A0(this.remaining);o&&(i=o,this.capture(i))}n[I0(e)]=I0(i)}parseQueryParam(n){const e=function(t){const n=t.match(Cz);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){const f=function(t){const n=t.match(Ez);return n?n[0]:""}(this.remaining);f&&(i=f,this.capture(i))}const o=XS(e),c=XS(i);if(n.hasOwnProperty(o)){let f=n[o];Array.isArray(f)||(f=[f],n[o]=f),f.push(c)}else n[o]=c}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=A0(this.remaining),o=this.remaining[i.length];if("/"!==o&&")"!==o&&";"!==o)throw new Error(`Cannot parse url '${this.url}'`);let c;i.indexOf(":")>-1?(c=i.substr(0,i.indexOf(":")),this.capture(c),this.capture(":")):n&&(c=Rn);const f=this.parseChildren();e[c]=1===Object.keys(f).length?f[Rn]:new $n([],f),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Error(`Expected "${n}".`)}}class JS{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Sx(n,this._root);return e?e.children.map(i=>i.value):[]}firstChild(n){const e=Sx(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=Ix(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Ix(n,this._root).map(e=>e.value)}}function Sx(t,n){if(t===n.value)return n;for(const e of n.children){const i=Sx(t,e);if(i)return i}return null}function Ix(t,n){if(t===n.value)return[n];for(const e of n.children){const i=Ix(t,e);if(i.length)return i.unshift(n),i}return[]}class gu{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function Zm(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class KS extends JS{constructor(n,e){super(n),this.snapshot=e,Ax(this,n)}toString(){return this.snapshot.toString()}}function QS(t,n){const e=function(t,n){const f=new k0([],{},{},"",{},Rn,n,null,t.root,-1,{});return new tI("",new gu(f,[]))}(t,n),i=new $r([new qm("",{})]),o=new $r({}),c=new $r({}),f=new $r({}),y=new $r(""),w=new kp(i,o,f,y,c,Rn,n,e.root);return w.snapshot=e.root,new KS(new gu(w,[]),e)}class kp{constructor(n,e,i,o,c,f,y,w){this.url=n,this.params=e,this.queryParams=i,this.fragment=o,this.data=c,this.outlet=f,this.component=y,this._futureSnapshot=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Rt(n=>Ap(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Rt(n=>Ap(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function eI(t,n="emptyOnly"){const e=t.pathFromRoot;let i=0;if("always"!==n)for(i=e.length-1;i>=1;){const o=e[i],c=e[i-1];if(o.routeConfig&&""===o.routeConfig.path)i--;else{if(c.component)break;i--}}return function(t){return t.reduce((n,e)=>({params:Object.assign(Object.assign({},n.params),e.params),data:Object.assign(Object.assign({},n.data),e.data),resolve:Object.assign(Object.assign({},n.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(e.slice(i))}class k0{constructor(n,e,i,o,c,f,y,w,T,A,O){this.url=n,this.params=e,this.queryParams=i,this.fragment=o,this.data=c,this.outlet=f,this.component=y,this.routeConfig=w,this._urlSegment=T,this._lastPathIndex=A,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ap(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ap(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class tI extends JS{constructor(n,e){super(e),this.url=n,Ax(this,e)}toString(){return nI(this._root)}}function Ax(t,n){n.value._routerState=t,n.children.forEach(e=>Ax(t,e))}function nI(t){const n=t.children.length>0?` { ${t.children.map(nI).join(", ")} } `:"";return`${t.value}${n}`}function kx(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,bc(n.queryParams,e.queryParams)||t.queryParams.next(e.queryParams),n.fragment!==e.fragment&&t.fragment.next(e.fragment),bc(n.params,e.params)||t.params.next(e.params),function(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!bc(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.url.next(e.url),bc(n.data,e.data)||t.data.next(e.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Px(t,n){return bc(t.params,n.params)&&function(t,n){return Vd(t,n)&&t.every((e,i)=>bc(e.parameters,n[i].parameters))}(t.url,n.url)&&!(!t.parent!=!n.parent)&&(!t.parent||Px(t.parent,n.parent))}function P0(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const i=e.value;i._futureSnapshot=n.value;const o=function(t,n,e){return n.children.map(i=>{for(const o of e.children)if(t.shouldReuseRoute(i.value,o.value.snapshot))return P0(t,i,o);return P0(t,i)})}(t,n,e);return new gu(i,o)}{if(t.shouldAttach(n.value)){const c=t.retrieve(n.value);if(null!==c){const f=c.route;return iI(n,f),f}}const i=function(t){return new kp(new $r(t.url),new $r(t.params),new $r(t.queryParams),new $r(t.fragment),new $r(t.data),t.outlet,t.component,t)}(n.value),o=n.children.map(c=>P0(t,c));return new gu(i,o)}}function iI(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(let e=0;e<t.children.length;++e)iI(t.children[e],n.children[e])}function N0(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Xm(t){return"object"==typeof t&&null!=t&&t.outlets}function Nx(t,n,e,i,o){let c={};return i&&bo(i,(f,y)=>{c[y]=Array.isArray(f)?f.map(w=>`${w}`):`${f}`}),new Bd(e.root===t?n:rI(e.root,t,n),c,o)}function rI(t,n,e){const i={};return bo(t.children,(o,c)=>{i[c]=o===n?e:rI(o,n,e)}),new $n(t.segments,i)}class oI{constructor(n,e,i){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=i,n&&i.length>0&&N0(i[0]))throw new Error("Root segment cannot have matrix parameters");const o=i.find(Xm);if(o&&o!==US(i))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Rx{constructor(n,e,i){this.segmentGroup=n,this.processChildren=e,this.index=i}}function sI(t,n,e){if(t||(t=new $n([],{})),0===t.segments.length&&t.hasChildren())return R0(t,n,e);const i=function(t,n,e){let i=0,o=n;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(i>=e.length)return c;const f=t.segments[o],y=e[i];if(Xm(y))break;const w=`${y}`,T=i<e.length-1?e[i+1]:null;if(o>0&&void 0===w)break;if(w&&T&&"object"==typeof T&&void 0===T.outlets){if(!lI(w,T,f))return c;i+=2}else{if(!lI(w,{},f))return c;i++}o++}return{match:!0,pathIndex:o,commandIndex:i}}(t,n,e),o=e.slice(i.commandIndex);if(i.match&&i.pathIndex<t.segments.length){const c=new $n(t.segments.slice(0,i.pathIndex),{});return c.children[Rn]=new $n(t.segments.slice(i.pathIndex),t.children),R0(c,0,o)}return i.match&&0===o.length?new $n(t.segments,{}):i.match&&!t.hasChildren()?Fx(t,n,e):i.match?R0(t,0,o):Fx(t,n,e)}function R0(t,n,e){if(0===e.length)return new $n(t.segments,{});{const i=function(t){return Xm(t[0])?t[0].outlets:{[Rn]:t}}(e),o={};return bo(i,(c,f)=>{"string"==typeof c&&(c=[c]),null!==c&&(o[f]=sI(t.children[f],n,c))}),bo(t.children,(c,f)=>{void 0===i[f]&&(o[f]=c)}),new $n(t.segments,o)}}function Fx(t,n,e){const i=t.segments.slice(0,n);let o=0;for(;o<e.length;){const c=e[o];if(Xm(c)){const w=Vz(c.outlets);return new $n(i,w)}if(0===o&&N0(e[0])){i.push(new qm(t.segments[n].path,aI(e[0]))),o++;continue}const f=Xm(c)?c.outlets[Rn]:`${c}`,y=o<e.length-1?e[o+1]:null;f&&y&&N0(y)?(i.push(new qm(f,aI(y))),o+=2):(i.push(new qm(f,{})),o++)}return new $n(i,{})}function Vz(t){const n={};return bo(t,(e,i)=>{"string"==typeof e&&(e=[e]),null!==e&&(n[i]=Fx(new $n([],{}),0,e))}),n}function aI(t){const n={};return bo(t,(e,i)=>n[i]=`${e}`),n}function lI(t,n,e){return t==e.path&&bc(n,e.parameters)}class Uz{constructor(n,e,i,o){this.routeReuseStrategy=n,this.futureState=e,this.currState=i,this.forwardEvent=o}activate(n){const e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,n),kx(this.futureState.root),this.activateChildRoutes(e,i,n)}deactivateChildRoutes(n,e,i){const o=Zm(e);n.children.forEach(c=>{const f=c.value.outlet;this.deactivateRoutes(c,o[f],i),delete o[f]}),bo(o,(c,f)=>{this.deactivateRouteAndItsChildren(c,i)})}deactivateRoutes(n,e,i){const o=n.value,c=e?e.value:null;if(o===c)if(o.component){const f=i.getContext(o.outlet);f&&this.deactivateChildRoutes(n,e,f.children)}else this.deactivateChildRoutes(n,e,i);else c&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(n,e){this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const i=e.getContext(n.value.outlet);if(i&&i.outlet){const o=i.outlet.detach(),c=i.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:o,route:n,contexts:c})}}deactivateRouteAndOutlet(n,e){const i=e.getContext(n.value.outlet),o=i&&n.value.component?i.children:e,c=Zm(n);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],o);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(n,e,i){const o=Zm(e);n.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],i),this.forwardEvent(new az(c.value.snapshot))}),n.children.length&&this.forwardEvent(new oz(n.value.snapshot))}activateRoutes(n,e,i){const o=n.value,c=e?e.value:null;if(kx(o),o===c)if(o.component){const f=i.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,f.children)}else this.activateChildRoutes(n,e,i);else if(o.component){const f=i.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const y=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),f.children.onOutletReAttached(y.contexts),f.attachRef=y.componentRef,f.route=y.route.value,f.outlet&&f.outlet.attach(y.componentRef,y.route.value),cI(y.route)}else{const y=function(t){for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(o.snapshot),w=y?y.module.componentFactoryResolver:null;f.attachRef=null,f.route=o,f.resolver=w,f.outlet&&f.outlet.activateWith(o,w),this.activateChildRoutes(n,null,f.children)}}else this.activateChildRoutes(n,null,i)}}function cI(t){kx(t.value),t.children.forEach(cI)}class Ox{constructor(n,e){this.routes=n,this.module=e}}function _h(t){return"function"==typeof t}function zd(t){return t instanceof Bd}const Ym=Symbol("INITIAL_VALUE");function Jm(){return Ml(t=>function(...t){let n,e;return Vo(t[t.length-1])&&(e=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&Me(t[0])&&(t=t[0]),Ps(t,e).lift(new EV(n))}(t.map(n=>n.pipe(os(1),function(...t){const n=t[t.length-1];return Vo(n)?(t.pop(),e=>C0(t,e,n)):e=>C0(t,e)}(Ym)))).pipe(kS((n,e)=>{let i=!1;return e.reduce((o,c,f)=>o!==Ym?o:(c===Ym&&(i=!0),i||!1!==c&&f!==e.length-1&&!zd(c)?o:c),n)},Ym),Ar(n=>n!==Ym),Rt(n=>zd(n)?n:!0===n),os(1)))}let uI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=si({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,i){1&e&&ei(0,"router-outlet")},directives:function(){return[jx]},encapsulation:2}),t})();function hI(t,n=""){for(let e=0;e<t.length;e++){const i=t[e];Zz(i,Xz(n,i))}}function Zz(t,n){t.children&&hI(t.children,n)}function Xz(t,n){return n?t||n.path?t&&!n.path?`${t}/`:!t&&n.path?n.path:`${t}/${n.path}`:"":t}function Lx(t){const n=t.children&&t.children.map(Lx),e=n?Object.assign(Object.assign({},t),{children:n}):Object.assign({},t);return!e.component&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Rn&&(e.component=uI),e}function ka(t){return t.outlet||Rn}function dI(t,n){const e=t.filter(i=>ka(i)===n);return e.push(...t.filter(i=>ka(i)!==n)),e}const fI={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function F0(t,n,e){var i;if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?Object.assign({},fI):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const c=(n.matcher||uz)(e,t,n);if(!c)return Object.assign({},fI);const f={};bo(c.posParams,(w,T)=>{f[T]=w.path});const y=c.consumed.length>0?Object.assign(Object.assign({},f),c.consumed[c.consumed.length-1].parameters):f;return{matched:!0,consumedSegments:c.consumed,lastChild:c.consumed.length,parameters:y,positionalParamSegments:null!==(i=c.posParams)&&void 0!==i?i:{}}}function O0(t,n,e,i,o="corrected"){if(e.length>0&&function(t,n,e){return e.some(i=>L0(t,n,i)&&ka(i)!==Rn)}(t,e,i)){const f=new $n(n,function(t,n,e,i){const o={};o[Rn]=i,i._sourceSegment=t,i._segmentIndexShift=n.length;for(const c of e)if(""===c.path&&ka(c)!==Rn){const f=new $n([],{});f._sourceSegment=t,f._segmentIndexShift=n.length,o[ka(c)]=f}return o}(t,n,i,new $n(e,t.children)));return f._sourceSegment=t,f._segmentIndexShift=n.length,{segmentGroup:f,slicedSegments:[]}}if(0===e.length&&function(t,n,e){return e.some(i=>L0(t,n,i))}(t,e,i)){const f=new $n(t.segments,function(t,n,e,i,o,c){const f={};for(const y of i)if(L0(t,e,y)&&!o[ka(y)]){const w=new $n([],{});w._sourceSegment=t,w._segmentIndexShift="legacy"===c?t.segments.length:n.length,f[ka(y)]=w}return Object.assign(Object.assign({},o),f)}(t,n,e,i,t.children,o));return f._sourceSegment=t,f._segmentIndexShift=n.length,{segmentGroup:f,slicedSegments:e}}const c=new $n(t.segments,t.children);return c._sourceSegment=t,c._segmentIndexShift=n.length,{segmentGroup:c,slicedSegments:e}}function L0(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}function pI(t,n,e,i){return!!(ka(t)===i||i!==Rn&&L0(n,e,t))&&("**"===t.path||F0(n,t,e).matched)}function gI(t,n,e){return 0===n.length&&!t.children[e]}class Km{constructor(n){this.segmentGroup=n||null}}class mI{constructor(n){this.urlTree=n}}function B0(t){return new Bt(n=>n.error(new Km(t)))}function _I(t){return new Bt(n=>n.error(new mI(t)))}function e5(t){return new Bt(n=>n.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class i5{constructor(n,e,i,o,c){this.configLoader=e,this.urlSerializer=i,this.urlTree=o,this.config=c,this.allowRedirects=!0,this.ngModule=n.get(yc)}apply(){const n=O0(this.urlTree.root,[],[],this.config).segmentGroup,e=new $n(n.segments,n.children);return this.expandSegmentGroup(this.ngModule,this.config,e,Rn).pipe(Rt(c=>this.createUrlTree(Bx(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ld(c=>{if(c instanceof mI)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof Km?this.noMatchError(c):c}))}match(n){return this.expandSegmentGroup(this.ngModule,this.config,n.root,Rn).pipe(Rt(o=>this.createUrlTree(Bx(o),n.queryParams,n.fragment))).pipe(Ld(o=>{throw o instanceof Km?this.noMatchError(o):o}))}noMatchError(n){return new Error(`Cannot match any routes. URL Segment: '${n.segmentGroup}'`)}createUrlTree(n,e,i){const o=n.segments.length>0?new $n([],{[Rn]:n}):n;return new Bd(o,e,i)}expandSegmentGroup(n,e,i,o){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(n,e,i).pipe(Rt(c=>new $n([],c))):this.expandSegment(n,i,e,i.segments,o,!0)}expandChildren(n,e,i){const o=[];for(const c of Object.keys(i.children))"primary"===c?o.unshift(c):o.push(c);return xi(o).pipe(Sp(c=>{const f=i.children[c],y=dI(e,c);return this.expandSegmentGroup(n,y,f,c).pipe(Rt(w=>({segment:w,outlet:c})))}),kS((c,f)=>(c[f.outlet]=f.segment,c),{}),function(t,n){const e=arguments.length>=2;return i=>i.pipe(t?Ar((o,c)=>t(o,c,i)):Ai,Cx(1),e?NS(n):PS(()=>new w0))}())}expandSegment(n,e,i,o,c,f){return xi(i).pipe(Sp(y=>this.expandSegmentAgainstRoute(n,e,i,y,o,c,f).pipe(Ld(T=>{if(T instanceof Km)return Kt(null);throw T}))),Ip(y=>!!y),Ld((y,w)=>{if(y instanceof w0||"EmptyError"===y.name){if(gI(e,o,c))return Kt(new $n([],{}));throw new Km(e)}throw y}))}expandSegmentAgainstRoute(n,e,i,o,c,f,y){return pI(o,e,c,f)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(n,e,o,c,f):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f):B0(e):B0(e)}expandSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,i,o,f):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,i,o){const c=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?_I(c):this.lineralizeSegments(i,c).pipe(gi(f=>{const y=new $n(f,{});return this.expandSegment(n,y,e,f,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,i,o,c,f){const{matched:y,consumedSegments:w,lastChild:T,positionalParamSegments:A}=F0(e,o,c);if(!y)return B0(e);const O=this.applyRedirectCommands(w,o.redirectTo,A);return o.redirectTo.startsWith("/")?_I(O):this.lineralizeSegments(o,O).pipe(gi(V=>this.expandSegment(n,e,i,V.concat(c.slice(T)),f,!1)))}matchSegmentAgainstRoute(n,e,i,o,c){if("**"===i.path)return i.loadChildren?(i._loadedConfig?Kt(i._loadedConfig):this.configLoader.load(n.injector,i)).pipe(Rt(V=>(i._loadedConfig=V,new $n(o,{})))):Kt(new $n(o,{}));const{matched:f,consumedSegments:y,lastChild:w}=F0(e,i,o);if(!f)return B0(e);const T=o.slice(w);return this.getChildConfig(n,i,o).pipe(gi(O=>{const V=O.module,j=O.routes,{segmentGroup:ee,slicedSegments:be}=O0(e,y,T,j),me=new $n(ee.segments,ee.children);if(0===be.length&&me.hasChildren())return this.expandChildren(V,j,me).pipe(Rt(Nt=>new $n(y,Nt)));if(0===j.length&&0===be.length)return Kt(new $n(y,{}));const Ve=ka(i)===c;return this.expandSegment(V,me,j,be,Ve?Rn:c,!0).pipe(Rt(Dt=>new $n(y.concat(Dt.segments),Dt.children)))}))}getChildConfig(n,e,i){return e.children?Kt(new Ox(e.children,n)):e.loadChildren?void 0!==e._loadedConfig?Kt(e._loadedConfig):this.runCanLoadGuards(n.injector,e,i).pipe(gi(o=>o?this.configLoader.load(n.injector,e).pipe(Rt(c=>(e._loadedConfig=c,c))):function(t){return new Bt(n=>n.error(Ex(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):Kt(new Ox([],n))}runCanLoadGuards(n,e,i){const o=e.canLoad;return o&&0!==o.length?Kt(o.map(f=>{const y=n.get(f);let w;if(function(t){return t&&_h(t.canLoad)}(y))w=y.canLoad(e,i);else{if(!_h(y))throw new Error("Invalid CanLoad guard");w=y(e,i)}return xc(w)})).pipe(Jm(),vo(f=>{if(!zd(f))return;const y=Ex(`Redirecting to "${this.urlSerializer.serialize(f)}"`);throw y.url=f,y}),Rt(f=>!0===f)):Kt(!0)}lineralizeSegments(n,e){let i=[],o=e.root;for(;;){if(i=i.concat(o.segments),0===o.numberOfChildren)return Kt(i);if(o.numberOfChildren>1||!o.children[Rn])return e5(n.redirectTo);o=o.children[Rn]}}applyRedirectCommands(n,e,i){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),n,i)}applyRedirectCreatreUrlTree(n,e,i,o){const c=this.createSegmentGroup(n,e.root,i,o);return new Bd(c,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const i={};return bo(n,(o,c)=>{if("string"==typeof o&&o.startsWith(":")){const y=o.substring(1);i[c]=e[y]}else i[c]=o}),i}createSegmentGroup(n,e,i,o){const c=this.createSegments(n,e.segments,i,o);let f={};return bo(e.children,(y,w)=>{f[w]=this.createSegmentGroup(n,y,i,o)}),new $n(c,f)}createSegments(n,e,i,o){return e.map(c=>c.path.startsWith(":")?this.findPosParam(n,c,o):this.findOrReturn(c,i))}findPosParam(n,e,i){const o=i[e.path.substring(1)];if(!o)throw new Error(`Cannot redirect to '${n}'. Cannot find '${e.path}'.`);return o}findOrReturn(n,e){let i=0;for(const o of e){if(o.path===n.path)return e.splice(i),o;i++}return n}}function Bx(t){const n={};for(const i of Object.keys(t.children)){const c=Bx(t.children[i]);(c.segments.length>0||c.hasChildren())&&(n[i]=c)}return function(t){if(1===t.numberOfChildren&&t.children[Rn]){const n=t.children[Rn];return new $n(t.segments.concat(n.segments),n.children)}return t}(new $n(t.segments,n))}class yI{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class V0{constructor(n,e){this.component=n,this.route=e}}function s5(t,n,e){const i=t._root;return Qm(i,n?n._root:null,e,[i.value])}function z0(t,n,e){const i=function(t){if(!t)return null;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(n);return(i?i.module.injector:e).get(t)}function Qm(t,n,e,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=Zm(n);return t.children.forEach(f=>{(function(t,n,e,i,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=t.value,f=n?n.value:null,y=e?e.getContext(t.value.outlet):null;if(f&&c.routeConfig===f.routeConfig){const w=function(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!Vd(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Vd(t.url,n.url)||!bc(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Px(t,n)||!bc(t.queryParams,n.queryParams);case"paramsChange":default:return!Px(t,n)}}(f,c,c.routeConfig.runGuardsAndResolvers);w?o.canActivateChecks.push(new yI(i)):(c.data=f.data,c._resolvedData=f._resolvedData),Qm(t,n,c.component?y?y.children:null:e,i,o),w&&y&&y.outlet&&y.outlet.isActivated&&o.canDeactivateChecks.push(new V0(y.outlet.component,f))}else f&&e_(n,y,o),o.canActivateChecks.push(new yI(i)),Qm(t,null,c.component?y?y.children:null:e,i,o)})(f,c[f.value.outlet],e,i.concat([f.value]),o),delete c[f.value.outlet]}),bo(c,(f,y)=>e_(f,e.getContext(y),o)),o}function e_(t,n,e){const i=Zm(t),o=t.value;bo(i,(c,f)=>{e_(c,o.component?n?n.children.getContext(f):null:n,e)}),e.canDeactivateChecks.push(new V0(o.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,o))}class v5{}function vI(t){return new Bt(n=>n.error(t))}class x5{constructor(n,e,i,o,c,f){this.rootComponentType=n,this.config=e,this.urlTree=i,this.url=o,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=f}recognize(){const n=O0(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,n,Rn);if(null===e)return null;const i=new k0([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Rn,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new gu(i,e),c=new tI(this.url,o);return this.inheritParamsAndData(c._root),c}inheritParamsAndData(n){const e=n.value,i=eI(e,this.paramsInheritanceStrategy);e.params=Object.freeze(i.params),e.data=Object.freeze(i.data),n.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(n,e,i){return 0===e.segments.length&&e.hasChildren()?this.processChildren(n,e):this.processSegment(n,e,e.segments,i)}processChildren(n,e){const i=[];for(const c of Object.keys(e.children)){const f=e.children[c],y=dI(n,c),w=this.processSegmentGroup(y,f,c);if(null===w)return null;i.push(...w)}const o=bI(i);return function(t){t.sort((n,e)=>n.value.outlet===Rn?-1:e.value.outlet===Rn?1:n.value.outlet.localeCompare(e.value.outlet))}(o),o}processSegment(n,e,i,o){for(const c of n){const f=this.processSegmentAgainstRoute(c,e,i,o);if(null!==f)return f}return gI(e,i,o)?[]:null}processSegmentAgainstRoute(n,e,i,o){if(n.redirectTo||!pI(n,e,i,o))return null;let c,f=[],y=[];if("**"===n.path){const j=i.length>0?US(i).parameters:{};c=new k0(i,j,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,CI(n),ka(n),n.component,n,xI(e),wI(e)+i.length,DI(n))}else{const j=F0(e,n,i);if(!j.matched)return null;f=j.consumedSegments,y=i.slice(j.lastChild),c=new k0(f,j.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,CI(n),ka(n),n.component,n,xI(e),wI(e)+f.length,DI(n))}const w=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(n),{segmentGroup:T,slicedSegments:A}=O0(e,f,y,w.filter(j=>void 0===j.redirectTo),this.relativeLinkResolution);if(0===A.length&&T.hasChildren()){const j=this.processChildren(w,T);return null===j?null:[new gu(c,j)]}if(0===w.length&&0===A.length)return[new gu(c,[])];const O=ka(n)===o,V=this.processSegment(w,T,A,O?Rn:o);return null===V?null:[new gu(c,V)]}}function D5(t){const n=t.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function bI(t){const n=[],e=new Set;for(const i of t){if(!D5(i)){n.push(i);continue}const o=n.find(c=>i.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...i.children),e.add(o)):n.push(i)}for(const i of e){const o=bI(i.children);n.push(new gu(i.value,o))}return n.filter(i=>!e.has(i))}function xI(t){let n=t;for(;n._sourceSegment;)n=n._sourceSegment;return n}function wI(t){let n=t,e=n._segmentIndexShift?n._segmentIndexShift:0;for(;n._sourceSegment;)n=n._sourceSegment,e+=n._segmentIndexShift?n._segmentIndexShift:0;return e-1}function CI(t){return t.data||{}}function DI(t){return t.resolve||{}}function Vx(t){return Ml(n=>{const e=t(n);return e?xi(e).pipe(Rt(()=>n)):Kt(n)})}class P5 extends class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}{}const zx=new Yt("ROUTES");class EI{constructor(n,e,i,o){this.loader=n,this.compiler=e,this.onLoadStartListener=i,this.onLoadEndListener=o}load(n,e){if(e._loader$)return e._loader$;this.onLoadStartListener&&this.onLoadStartListener(e);const o=this.loadModuleFactory(e.loadChildren).pipe(Rt(c=>{this.onLoadEndListener&&this.onLoadEndListener(e);const f=c.create(n);return new Ox(zS(f.injector.get(zx,void 0,Tt.Self|Tt.Optional)).map(Lx),f)}),Ld(c=>{throw e._loader$=void 0,c}));return e._loader$=new Tc(o,()=>new qn).pipe(Rl()),e._loader$}loadModuleFactory(n){return"string"==typeof n?xi(this.loader.load(n)):xc(n()).pipe(gi(e=>e instanceof JD?Kt(e):xi(this.compiler.compileModuleAsync(e))))}}class N5{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Pp,this.attachRef=null}}class Pp{constructor(){this.contexts=new Map}onChildOutletCreated(n,e){const i=this.getOrCreateContext(n);i.outlet=e,this.contexts.set(n,i)}onChildOutletDestroyed(n){const e=this.getContext(n);e&&(e.outlet=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let e=this.getContext(n);return e||(e=new N5,this.contexts.set(n,e)),e}getContext(n){return this.contexts.get(n)||null}}class F5{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,e){return n}}function O5(t){throw t}function L5(t,n,e){return n.parse("/")}function TI(t,n){return Kt(null)}const B5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},V5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ss=(()=>{class t{constructor(e,i,o,c,f,y,w,T){this.rootComponentType=e,this.urlSerializer=i,this.rootContexts=o,this.location=c,this.config=T,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new qn,this.errorHandler=O5,this.malformedUriErrorHandler=L5,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:TI,afterPreactivation:TI},this.urlHandlingStrategy=new F5,this.routeReuseStrategy=new P5,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=f.get(yc),this.console=f.get(Oy);const V=f.get(Bn);this.isNgZoneEnabled=V instanceof Bn&&Bn.isInAngularZone(),this.resetConfig(T),this.currentUrlTree=new Bd(new $n([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new EI(y,w,j=>this.triggerEvent(new FS(j)),j=>this.triggerEvent(new OS(j))),this.routerState=QS(this.currentUrlTree,this.rootComponentType),this.transitions=new $r({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var e;return null===(e=this.location.getState())||void 0===e?void 0:e.\u0275routerPageId}setupNavigations(e){const i=this.events;return e.pipe(Ar(o=>0!==o.id),Rt(o=>Object.assign(Object.assign({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Ml(o=>{let c=!1,f=!1;return Kt(o).pipe(vo(y=>{this.currentNavigation={id:y.id,initialUrl:y.currentRawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ml(y=>{const w=this.browserUrlTree.toString(),T=!this.navigated||y.extractedUrl.toString()!==w||w!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||T)&&this.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return U0(y.source)&&(this.browserUrlTree=y.extractedUrl),Kt(y).pipe(Ml(O=>{const V=this.transitions.getValue();return i.next(new Dx(O.id,this.serializeUrl(O.extractedUrl),O.source,O.restoredState)),V!==this.transitions.getValue()?Od:Promise.resolve(O)}),function(t,n,e,i){return Ml(o=>function(t,n,e,i,o){return new i5(t,n,e,i,o).apply()}(t,n,e,o.extractedUrl,i).pipe(Rt(c=>Object.assign(Object.assign({},o),{urlAfterRedirects:c}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),vo(O=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:O.urlAfterRedirects})}),function(t,n,e,i,o){return gi(c=>function(t,n,e,i,o="emptyOnly",c="legacy"){try{const f=new x5(t,n,e,i,o,c).recognize();return null===f?vI(new v5):Kt(f)}catch(f){return vI(f)}}(t,n,c.urlAfterRedirects,e(c.urlAfterRedirects),i,o).pipe(Rt(f=>Object.assign(Object.assign({},c),{targetSnapshot:f}))))}(this.rootComponentType,this.config,O=>this.serializeUrl(O),this.paramsInheritanceStrategy,this.relativeLinkResolution),vo(O=>{"eager"===this.urlUpdateStrategy&&(O.extras.skipLocationChange||this.setBrowserUrl(O.urlAfterRedirects,O),this.browserUrlTree=O.urlAfterRedirects);const V=new QV(O.id,this.serializeUrl(O.extractedUrl),this.serializeUrl(O.urlAfterRedirects),O.targetSnapshot);i.next(V)}));if(T&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:V,extractedUrl:j,source:ee,restoredState:be,extras:me}=y,Ve=new Dx(V,this.serializeUrl(j),ee,be);i.next(Ve);const ke=QS(j,this.rootComponentType).snapshot;return Kt(Object.assign(Object.assign({},y),{targetSnapshot:ke,urlAfterRedirects:j,extras:Object.assign(Object.assign({},me),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=y.rawUrl,this.browserUrlTree=y.urlAfterRedirects,y.resolve(null),Od}),Vx(y=>{const{targetSnapshot:w,id:T,extractedUrl:A,rawUrl:O,extras:{skipLocationChange:V,replaceUrl:j}}=y;return this.hooks.beforePreactivation(w,{navigationId:T,appliedUrlTree:A,rawUrlTree:O,skipLocationChange:!!V,replaceUrl:!!j})}),vo(y=>{const w=new ez(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(w)}),Rt(y=>Object.assign(Object.assign({},y),{guards:s5(y.targetSnapshot,y.currentSnapshot,this.rootContexts)})),function(t,n){return gi(e=>{const{targetSnapshot:i,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:f}}=e;return 0===f.length&&0===c.length?Kt(Object.assign(Object.assign({},e),{guardsResult:!0})):function(t,n,e,i){return xi(t).pipe(gi(o=>function(t,n,e,i,o){const c=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return c&&0!==c.length?Kt(c.map(y=>{const w=z0(y,n,o);let T;if(function(t){return t&&_h(t.canDeactivate)}(w))T=xc(w.canDeactivate(t,n,e,i));else{if(!_h(w))throw new Error("Invalid CanDeactivate guard");T=xc(w(t,n,e,i))}return T.pipe(Ip())})).pipe(Jm()):Kt(!0)}(o.component,o.route,e,n,i)),Ip(o=>!0!==o,!0))}(f,i,o,t).pipe(gi(y=>y&&function(t){return"boolean"==typeof t}(y)?function(t,n,e,i){return xi(n).pipe(Sp(o=>C0(function(t,n){return null!==t&&n&&n(new rz(t)),Kt(!0)}(o.route.parent,i),function(t,n){return null!==t&&n&&n(new sz(t)),Kt(!0)}(o.route,i),function(t,n,e){const i=n[n.length-1],c=n.slice(0,n.length-1).reverse().map(f=>function(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(f)).filter(f=>null!==f).map(f=>IS(()=>Kt(f.guards.map(w=>{const T=z0(w,f.node,e);let A;if(function(t){return t&&_h(t.canActivateChild)}(T))A=xc(T.canActivateChild(i,t));else{if(!_h(T))throw new Error("Invalid CanActivateChild guard");A=xc(T(i,t))}return A.pipe(Ip())})).pipe(Jm())));return Kt(c).pipe(Jm())}(t,o.path,e),function(t,n,e){const i=n.routeConfig?n.routeConfig.canActivate:null;return i&&0!==i.length?Kt(i.map(c=>IS(()=>{const f=z0(c,n,e);let y;if(function(t){return t&&_h(t.canActivate)}(f))y=xc(f.canActivate(n,t));else{if(!_h(f))throw new Error("Invalid CanActivate guard");y=xc(f(n,t))}return y.pipe(Ip())}))).pipe(Jm()):Kt(!0)}(t,o.route,e))),Ip(o=>!0!==o,!0))}(i,c,t,n):Kt(y)),Rt(y=>Object.assign(Object.assign({},e),{guardsResult:y})))})}(this.ngModule.injector,y=>this.triggerEvent(y)),vo(y=>{if(zd(y.guardsResult)){const T=Ex(`Redirecting to "${this.serializeUrl(y.guardsResult)}"`);throw T.url=y.guardsResult,T}const w=new tz(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.triggerEvent(w)}),Ar(y=>!!y.guardsResult||(this.restoreHistory(y),this.cancelNavigationTransition(y,""),!1)),Vx(y=>{if(y.guards.canActivateChecks.length)return Kt(y).pipe(vo(w=>{const T=new nz(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(T)}),Ml(w=>{let T=!1;return Kt(w).pipe(function(t,n){return gi(e=>{const{targetSnapshot:i,guards:{canActivateChecks:o}}=e;if(!o.length)return Kt(e);let c=0;return xi(o).pipe(Sp(f=>function(t,n,e,i){return function(t,n,e,i){const o=Object.keys(t);if(0===o.length)return Kt({});const c={};return xi(o).pipe(gi(f=>function(t,n,e,i){const o=z0(t,n,i);return xc(o.resolve?o.resolve(n,e):o(n,e))}(t[f],n,e,i).pipe(vo(y=>{c[f]=y}))),Cx(1),gi(()=>Object.keys(c).length===o.length?Kt(c):Od))}(t._resolve,t,n,i).pipe(Rt(c=>(t._resolvedData=c,t.data=Object.assign(Object.assign({},t.data),eI(t,e).resolve),null)))}(f.route,i,t,n)),vo(()=>c++),Cx(1),gi(f=>c===o.length?Kt(e):Od))})}(this.paramsInheritanceStrategy,this.ngModule.injector),vo({next:()=>T=!0,complete:()=>{T||(this.restoreHistory(w),this.cancelNavigationTransition(w,"At least one route resolver didn't emit any value."))}}))}),vo(w=>{const T=new iz(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(T)}))}),Vx(y=>{const{targetSnapshot:w,id:T,extractedUrl:A,rawUrl:O,extras:{skipLocationChange:V,replaceUrl:j}}=y;return this.hooks.afterPreactivation(w,{navigationId:T,appliedUrlTree:A,rawUrlTree:O,skipLocationChange:!!V,replaceUrl:!!j})}),Rt(y=>{const w=function(t,n,e){const i=P0(t,n._root,e?e._root:void 0);return new KS(i,n)}(this.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return Object.assign(Object.assign({},y),{targetRouterState:w})}),vo(y=>{this.currentUrlTree=y.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),this.routerState=y.targetRouterState,"deferred"===this.urlUpdateStrategy&&(y.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,y),this.browserUrlTree=y.urlAfterRedirects)}),((t,n,e)=>Rt(i=>(new Uz(n,i.targetRouterState,i.currentRouterState,e).activate(t),i)))(this.rootContexts,this.routeReuseStrategy,y=>this.triggerEvent(y)),vo({next(){c=!0},complete(){c=!0}}),function(t){return n=>n.lift(new YV(t))}(()=>{if(!c&&!f){const y=`Navigation ID ${o.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(o),this.cancelNavigationTransition(o,y)):this.cancelNavigationTransition(o,y)}this.currentNavigation=null}),Ld(y=>{if(f=!0,function(t){return t&&t[BS]}(y)){const w=zd(y.url);w||(this.navigated=!0,this.restoreHistory(o,!0));const T=new RS(o.id,this.serializeUrl(o.extractedUrl),y.message);i.next(T),w?setTimeout(()=>{const A=this.urlHandlingStrategy.merge(y.url,this.rawUrlTree),O={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||U0(o.source)};this.scheduleNavigation(A,"imperative",null,O,{resolve:o.resolve,reject:o.reject,promise:o.promise})},0):o.resolve(!1)}else{this.restoreHistory(o,!0);const w=new KV(o.id,this.serializeUrl(o.extractedUrl),y);i.next(w);try{o.resolve(this.errorHandler(y))}catch(T){o.reject(T)}}return Od}))}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const i=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,i)&&setTimeout(()=>{const{source:o,state:c,urlTree:f}=i,y={replaceUrl:!0};if(c){const w=Object.assign({},c);delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(y.state=w)}this.scheduleNavigation(f,o,c,y)},0),this.lastLocationChangeInfo=i}))}extractLocationChangeInfoFromEvent(e){var i;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(i=e.state)||void 0===i?void 0:i.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,i){if(!e)return!0;const o=i.urlTree.toString()===e.urlTree.toString();return i.transitionId!==e.transitionId||!o||!("hashchange"===i.source&&"popstate"===e.source||"popstate"===i.source&&"hashchange"===e.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){hI(e),this.config=e.map(Lx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,i={}){const{relativeTo:o,queryParams:c,fragment:f,queryParamsHandling:y,preserveFragment:w}=i,T=o||this.routerState.root,A=w?this.currentUrlTree.fragment:f;let O=null;switch(y){case"merge":O=Object.assign(Object.assign({},this.currentUrlTree.queryParams),c);break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=c||null}return null!==O&&(O=this.removeEmptyProps(O)),function(t,n,e,i,o){if(0===e.length)return Nx(n.root,n.root,n,i,o);const c=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new oI(!0,0,t);let n=0,e=!1;const i=t.reduce((o,c,f)=>{if("object"==typeof c&&null!=c){if(c.outlets){const y={};return bo(c.outlets,(w,T)=>{y[T]="string"==typeof w?w.split("/"):w}),[...o,{outlets:y}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===f?(c.split("/").forEach((y,w)=>{0==w&&"."===y||(0==w&&""===y?e=!0:".."===y?n++:""!=y&&o.push(y))}),o):[...o,c]},[]);return new oI(e,n,i)}(e);if(c.toRoot())return Nx(n.root,new $n([],{}),n,i,o);const f=function(t,n,e){if(t.isAbsolute)return new Rx(n.root,!0,0);if(-1===e.snapshot._lastPathIndex){const c=e.snapshot._urlSegment;return new Rx(c,c===n.root,0)}const i=N0(t.commands[0])?0:1;return function(t,n,e){let i=t,o=n,c=e;for(;c>o;){if(c-=o,i=i.parent,!i)throw new Error("Invalid number of '../'");o=i.segments.length}return new Rx(i,!1,o-c)}(e.snapshot._urlSegment,e.snapshot._lastPathIndex+i,t.numberOfDoubleDots)}(c,n,t),y=f.processChildren?R0(f.segmentGroup,f.index,c.commands):sI(f.segmentGroup,f.index,c.commands);return Nx(f.segmentGroup,y,n,i,o)}(T,this.currentUrlTree,e,O,null!=A?A:null)}navigateByUrl(e,i={skipLocationChange:!1}){const o=zd(e)?e:this.parseUrl(e),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,i)}navigate(e,i={skipLocationChange:!1}){return function(t){for(let n=0;n<t.length;n++){const e=t[n];if(null==e)throw new Error(`The requested path contains ${e} segment at index ${n}`)}}(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let i;try{i=this.urlSerializer.parse(e)}catch(o){i=this.malformedUriErrorHandler(o,this.urlSerializer,e)}return i}isActive(e,i){let o;if(o=!0===i?Object.assign({},B5):!1===i?Object.assign({},V5):i,zd(e))return jS(this.currentUrlTree,e,o);const c=this.parseUrl(e);return jS(this.currentUrlTree,c,o)}removeEmptyProps(e){return Object.keys(e).reduce((i,o)=>{const c=e[o];return null!=c&&(i[o]=c),i},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new Gm(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}scheduleNavigation(e,i,o,c,f){var y,w;if(this.disposed)return Promise.resolve(!1);const T=this.getTransition(),A=U0(i)&&T&&!U0(T.source),j=(this.lastSuccessfulId===T.id||this.currentNavigation?T.rawUrl:T.urlAfterRedirects).toString()===e.toString();if(A&&j)return Promise.resolve(!0);let ee,be,me;f?(ee=f.resolve,be=f.reject,me=f.promise):me=new Promise((Dt,Nt)=>{ee=Dt,be=Nt});const Ve=++this.navigationId;let ke;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),ke=o&&o.\u0275routerPageId?o.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?null!==(y=this.browserPageId)&&void 0!==y?y:0:(null!==(w=this.browserPageId)&&void 0!==w?w:0)+1):ke=0,this.setTransition({id:Ve,targetPageId:ke,source:i,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:c,resolve:ee,reject:be,promise:me,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),me.catch(Dt=>Promise.reject(Dt))}setBrowserUrl(e,i){const o=this.urlSerializer.serialize(e),c=Object.assign(Object.assign({},i.extras.state),this.generateNgRouterState(i.id,i.targetPageId));this.location.isCurrentPathEqualTo(o)||i.extras.replaceUrl?this.location.replaceState(o,"",c):this.location.go(o,"",c)}restoreHistory(e,i=!1){var o,c;if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(o=this.currentNavigation)||void 0===o?void 0:o.finalUrl)||0===f?this.currentUrlTree===(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)&&0===f&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(f)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,i){const o=new RS(e.id,this.serializeUrl(e.extractedUrl),i);this.triggerEvent(o),e.resolve(!1)}generateNgRouterState(e,i){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}}return t.\u0275fac=function(e){return new(e||t)(je(jh),je(Tx),je(Pp),je(Xy),je(Un),je(By),je(Ad),je(void 0))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function U0(t){return"imperative"!==t}let jx=(()=>{class t{constructor(e,i,o,c,f){this.parentContexts=e,this.location=i,this.resolver=o,this.changeDetector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new kt,this.deactivateEvents=new kt,this.name=c||Rn,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const f=(i=i||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),y=this.parentContexts.getOrCreateContext(this.name).children,w=new j5(e,y,this.location.injector);this.activated=this.location.createComponent(f,this.location.length,w),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)(ce(Pp),ce(ts),ce(Js),function(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const i=e.length;let o=0;for(;o<i;){const c=e[o];if(J(c))break;if(0===c)o+=2;else if("number"==typeof c)for(o++;o<i&&"string"==typeof e[o];)o++;else{if(c===n)return e[o+1];o+=2}}}return null}(Ti(),t)}("name"),ce(mo))},t.\u0275dir=ut({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),t})();class j5{constructor(n,e,i){this.route=n,this.childContexts=e,this.parent=i}get(n,e){return n===kp?this.route:n===Pp?this.childContexts:this.parent.get(n,e)}}class MI{}class SI{preload(n,e){return Kt(null)}}let II=(()=>{class t{constructor(e,i,o,c,f){this.router=e,this.injector=c,this.preloadingStrategy=f,this.loader=new EI(i,o,T=>e.triggerEvent(new FS(T)),T=>e.triggerEvent(new OS(T)))}setUpPreloading(){this.subscription=this.router.events.pipe(Ar(e=>e instanceof Gm),Sp(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(yc);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,i){const o=[];for(const c of i)if(c.loadChildren&&!c.canLoad&&c._loadedConfig){const f=c._loadedConfig;o.push(this.processRoutes(f.module,f.routes))}else c.loadChildren&&!c.canLoad?o.push(this.preloadConfig(e,c)):c.children&&o.push(this.processRoutes(e,c.children));return xi(o).pipe(mr(),Rt(c=>{}))}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>(i._loadedConfig?Kt(i._loadedConfig):this.loader.load(e.injector,i)).pipe(gi(c=>(i._loadedConfig=c,this.processRoutes(c.module,c.routes)))))}}return t.\u0275fac=function(e){return new(e||t)(je(ss),je(By),je(Ad),je(Un),je(MI))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),Hx=(()=>{class t{constructor(e,i,o={}){this.router=e,this.viewportScroller=i,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof Dx?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Gm&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof LS&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,i){this.router.triggerEvent(new LS(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(je(ss),je(hM),je(void 0))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const Ud=new Yt("ROUTER_CONFIGURATION"),AI=new Yt("ROUTER_FORROOT_GUARD"),G5=[Xy,{provide:Tx,useClass:WS},{provide:ss,useFactory:function(t,n,e,i,o,c,f,y={},w,T){const A=new ss(null,t,n,e,i,o,c,zS(f));return w&&(A.urlHandlingStrategy=w),T&&(A.routeReuseStrategy=T),function(t,n){t.errorHandler&&(n.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(n.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(n.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(n.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(n.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(n.urlUpdateStrategy=t.urlUpdateStrategy)}(y,A),y.enableTracing&&A.events.subscribe(O=>{var V,j;null===(V=console.group)||void 0===V||V.call(console,`Router Event: ${O.constructor.name}`),console.log(O.toString()),console.log(O),null===(j=console.groupEnd)||void 0===j||j.call(console)}),A},deps:[Tx,Pp,Xy,Un,By,Ad,zx,Ud,[class{},new ko],[class{},new ko]]},Pp,{provide:kp,useFactory:function(t){return t.routerState.root},deps:[ss]},{provide:By,useClass:iO},II,SI,class{preload(n,e){return e().pipe(Ld(()=>Kt(null)))}},{provide:Ud,useValue:{enableTracing:!1}}];function q5(){return new hb("Router",ss)}let kI=(()=>{class t{constructor(e,i){}static forRoot(e,i){return{ngModule:t,providers:[G5,PI(e),{provide:AI,useFactory:X5,deps:[[ss,new ko,new al]]},{provide:Ud,useValue:i||{}},{provide:Ep,useFactory:Z5,deps:[Nd,[new Hu(Sb),new ko],Ud]},{provide:Hx,useFactory:W5,deps:[ss,hM,Ud]},{provide:MI,useExisting:i&&i.preloadingStrategy?i.preloadingStrategy:SI},{provide:hb,multi:!0,useFactory:q5},[Gx,{provide:Im,multi:!0,useFactory:Q5,deps:[Gx]},{provide:NI,useFactory:e4,deps:[Gx]},{provide:tT,multi:!0,useExisting:NI}]]}}static forChild(e){return{ngModule:t,providers:[PI(e)]}}}return t.\u0275fac=function(e){return new(e||t)(je(AI,8),je(ss,8))},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})();function W5(t,n,e){return e.scrollOffset&&n.setOffset(e.scrollOffset),new Hx(t,n,e)}function Z5(t,n,e={}){return e.useHash?new CL(t,n):new GT(t,n)}function X5(t){return"guarded"}function PI(t){return[{provide:f_,multi:!0,useValue:t},{provide:zx,multi:!0,useValue:t}]}let Gx=(()=>{class t{constructor(e){this.injector=e,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new qn}appInitializer(){return this.injector.get(bL,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let i=null;const o=new Promise(y=>i=y),c=this.injector.get(ss),f=this.injector.get(Ud);return"disabled"===f.initialNavigation?(c.setUpLocationChangeListener(),i(!0)):"enabled"===f.initialNavigation||"enabledBlocking"===f.initialNavigation?(c.hooks.afterPreactivation=()=>this.initNavigation?Kt(null):(this.initNavigation=!0,i(!0),this.resultOfPreactivationDone),c.initialNavigation()):i(!0),o})}bootstrapListener(e){const i=this.injector.get(Ud),o=this.injector.get(II),c=this.injector.get(Hx),f=this.injector.get(ss),y=this.injector.get(xl);e===y.components[0]&&(("enabledNonBlocking"===i.initialNavigation||void 0===i.initialNavigation)&&f.initialNavigation(),o.setUpPreloading(),c.init(),f.resetRootComponentType(y.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(e){return new(e||t)(je(Un))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();function Q5(t){return t.appInitializer.bind(t)}function e4(t){return t.bootstrapListener.bind(t)}const NI=new Yt("Router Initializer");var t_=Ie(958);function xo(t,n,e,i){return Je(e)&&(i=e,e=void 0),i?xo(t,n,e).pipe(Rt(o=>Me(o)?i(...o):i(o))):new Bt(o=>{RI(t,n,function(f){o.next(arguments.length>1?Array.prototype.slice.call(arguments):f)},o,e)})}function RI(t,n,e,i,o){let c;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const f=t;t.addEventListener(n,e,o),c=()=>f.removeEventListener(n,e,o)}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const f=t;t.on(n,e),c=()=>f.off(n,e)}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const f=t;t.addListener(n,e),c=()=>f.removeListener(n,e)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let f=0,y=t.length;f<y;f++)RI(t[f],n,e,i,o)}i.add(c)}class o4 extends K{constructor(n,e){super()}schedule(n,e=0){return this}}let FI=(()=>{class t{constructor(e,i=t.now){this.SchedulerAction=e,this.now=i}schedule(e,i=0,o){return new this.SchedulerAction(this,e).schedule(o,i)}}return t.now=()=>Date.now(),t})();class yh extends FI{constructor(n,e=FI.now){super(n,()=>yh.delegate&&yh.delegate!==this?yh.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(n,e=0,i){return yh.delegate&&yh.delegate!==this?yh.delegate.schedule(n,e,i):super.schedule(n,e,i)}flush(n){const{actions:e}=this;if(this.active)return void e.push(n);let i;this.active=!0;do{if(i=n.execute(n.state,n.delay))break}while(n=e.shift());if(this.active=!1,i){for(;n=e.shift();)n.unsubscribe();throw i}}}const OI=new yh(class extends o4{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){if(this.closed)return this;this.state=n;const i=this.id,o=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(o,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(o,this.id,e),this}requestAsyncId(n,e,i=0){return setInterval(n.flush.bind(n,this),i)}recycleAsyncId(n,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(n,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let o,i=!1;try{this.work(n)}catch(c){i=!0,o=!!c&&c||new Error(c)}if(i)return this.unsubscribe(),o}_unsubscribe(){const n=this.id,e=this.scheduler,i=e.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&i.splice(o,1),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null}});function LI(t){return!Me(t)&&t-parseFloat(t)+1>=0}function a4(t){const{index:n,period:e,subscriber:i}=t;if(i.next(n),!i.closed){if(-1===e)return i.complete();t.index=n+1,this.schedule(t,e)}}class l4{call(n,e){return e.subscribe(new c4(n))}}class c4 extends bx{constructor(n){super(n),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}_next(n){this.observables.push(n)}_complete(){const n=this.observables,e=n.length;if(0===e)this.destination.complete();else{for(let i=0;i<e&&!this.hasFirst;i++){const c=xx(this,n[i],void 0,i);this.subscriptions&&this.subscriptions.push(c),this.add(c)}this.observables=null}}notifyNext(n,e,i){if(!this.hasFirst){this.hasFirst=!0;for(let o=0;o<this.subscriptions.length;o++)if(o!==i){let c=this.subscriptions[o];c.unsubscribe(),this.remove(c)}this.subscriptions=null}this.destination.next(e)}}function $0(...t){const n=t[t.length-1];return"function"==typeof n&&t.pop(),Ps(t,void 0).lift(new u4(n))}new Bt(fu);class u4{constructor(n){this.resultSelector=n}call(n,e){return e.subscribe(new h4(n,this.resultSelector))}}class h4 extends ct{constructor(n,e,i=Object.create(null)){super(n),this.resultSelector=e,this.iterators=[],this.active=0,this.resultSelector="function"==typeof e?e:void 0}_next(n){const e=this.iterators;Me(n)?e.push(new f4(n)):e.push("function"==typeof n[Pr]?new d4(n[Pr]()):new p4(this.destination,this,n))}_complete(){const n=this.iterators,e=n.length;if(this.unsubscribe(),0!==e){this.active=e;for(let i=0;i<e;i++){let o=n[i];o.stillUnsubscribed?this.destination.add(o.subscribe()):this.active--}}else this.destination.complete()}notifyInactive(){this.active--,0===this.active&&this.destination.complete()}checkIterators(){const n=this.iterators,e=n.length,i=this.destination;for(let f=0;f<e;f++){let y=n[f];if("function"==typeof y.hasValue&&!y.hasValue())return}let o=!1;const c=[];for(let f=0;f<e;f++){let y=n[f],w=y.next();if(y.hasCompleted()&&(o=!0),w.done)return void i.complete();c.push(w.value)}this.resultSelector?this._tryresultSelector(c):i.next(c),o&&i.complete()}_tryresultSelector(n){let e;try{e=this.resultSelector.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class d4{constructor(n){this.iterator=n,this.nextResult=n.next()}hasValue(){return!0}next(){const n=this.nextResult;return this.nextResult=this.iterator.next(),n}hasCompleted(){const n=this.nextResult;return Boolean(n&&n.done)}}class f4{constructor(n){this.array=n,this.index=0,this.length=0,this.length=n.length}[Pr](){return this}next(n){const e=this.index++;return e<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}}hasValue(){return this.array.length>this.index}hasCompleted(){return this.array.length===this.index}}class p4 extends cs{constructor(n,e,i){super(n),this.parent=e,this.observable=i,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}[Pr](){return this}next(){const n=this.buffer;return 0===n.length&&this.isComplete?{value:null,done:!0}:{value:n.shift(),done:!1}}hasValue(){return this.buffer.length>0}hasCompleted(){return 0===this.buffer.length&&this.isComplete}notifyComplete(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()}notifyNext(n){this.buffer.push(n),this.parent.checkIterators()}subscribe(){return Nr(this.observable,new ia(this))}}function cr(t){return n=>n.lift(new m4(t))}class m4{constructor(n){this.notifier=n}call(n,e){const i=new _4(n),o=Nr(this.notifier,new ia(i));return o&&!i.seenValue?(i.add(o),e.subscribe(i)):i}}class _4 extends cs{constructor(n){super(n),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function Wx(...t){return n=>{let e;return"function"==typeof t[t.length-1]&&(e=t.pop()),n.lift(new b4(t,e))}}class b4{constructor(n,e){this.observables=n,this.project=e}call(n,e){return e.subscribe(new x4(n,this.observables,this.project))}}class x4 extends bx{constructor(n,e,i){super(n),this.observables=e,this.project=i,this.toRespond=[];const o=e.length;this.values=new Array(o);for(let c=0;c<o;c++)this.toRespond.push(c);for(let c=0;c<o;c++)this.add(xx(this,e[c],void 0,c))}notifyNext(n,e,i){this.values[i]=e;const o=this.toRespond;if(o.length>0){const c=o.indexOf(i);-1!==c&&o.splice(c,1)}}notifyComplete(){}_next(n){if(0===this.toRespond.length){const e=[n,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(n){let e;try{e=this.project.apply(this,n)}catch(i){return void this.destination.error(i)}this.destination.next(e)}}class Sl{constructor(n,e,i){this.kind=n,this.value=e,this.error=i,this.hasValue="N"===n}observe(n){switch(this.kind){case"N":return n.next&&n.next(this.value);case"E":return n.error&&n.error(this.error);case"C":return n.complete&&n.complete()}}do(n,e,i){switch(this.kind){case"N":return n&&n(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}}accept(n,e,i){return n&&"function"==typeof n.next?this.observe(n):this.do(n,e,i)}toObservable(){switch(this.kind){case"N":return Kt(this.value);case"E":return function(t,n){return new Bt(e=>e.error(t))}(this.error);case"C":return D0()}throw new Error("unexpected notification kind value")}static createNext(n){return void 0!==n?new Sl("N",n):Sl.undefinedValueNotification}static createError(n){return new Sl("E",void 0,n)}static createComplete(){return Sl.completeNotification}}Sl.completeNotification=new Sl("C"),Sl.undefinedValueNotification=new Sl("N",void 0);const Rp=["*"],_6=["dialog"];function vh(t){return null!=t}function Op(t){return(t||document.body).getBoundingClientRect()}"undefined"!=typeof Element&&!Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(t){let n=this;if(!document.documentElement.contains(n))return null;do{if(n.matches(t))return n;n=n.parentElement||n.parentNode}while(null!==n&&1===n.nodeType);return null});const HI={animation:!0,transitionTimerDelayMs:5};let to=(()=>{class t{constructor(){this.animation=HI.animation}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({factory:function(){return new t},token:t,providedIn:"root"}),t})();const I8=()=>{},{transitionTimerDelayMs:A8}=HI,i_=new Map,jr=(t,n,e,i)=>{let o=i.context||{};const c=i_.get(n);if(c)switch(i.runningTransition){case"continue":return Od;case"stop":t.run(()=>c.transition$.complete()),o=Object.assign(c.context,o),i_.delete(n)}const f=e(n,i.animation,o)||I8;if(!i.animation||"none"===window.getComputedStyle(n).transitionProperty)return t.run(()=>f()),Kt(void 0).pipe(function(t){return n=>new Bt(e=>n.subscribe(f=>t.run(()=>e.next(f)),f=>t.run(()=>e.error(f)),()=>t.run(()=>e.complete())))}(t));const y=new qn,w=new qn,T=y.pipe(function(...t){return n=>C0(n,Kt(...t))}(!0));i_.set(n,{transition$:y,complete:()=>{w.next(),w.complete()},context:o});const A=function(t){const{transitionDelay:n,transitionDuration:e}=window.getComputedStyle(t);return 1e3*(parseFloat(n)+parseFloat(e))}(n);return t.runOutsideAngular(()=>{const O=xo(n,"transitionend").pipe(cr(T),Ar(({target:j})=>j===n));(function(...t){if(1===t.length){if(!Me(t[0]))return t[0];t=t[0]}return Ps(t,void 0).lift(new l4)})(function(t=0,n,e){let i=-1;return LI(n)?i=Number(n)<1?1:Number(n):Vo(n)&&(e=n),Vo(e)||(e=OI),new Bt(o=>{const c=LI(t)?t:+t-e.now();return e.schedule(a4,c,{index:0,period:i,subscriber:o})})}(A+A8).pipe(cr(T)),O,w).pipe(cr(T)).subscribe(()=>{i_.delete(n),t.run(()=>{f(),y.next(),y.complete()})})}),y.asObservable()};let XI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),YI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),KI=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})(),tA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),nA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})();var Sn=(()=>(function(t){t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.ArrowLeft=37]="ArrowLeft",t[t.ArrowUp=38]="ArrowUp",t[t.ArrowRight=39]="ArrowRight",t[t.ArrowDown=40]="ArrowDown"}(Sn||(Sn={})),Sn))();"undefined"!=typeof navigator&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const aA=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function lA(t){const n=Array.from(t.querySelectorAll(aA)).filter(e=>-1!==e.tabIndex);return[n[0],n[n.length-1]]}new class{getAllStyles(n){return window.getComputedStyle(n)}getStyle(n,e){return this.getAllStyles(n)[e]}isStaticPositioned(n){return"static"===(this.getStyle(n,"position")||"static")}offsetParent(n){let e=n.offsetParent||document.documentElement;for(;e&&e!==document.documentElement&&this.isStaticPositioned(e);)e=e.offsetParent;return e||document.documentElement}position(n,e=!0){let i,o={width:0,height:0,top:0,bottom:0,left:0,right:0};if("fixed"===this.getStyle(n,"position"))i=n.getBoundingClientRect(),i={top:i.top,bottom:i.bottom,left:i.left,right:i.right,height:i.height,width:i.width};else{const c=this.offsetParent(n);i=this.offset(n,!1),c!==document.documentElement&&(o=this.offset(c,!1)),o.top+=c.clientTop,o.left+=c.clientLeft}return i.top-=o.top,i.bottom-=o.top,i.left-=o.left,i.right-=o.left,e&&(i.top=Math.round(i.top),i.bottom=Math.round(i.bottom),i.left=Math.round(i.left),i.right=Math.round(i.right)),i}offset(n,e=!0){const i=n.getBoundingClientRect(),o_top=window.pageYOffset-document.documentElement.clientTop,o_left=window.pageXOffset-document.documentElement.clientLeft;let c={height:i.height||n.offsetHeight,width:i.width||n.offsetWidth,top:i.top+o_top,bottom:i.bottom+o_top,left:i.left+o_left,right:i.right+o_left};return e&&(c.height=Math.round(c.height),c.width=Math.round(c.width),c.top=Math.round(c.top),c.bottom=Math.round(c.bottom),c.left=Math.round(c.left),c.right=Math.round(c.right)),c}positionElements(n,e,i,o){const[c="top",f="center"]=i.split("-"),y=o?this.offset(n,!1):this.position(n,!1),w=this.getAllStyles(e),T=parseFloat(w.marginTop),A=parseFloat(w.marginBottom),O=parseFloat(w.marginLeft),V=parseFloat(w.marginRight);let j=0,ee=0;switch(c){case"top":j=y.top-(e.offsetHeight+T+A);break;case"bottom":j=y.top+y.height;break;case"left":ee=y.left-(e.offsetWidth+O+V);break;case"right":ee=y.left+y.width}switch(f){case"top":j=y.top;break;case"bottom":j=y.top+y.height-e.offsetHeight;break;case"left":ee=y.left;break;case"right":ee=y.left+y.width-e.offsetWidth;break;case"center":"top"===c||"bottom"===c?ee=y.left+y.width/2-e.offsetWidth/2:j=y.top+y.height/2-e.offsetHeight/2}e.style.transform=`translate(${Math.round(ee)}px, ${Math.round(j)}px)`;const be=e.getBoundingClientRect(),me=document.documentElement,Ve=window.innerHeight||me.clientHeight,ke=window.innerWidth||me.clientWidth;return be.left>=0&&be.top>=0&&be.right<=ke&&be.bottom<=Ve}},new Date(1882,10,12),new Date(2174,10,25);let yA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks,wV]]}),t})(),wA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})(),CA=(()=>{class t{constructor(e){this._ngbConfig=e,this.backdrop=!0,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(e){this._animation=e}}return t.\u0275fac=function(e){return new(e||t)(je(to))},t.\u0275prov=ht({factory:function(){return new t(je(to))},token:t,providedIn:"root"}),t})();class qd{constructor(n,e,i){this.nodes=n,this.viewRef=e,this.componentRef=i}}const MU=()=>{};let DA=(()=>{class t{constructor(e){this._document=e}compensate(){const e=this._getWidth();return this._isPresent(e)?this._adjustBody(e):MU}_adjustBody(e){const i=this._document.body,o=i.style.paddingRight,c=parseFloat(window.getComputedStyle(i)["padding-right"]);return i.style["padding-right"]=`${c+e}px`,()=>i.style["padding-right"]=o}_isPresent(e){const i=this._document.body.getBoundingClientRect();return window.innerWidth-(i.left+i.right)>=e-.1*e}_getWidth(){const e=this._document.createElement("div");e.className="modal-scrollbar-measure";const i=this._document.body;i.appendChild(e);const o=e.getBoundingClientRect().width-e.clientWidth;return i.removeChild(e),o}}return t.\u0275fac=function(e){return new(e||t)(je(ci))},t.\u0275prov=ht({factory:function(){return new t(je(ci))},token:t,providedIn:"root"}),t})(),SU=(()=>{class t{constructor(e,i){this._el=e,this._zone=i}ngOnInit(){this._zone.onStable.asObservable().pipe(os(1)).subscribe(()=>{jr(this._zone,this._el.nativeElement,(e,i)=>{i&&Op(e),e.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return jr(this._zone,this._el.nativeElement,({classList:e})=>e.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return t.\u0275fac=function(e){return new(e||t)(ce(bn),ce(Bn))},t.\u0275cmp=si({type:t,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1050"],hostVars:6,hostBindings:function(e,i){2&e&&(gl("modal-backdrop"+(i.backdropClass?" "+i.backdropClass:"")),gn("show",!i.animation)("fade",i.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},decls:0,vars:0,template:function(e,i){},encapsulation:2}),t})();class EA{close(n){}dismiss(n){}}class IU{constructor(n,e,i,o){this._windowCmptRef=n,this._contentRef=e,this._backdropCmptRef=i,this._beforeDismiss=o,this._closed=new qn,this._dismissed=new qn,this._hidden=new qn,n.instance.dismissEvent.subscribe(c=>{this.dismiss(c)}),this.result=new Promise((c,f)=>{this._resolve=c,this._reject=f}),this.result.then(null,()=>{})}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(cr(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(cr(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const e=this._beforeDismiss();e&&e.then?e.then(i=>{!1!==i&&this._dismiss(n)},()=>{}):!1!==e&&this._dismiss(n)}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),e=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Kt(void 0);n.subscribe(()=>{const{nativeElement:i}=this._windowCmptRef.location;i.parentNode.removeChild(i),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),e.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:i}=this._backdropCmptRef.location;i.parentNode.removeChild(i),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),$0(n,e).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var Wd=(()=>(function(t){t[t.BACKDROP_CLICK=0]="BACKDROP_CLICK",t[t.ESC=1]="ESC"}(Wd||(Wd={})),Wd))();let AU=(()=>{class t{constructor(e,i,o){this._document=e,this._elRef=i,this._zone=o,this._closed$=new qn,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new kt,this.shown=new qn,this.hidden=new qn}dismiss(e){this.dismissEvent.emit(e)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(os(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:e}=this._elRef,i={animation:this.animation,runningTransition:"stop"},f=$0(jr(this._zone,e,()=>e.classList.remove("show"),i),jr(this._zone,this._dialogEl.nativeElement,()=>{},i));return f.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),f}_show(){const e={animation:this.animation,runningTransition:"continue"};$0(jr(this._zone,this._elRef.nativeElement,(c,f)=>{f&&Op(c),c.classList.add("show")},e),jr(this._zone,this._dialogEl.nativeElement,()=>{},e)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:e}=this._elRef;this._zone.runOutsideAngular(()=>{xo(e,"keydown").pipe(cr(this._closed$),Ar(o=>o.which===Sn.Escape)).subscribe(o=>{this.keyboard?requestAnimationFrame(()=>{o.defaultPrevented||this._zone.run(()=>this.dismiss(Wd.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let i=!1;xo(this._dialogEl.nativeElement,"mousedown").pipe(cr(this._closed$),vo(()=>i=!1),Ml(()=>xo(e,"mouseup").pipe(cr(this._closed$),os(1))),Ar(({target:o})=>e===o)).subscribe(()=>{i=!0}),xo(e,"click").pipe(cr(this._closed$)).subscribe(({target:o})=>{e===o&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!i&&this._zone.run(()=>this.dismiss(Wd.BACKDROP_CLICK))),i=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:e}=this._elRef;if(!e.contains(document.activeElement)){const i=e.querySelector("[ngbAutofocus]"),o=lA(e)[0];(i||o||e).focus()}}_restoreFocus(){const e=this._document.body,i=this._elWithFocus;let o;o=i&&i.focus&&e.contains(i)?i:e,this._zone.runOutsideAngular(()=>{setTimeout(()=>o.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&jr(this._zone,this._elRef.nativeElement,({classList:e})=>(e.add("modal-static"),()=>e.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return t.\u0275fac=function(e){return new(e||t)(ce(ci),ce(bn),ce(Bn))},t.\u0275cmp=si({type:t,selectors:[["ngb-modal-window"]],viewQuery:function(e,i){if(1&e&&Id(_6,7),2&e){let o;hi(o=function(t,n){return t[19].queries[n].queryList}(tt(),Ou()))&&(i._dialogEl=o.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(e,i){2&e&&(Yn("aria-modal",!0)("aria-labelledby",i.ariaLabelledBy)("aria-describedby",i.ariaDescribedBy),gl("modal d-block"+(i.windowClass?" "+i.windowClass:"")),gn("fade",i.animation))},inputs:{backdrop:"backdrop",keyboard:"keyboard",animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",centered:"centered",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},ngContentSelectors:Rp,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(e,i){1&e&&(function(t){const n=tt()[16][6];if(!n.projection){const i=n.projection=nc(t?t.length:1,null),o=i.slice();let c=n.child;for(;null!==c;){const f=t?mk(c,t):0;null!==f&&(o[f]?o[f].projectionNext=c:i[f]=c,o[f]=c),c=c.next}}}(),Ue(0,"div",0,1),Ue(2,"div",2),function(t,n=0,e){const i=tt(),o=An(),c=hc(o,20+t,16,null,e||null);null===c.projection&&(c.projection=n),yt(),64!=(64&c.flags)&&function(t,n,e){pd(n[11],0,n,e,Ng(t,e,n),q_(e.parent||n[6],e,n))}(o,i,c)}(3),$e(),$e()),2&e&&gl("modal-dialog"+(i.size?" modal-"+i.size:"")+(i.centered?" modal-dialog-centered":"")+(i.scrollable?" modal-dialog-scrollable":"")+(i.modalDialogClass?" "+i.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}"],encapsulation:2}),t})(),TA=(()=>{class t{constructor(e,i,o,c,f,y){this._applicationRef=e,this._injector=i,this._document=o,this._scrollBar=c,this._rendererFactory=f,this._ngZone=y,this._activeWindowCmptHasChanged=new qn,this._ariaHiddenValues=new Map,this._backdropAttributes=["animation","backdropClass"],this._modalRefs=[],this._windowAttributes=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","keyboard","scrollable","size","windowClass","modalDialogClass"],this._windowCmpts=[],this._activeInstances=new kt,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const w=this._windowCmpts[this._windowCmpts.length-1];((t,n,e,i=!1)=>{t.runOutsideAngular(()=>{const o=xo(n,"focusin").pipe(cr(e),Rt(c=>c.target));xo(n,"keydown").pipe(cr(e),Ar(c=>c.which===Sn.Tab),Wx(o)).subscribe(([c,f])=>{const[y,w]=lA(n);(f===y||f===n)&&c.shiftKey&&(w.focus(),c.preventDefault()),f===w&&!c.shiftKey&&(y.focus(),c.preventDefault())}),i&&xo(n,"click").pipe(cr(e),Wx(o),Rt(c=>c[1])).subscribe(c=>c.focus())})})(this._ngZone,w.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(w.location.nativeElement)}})}open(e,i,o,c){const f=c.container instanceof HTMLElement?c.container:vh(c.container)?this._document.querySelector(c.container):this._document.body,y=this._rendererFactory.createRenderer(null,null),w=this._scrollBar.compensate(),T=()=>{this._modalRefs.length||(y.removeClass(this._document.body,"modal-open"),this._revertAriaHidden())};if(!f)throw new Error(`The specified modal container "${c.container||"body"}" was not found in the DOM.`);const A=new EA,O=this._getContentRef(e,c.injector||i,o,A,c);let V=!1!==c.backdrop?this._attachBackdrop(e,f):void 0,j=this._attachWindowComponent(e,f,O),ee=new IU(j,O,V,c.beforeDismiss);return this._registerModalRef(ee),this._registerWindowCmpt(j),ee.result.then(w,w),ee.result.then(T,T),A.close=be=>{ee.close(be)},A.dismiss=be=>{ee.dismiss(be)},this._applyWindowOptions(j.instance,c),1===this._modalRefs.length&&y.addClass(this._document.body,"modal-open"),V&&V.instance&&(this._applyBackdropOptions(V.instance,c),V.changeDetectorRef.detectChanges()),j.changeDetectorRef.detectChanges(),ee}get activeInstances(){return this._activeInstances}dismissAll(e){this._modalRefs.forEach(i=>i.dismiss(e))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(e,i){let c=e.resolveComponentFactory(SU).create(this._injector);return this._applicationRef.attachView(c.hostView),i.appendChild(c.location.nativeElement),c}_attachWindowComponent(e,i,o){let f=e.resolveComponentFactory(AU).create(this._injector,o.nodes);return this._applicationRef.attachView(f.hostView),i.appendChild(f.location.nativeElement),f}_applyWindowOptions(e,i){this._windowAttributes.forEach(o=>{vh(i[o])&&(e[o]=i[o])})}_applyBackdropOptions(e,i){this._backdropAttributes.forEach(o=>{vh(i[o])&&(e[o]=i[o])})}_getContentRef(e,i,o,c,f){return o?o instanceof Ii?this._createFromTemplateRef(o,c):function(t){return"string"==typeof t}(o)?this._createFromString(o):this._createFromComponent(e,i,o,c,f):new qd([])}_createFromTemplateRef(e,i){const c=e.createEmbeddedView({$implicit:i,close(f){i.close(f)},dismiss(f){i.dismiss(f)}});return this._applicationRef.attachView(c),new qd([c.rootNodes],c)}_createFromString(e){const i=this._document.createTextNode(`${e}`);return new qd([[i]])}_createFromComponent(e,i,o,c,f){const y=e.resolveComponentFactory(o),w=Un.create({providers:[{provide:EA,useValue:c}],parent:i}),T=y.create(w),A=T.location.nativeElement;return f.scrollable&&A.classList.add("component-host-scrollable"),this._applicationRef.attachView(T.hostView),new qd([[A]],T.hostView,T)}_setAriaHidden(e){const i=e.parentElement;i&&e!==this._document.body&&(Array.from(i.children).forEach(o=>{o!==e&&"SCRIPT"!==o.nodeName&&(this._ariaHiddenValues.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}),this._setAriaHidden(i))}_revertAriaHidden(){this._ariaHiddenValues.forEach((e,i)=>{e?i.setAttribute("aria-hidden",e):i.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(e){const i=()=>{const o=this._modalRefs.indexOf(e);o>-1&&(this._modalRefs.splice(o,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(e),this._activeInstances.emit(this._modalRefs),e.result.then(i,i)}_registerWindowCmpt(e){this._windowCmpts.push(e),this._activeWindowCmptHasChanged.next(),e.onDestroy(()=>{const i=this._windowCmpts.indexOf(e);i>-1&&(this._windowCmpts.splice(i,1),this._activeWindowCmptHasChanged.next())})}}return t.\u0275fac=function(e){return new(e||t)(je(xl),je(Un),je(ci),je(DA),je(pp),je(Bn))},t.\u0275prov=ht({factory:function(){return new t(je(xl),je(ii),je(ci),je(DA),je(pp),je(Bn))},token:t,providedIn:"root"}),t})(),MA=(()=>{class t{constructor(e,i,o,c){this._moduleCFR=e,this._injector=i,this._modalStack=o,this._config=c}open(e,i={}){const o=Object.assign(Object.assign(Object.assign({},this._config),{animation:this._config.animation}),i);return this._modalStack.open(this._moduleCFR,this._injector,e,o)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(e){this._modalStack.dismissAll(e)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return t.\u0275fac=function(e){return new(e||t)(je(Js),je(Un),je(TA),je(CA))},t.\u0275prov=ht({factory:function(){return new t(je(Js),je(ii),je(TA),je(CA))},token:t,providedIn:"root"}),t})(),SA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:[MA]}),t})(),PA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),zA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),jA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),HA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),GA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),XA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),YA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})(),JA=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})();new Yt("live announcer delay",{providedIn:"root",factory:function(){return 100}});let e2=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[Ks]]}),t})();const f$=[XI,YI,KI,tA,nA,yA,wA,SA,PA,zA,jA,HA,GA,XA,YA,JA,e2];let p$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[f$,XI,YI,KI,tA,nA,yA,wA,SA,PA,zA,jA,HA,GA,XA,YA,JA,e2]}),t})();class t2{}class n2{}class mu{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(e=>{const i=e.indexOf(":");if(i>0){const o=e.slice(0,i),c=o.toLowerCase(),f=e.slice(i+1).trim();this.maybeSetNormalizedName(o,c),this.headers.has(c)?this.headers.get(c).push(f):this.headers.set(c,[f])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(e=>{let i=n[e];const o=e.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(o,i),this.maybeSetNormalizedName(e,o))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof mu?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new mu;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof mu?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let i=n.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(n.name,e);const o=("a"===n.op?this.headers.get(e):void 0)||[];o.push(...i),this.headers.set(e,o);break;case"d":const c=n.value;if(c){let f=this.headers.get(e);if(!f)return;f=f.filter(y=>-1===c.indexOf(y)),0===f.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,f)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class g${encodeKey(n){return i2(n)}encodeValue(n){return i2(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const _$=/%(\d[a-f0-9])/gi,y$={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function i2(t){return encodeURIComponent(t).replace(_$,(n,e)=>{var i;return null!==(i=y$[e])&&void 0!==i?i:n})}function r2(t){return`${t}`}class xh{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new g$,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const c=o.indexOf("="),[f,y]=-1==c?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,c)),n.decodeValue(o.slice(c+1))],w=e.get(f)||[];w.push(y),e.set(f,w)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const i=n.fromObject[e];this.map.set(e,Array.isArray(i)?i:[i])})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(i=>{const o=n[i];Array.isArray(o)?o.forEach(c=>{e.push({param:i,value:c,op:"a"})}):e.push({param:i,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new xh({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(r2(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let i=this.map.get(n.param)||[];const o=i.indexOf(r2(n.value));-1!==o&&i.splice(o,1),i.length>0?this.map.set(n.param,i):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class v${constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}keys(){return this.map.keys()}}function o2(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function s2(t){return"undefined"!=typeof Blob&&t instanceof Blob}function a2(t){return"undefined"!=typeof FormData&&t instanceof FormData}class c_{constructor(n,e,i,o){let c;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==i?i:null,c=o):c=i,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params)),this.headers||(this.headers=new mu),this.context||(this.context=new v$),this.params){const f=this.params.toString();if(0===f.length)this.urlWithParams=e;else{const y=e.indexOf("?");this.urlWithParams=e+(-1===y?"?":y<e.length-1?"&":"")+f}}else this.params=new xh,this.urlWithParams=e}serializeBody(){return null===this.body?null:o2(this.body)||s2(this.body)||a2(this.body)||function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof xh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||a2(this.body)?null:s2(this.body)?this.body.type||null:o2(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof xh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){var e;const i=n.method||this.method,o=n.url||this.url,c=n.responseType||this.responseType,f=void 0!==n.body?n.body:this.body,y=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,w=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let T=n.headers||this.headers,A=n.params||this.params;const O=null!==(e=n.context)&&void 0!==e?e:this.context;return void 0!==n.setHeaders&&(T=Object.keys(n.setHeaders).reduce((V,j)=>V.set(j,n.setHeaders[j]),T)),n.setParams&&(A=Object.keys(n.setParams).reduce((V,j)=>V.set(j,n.setParams[j]),A)),new c_(i,o,f,{params:A,headers:T,context:O,reportProgress:w,responseType:c,withCredentials:y})}}var kr=(()=>((kr=kr||{})[kr.Sent=0]="Sent",kr[kr.UploadProgress=1]="UploadProgress",kr[kr.ResponseHeader=2]="ResponseHeader",kr[kr.DownloadProgress=3]="DownloadProgress",kr[kr.Response=4]="Response",kr[kr.User=5]="User",kr))();class hw{constructor(n,e=200,i="OK"){this.headers=n.headers||new mu,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||i,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class dw extends hw{constructor(n={}){super(n),this.type=kr.ResponseHeader}clone(n={}){return new dw({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class tv extends hw{constructor(n={}){super(n),this.type=kr.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new tv({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class l2 extends hw{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function fw(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let c2=(()=>{class t{constructor(e){this.handler=e}request(e,i,o={}){let c;if(e instanceof c_)c=e;else{let w,T;w=o.headers instanceof mu?o.headers:new mu(o.headers),o.params&&(T=o.params instanceof xh?o.params:new xh({fromObject:o.params})),c=new c_(e,i,void 0!==o.body?o.body:null,{headers:w,context:o.context,params:T,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const f=Kt(c).pipe(Sp(w=>this.handler.handle(w)));if(e instanceof c_||"events"===o.observe)return f;const y=f.pipe(Ar(w=>w instanceof tv));switch(o.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return y.pipe(Rt(w=>{if(null!==w.body&&!(w.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return w.body}));case"blob":return y.pipe(Rt(w=>{if(null!==w.body&&!(w.body instanceof Blob))throw new Error("Response is not a Blob.");return w.body}));case"text":return y.pipe(Rt(w=>{if(null!==w.body&&"string"!=typeof w.body)throw new Error("Response is not a string.");return w.body}));case"json":default:return y.pipe(Rt(w=>w.body))}case"response":return y;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:(new xh).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,o={}){return this.request("PATCH",e,fw(o,i))}post(e,i,o={}){return this.request("POST",e,fw(o,i))}put(e,i,o={}){return this.request("PUT",e,fw(o,i))}}return t.\u0275fac=function(e){return new(e||t)(je(t2))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();class u2{constructor(n,e){this.next=n,this.interceptor=e}handle(n){return this.interceptor.intercept(n,this.next)}}const h2=new Yt("HTTP_INTERCEPTORS");let w$=(()=>{class t{intercept(e,i){return i.handle(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const C$=/^\)\]\}',?\n/;let d2=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Bt(i=>{const o=this.xhrFactory.build();if(o.open(e.method,e.urlWithParams),e.withCredentials&&(o.withCredentials=!0),e.headers.forEach((j,ee)=>o.setRequestHeader(j,ee.join(","))),e.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const j=e.detectContentTypeHeader();null!==j&&o.setRequestHeader("Content-Type",j)}if(e.responseType){const j=e.responseType.toLowerCase();o.responseType="json"!==j?j:"text"}const c=e.serializeBody();let f=null;const y=()=>{if(null!==f)return f;const j=1223===o.status?204:o.status,ee=o.statusText||"OK",be=new mu(o.getAllResponseHeaders()),me=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(o)||e.url;return f=new dw({headers:be,status:j,statusText:ee,url:me}),f},w=()=>{let{headers:j,status:ee,statusText:be,url:me}=y(),Ve=null;204!==ee&&(Ve=void 0===o.response?o.responseText:o.response),0===ee&&(ee=Ve?200:0);let ke=ee>=200&&ee<300;if("json"===e.responseType&&"string"==typeof Ve){const Dt=Ve;Ve=Ve.replace(C$,"");try{Ve=""!==Ve?JSON.parse(Ve):null}catch(Nt){Ve=Dt,ke&&(ke=!1,Ve={error:Nt,text:Ve})}}ke?(i.next(new tv({body:Ve,headers:j,status:ee,statusText:be,url:me||void 0})),i.complete()):i.error(new l2({error:Ve,headers:j,status:ee,statusText:be,url:me||void 0}))},T=j=>{const{url:ee}=y(),be=new l2({error:j,status:o.status||0,statusText:o.statusText||"Unknown Error",url:ee||void 0});i.error(be)};let A=!1;const O=j=>{A||(i.next(y()),A=!0);let ee={type:kr.DownloadProgress,loaded:j.loaded};j.lengthComputable&&(ee.total=j.total),"text"===e.responseType&&!!o.responseText&&(ee.partialText=o.responseText),i.next(ee)},V=j=>{let ee={type:kr.UploadProgress,loaded:j.loaded};j.lengthComputable&&(ee.total=j.total),i.next(ee)};return o.addEventListener("load",w),o.addEventListener("error",T),o.addEventListener("timeout",T),o.addEventListener("abort",T),e.reportProgress&&(o.addEventListener("progress",O),null!==c&&o.upload&&o.upload.addEventListener("progress",V)),o.send(c),i.next({type:kr.Sent}),()=>{o.removeEventListener("error",T),o.removeEventListener("abort",T),o.removeEventListener("load",w),o.removeEventListener("timeout",T),e.reportProgress&&(o.removeEventListener("progress",O),null!==c&&o.upload&&o.upload.removeEventListener("progress",V)),o.readyState!==o.DONE&&o.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(je(fM))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})();const pw=new Yt("XSRF_COOKIE_NAME"),gw=new Yt("XSRF_HEADER_NAME");class f2{}let E$=(()=>{class t{constructor(e,i,o){this.doc=e,this.platform=i,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=rM(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(je(ci),je(km),je(pw))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),mw=(()=>{class t{constructor(e,i){this.tokenService=e,this.headerName=i}intercept(e,i){const o=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||o.startsWith("http://")||o.startsWith("https://"))return i.handle(e);const c=this.tokenService.getToken();return null!==c&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,c)})),i.handle(e)}}return t.\u0275fac=function(e){return new(e||t)(je(f2),je(gw))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),T$=(()=>{class t{constructor(e,i){this.backend=e,this.injector=i,this.chain=null}handle(e){if(null===this.chain){const i=this.injector.get(h2,[]);this.chain=i.reduceRight((o,c)=>new u2(o,c),this.backend)}return this.chain.handle(e)}}return t.\u0275fac=function(e){return new(e||t)(je(n2),je(Un))},t.\u0275prov=ht({token:t,factory:t.\u0275fac}),t})(),M$=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:mw,useClass:w$}]}}static withOptions(e={}){return{ngModule:t,providers:[e.cookieName?{provide:pw,useValue:e.cookieName}:[],e.headerName?{provide:gw,useValue:e.headerName}:[]]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:[mw,{provide:h2,useExisting:mw,multi:!0},{provide:f2,useClass:E$},{provide:pw,useValue:"XSRF-TOKEN"},{provide:gw,useValue:"X-XSRF-TOKEN"}]}),t})(),S$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({providers:[c2,{provide:t2,useClass:T$},d2,{provide:n2,useExisting:d2}],imports:[[M$.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();var nv=Ie(26);const I$=nv.Manager,A$=nv.Socket,_w=nv;class yw{constructor(n){this.config=n,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===n&&(n=this.emptyConfig),this.ioSocket=(_w||Le)(n.url,n.options)}of(n){this.ioSocket.of(n)}on(n,e){this.ioSocket.on(n,e)}once(n,e){this.ioSocket.once(n,e)}connect(){return this.ioSocket.connect()}disconnect(n){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(n,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(n,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(n){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(n){return this.subscribersCounter[n]||(this.subscribersCounter[n]=0),this.subscribersCounter[n]++,this.eventObservables$[n]||(this.eventObservables$[n]=new Bt(e=>{const i=o=>{e.next(o)};return this.ioSocket.on(n,i),()=>{this.subscribersCounter[n]--,0===this.subscribersCounter[n]&&(this.ioSocket.removeListener(n,i),delete this.eventObservables$[n])}}).pipe(us())),this.eventObservables$[n]}fromOneTimeEvent(n){return new Promise(e=>this.once(n,e))}}function k$(t){return new yw(t)}const p2=new Yt("__SOCKET_IO_CONFIG__");let P$=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:p2,useValue:e},{provide:yw,useFactory:k$,deps:[p2]}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({}),t})(),g2=(()=>{class t{constructor(e){this.socket=e,this.socketStatus=!1,this.usuario=null,this.checkStatus()}checkStatus(){this.socket.on("connect",()=>{console.log("Conectado al servidor"),this.socketStatus=!0}),this.socket.on("disconnect",()=>{console.log("Desconectado del servidor"),this.socketStatus=!1})}emit(e,i,o){console.log("Emitiendo",e),this.socket.emit(e,i,o)}listen(e){return this.socket.fromEvent(e)}}return t.\u0275fac=function(e){return new(e||t)(je(yw))},t.\u0275prov=ht({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function N$(t,n){if(1&t){const e=Fi();Ue(0,"div",6),Ue(1,"h4",7),Ln(2,"Bienvenido A Nuestro mapa"),$e(),Ue(3,"button",8),At("click",function(){return mn(e).$implicit.dismiss("Cross click")}),Ue(4,"span",9),Ln(5,"\xd7"),$e(),$e(),$e(),Ue(6,"div",10),Ue(7,"div",11),At("click",function(){return mn(e),pt().openalert(0)}),Ue(8,"div",12),Ln(9," Cliente "),$e(),$e(),Ue(10,"div",11),At("click",function(){return mn(e),pt().openalert(1)}),Ue(11,"div",13),Ln(12," admin "),$e(),$e(),$e(),Ue(13,"div",14),Ue(14,"button",15),At("click",function(){return mn(e).$implicit.close("Save click")}),Ln(15,"Ok"),$e(),$e()}}const R$=[{path:"maps",component:(()=>{class t{constructor(e,i,o){this.http=e,this.wsService=i,this.modalService=o,this.latitude=null,this.longitude=null,this.putMarker=!0,this.closeResult="",this.lugares={},this.markersMapbox={}}ngOnInit(){document.getElementsByClassName("btn")[0].click(),this.http.get("https://web-socket-server-mapbox.herokuapp.com/mapa").subscribe(i=>{console.log(i),this.lugares=i,this.crearMapa()}),this.escucharSockets()}open(e){this.modalService.open(e,{ariaLabelledBy:"modal-basic-title"}).result.then(i=>{this.closeResult=`Closed with: ${i}`},i=>{this.closeResult=`Dismissed ${this.getDismissReason(i)}`,alert(this.closeResult)})}getDismissReason(e){return e===Wd.ESC?"by pressing ESC":e===Wd.BACKDROP_CLICK?"by clicking on a backdrop":`with: ${e}`}openalert(e){this.putMarker=0==e,document.getElementsByClassName("btn")[1].click()}escucharSockets(){this.wsService.listen("id-usuario").subscribe(e=>{console.log(e),this.crearMarcador(e)}),this.wsService.listen("marcador-nuevo").subscribe(e=>{console.log(e),this.agregarMarcador(e)}),this.wsService.listen("marcador-mover").subscribe(e=>{console.log(e),this.markersMapbox[e.id].setLngLat([e.lng,e.lat])}),this.wsService.listen("marcador-borrar").subscribe(e=>{this.markersMapbox[e].remove(),delete this.markersMapbox[e]})}crearMapa(){t_.accessToken="pk.eyJ1IjoiamhvbnNiZyIsImEiOiJja3Nhcm9xdTUxNWdlMnNuenJtNDA3ODB3In0.O7rhebA6nNSikLhKue4m4g",this.mapa=new t_.Map({container:"mapa",style:"mapbox://styles/mapbox/streets-v11",center:[-74.06165854470065,4.687273776841303],zoom:15.8});for(const[e,i]of Object.entries(this.lugares))this.agregarMarcador(i);this.mapa.addControl(new t_.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}))}agregarMarcador(e,i){const o=document.createElement("h2");o.innerText=e.nombre;const c=document.createElement("button");c.innerText="Borrar";const f=document.createElement("div");f.append(o,c);const y=new t_.Popup({offset:25,closeOnClick:!1}).setDOMContent(f),w=new t_.Marker({draggable:!1,color:e.color}).setLngLat([e.lng,e.lat]).setPopup(y).addTo(this.mapa);navigator.geolocation.watchPosition(T=>{if(e.id==i&&1==this.putMarker){var A=T.coords.latitude,O=T.coords.longitude;const ee={id:e.id,lng:O,lat:A,nombre:e.nombre,color:e.color};this.markersMapbox[e.id].setLngLat([O,A]),console.log(ee),this.wsService.emit("marcador-mover",ee);var V=document.getElementById("centrarMapa");"1"==(null==V?void 0:V.getAttribute("status"))&&(this.mapa.setCenter([O,A]),this.mapa.setZoom(15.8))}},T=>{console.log(T)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}),c.addEventListener("click",()=>{w.remove(),this.wsService.emit("marcador-borrar",e.id)}),this.markersMapbox[e.id]=w}crearMarcador(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{var o=i.coords.latitude,c=i.coords.longitude;const f={id:e,lng:c,lat:o,nombre:"Sin nombre",color:"#"+Math.floor(16777215*Math.random()).toString(16)};this.mapa.setCenter([c,o]),this.mapa.setZoom(15.8),this.agregarMarcador(f,e),this.wsService.emit("marcador-nuevo",f)}):console.log("Geolocation is not supported by your browser")}centrarMapa(){var e=document.getElementById("centrarMapa"),i=null==e?void 0:e.getAttribute("status");console.log(i),"0"==i?(null==e||e.setAttribute("status","1"),document.getElementById("imgCentrarMapa").style.filter="grayscale(0%)"):(null==e||e.setAttribute("status","0"),document.getElementById("imgCentrarMapa").style.filter="grayscale(80%)")}}return t.\u0275fac=function(e){return new(e||t)(ce(c2),ce(g2),ce(MA))},t.\u0275cmp=si({type:t,selectors:[["app-maps"]],inputs:{latitude:"latitude",longitude:"longitude"},decls:9,vars:0,consts:[["role","main",1,"content"],["id","centrarMapa","status","0",3,"click"],["id","imgCentrarMapa","src","https://img.icons8.com/office/80/000000/worldwide-location--v2.png"],["id","mapa"],["hidden","",1,"btn","btn-lg","btn-outline-primary",3,"click"],["mymodal",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"card-container",3,"click"],["target","_blank",1,"card","btn-success"],["target","_blank",1,"card","btn-primary"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-dark",3,"click"]],template:function(e,i){if(1&e){const o=Fi();Ue(0,"div",0),Ue(1,"button",1),At("click",function(){return i.centrarMapa()}),Ue(2,"figure"),ei(3,"img",2),$e(),$e(),ei(4,"div",3),$e(),Ue(5,"button",4),At("click",function(){mn(o);const f=function(t){return function(t,n){return t[n]}(It.lFrame.contextLView,20+t)}(8);return i.open(f)}),Ln(6,"Open My Modal"),$e(),function(t,n,e,i,o,c,f,y){const w=tt(),T=An(),A=t+20,O=T.firstCreatePass?function(t,n,e,i,o,c,f,y,w){const T=n.consts,A=hc(n,t,4,f||null,Vs(T,y));P(n,e,A,Vs(T,w)),qc(n,A);const O=A.tViews=bd(2,A,i,o,c,n.directiveRegistry,n.pipeRegistry,null,n.schemas,T);return null!==n.queries&&(n.queries.template(n,A),O.queries=n.queries.embeddedTView(A)),A}(A,T,w,n,e,i,o,c,f):T.data[A];qo(O,!1);const V=w[11].createComment("");dd(T,w,V,O),Yr(V,w),St(w,w[A]=at(V,w,V,O)),Oc(O)&&Zf(T,w,O),null!=f&&ah(w,O,y)}(7,N$,16,0,"ng-template",null,5,Kr)}},styles:["#centrarMapa[_ngcontent-%COMP%]{position:fixed;padding:0;top:90px;right:30px;z-index:999;height:30px;width:30px;background-color:#fff;border:0px;border-radius:5px;outline:3px solid #F4F4F4}button[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]{margin:0;height:30px;width:30px}button[_ngcontent-%COMP%]   figure[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:30px;width:30px;filter:grayscale(80%)}a[_ngcontent-%COMP%]{position:fixed}#mapa[_ngcontent-%COMP%]{width:100%;height:100%;background-color:gray}.content[_ngcontent-%COMP%]{display:flex;margin:82px auto 32px;padding:0 16px;width:90% px;height:80vh;flex-direction:column;align-items:center}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(:last-child){margin-right:0}.card.card-small[_ngcontent-%COMP%]{height:16px;width:168px}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card){cursor:pointer}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover{transform:translateY(-3px);box-shadow:0 4px 17px #00000059}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover   .material-icons[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#696767}.card-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;margin-top:16px}.card[_ngcontent-%COMP%]{all:unset;border-radius:4px;border:1px solid #eee;background-color:#fafafa;margin:0 8px 16px;padding:16px;display:flex;flex-direction:row;justify-content:center;align-items:center;transition:all .2s ease-in-out;line-height:24px}"]}),t})()},{path:"",component:(()=>{class t{constructor(e){this.router=e,this.title="traquingApp",this.miformulario=new b0({username:new Fd("",[Tp.required,Tp.email]),password:new Fd("",[Tp.required,Tp.minLength(6)]),check:new Fd("",[Tp.required,Tp.requiredTrue])})}ngOnInit(){this.loadAPI()}loadAPI(){this.miformulario.patchValue({username:"maserati92@hotmail.com",password:"1234567",check:!0})}send(){this.router.navigateByUrl("/maps"),console.log(this.miformulario.value.password),console.log(this.miformulario.value.username),console.log(this.miformulario.value.check)}}return t.\u0275fac=function(e){return new(e||t)(ce(ss))},t.\u0275cmp=si({type:t,selectors:[["app-login"]],decls:18,vars:2,consts:[["ng-init","ngOnInit()","role","main",1,"content"],[1,"card-container"],["target","_blank",1,"card"],[3,"formGroup","submit"],[1,"form-group"],["for","exampleInputEmail1"],["formControlName","username","type","text","id","Email1","aria-describedby","emailHelp","placeholder","Enter User Name",1,"form-control"],["for","exampleInputPassword1"],["formControlName","password","type","password","id","Password","placeholder","Password",1,"form-control"],[1,"form-group","form-check"],["type","checkbox","formControlName","check","id","exampleCheck1",1,"form-check-input"],["for","exampleCheck1",1,"form-check-label"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(e,i){1&e&&(Ue(0,"div",0),Ue(1,"div",1),Ue(2,"div",2),Ue(3,"form",3),At("submit",function(){return i.send()}),Ue(4,"div",4),Ue(5,"label",5),Ln(6,"Enter you User Name"),$e(),ei(7,"input",6),$e(),Ue(8,"div",4),Ue(9,"label",7),Ln(10,"Password"),$e(),ei(11,"input",8),$e(),Ue(12,"div",9),ei(13,"input",10),Ue(14,"label",11),Ln(15,"Terminos y Condiciones"),$e(),$e(),Ue(16,"button",12),Ln(17,"Submit"),$e(),$e(),$e(),$e(),$e()),2&e&&(ot(3),rt("formGroup",i.miformulario),ot(13),rt("disabled",i.miformulario.invalid))},directives:[aS,JM,x0,h0,YM,mx,Qb],styles:['@charset "UTF-8";.example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.example-full-width[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{margin:8px 0}p[_ngcontent-%COMP%]{margin:0}.spacer[_ngcontent-%COMP%]{flex:1}.toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:600}.toolbar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:0 16px}.toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%]{height:40px;margin:0 8px}.toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%]{height:40px;margin:0 16px}.toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%]:hover, .toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%]:hover{opacity:.8}.content[_ngcontent-%COMP%]{display:flex;margin:82px auto 32px;padding:0 16px;max-width:960px;flex-direction:column;align-items:center}svg.material-icons[_ngcontent-%COMP%]{height:24px;width:auto}svg.material-icons[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}.card[_ngcontent-%COMP%]   svg.material-icons[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#888}.card-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;margin-top:16px}.card[_ngcontent-%COMP%]{all:unset;border-radius:4px;border:1px solid #eee;background-color:#fafafa;margin:0 8px 16px;padding:16px;display:flex;flex-direction:row;justify-content:center;align-items:center;transition:all .2s ease-in-out;line-height:24px}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(:last-child){margin-right:0}.card.card-small[_ngcontent-%COMP%]{height:16px;width:168px}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card){cursor:pointer}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover{transform:translateY(-3px);box-shadow:0 4px 17px #00000059}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover   .material-icons[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#696767}.card.highlight-card[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;font-weight:600;border:none;width:auto;min-width:30%;position:relative}.card.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:60px}svg#rocket[_ngcontent-%COMP%]{width:80px;position:absolute;left:-10px;top:-24px}svg#rocket-smoke[_ngcontent-%COMP%]{height:calc(100vh - 95px);position:absolute;top:10px;right:180px;z-index:-10}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited, a[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:none}a[_ngcontent-%COMP%]:hover{color:#125699}.terminal[_ngcontent-%COMP%]{position:relative;width:80%;max-width:600px;border-radius:6px;padding-top:45px;margin-top:8px;overflow:hidden;background-color:#0f0f10}.terminal[_ngcontent-%COMP%]:before{content:"\\2022\\2022\\2022";position:absolute;top:0;left:0;height:4px;background:#3a3a3a;color:#c2c3c4;width:100%;font-size:2rem;line-height:0;padding:14px 0;text-indent:4px}.terminal[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;color:#fff;padding:0 1rem 1rem;margin:0}.circle-link[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:40px;margin:8px;background-color:#fff;border:1px solid #eeeeee;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d;transition:1s ease-out}.circle-link[_ngcontent-%COMP%]:hover{transform:translateY(-.25rem);box-shadow:0 3px 15px #0003}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}.github-star-badge[_ngcontent-%COMP%]{color:#24292e;display:flex;align-items:center;font-size:12px;padding:3px 10px;border:1px solid rgba(27,31,35,.2);border-radius:3px;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%);margin-left:4px;font-weight:600}.github-star-badge[_ngcontent-%COMP%]:hover{background-image:linear-gradient(-180deg,#f0f3f6,#e6ebf1 90%);border-color:#1b1f2359;background-position:-.5em}.github-star-badge[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{height:16px;width:16px;margin-right:4px}svg#clouds[_ngcontent-%COMP%]{position:fixed;bottom:-160px;left:-230px;z-index:-10;width:1920px}@media screen and (max-width: 767px){.card-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.circle-link), .terminal[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]:not(.highlight-card){height:16px;margin:8px 0}.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:72px}svg#rocket-smoke[_ngcontent-%COMP%]{right:120px;transform:rotate(-5deg)}}@media screen and (max-width: 575px){svg#rocket-smoke[_ngcontent-%COMP%]{display:none;visibility:hidden}}']}),t})()}];let F$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t}),t.\u0275inj=Pt({imports:[[kI.forRoot(R$)],kI]}),t})(),m2=(()=>{class t{constructor(){}getPosition(){return new Promise((e,i)=>{setInterval(()=>{navigator.geolocation.getCurrentPosition(o=>{e({lng:o.coords.longitude,lat:o.coords.latitude})},o=>{i(o)})},1e3)})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=ht({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),O$=(()=>{class t{constructor(e){this.locationService=e,this.title="geolocation",this.latitudeEvent=new kt,this.longitudeEvent=new kt,this.latitude=0,this.longitude=0}ngOnInit(){setInterval(()=>{this.getLocation()},1e3)}getLocation(){this.locationService.getPosition().then(e=>{this.latitudeEvent.emit(e.lat),this.longitudeEvent.emit(e.lng),this.latitude=e.lat,this.longitude=e.lng,console.log("coordenadas: "+e.lat+" - "+e.lng)})}}return t.\u0275fac=function(e){return new(e||t)(ce(m2))},t.\u0275cmp=si({type:t,selectors:[["app-get-location"]],outputs:{latitudeEvent:"latitudeEvent",longitudeEvent:"longitudeEvent"},decls:3,vars:2,consts:[[2,"text-align","center"]],template:function(e,i){1&e&&(Ue(0,"div",0),Ue(1,"h1"),Ln(2),$e(),$e()),2&e&&(ot(2),C1("",i.latitude,",",i.longitude,""))},styles:[""]}),t})(),L$=(()=>{class t{constructor(e){this.wsService=e,this.title="mapbox",this.latitude=null,this.longitude=null}ngOnInit(){}positionCapture(e,i){!0===i?this.latitude=e:this.longitude=e}}return t.\u0275fac=function(e){return new(e||t)(ce(g2))},t.\u0275cmp=si({type:t,selectors:[["app-root"]],decls:21,vars:0,consts:[["role","banner",1,"toolbar"],["width","90","alt","Angular Logo","src","https://i1.wp.com/soytecno.com/wp-content/uploads/2017/07/area-01-e1501620926535.png?fit=1200%2C809&ssl=1"],[2,"font-size","x-large"],[1,"spacer"],["aria-label","Angular on twitter","target","_blank","rel","noopener","href","https://twitter.com/angular","title","Twitter"],["id","twitter-logo","height","24","data-name","Logo","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 400 400"],["width","400","height","400","fill","none"],["d","M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23","fill","#fff"],["aria-label","Angular on YouTube","target","_blank","rel","noopener","href","https://youtube.com/angular","title","YouTube"],["id","youtube-logo","height","24","width","24","data-name","Logo","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","#fff"],["d","M0 0h24v24H0V0z","fill","none"],["d","M21.58 7.19c-.23-.86-.91-1.54-1.77-1.77C18.25 5 12 5 12 5s-6.25 0-7.81.42c-.86.23-1.54.91-1.77 1.77C2 8.75 2 12 2 12s0 3.25.42 4.81c.23.86.91 1.54 1.77 1.77C5.75 19 12 19 12 19s6.25 0 7.81-.42c.86-.23 1.54-.91 1.77-1.77C22 15.25 22 12 22 12s0-3.25-.42-4.81zM10 15V9l5.2 3-5.2 3z"],["hidden","",3,"latitudeEvent","longitudeEvent"],["id","clouds","xmlns","http://www.w3.org/2000/svg","width","2611.084","height","485.677","viewBox","0 0 2611.084 485.677"],["id","Path_39","data-name","Path 39","d","M2379.709,863.793c10-93-77-171-168-149-52-114-225-105-264,15-75,3-140,59-152,133-30,2.83-66.725,9.829-93.5,26.25-26.771-16.421-63.5-23.42-93.5-26.25-12-74-77-130-152-133-39-120-212-129-264-15-54.084-13.075-106.753,9.173-138.488,48.9-31.734-39.726-84.4-61.974-138.487-48.9-52-114-225-105-264,15a162.027,162.027,0,0,0-103.147,43.044c-30.633-45.365-87.1-72.091-145.206-58.044-52-114-225-105-264,15-75,3-140,59-152,133-53,5-127,23-130,83-2,42,35,72,70,86,49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33,61.112,8.015,113.854-5.72,150.492-29.764a165.62,165.62,0,0,0,110.861-3.236c47,94,178,113,251,33,31.385,4.116,60.563,2.495,86.487-3.311,25.924,5.806,55.1,7.427,86.488,3.311,73,80,204,61,251-33a165.625,165.625,0,0,0,120,0c51,13,108,15,157-5a147.188,147.188,0,0,0,33.5-18.694,147.217,147.217,0,0,0,33.5,18.694c49,20,106,18,157,5a165.625,165.625,0,0,0,120,0c47,94,178,113,251,33C2446.709,1093.793,2554.709,922.793,2379.709,863.793Z","transform","translate(142.69 -634.312)","fill","#eee"]],template:function(e,i){1&e&&(Ue(0,"div",0),ei(1,"img",1),Ue(2,"span",2),Ln(3,"LOGIN MAPS"),$e(),ei(4,"div",3),Ue(5,"a",4),Zo(),Ue(6,"svg",5),ei(7,"rect",6),ei(8,"path",7),$e(),$e(),$s(),Ue(9,"a",8),Zo(),Ue(10,"svg",9),ei(11,"path",10),ei(12,"path",11),$e(),$e(),$e(),$s(),Ue(13,"app-get-location",12),At("latitudeEvent",function(c){return i.positionCapture(c,!0)})("longitudeEvent",function(c){return i.positionCapture(c,!1)}),$e(),ei(14,"router-outlet"),Ue(15,"footer"),Ln(16," Jhon bohorquez\n"),$e(),Zo(),Ue(17,"svg",13),Ue(18,"title"),Ln(19,"Gray Clouds Background"),$e(),ei(20,"path",14),$e())},directives:[O$,jx],styles:['@charset "UTF-8";.example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.example-full-width[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{margin:8px 0}p[_ngcontent-%COMP%]{margin:0}.spacer[_ngcontent-%COMP%]{flex:1}.toolbar[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:600}.toolbar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:0 16px}.toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%]{height:40px;margin:0 8px}.toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%]{height:40px;margin:0 16px}.toolbar[_ngcontent-%COMP%]   #twitter-logo[_ngcontent-%COMP%]:hover, .toolbar[_ngcontent-%COMP%]   #youtube-logo[_ngcontent-%COMP%]:hover{opacity:.8}.content[_ngcontent-%COMP%]{display:flex;margin:82px auto 32px;padding:0 16px;max-width:960px;flex-direction:column;align-items:center}svg.material-icons[_ngcontent-%COMP%]{height:24px;width:auto}svg.material-icons[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}.card[_ngcontent-%COMP%]   svg.material-icons[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#888}.card-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;margin-top:16px}.card[_ngcontent-%COMP%]{all:unset;border-radius:4px;border:1px solid #eee;background-color:#fafafa;margin:0 8px 16px;padding:16px;display:flex;flex-direction:row;justify-content:center;align-items:center;transition:all .2s ease-in-out;line-height:24px}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(:last-child){margin-right:0}.card.card-small[_ngcontent-%COMP%]{height:16px;width:168px}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card){cursor:pointer}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover{transform:translateY(-3px);box-shadow:0 4px 17px #00000059}.card-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:not(.highlight-card):hover   .material-icons[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#696767}.card.highlight-card[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;font-weight:600;border:none;width:auto;min-width:30%;position:relative}.card.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:60px}svg#rocket[_ngcontent-%COMP%]{width:80px;position:absolute;left:-10px;top:-24px}svg#rocket-smoke[_ngcontent-%COMP%]{height:calc(100vh - 95px);position:absolute;top:10px;right:180px;z-index:-10}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited, a[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:none}a[_ngcontent-%COMP%]:hover{color:#125699}.terminal[_ngcontent-%COMP%]{position:relative;width:80%;max-width:600px;border-radius:6px;padding-top:45px;margin-top:8px;overflow:hidden;background-color:#0f0f10}.terminal[_ngcontent-%COMP%]:before{content:"\\2022\\2022\\2022";position:absolute;top:0;left:0;height:4px;background:#3a3a3a;color:#c2c3c4;width:100%;font-size:2rem;line-height:0;padding:14px 0;text-indent:4px}.terminal[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;color:#fff;padding:0 1rem 1rem;margin:0}.circle-link[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:40px;margin:8px;background-color:#fff;border:1px solid #eeeeee;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 1px 3px #0000001f,0 1px 2px #0000003d;transition:1s ease-out}.circle-link[_ngcontent-%COMP%]:hover{transform:translateY(-.25rem);box-shadow:0 3px 15px #0003}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}.github-star-badge[_ngcontent-%COMP%]{color:#24292e;display:flex;align-items:center;font-size:12px;padding:3px 10px;border:1px solid rgba(27,31,35,.2);border-radius:3px;background-image:linear-gradient(-180deg,#fafbfc,#eff3f6 90%);margin-left:4px;font-weight:600}.github-star-badge[_ngcontent-%COMP%]:hover{background-image:linear-gradient(-180deg,#f0f3f6,#e6ebf1 90%);border-color:#1b1f2359;background-position:-.5em}.github-star-badge[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{height:16px;width:16px;margin-right:4px}svg#clouds[_ngcontent-%COMP%]{position:fixed;bottom:-160px;left:-230px;z-index:-10;width:1920px}@media screen and (max-width: 767px){.card-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.circle-link), .terminal[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]:not(.highlight-card){height:16px;margin:8px 0}.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:72px}svg#rocket-smoke[_ngcontent-%COMP%]{right:120px;transform:rotate(-5deg)}}@media screen and (max-width: 575px){svg#rocket-smoke[_ngcontent-%COMP%]{display:none;visibility:hidden}}']}),t})();const _2_socketConfig={url:"https://web-socket-server-mapbox.herokuapp.com/",options:{}};let B$=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Dn({type:t,bootstrap:[L$]}),t.\u0275inj=Pt({providers:[m2],imports:[[EB,F$,CV,S$,P$.forRoot(_2_socketConfig),p$]]}),t})();(function(){if(lT)throw new Error("Cannot enable prod mode after platform setup.");aT=!1})(),CB().bootstrapModule(B$).catch(t=>console.error(t))},26:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.io=Re.Socket=Re.Manager=Re.protocol=void 0;const Le=Ie(390),Je=Ie(300),qe=Ie(36)("socket.io-client");Et.exports=Re=Pe;const d=Re.managers={};function Pe(ne,ye){"object"==typeof ne&&(ye=ne,ne=void 0);const K=(0,Le.url)(ne,(ye=ye||{}).path||"/socket.io"),ae=K.source,Ne=K.id;let jt;return ye.forceNew||ye["force new connection"]||!1===ye.multiplex||d[Ne]&&K.path in d[Ne].nsps?(qe("ignoring socket cache for %s",ae),jt=new Je.Manager(ae,ye)):(d[Ne]||(qe("new io instance for %s",ae),d[Ne]=new Je.Manager(ae,ye)),jt=d[Ne]),K.query&&!ye.query&&(ye.query=K.queryKey),jt.socket(K.path,ye)}Re.io=Pe;var Be=Ie(712);Object.defineProperty(Re,"protocol",{enumerable:!0,get:function(){return Be.protocol}}),Re.connect=Pe;var Me=Ie(300);Object.defineProperty(Re,"Manager",{enumerable:!0,get:function(){return Me.Manager}});var q=Ie(857);Object.defineProperty(Re,"Socket",{enumerable:!0,get:function(){return q.Socket}}),Re.default=Pe},300:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.Manager=void 0;const Le=Ie(338),Je=Ie(118),qe=Ie(857),d=Ie(712),Pe=Ie(18),Be=Ie(591),Me=Ie(918),q=Ie(36)("socket.io-client:manager");Re.Manager=class extends Me.StrictEventEmitter{constructor(K,ae){var Ne;super(),this.nsps={},this.subs=[],K&&"object"==typeof K&&(ae=K,K=void 0),(ae=ae||{}).path=ae.path||"/socket.io",this.opts=ae,(0,Je.installTimerFunctions)(this,ae),this.reconnection(!1!==ae.reconnection),this.reconnectionAttempts(ae.reconnectionAttempts||1/0),this.reconnectionDelay(ae.reconnectionDelay||1e3),this.reconnectionDelayMax(ae.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(Ne=ae.randomizationFactor)&&void 0!==Ne?Ne:.5),this.backoff=new Be({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==ae.timeout?2e4:ae.timeout),this._readyState="closed",this.uri=K;const nt=ae.parser||d;this.encoder=new nt.Encoder,this.decoder=new nt.Decoder,this._autoConnect=!1!==ae.autoConnect,this._autoConnect&&this.open()}reconnection(K){return arguments.length?(this._reconnection=!!K,this):this._reconnection}reconnectionAttempts(K){return void 0===K?this._reconnectionAttempts:(this._reconnectionAttempts=K,this)}reconnectionDelay(K){var ae;return void 0===K?this._reconnectionDelay:(this._reconnectionDelay=K,null===(ae=this.backoff)||void 0===ae||ae.setMin(K),this)}randomizationFactor(K){var ae;return void 0===K?this._randomizationFactor:(this._randomizationFactor=K,null===(ae=this.backoff)||void 0===ae||ae.setJitter(K),this)}reconnectionDelayMax(K){var ae;return void 0===K?this._reconnectionDelayMax:(this._reconnectionDelayMax=K,null===(ae=this.backoff)||void 0===ae||ae.setMax(K),this)}timeout(K){return arguments.length?(this._timeout=K,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(K){if(q("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;q("opening %s",this.uri),this.engine=Le(this.uri,this.opts);const ae=this.engine,Ne=this;this._readyState="opening",this.skipReconnect=!1;const nt=(0,Pe.on)(ae,"open",function(){Ne.onopen(),K&&K()}),ct=(0,Pe.on)(ae,"error",xt=>{q("error"),Ne.cleanup(),Ne._readyState="closed",this.emitReserved("error",xt),K?K(xt):Ne.maybeReconnectOnOpen()});if(!1!==this._timeout){const xt=this._timeout;q("connect attempt will timeout after %d",xt),0===xt&&nt();const jt=this.setTimeoutFn(()=>{q("connect attempt timed out after %d",xt),nt(),ae.close(),ae.emit("error",new Error("timeout"))},xt);this.opts.autoUnref&&jt.unref(),this.subs.push(function(){clearTimeout(jt)})}return this.subs.push(nt),this.subs.push(ct),this}connect(K){return this.open(K)}onopen(){q("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const K=this.engine;this.subs.push((0,Pe.on)(K,"ping",this.onping.bind(this)),(0,Pe.on)(K,"data",this.ondata.bind(this)),(0,Pe.on)(K,"error",this.onerror.bind(this)),(0,Pe.on)(K,"close",this.onclose.bind(this)),(0,Pe.on)(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(K){this.decoder.add(K)}ondecoded(K){this.emitReserved("packet",K)}onerror(K){q("error",K),this.emitReserved("error",K)}socket(K,ae){let Ne=this.nsps[K];return Ne||(Ne=new qe.Socket(this,K,ae),this.nsps[K]=Ne),Ne}_destroy(K){const ae=Object.keys(this.nsps);for(const Ne of ae)if(this.nsps[Ne].active)return void q("socket %s is still active, skipping close",Ne);this._close()}_packet(K){q("writing packet %j",K);const ae=this.encoder.encode(K);for(let Ne=0;Ne<ae.length;Ne++)this.engine.write(ae[Ne],K.options)}cleanup(){q("cleanup"),this.subs.forEach(K=>K()),this.subs.length=0,this.decoder.destroy()}_close(){q("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(K){q("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",K),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const K=this;if(this.backoff.attempts>=this._reconnectionAttempts)q("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const ae=this.backoff.duration();q("will wait %dms before reconnect attempt",ae),this._reconnecting=!0;const Ne=this.setTimeoutFn(()=>{K.skipReconnect||(q("attempting reconnect"),this.emitReserved("reconnect_attempt",K.backoff.attempts),!K.skipReconnect&&K.open(nt=>{nt?(q("reconnect attempt error"),K._reconnecting=!1,K.reconnect(),this.emitReserved("reconnect_error",nt)):(q("reconnect success"),K.onreconnect())}))},ae);this.opts.autoUnref&&Ne.unref(),this.subs.push(function(){clearTimeout(Ne)})}}onreconnect(){const K=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",K)}}},18:(Et,Re)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.on=void 0,Re.on=function(Le,Je,qe){return Le.on(Je,qe),function(){Le.off(Je,qe)}}},857:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.Socket=void 0;const Le=Ie(712),Je=Ie(18),qe=Ie(918),d=Ie(36)("socket.io-client:socket"),Pe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});Re.Socket=class extends qe.StrictEventEmitter{constructor(q,ne,ye){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=q,this.nsp=ne,ye&&ye.auth&&(this.auth=ye.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const q=this.io;this.subs=[(0,Je.on)(q,"open",this.onopen.bind(this)),(0,Je.on)(q,"packet",this.onpacket.bind(this)),(0,Je.on)(q,"error",this.onerror.bind(this)),(0,Je.on)(q,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...q){return q.unshift("message"),this.emit.apply(this,q),this}emit(q,...ne){if(Pe.hasOwnProperty(q))throw new Error('"'+q+'" is a reserved event name');ne.unshift(q);const ye={type:Le.PacketType.EVENT,data:ne,options:{}};return ye.options.compress=!1!==this.flags.compress,"function"==typeof ne[ne.length-1]&&(d("emitting packet with ack id %d",this.ids),this.acks[this.ids]=ne.pop(),ye.id=this.ids++),!this.flags.volatile||this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable&&this.connected?this.connected?this.packet(ye):this.sendBuffer.push(ye):d("discard packet as the transport is not currently writable"),this.flags={},this}packet(q){q.nsp=this.nsp,this.io._packet(q)}onopen(){d("transport is open - connecting"),"function"==typeof this.auth?this.auth(q=>{this.packet({type:Le.PacketType.CONNECT,data:q})}):this.packet({type:Le.PacketType.CONNECT,data:this.auth})}onerror(q){this.connected||this.emitReserved("connect_error",q)}onclose(q){d("close (%s)",q),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",q)}onpacket(q){if(q.nsp===this.nsp)switch(q.type){case Le.PacketType.CONNECT:q.data&&q.data.sid?this.onconnect(q.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Le.PacketType.EVENT:case Le.PacketType.BINARY_EVENT:this.onevent(q);break;case Le.PacketType.ACK:case Le.PacketType.BINARY_ACK:this.onack(q);break;case Le.PacketType.DISCONNECT:this.ondisconnect();break;case Le.PacketType.CONNECT_ERROR:const ye=new Error(q.data.message);ye.data=q.data.data,this.emitReserved("connect_error",ye)}}onevent(q){const ne=q.data||[];d("emitting event %j",ne),null!=q.id&&(d("attaching ack callback to event"),ne.push(this.ack(q.id))),this.connected?this.emitEvent(ne):this.receiveBuffer.push(Object.freeze(ne))}emitEvent(q){if(this._anyListeners&&this._anyListeners.length){const ne=this._anyListeners.slice();for(const ye of ne)ye.apply(this,q)}super.emit.apply(this,q)}ack(q){const ne=this;let ye=!1;return function(...K){ye||(ye=!0,d("sending ack %j",K),ne.packet({type:Le.PacketType.ACK,id:q,data:K}))}}onack(q){const ne=this.acks[q.id];"function"==typeof ne?(d("calling ack %s with %j",q.id,q.data),ne.apply(this,q.data),delete this.acks[q.id]):d("bad ack %s",q.id)}onconnect(q){d("socket connected with id %s",q),this.id=q,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(q=>this.emitEvent(q)),this.receiveBuffer=[],this.sendBuffer.forEach(q=>this.packet(q)),this.sendBuffer=[]}ondisconnect(){d("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(q=>q()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(d("performing disconnect (%s)",this.nsp),this.packet({type:Le.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(q){return this.flags.compress=q,this}get volatile(){return this.flags.volatile=!0,this}onAny(q){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(q),this}prependAny(q){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(q),this}offAny(q){if(!this._anyListeners)return this;if(q){const ne=this._anyListeners;for(let ye=0;ye<ne.length;ye++)if(q===ne[ye])return ne.splice(ye,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}},918:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.StrictEventEmitter=void 0;const Le=Ie(899);Re.StrictEventEmitter=class extends Le{on(d,Pe){return super.on(d,Pe),this}once(d,Pe){return super.once(d,Pe),this}emit(d,...Pe){return super.emit(d,...Pe),this}emitReserved(d,...Pe){return super.emit(d,...Pe),this}listeners(d){return super.listeners(d)}}},390:(Et,Re,Ie)=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0}),Re.url=void 0;const Le=Ie(171),Je=Ie(36)("socket.io-client:url");Re.url=function(d,Pe="",Be){let Me=d;Be=Be||"undefined"!=typeof location&&location,null==d&&(d=Be.protocol+"//"+Be.host),"string"==typeof d&&("/"===d.charAt(0)&&(d="/"===d.charAt(1)?Be.protocol+d:Be.host+d),/^(https?|wss?):\/\//.test(d)||(Je("protocol-less url %s",d),d=void 0!==Be?Be.protocol+"//"+d:"https://"+d),Je("parse %s",d),Me=Le(d)),Me.port||(/^(http|ws)$/.test(Me.protocol)?Me.port="80":/^(http|ws)s$/.test(Me.protocol)&&(Me.port="443")),Me.path=Me.path||"/";const ne=-1!==Me.host.indexOf(":")?"["+Me.host+"]":Me.host;return Me.id=Me.protocol+"://"+ne+":"+Me.port+Pe,Me.href=Me.protocol+"://"+ne+(Be&&Be.port===Me.port?"":":"+Me.port),Me}}},Et=>{Et(Et.s=949)}]);